(function() {function k(){return function(){}}function s(a){return function(){return this[a]}}function t(a){return function(){return a}}var y,aa,C,D,E,ba,ca,fa,ga,ha,ia,G,ja,I,ka,na,oa,pa,qa,ra,sa,ta,ua,va,wa,xa,ya,za,Aa,Ba=300,Ca=300,Da=300,Ea=20,Fa=300,Ga=2E3,Ha=600,Ia=150,Ja=1200,Ka=500,La=function(){var a=document.createElement("div"),b=!1;["Moz","Webkit","ms"].forEach(function(c){b|=c+"Animation"in a.style});return!!b}(),Ma=document.createElement("input");Ma.setAttribute("type","file");
var Na="undefined"!==typeof File,Oa=!1===Ma.disabled&&Na,Pa=1<window.devicePixelRatio?"@2x":"",Qa=window.navigator.userAgent.match(/Macintosh/)?!0:!1,Ra=230/24,Sa="d3e460 3589a1 8bcfb1 8bcfb1 de5947 ab7253 ee826d 9d427a 969db1 54a4a5 be842e 318ba2 f3bc33 df5a46 54a4a5 9f437b df5a46 ee826c f3bc33 b7a77f 8cccaf f3bc33 f3bc33 54a4a5 318ba2 8cccaf".split(" "),Ta=function(){var a=document.createElement("div"),b=!1;["Moz","Webkit","ms"].forEach(function(c){b|=c+"Transition"in a.style});return!!b}(),Va=
[5,4,3,2,1,0.67,0.5,0.333,0.25,0.1667,0.125],Wa=0,Xa=1,Ya=2,Za=3,$a=4,ab=5,bb=6,cb=7,db=[{he:"Sans-serif",zc:"sans-serif",Ob:[{k:"Allerta Stencil",url:"//fonts.googleapis.com/css?family=Allerta+Stencil",m:"AllertaStencil-Regular"},{k:"Antic",url:"//fonts.googleapis.com/css?family=Antic",m:"Antic-Regular"},{k:"Archivo Narrow",url:"//fonts.googleapis.com/css?family=Archivo+Narrow:400,400italic,700,700italic",m:"ArchivoNarrow-Regular"},{k:"Carter One",url:"//fonts.googleapis.com/css?family=Carter+One",
m:"CarterOne"},{k:"Fredoka One",url:"//fonts.googleapis.com/css?family=Fredoka+One",m:"FredokaOne-Regular"},{k:"Hammersmith One",url:"//fonts.googleapis.com/css?family=Hammersmith+One",m:"HammersmithOne"},{k:"Helvetica",m:"Helvetica"},{k:"Josefin Sans",url:"//fonts.googleapis.com/css?family=Josefin+Sans:400,700,400italic,700italic",m:"JosefinSans"},{k:"Limelight",url:"//fonts.googleapis.com/css?family=Limelight",m:"Limelight"},{name:"PT Sans",url:"//fonts.googleapis.com/css?family=PT+Sans:400,700,400italic,700italic",
m:"PTSans-Regular"},{k:"Nunito",url:"//fonts.googleapis.com/css?family=Nunito:300,700",m:"Nunito-Regular"},{k:"Raleway",url:"//fonts.googleapis.com/css?family=Raleway:100,400,700,900",m:"Raleway"},{name:"Raleway Ultra-Light",k:"Raleway",url:"//fonts.googleapis.com/css?family=Raleway:100,400,700,900",be:"100",m:"Raleway-ExtraLight"},{name:"Raleway Ultra-Bold",k:"Raleway",url:"//fonts.googleapis.com/css?family=Raleway:100,400,700,900",be:"900",m:"Raleway-ExtraBold"},{k:"Roboto Condensed",url:"//fonts.googleapis.com/css?family=Roboto+Condensed:400italic,700italic,400,700",
m:"RobotoCondensed-Regular"},{k:"Rosario",url:"//fonts.googleapis.com/css?family=Rosario:400,400italic,700,700italic",m:"Rosario-Bold"},{k:"Amaranth",url:"//fonts.googleapis.com/css?family=Amaranth",m:"Amaranth"},{k:"Anton",url:"//fonts.googleapis.com/css?family=Anton",m:"Anton"},{k:"Arimo",url:"//fonts.googleapis.com/css?family=Arimo",m:"Arimo"},{k:"Crushed",url:"//fonts.googleapis.com/css?family=Crushed",m:"Crushed-Regular"},{k:"Economica",url:"//fonts.googleapis.com/css?family=Economica",m:"Economica-Regular"},
{k:"Gruppo",url:"//fonts.googleapis.com/css?family=Gruppo",m:"Gruppo"},{k:"Julius Sans One",url:"//fonts.googleapis.com/css?family=Julius+Sans+One",m:"JuliusSansOne-Regular"},{k:"Kite One",url:"//fonts.googleapis.com/css?family=Kite+One",m:"KiteOne-Regular"},{k:"Lilita One",url:"//fonts.googleapis.com/css?family=Lilita+One",m:"LilitaOne"},{k:"Open Sans",url:"//fonts.googleapis.com/css?family=Open+Sans",m:"OpenSans"},{k:"Racing Sans One",url:"//fonts.googleapis.com/css?family=Racing+Sans+One",m:"RacingSansOne-Regular"},
{k:"Roboto",url:"//fonts.googleapis.com/css?family=Roboto",m:"Roboto-Regular"},{k:"Ubuntu",url:"//fonts.googleapis.com/css?family=Ubuntu",m:"Ubuntu"},{k:"Six Caps",url:"//fonts.googleapis.com/css?family=Six+Caps",m:"SixCaps"},{k:"Text Me One",url:"//fonts.googleapis.com/css?family=Text+Me+One",m:"TextMeOne-Regular"}]},{he:"Serif",zc:"serif",Ob:[{k:"Abril Fatface",url:"//fonts.googleapis.com/css?family=Abril+Fatface",m:"AbrilFatface-Regular"},{name:"Alegreya Small Caps",k:"Alegreya SC",url:"//fonts.googleapis.com/css?family=Alegreya+SC:400,400italic,700,700italic",
m:"AlegreyaSC-Regular"},{k:"Alfa Slab One",url:"//fonts.googleapis.com/css?family=Alfa+Slab+One",m:"AlfaSlabOne-Regular"},{k:"Alike",url:"//fonts.googleapis.com/css?family=Alike",m:"Alike-Regular"},{k:"Anonymous Pro",url:"//fonts.googleapis.com/css?family=Anonymous+Pro:400,400italic,700,700italic",m:"AnonymousPro"},{k:"Arvo",url:"//fonts.googleapis.com/css?family=Arvo:400,700,400italic,700italic",m:"Arvo"},{k:"Cinzel",url:"//fonts.googleapis.com/css?family=Cinzel:400,700",m:"Cinzel-Regular"},{k:"Droid Serif",
url:"//fonts.googleapis.com/css?family=Droid+Serif:400,700,400italic,700italic",m:"DroidSerif"},{k:"Glegoo",url:"//fonts.googleapis.com/css?family=Glegoo",m:"Glegoo-Regular"},{name:"IM Fell English Small Caps",k:"IM Fell English SC",url:"//fonts.googleapis.com/css?family=IM+Fell+English+SC",m:"IM_FELL_English_SC"},{k:"Libre Baskerville",url:"//fonts.googleapis.com/css?family=Libre+Baskerville:400,700,400italic",m:"LibreBaskerville-Regular"},{k:"Lora",url:"//fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic",
m:"Lora"},{k:"Lustria",url:"//fonts.googleapis.com/css?family=Lustria",m:"Lustria-Regular"},{k:"Nixie One",url:"//fonts.googleapis.com/css?family=Nixie+One",m:"NixieOne-Regular"},{name:"Playfair Small Caps",k:"Playfair Display SC",url:"//fonts.googleapis.com/css?family=Playfair+Display+SC:400,400italic,700,700italic",m:"PlayfairDisplaySC-Regular"},{k:"Prata",url:"//fonts.googleapis.com/css?family=Prata",m:"Prata-Regular"},{k:"PT Serif",url:"//fonts.googleapis.com/css?family=PT+Serif:400,700,400italic,700italic",
m:"PTSerif-Regular"},{k:"Quando",url:"//fonts.googleapis.com/css?family=Quando",m:"Quando-Regular"},{k:"Quattrocento",url:"//fonts.googleapis.com/css?family=Quattrocento:400,700",m:"Quattrocento"},{k:"Sanchez",url:"//fonts.googleapis.com/css?family=Sanchez:400italic,400",m:"Sanchez-Regular"},{k:"Times New Roman",m:"TimesNewRomanPSMT"},{k:"Trocchi",url:"//fonts.googleapis.com/css?family=Trocchi",m:"Trocchi"},{k:"Ultra",url:"//fonts.googleapis.com/css?family=Ultra",m:"Ultra"},{k:"Vidaloka",url:"//fonts.googleapis.com/css?family=Vidaloka",
m:"Vidaloka-Regular"},{k:"Cantora One",url:"//fonts.googleapis.com/css?family=Cantora+One",m:"CantoraOne-Regular"},{k:"Coustard",url:"//fonts.googleapis.com/css?family=Coustard",m:"Coustard"},{k:"Emilys Candy",url:"//fonts.googleapis.com/css?family=Emilys+Candy",m:"EmilysCandy-Regular"},{k:"Glass Antiqua",url:"//fonts.googleapis.com/css?family=Glass+Antiqua",m:"GlassAntiqua-Regular"},{k:"Graduate",url:"//fonts.googleapis.com/css?family=Graduate",m:"Graduate-Regular"},{k:"Ribeye",url:"//fonts.googleapis.com/css?family=Ribeye",
m:"Ribeye-Regular"},{k:"Vast Shadow",url:"//fonts.googleapis.com/css?family=Vast+Shadow",m:"VastShadow-Regular"}]},{he:"Handwritten",zc:"cursive",Ob:[{k:"Gochi Hand",url:"//fonts.googleapis.com/css?family=Gochi+Hand",m:"GochiHand-Regular"},{k:"Over The Rainbow",url:"//fonts.googleapis.com/css?family=Over+the+Rainbow",m:"OvertheRainbow"},{k:"Permanent Marker",url:"//fonts.googleapis.com/css?family=Permanent+Marker",m:"PermanentMarker"},{k:"Sacramento",url:"//fonts.googleapis.com/css?family=Sacramento",
m:"Sacramento-Regular"},{k:"Schoolbell",url:"//fonts.googleapis.com/css?family=Schoolbell",m:"Schoolbell"},{name:"Shadows Into Light",k:"Shadows Into Light Two",url:"//fonts.googleapis.com/css?family=Shadows+Into+Light+Two",m:"ShadowsIntoLight"},{name:"Amatic Small Caps",k:"Amatic SC",url:"//fonts.googleapis.com/css?family=Amatic+SC",m:"AmaticSC-Regular"},{k:"Architects Daughter",url:"//fonts.googleapis.com/css?family=Architects+Daughter",m:"ArchitectsDaughter"},{k:"Cabin Sketch",url:"//fonts.googleapis.com/css?family=Cabin+Sketch",
m:"CabinSketch-Regular"},{k:"Coming Soon",url:"//fonts.googleapis.com/css?family=Coming+Soon",m:"ComingSoon"}]},{he:"Script",zc:"cursive",Ob:[{k:"Allura",url:"//fonts.googleapis.com/css?family=Allura",m:"Allura-Regular"},{k:"Clicker Script",url:"//fonts.googleapis.com/css?family=Clicker+Script",m:"ClickerScript-Regular"},{k:"Courgette",url:"//fonts.googleapis.com/css?family=Courgette",m:"Courgette-Regular"},{k:"Great Vibes",url:"//fonts.googleapis.com/css?family=Great+Vibes",m:"GreatVibes-Regular"},
{k:"Mr Dafoe",url:"//fonts.googleapis.com/css?family=Mr+Dafoe",m:"MrDafoe-Regular"},{k:"Niconne",url:"//fonts.googleapis.com/css?family=Niconne",m:"Niconne-Regular"},{k:"Parisienne",url:"//fonts.googleapis.com/css?family=Parisienne",m:"Parisienne-Regular"},{k:"Pinyon Script",url:"//fonts.googleapis.com/css?family=Pinyon+Script",m:"PinyonScript"},{k:"Dr Sugiyama",url:"//fonts.googleapis.com/css?family=Dr+Sugiyama",m:"DrSugiyama-Regular"},{k:"Grand Hotel",url:"//fonts.googleapis.com/css?family=Grand+Hotel",
m:"GrandHotel-Regular"},{k:"Knewave",url:"//fonts.googleapis.com/css?family=Knewave",m:"Knewave-Regular"},{k:"Pacifico",url:"//fonts.googleapis.com/css?family=Pacifico",m:"Pacifico-Regular"},{k:"Princess Sofia",url:"//fonts.googleapis.com/css?family=Princess+Sofia",m:"PrincessSofia"},{k:"Satisfy",url:"//fonts.googleapis.com/css?family=Satisfy",m:"Satisfy"},{k:"Yellowtail",url:"//fonts.googleapis.com/css?family=Yellowtail",m:"Yellowtail"}]},{he:"Fun & Fancy",zc:"fantasy",Ob:[{k:"Berkshire Swash",url:"//fonts.googleapis.com/css?family=Berkshire+Swash",
m:"BerkshireSwash-Regular"},{k:"Black Ops One",url:"//fonts.googleapis.com/css?family=Black+Ops+One",m:"BlackOpsOne-Regular"},{k:"Chewy",url:"//fonts.googleapis.com/css?family=Chewy",m:"Chewy"},{k:"Creepster",url:"//fonts.googleapis.com/css?family=Creepster",m:"Creepster-Regular"},{name:"Diplomata Small Caps",k:"Diplomata SC",url:"//fonts.googleapis.com/css?family=Diplomata+SC",m:"DiplomataSC-Regular"},{k:"Germania One",url:"//fonts.googleapis.com/css?family=Germania+One",m:"GermaniaOne-Regular"},
{k:"Megrim",url:"//fonts.googleapis.com/css?family=Megrim",m:"Megrim"},{k:"Rye",url:"//fonts.googleapis.com/css?family=Rye",m:"Rye-Regular"},{k:"UnifrakturMaguntia",url:"//fonts.googleapis.com/css?family=UnifrakturMaguntia",m:"UnifrakturMaguntia"},{k:"Codystar",url:"//fonts.googleapis.com/css?family=Codystar",m:"Codystar"},{k:"Crafty Girls",url:"//fonts.googleapis.com/css?family=Crafty+Girls",m:"CraftyGirls"},{k:"Lobster",url:"//fonts.googleapis.com/css?family=Lobster",m:"Lobster"},{k:"Londrina Shadow",
url:"//fonts.googleapis.com/css?family=Londrina+Shadow",m:"LondrinaShadow-Regular"},{k:"Londrina Sketch",url:"//fonts.googleapis.com/css?family=Londrina+Sketch",m:"LondrinaSketch-Regular"},{k:"Oregano",url:"//fonts.googleapis.com/css?family=Oregano",m:"Oregano-Regular"},{k:"Sniglet",url:"//fonts.googleapis.com/css?family=Sniglet:800",m:"Sniglet"},{k:"Special Elite",url:"//fonts.googleapis.com/css?family=Special+Elite",m:"SpecialElite-Regular"},{k:"Vampiro One",url:"//fonts.googleapis.com/css?family=Vampiro+One",
m:"VampiroOne-Regular"},{k:"VT323",url:"//fonts.googleapis.com/css?family=VT323",m:"VT323"}]}],eb="#000000 #ffffff #cc0000 #ffcc00 #009900 #0066cc".split(" ");var L="undefined"!==typeof _&&"undefined"!==typeof Backbone&&_.extend({},Backbone.Events);function fb(){this.Qa=null}fb.prototype.cancel=function(){this.Qa&&(this.Qa.abort(),this.Qa=null)};fb.prototype.finish=function(){this.Qa=null};function gb(){this.ac={}}function ib(a){var b=a.indexOf("/",1);return-1==b?a:a.substring(0,b)}gb.prototype.get=function(a,b){var c=new fb;jb(this,"GET",a,null,c,null,b);return c};gb.prototype.post=function(a,b,c,d){var e=new fb;kb(this,"POST",a,b,0,e,c,d);return e};gb.prototype.Jg=function(a,b){var c=new fb;kb(this,"DELETE",a,null,0,c,null,b);return c};
function kb(a,b,c,d,e,f,g,h){var l=ib(c);if(l in a.ac){var m=a,n=m.ac[l];jb(m,b,c,d,f,g,function(a,q){418==a&&1>e?(m.ac[l]==n&&delete m.ac[l],kb(m,b,c,d,e+1,f,g,h)):(h&&h(a,q),f.finish())})}else{var m=a;jb(m,"GET","/csrf"+l,null,f,null,function(a,n){200==a?(l in m.ac||(m.ac[l]=n),kb(m,b,c,d,e,f,g,h)):(h(a,null),f.finish())})}}
function jb(a,b,c,d,e,f,g){var h=e.Qa=new XMLHttpRequest;h.open(b,"/_ajax"+c,!0);c=ib(c);"GET"!=b&&c in a.ac&&h.setRequestHeader("X-Csrf-Token",a.ac[c]);null===d?a=null:"object"==typeof d&&"undefined"!==typeof File&&d.constructor==File?(h.setRequestHeader("Content-Type",d.type),f&&h.upload.addEventListener("progress",f,!1),a=d):(h.setRequestHeader("Content-Type","application/json;charset=UTF-8"),a=JSON.stringify(d));h.onreadystatechange=function(){if(4==h.readyState){var a,b,c;try{a=h.status,b=h.responseText.trim()}catch(d){if(d.message&&
d.message.match(/c00c023f/))a=0,b="";else throw d;}var f=b.substring(0,20);if(0<f.length){if("'\"])}while(1);</x>//"!=f){g(500,null);e.finish();return}b=b.substring(20);try{c=JSON.parse(b)}catch(u){g(500,null);e.finish();return}}else c=null;g(a,c);e.finish()}};h.send(a)};function lb(a){this.Kd=null;this.O=a;this.Qa=null}lb.prototype.start=function(){if(null==this.Kd){var a=this;this.Kd=window.setInterval(function(){mb(a)},3E5)}};lb.prototype.stop=function(){null!=this.Kd&&(window.clearInterval(this.Kd),this.Kd=null)};
function mb(a){a.Qa&&a.Qa.cancel();a.Qa=a.O.get("/alerts/active",function(a,c){this.Qa=null;if(200==a){var d=$("#systemAlert");c?(0==d.length&&($("body").addClass("alert"),d=$('<div id="systemAlert"><p><span></span> <a href="#">Hide</a></p></div>'),d.appendTo($("body")),nb(d)),d.find("span").text(c)):(d.remove(),$("body").removeClass("alert"))}})}function nb(a){a.on("click",function(){a.remove();$("body").removeClass("alert");return!1})}$(function(){var a=new lb(new gb);nb($("#systemAlert"));a.start()});function ob(a){this.fa=a;this.oe=a.l();this.pe=a.j();this.Mg=this.Lg=0;if(a.$b){var b=a.pd;this.oe=b.l();this.pe=b.j();this.Lg=(b.l()-a.l())*N;this.Mg=(b.j()-a.j())*N}}y=ob.prototype;y.Z=function(){var a=this.fa.Z()+this.Lg,b=this.fa.U().l()*N;return a+b};y.ga=function(){var a=this.fa.ga()+this.Mg,b=this.fa.U().j()*N;return a+b};y.l=function(){return this.fa.U().l()+this.oe};y.V=ob.prototype.l;y.j=function(){return this.fa.U().j()+this.pe};y.Q=ob.prototype.j;y.g=function(){return this.fa.U().g()};
y.Fa=ob.prototype.g;y.h=function(){return this.fa.U().h()};y.Ca=ob.prototype.h;y.W=function(){return this.l()+this.g()};y.Da=ob.prototype.W;y.G=function(){return this.j()+this.h()};y.Y=ob.prototype.G;y.Bc=function(){return this.j()+this.h()/2};y.Qb=function(){return this.l()+this.g()/2};y.qa=t(0);y.setSize=function(a,b){var c=this.fa.U();c.D(a);c.q(b);pb(this.fa,c)};y.D=function(a){var b=this.fa.U();b.D(a);pb(this.fa,b)};y.q=function(a){var b=this.fa.U();b.q(a);pb(this.fa,b)};
y.S=function(a){var b=this.fa.U();b.S(a-this.oe);pb(this.fa,b)};y.P=function(a){var b=this.fa.U();b.P(a-this.pe);pb(this.fa,b)};y.oa=function(a,b){var c=this.fa.U();c.oa(a-this.oe,b-this.pe);pb(this.fa,c)};function qb(a){this.Ya=a;a=Array.min(this.Ya.map(function(a){return a.V()}));var b=Array.max(this.Ya.map(function(a){return a.Da()})),c=Array.min(this.Ya.map(function(a){return a.Q()})),d=Array.max(this.Ya.map(function(a){return a.Y()}));this.width=b-a;this.height=d-c}y=qb.prototype;y.Z=function(){return Array.min(this.Ya.map(function(a){return a.Z()}))};
y.ga=function(){return Array.min(this.Ya.map(function(a){return a.ga()}))};y.l=function(){return Array.min(this.Ya.map(function(a){return a.V()}))};y.V=qb.prototype.l;y.j=function(){return Array.min(this.Ya.map(function(a){return a.Q()}))};y.Q=qb.prototype.j;y.g=s("width");y.Fa=qb.prototype.g;y.h=s("height");y.Ca=qb.prototype.h;y.W=function(){return this.l()+this.g()};y.Da=qb.prototype.W;y.G=function(){return this.j()+this.h()};y.Y=qb.prototype.G;y.Bc=function(){return this.j()+this.h()/2};
y.Qb=function(){return this.l()+this.g()/2};y.qa=t(0);y.v=function(){return this.Ya[0].v()};y.setSize=k();y.D=k();y.q=k();y.S=function(a){var b=a-this.l();this.Ya.forEach(function(a){a.S(a.l()+b)})};y.P=function(a){var b=a-this.j();this.Ya.forEach(function(a){a.P(a.j()+b)})};y.oa=function(a,b){var c=a-this.l(),d=b-this.j();this.Ya.forEach(function(a){a.oa(a.l()+c,a.j()+d)})};function rb(a,b){this.elem=a;this.cd=b;this.height=a.height();this.width=a.width()}y=rb.prototype;
y.Z=function(){return parseInt(this.elem.css("left"),10)+$("#canvaDocument").scrollLeft()-$("#canvaDocument").offset().left};y.ga=function(){return parseInt(this.elem.css("top"),10)+$("#canvaDocument").scrollTop()};y.l=function(){return(parseInt(this.elem.css("left"),10)-this.cd.left)/N};y.V=rb.prototype.l;y.j=function(){return(parseInt(this.elem.css("top"),10)-this.cd.top)/N};y.Q=rb.prototype.j;y.g=function(){return this.width/N};y.Fa=rb.prototype.g;y.h=function(){return this.height/N};y.Ca=rb.prototype.h;
y.W=function(){return this.l()+this.g()};y.Da=rb.prototype.W;y.G=function(){return this.j()+this.h()};y.Y=rb.prototype.G;y.Bc=function(){return this.j()+this.h()/2};y.Qb=function(){return this.l()+this.g()/2};y.qa=t(0);y.setSize=k();y.D=k();y.q=k();y.S=function(a){this.elem.css("left",a*N+this.cd.left)};y.P=function(a){this.elem.css("top",a*N+this.cd.top)};y.oa=function(a,b){this.elem.css("left",a*N+this.cd.left).css("top",b*N+this.cd.top)};function sb(a){this.gc=a;this.bc=this.Pf=null}
function tb(){var a=window.analyticsToken,b=window.analyticsUser,c;if(window.analyticsEnabled)c={track:function(a,b,c){window.mixpanel&&window.mixpanel.track(a,b,c)},ae:function(c,d){d.distinct_id=b;d.token=a;var g="//api.mixpanel.com/track/?data="+window.btoa(JSON.stringify({event:c,properties:d}))+"&ip=1";$.ajax({url:g,async:!1})},init:function(a){window.mixpanel&&window.mixpanel.init(a)},identify:function(a){window.mixpanel&&window.mixpanel.identify(a)},alias:function(a){window.mixpanel&&window.mixpanel.alias(a)},
get_distinct_id:function(){return window.mixpanel&&window.mixpanel.get_distinct_id()},name_tag:function(a){window.mixpanel&&window.mixpanel.name_tag(a)},people:{increment:function(a,b){window.mixpanel&&window.mixpanel.people.increment(a,b)},set:function(a,b){window.mixpanel&&window.mixpanel.people.set(a,b)}},gj:function(){return window.mixpanel&&window.mixpanel.get_distinct_id}};else{var d=null;window.setTimeout(function(){window.console&&window.console.log("analytics:loaded");d=Math.random().toString(36).substring(2)},
1E3);c={track:function(a,b,c){window.console&&window.console.log("analytics:track",d,a,b);c&&window.setTimeout(c,0)},ae:function(a,b){window.console&&window.console.log("analytics:trackNow",d,a,b)},init:function(){window.console&&window.console.log("analytics:init")},identify:function(a){d=a;window.console&&window.console.log("analytics:identify",d)},alias:function(a){window.console&&window.console.log("analytics:alias",d,a)},get_distinct_id:function(){return d},people:{increment:function(a,b){window.console&&
window.console.log("analytics:increment",d,a,b)},set:function(a,b){window.console&&window.console.log("analytics:set",d,a);b&&window.setTimeout(b,0)}},name_tag:function(a){window.console&&window.console.log("analytics:name_tag",d,a)},gj:function(){return null!=d}}}c.init(a);b&&c.identify(b);return new sb(c)}y=sb.prototype;y.track=function(a,b,c){null!=this.bc&&(b?b.design=this.bc:b={design:this.bc});this.gc.track(a,b,c)};y.identify=function(a){if(-1!=a.indexOf("@"))throw"not an id";this.gc.identify(a)};
y.alias=function(a){this.gc.alias(a)};y.set=function(a,b){this.gc.people.set(a,b)};y.increment=function(a,b){this.gc.people.increment(a,b)};y.ae=function(a,b){null!=this.bc&&(null==b?b={design:this.bc}:b.design=this.bc);this.gc.ae(a,b)};function ub(a){var b=I;b.gc.track("design_open",{design:a});b.bc=a;b.Pf=Date.now()};function vb(a){this.O=a}function wb(a,b){return va.O.post("/billing/create_acc?stripeToken="+encodeURIComponent(a),{},null,function(a,d){b(a,200==a?null:d.error.message)})}vb.prototype.te=function(a,b){return this.O.get("/billing/"+encodeURIComponent(a),function(a,d){var e=200==a?yb(d):null;b&&b(a,e)})};vb.prototype.Qd=function(a,b,c){return this.O.post("/billing/\t"+encodeURIComponent(a),b,null,function(a,b){var f=b?yb(b):null;c&&c(a,f)})};
function zb(){this.contributorName=this.title=this.thumbnail="";this.price=0;this.sessionCreationDate=null}zb.prototype.Ea=s("title");function Ab(a){return a?$.extend(new zb,a):null}function Bb(){this.newItems=[];this.paidItems=[];this.creditBalance=0;this.creditCard=null;this.documentVersion=0}function Cb(a){return a.newItems}function Db(a){return a.newItems.reduce(function(a,c){return a+c.price},0)}
function Eb(a){a=a.paidItems.filter(function(a){return 0!==a.price&&null!==a.sessionCreationDate});if(0==a.length)return null;a=a.map(function(a){return a.sessionCreationDate});return Math.min.apply(Math,a)}function yb(a){if(!a)return null;a=$.extend(new Bb,a);a.newItems&&(a.newItems=a.newItems?a.newItems.map(Ab):null);a.paidItems&&(a.paidItems=a.paidItems?a.paidItems.map(Ab):null);return a};function O(a,b,c,d){this.left=a;this.top=b;this.width=c;this.height=d}function Fb(a){return new O(a.left||0,a.top||0,a.width||0,a.height||0)}y=O.prototype;y.clone=function(){return new O(this.left,this.top,this.width,this.height)};y.Pg=function(a){return null===a?!1:this.left===a.left&&this.top===a.top&&this.width===a.width&&this.height===a.height};y.l=s("left");y.V=O.prototype.l;y.j=s("top");y.Q=O.prototype.j;y.W=function(){return this.left+this.width};y.Da=O.prototype.W;
y.G=function(){return this.top+this.height};y.Y=O.prototype.G;y.g=s("width");y.Fa=O.prototype.g;y.h=s("height");y.Ca=O.prototype.h;function Gb(a){return{x:a.left+a.width/2,y:a.top+a.height/2}}y.S=function(a){this.left=a;return this};y.P=function(a){this.top=a;return this};y.oa=function(a,b){this.left=a;this.top=b;return this};y.D=function(a){this.width=a;return this};y.q=function(a){this.height=a;return this};y.setSize=function(a,b){this.width=a;this.height=b;return this};
y.translate=function(a,b){this.left+=a;this.top+=b;return this};y.scale=function(a,b){void 0===b&&(b=a);this.left*=a;this.top*=b;this.width*=a;this.height*=b;return this};function Hb(a){var b=Ib;a.left+=b;a.top+=b;a.width-=b;a.height-=b}y.ie=function(a){this.left=a.left-(this.width-a.width)/2;this.top=a.top-(this.height-a.height)/2;return this};
function Jb(a,b){var c=a.width/a.height;a.width/a.height>b.width/b.height?(a.height=b.height,a.width=c*a.height):(a.width=b.width,a.height=a.width/c);a.ie(b);return a}function Kb(a,b){var c=a.width/a.height;a.width/a.height<b.width/b.height?(a.height=b.height,a.width=c*a.height):(a.width=b.width,a.height=a.width/c);a.ie(b)}y.round=function(){this.left=Math.round(this.left);this.top=Math.round(this.top);this.width=Math.round(this.width);this.height=Math.round(this.height);return this};
y.serialize=function(){return{left:this.left,top:this.top,width:this.width,height:this.height}};function Lb(a,b){return a.W()<=b.l()||a.G()<=b.j()||a.l()>=b.W()||a.j()>=b.G()?!1:!0}function Mb(a,b,c){a.width+=b;a.height+=c;return a};function Nb(a,b,c){function d(a,b,c){0>c&&(c+=1);1<c&&(c-=1);return c<1/6?a+6*(b-a)*c:0.5>c?b:c<2/3?a+6*(b-a)*(2/3-c):a}if(0==b)c=b=a=c;else{var e=0.5>c?c*(1+b):c+b-c*b,f=2*c-e;c=d(f,e,a+1/3);b=d(f,e,a);a=d(f,e,a-1/3)}return[255*c,255*b,255*a]}function Ob(a){var b=/^hsl\((\d{1,3}\.?\d*),\s*(\d{1,3}\.?\d*)%,\s*(\d{1,3}\.?\d*)%\)/;if(!a.match(b))return null;a=a.match(b);return[parseFloat(a[1]),parseFloat(a[2]),parseFloat(a[3])]}
function Pb(a){a=Ob(a);return null==a?null:"#"+Nb(a[0]/360,a[1]/100,a[2]/100).map(function(a){a=Math.round(a).toString(16);2>a.length&&(a="0"+a);return a}).join("")}
function Qb(a){if(void 0===a)return null;var b=/^hsl\((\d{1,3}\.?\d*),\s*(\d{1,3}\.?\d*)%,\s*(\d{1,3}\.?\d*)%\)/;if(a.match(/^#[0-9A-F]{6}/i)){var c,b=parseInt(a.substr(1,2),16),d=parseInt(a.substr(3,2),16);a=parseInt(a.substr(5,2),16);b/=255;d/=255;a/=255;var e=Math.max(b,d,a),f=Math.min(b,d,a),g=(e+f)/2;if(e==f)c=f=0;else{var h=e-f,f=0.5<g?h/(2-e-f):h/(e+f);switch(e){case b:c=(d-a)/h+(d<a?6:0);break;case d:c=(a-b)/h+2;break;case a:c=(b-d)/h+4}c/=6}c=[c,f,g];e=360*c[0];g=100*c[1];a=100*c[2]}else if(a.match(b))c=
Ob(a),e=c[0],g=c[1],a=c[2];else return null;e=Math.round(e);g=Math.round(g);a=Math.round(a);c=e;b=g/100;d=1-a/(100-50*b);h=Math.round(100-50*b);a="hsl("+e+","+g+"%,"+a+"%)";e="hsl("+e+","+g+"%,"+h+"%)";g=Math.min(90,100*b)*Math.cos(c*Math.PI/180);h=Math.min(90,100*b)*Math.sin(c*Math.PI/180);g+=100;h+=100;f=Math.min(190,Math.max(10,200*d));return{color:a,Fg:e,xh:g,yh:h,ah:f,angle:c,ed:b,mf:d}}
function Rb(a){this.Xc=this.He=this.za=null;if(a)if(/^#([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/.test(a)){this.za=a;var b=a.replace(/^#/,"");this.He=[parseInt(b.substring(0,2),16),parseInt(b.substring(2,4),16),parseInt(b.substring(4,6),16)].join();this.Xc=Qb(a).color}else this.Xc=Qb(a).color,this.za=Pb(this.Xc),a=Ob(this.Xc),this.He=null==a?null:Nb(a[0]/360,a[1]/100,a[2]/100).join(",")}
function Sb(a,b){a.za=b;a.Xc=Qb(b).color;var c=b.replace(/^#/,"");a.He=[parseInt(c.substring(0,2),16),parseInt(c.substring(2,4),16),parseInt(c.substring(4,6),16)].join();return a}function Tb(a){return a.He.split(",").map(function(a){return parseFloat(a)})}function Ub(a){return 3===Tb(a).filter(function(a){return 0<=a&&255>=a}).length}function Vb(a){return a.za}Rb.prototype.serialize=s("Xc");function Wb(){this.sb=[];var a=this;eb.forEach(function(b){b=Sb(new Rb,b);Xb(a,b)})}function Xb(a,b){!Ub(b)||0<=$b(a).indexOf(b.za)||a.sb.push(b)}Wb.prototype.unshift=function(a){!Ub(a)||0<=$b(this).indexOf(a.za)||this.sb.unshift(a)};function ac(){var a=new Wb;a.sb=[];return a}function bc(a,b){b&&b.length&&b.forEach(function(b){Xb(a,b)});return a}function cc(a){return a.sb}function $b(a){return a.sb.map(function(a){return a.za})}
Wb.prototype.serialize=function(){return this.sb.filter(function(a){return-1==eb.indexOf(a.za)}).map(function(a){return a.serialize()})};function dc(a){function b(){u&&(u=!1,$("#overlays .rotationGuide").addClass("willSnap"))}function c(a){a.shiftKey&&$("#overlays .rotationGuide").hasClass("willSnap")&&(u=!0,$("#overlays .rotationGuide").removeClass("willSnap"))}function d(a){var b=p+ec(l,m,void 0!==a.clientX?a.clientX:a.touches[0].clientX,void 0!==a.clientY?a.clientY:a.touches[0].clientY)-q;$("#overlays .rotation.align").addClass("on");var c=b%45;0>c&&(c+=45);var d=b>n.qa(),e=d&&42<c,d=!d&&3>c,f=3>c||42<c;if(a.shiftKey)x=!1,$("#overlays .rotationGuide").removeClass("willSnap"),
f||(u=!1);else{f?$("#overlays .rotationGuide").addClass("willSnap"):(x=!1,$("#overlays .rotationGuide").removeClass("willSnap"));if(x)return!1;e?(b=b+45-c,x=!0):d&&($("#overlays .rotationGuide").addClass("willSnap"),b-=c,x=!0)}a=b;$("#overlays .rotationGuide").css("transform",fc({rotate:a}));c=a=b;0>c&&(c=360+c);r.html(Math.round(c)+"&deg;").css("transform",fc({rotate:360-a}));gc(n,b);n instanceof hc&&ic(n);v||(v=!0,_gaq.push(["_trackEvent","Element","Rotated"]));return!1}function e(){w.off("mousemove|touchmove",
d).off("mouseup|touchend",e);f.removeClass("on");$(".cornerHandles .rotate").empty();$("#overlays .align").removeClass("on");$("#overlays .rotationGuide").removeClass("willSnap");$(document).off("keydown",c);$(document).off("keydown",b);if(p!=n.qa()){var a={elementIndex:n.s(),pageIndex:P(C,n.v()),"new":{rotation:n.qa()},old:{rotation:p}};Q(D,new R(jc,a))}}var f=$(this);f.addClass("on");var g=$(this).parents(".selectionBox").data("element"),h=g.offset(),l=h.left+g.width()/2,m=h.top+g.height()/2,n=
g.data("canvaElement"),p=n.qa(),q=ec(l,m,void 0!==a.clientX?a.clientX:a.touches[0].clientX,void 0!==a.clientY?a.clientY:a.touches[0].clientY),u=!1,r=$('<span class="degrees"></span>');$(".cornerHandles .rotate").append(r);kc();$(document).on("keydown",c);$(document).on("keyup",b);var w=new S($(document));w.on("mousemove|touchmove",d).on("mouseup|touchend",e);var v=!1;a=lc(n);var x=!1,g=$("#overlays").get(0).getBoundingClientRect();$("#overlays .rotation.align").first().css("left",a.x-g.left+"px").css("top",
a.y-g.top+"px");$("#overlays .rotationGuide").first().css("left",a.x-g.left+"px").css("top",a.y-g.top+"px").css("margin-top",-1*mc(n)/2+"px").css("height",mc(n)+"px");return!1};function nc(a,b){this.Qc=a;this.Yf=b}
nc.prototype.go=function(a){function b(a){var b={};b.Ed=oc?e:function(){var a=e,b=$("#canvaDocument > .inner > .page").first(),c=b.offset();$('<div id="newDocPage"></div>').css("left",$(window).width()/2).css("top",$(window).height()/2).css("width",b.width()/8).css("height",b.height()/8).appendTo("body").animate({opacity:1},{duration:250,Za:"linear",queue:!1}).animate({left:c.left,top:c.top,width:b.outerWidth(),height:b.outerHeight()},{duration:500,Za:"easeOutSine",queue:!1});a()};b.content=a;pc(b)}
function c(a){E=qc.custom;E.width=a.width;E.height=a.height;ba=E.templates.blank;ba.width=E.width;ba.height=E.height}function d(a){E=qc[a];ba=E.templates.blank}function e(){/magicButton/gi.test(f.Qc.location.search.toString())&&(new rc(C)).go();/onboarding/gi.test(f.Qc.location.search.toString())&&(new sc).go()}var f=this;if(a=a&&a.content)b(a);else a:{/onboarding/gi.test(f.Qc.location.search.toString())&&(new sc).go();if(tc(f.Qc))c(tc(f.Qc));else if(uc(f.Qc))d(uc(f.Qc));else{alert("This is a new document & there is no hash in the URL. This is strange and has caused an error. Please contact support@canva.com with details of what happened.");
break a}pc()}};function vc(a){var b=this;this.ha=qc.presentation;this.Db=this.ha.templates.blank;this.$d=a.title||"Untitled design";this.Dc=ac();this.Uc=ac();a.palette&&a.palette.length&&a.palette.forEach(function(a){var d=Sb(new Rb,a.replace(/!/,""));/^!/gi.test(a)?Xb(b.Uc,d):Xb(b.Dc,d)});this.n=[];this.Pc={title:{},subtitle:{},body:{}};$.extend(this.Pc,a.defaultFonts);this.vd={title:{fontSize:42,fontFamily:"Abril Fatface"},subtitle:{fontSize:24,fontFamily:"Trocchi"},body:{fontSize:16,fontFamily:"Helvetica"}};
$.extend(this.vd,a.canvaDefaultFonts);a.layout?(null==qc[a.layout]&&(a.layout="custom",a.template="blank"),this.ha=qc[a.layout],this.Db=this.ha.templates[a.template],"custom"==a.layout&&(this.ha.width=a.pages[0].width,this.ha.height=a.pages[0].height,this.Db.width=this.ha.width,this.Db.height=this.ha.height)):void 0!==E&&void 0!==ba&&(this.ha=E,this.Db=ba);a.pages?a.pages.forEach(function(a){b.n.push(new xc(b,a))}):this.n.push(new xc(b,this.Db));yc(this,0)}vc.prototype.trigger=Backbone.Events.trigger;
vc.prototype.on=Backbone.Events.on;vc.prototype.off=Backbone.Events.off;_.extend(vc.prototype,Backbone.Events);function zc(a){function b(a){a&&a.hasOwnProperty("fontFamily")&&null!==a.fontFamily&&(c.push(a.fontFamily),a.hasOwnProperty("html")&&(c=c.concat(Ac(a.html))))}var c=[];a&&a.hasOwnProperty("pages")&&a.pages.forEach(function(a){a&&a.hasOwnProperty("elements")&&a.elements.forEach(function(a){b(a);a&&a.hasOwnProperty("contents")&&null!==a.contents&&a.contents.forEach(b)})});return c}y=vc.prototype;
y.Rb=function(){var a=this,b=this.Dc.sb,c=ac(),d=[];b.forEach(function(a){Xb(c,a)});this.n.forEach(function(b){cc(b.Rb()).forEach(function(b){0<=$b(a.Uc).indexOf(b.za)||d.unshift(b)})});d.forEach(function(a){c.unshift(a)});return c};function Bc(a,b){if(!(0<=$b(a.Dc).indexOf(b.za))){Xb(a.Dc,b);var c=a.Uc.sb.filter(function(a){return a.za!==b.za});a.Uc=bc(ac(),c);a.trigger("paletteEntry:add",a,b)}}
function Cc(a,b){Xb(a.Uc,b);var c=a.Dc.sb.filter(function(a){return a.za!==b.za});a.Dc=bc(ac(),c);a.trigger("paletteEntry:remove",a,b)}function Dc(a){return $b(a.Dc).concat(a.Uc.sb.map(function(a){return"!"+a.za}))}y.serialize=function(){var a=[];this.n.forEach(function(b){!b.Zg&&a.push(b.serialize())});return{palette:Dc(this),pages:a,layout:Gc(this),template:Hc(this),title:this.$d,defaultFonts:this.Pc,canvaDefaultFonts:this.vd}};
function Gc(a){var b=null,c;for(c in qc)qc[c]==a.ha&&(b=c);return b}function Hc(a){var b=null,c;for(c in a.ha.templates)a.ha.templates[c]==a.Db&&(b=c);return b}y.Ea=s("$d");function Ic(a,b){a.$d=b;a.trigger("change:title",a);a.trigger("change",a)}function T(a){a=a.n.filter(function(a){return a.Md()});return 0<a.length?a[0]:null}function Jc(a){var b=T(a);return P(a,b)}function yc(a,b){Jc(a)!==b&&(a.n.forEach(function(a){a.Qe(!1)}),a.n[b].Qe(!0),a.trigger("page:change:selected",a,a.n[b]))}
function P(a,b){return a.n.indexOf(b)}function Kc(a){var b=new xc(a,a.Db);if(0<a.n.length){var c=Lc(a.n[a.n.length-1]);0<c.length&&(c=c[c.length-1].clone(),c.appendTo(b),Mc(c))}a.n.push(b);a.trigger("page:add",a,b);b.aa().forEach(function(a){b.trigger("element:add",b,a)});return b}
function Nc(a,b,c,d){var e=a.n.indexOf(b),f=!0;!1===d&&(f=!1);b.Ia=a;-1==e?(a.n.splice(c,0,b),a.trigger("page:add",a,b,c,f)):(a.n.splice(c,0,a.n.splice(e,1)[0]),a.trigger("page:move",a,b,e,c));-1==e&&b.aa().forEach(function(a){b.trigger("element:add",b,a)})}function Oc(a,b){var c=Jc(a),d=a.n.indexOf(b);-1<d&&a.n.splice(d,1);b.Ia=null;c>d&&c--;yc(a,Math.max(0,Math.min(a.n.length-1,c)));a.trigger("page:remove",a,b,d)}
y.ba=function(){var a=[],b=this.n.map(function(a){return a.ba()});return a.concat.apply(a,b)};y.aa=function(){var a=[],b=this.n.map(function(a){return a.aa()});return a.concat.apply(a,b)};function Pc(a,b,c){var d=Qc(a,b);_.isEqual(c,d)||(a.Pc[b]=$.extend(!0,{},c),a.trigger("change:defaultFont",a,b,c),a.trigger("change",a),Rc(a,b))}function Qc(a,b){return $.extend(!0,{},a.vd[b],a.Pc[b])}
function Rc(a,b){var c=Qc(a,b);c&&a.aa().filter(function(a){return a instanceof Sc&&a.Ah===b}).forEach(function(a){var b=$.extend(!0,{},a.Wa),f;for(f in c)c.hasOwnProperty(f)&&!a.Wa[f]&&(-1<Tc.indexOf(f)&&("fontFamily"==f?a.Vb(0,c[f]):"fontSize"==f?a.ob(0,c[f]):"bold"==f?a.oc(0,c[f]):"italic"==f?a.pc(0,c[f]):"justification"==f&&a.Bb(0,c[f])),"color"==f&&a.setColor(0,Qb(c[f])));a.Wa=b})}
function Uc(a){function b(a){var e,f;for(f in a)a.hasOwnProperty(f)&&(e=a[f],c=c&&("number"===typeof e?!isNaN(e):!0),"object"==typeof e&&b(e));Array.isArray(a)&&a.forEach(function(a){c=c&&("number"===typeof a?!isNaN(a):!0);"object"==typeof e&&b(e)})}var c=!0;b(a);return c};function Vc(a,b,c,d,e,f,g,h,l,m){this.lb=a;this.Cb=b;this.xd=d;this.Hb=c;this.nc=e;this.Ud=f;this.o=h;this.Vc=l;this.Ue=m;this.bb=null}y=Vc.prototype;y.Bd=function(){return this.Vc&&this.Vc.edit||null};y.rg=function(){return this.Vc&&this.Vc.view||null};y.Nc=s("nc");y.ic=function(){return 1==this.Cb};y.state=s("o");y.Re=function(a){if(this.bb)throw"listener already set";this.bb=a};
function Wc(a,b,c){var d=c.document.draft;a.nc!=b||d.version<=a.nc||(Xc(a,c),a.nc=d.version,a.Ud=d.session,a.Ud!=a.xd&&(a.Hb++,a.Cb=0,a.o=d.content),a.Ue=c.document.tags,a.bb&&a.bb(a.Cb))}function Yc(a,b,c,d){var e=d.document.draft;a.nc==c&&(null==a.lb&&(a.lb=d.document._id),null==a.Vc&&(a.Vc=d.document.extensions),null==a.Ue&&(a.Ue=d.document.tags),Xc(a,d),a.Hb==b&&(a.Cb=0),a.nc=e.version,a.Ud=e.session,a.bb&&a.bb(a.Cb))}
function Zc(a,b,c,d){var e=d.document.draft;a.nc>c||(Xc(a,d),a.nc=e.version,a.Ud=e.session,a.Ud!=a.xd?(a.Hb++,a.Cb=0,a.o=e.content):a.Hb==b&&(a.Cb=0),a.Ue=d.document.tags,a.bb&&a.bb(a.Cb))}function Xc(a,b){null==a.xd&&(a.xd=b.session)}function $c(a,b){this.O=a;this.sa=b;this.tc=this.Gc=this.Ra=this.bb=null}function ad(a){var b=0.2*Math.random()-0.1;return null==a?5E3:6E5<a?6E5:a*(1.6+b)}
$c.prototype.stop=function(){this.Ra=null;this.Gc&&(this.Gc.cancel(),this.Gc=null);null!=this.tc&&(window.clearTimeout(this.tc),this.tc=null)};$c.prototype.Re=function(a){this.bb=a};$c.prototype.sync=function(a){if(this.Ra)throw"already syncing";this.Ra=a;bd(this,ad(null))};function cd(a,b){var c=a.Ra;c&&(a.Ra=null,c(b))}
function bd(a,b){if(null==b)cd(a,!1);else{var c=a.sa,d=c.lb,e=c.xd,f=c.Hb,g=c.Nc(),h=c.ic();if(h)d="/documents"+(null==d?"":"/"+encodeURIComponent(d))+"?version="+encodeURIComponent(g.toString())+(null==e?"":"&session="+encodeURIComponent(e.toString())),e=c.state();else{if(null==d)return;d="/documents/"+encodeURIComponent(d)+(null==e?"":"?session="+encodeURIComponent(e.toString()));e=null}var l=function(d,e){window.clearTimeout(a.tc);a.Gc=null;a.tc=null;var l;h&&200==d?(Yc(c,f,g,e),l=null):h&&409==
d?(Zc(c,f,g,e),l=null):h||200!=d?l=0==d?null:400<=d&&499>=d?b:500<=d&&599>=d?b:null:(Wc(c,g,e),l=null);null!=l?a.tc=window.setTimeout(function(){bd(a,ad(l))},l):cd(a,200==d)};a.tc=window.setTimeout(function(){var c=a.Ra;a.Ra=null;a.Gc.cancel();a.Gc=null;a.tc=null;a.Ra=c;bd(a,ad(b))},b);a.Gc=h?a.O.post(d,e,null,l):a.O.get(d,l)}}function dd(a,b){this.O=a;this.sa=b;this.Nf=this.Of=this.Tf=this.de=this.sc=null}
function ed(a){a.de=window.setInterval(function(){a.sa.ic()&&a.sync()},5E3);a.Tf=window.setInterval(function(){a.sync()},6E4)}y=dd.prototype;y.sync=function(){if(!this.sc){var a=this,b=new $c(a.O,a.sa);a.sc=b;a.Of&&a.Of();a.sc.sync(function(c){a.sc==b&&(a.sc=null,a.Nf&&a.Nf(c))})}};function fd(a,b){var c=G;c.Of=a;c.Nf=b}y.close=function(){this.sc&&(this.sc.stop(),this.sc=null);this.de&&(window.clearInterval(this.de),this.de=null);this.Tf&&window.clearInterval(this.Tf)};y.Re=function(a){this.sa.Re(a)};
y.post=function(a,b){var c;c=this.sa;c.Hb!=a?c=null:(c.Cb=1,c.o=b,c.Hb++,c.bb&&c.bb(c.Cb),c=c.Hb);return c};function gd(a){var b=G;if(b.sa.ic())throw"context has pending changes";if(b.sa.o){var c=b.sa.lb;if(null==c)throw"synced context has no id";b.O.post("/publish/"+encodeURIComponent(c)+"/"+encodeURIComponent(b.sa.Nc().toString()),null,null,function(b){a(200==b)})}else alert("You cannot publish a blank design.")}y.id=function(){return this.sa.lb};y.rg=function(){return this.sa.rg()};y.Bd=function(){return this.sa.Bd()};
y.version=function(){return this.sa.Hb};y.Nc=function(){return this.sa.Nc()};y.ic=function(){return this.sa.ic()};y.state=function(){return this.sa.state()};function hd(a){this.O=a}function id(){var a=new hd(sa);a.load();return a}hd.prototype.load=k();hd.prototype.open=function(a,b,c,d,e,f,g,h){a=new dd(this.O,new Vc(a,0,b,c,d,e,0,g,h,null));ed(a);return a};function jd(a){this.O=a}var kd="SCREEN",ld="PRINT",md="PNG",nd="READY",od="FAILED",pd="CANCELLED";function qd(a,b,c){this.Ui=a;this.Vi=b;this.Bh=c}
jd.prototype.yd=function(a,b,c,d,e,f){a="/export?doc="+encodeURIComponent(a)+"&quality="+encodeURIComponent(c)+"&version="+b.toString()+"&fileFormat="+encodeURIComponent(d);f&&(a+="&fbId="+encodeURIComponent(f.Ui)+"&fbToken="+encodeURIComponent(f.Vi)+(f.Bh?"&userMessage="+encodeURIComponent(f.Bh):"")+"&destination="+encodeURIComponent("FACEBOOK"));return this.O.post(a,{},null,function(a,b){var c=200==a?b.jobId:null;e&&e(a,c)})};
jd.prototype.ue=function(a,b,c,d){return this.O.get("/export/"+encodeURIComponent(a)+"/"+b+(c?"?attachment":""),function(a,b){if(200==a){var c=b.stage,h=null;c==nd?h=b["export"].url:c==od?h=b["export"]&&b["export"].msg:c==pd&&(h="The export job was cancelled");d&&d(a,{jg:c,lg:h})}else d&&d(a,null)})};function pc(a){a=a||{};rd?a.Ed&&a.Ed():(rd=!0,ca=new sd,Qa&&$("html").addClass("isMac"),Oa?($("#uploadsDisabled").remove(),$("#normalUploads").removeClass("hidden disappearing")):($("body").addClass("fileInputsDisabled"),$("#normalUploads").remove(),$("#uploadsDisabled").removeClass("hidden disappearing")),$("#documentTitleAndMenu").css("opacity",0),$("#objectPanel").css("opacity",0),$("#content").addClass("preparing"),setTimeout(function(){td(a.content||{});ud();$("#content").on("click",".elementToolbar a, .textToolbar a",
!1);$("#canvaDocument").on("touchClick",".elementToolbarBackward.enabled a",{cancel:!0},vd);$("#canvaDocument").on("touchClick",".elementToolbarForward.enabled a",{cancel:!0},wd);$("#canvaDocument").on("touchClick",".elementToolbarCopy.enabled a",{cancel:!0},xd);$("#canvaDocument").on("touchClick",".elementToolbarDelete.enabled a",{cancel:!0},yd);$("#canvaDocument").on("touchClick",".elementToolbarCrop.enabled a",{cancel:!0},zd);$("#canvaDocument").on("change",".textToolbarFontFamily",Ad);$("#canvaDocument").on("change",
".textToolbarFontSize",Bd);$("#canvaDocument").on("touchClick",".textToolbarBold a",{cancel:!0},Cd);$("#canvaDocument").on("touchClick",".textToolbarItalic a",{cancel:!0},Dd);$("#canvaDocument").on("touchClick",".textToolbarJustification a",{cancel:!0},Ed);$("#canvaDocument").on("touchClick",".textToolbarList a",{cancel:!0},Fd);$("#canvaDocument").on("touchClick",".textToolbarColor a",{cancel:!0},Gd);$("#canvaDocument").on("touchClick",".elementToolbarColor a",{cancel:!0},Hd);$("#canvaDocument").on("change",
".gridToolbarSpacing select",Id);Jd();$("#zoomIn").on("touchClick",Kd);$("#zoomOut").on("touchClick",Ld);Md();Nd();Od();a.Ed&&a.Ed();setTimeout(function(){$("#content").addClass("on");$("#newDocPage").remove();var a=$("#objectPanel");a.addClass("doNotTransition").css("transform",fc({uc:-a.outerWidth()})).css("opacity","").delay(20,function(){$(this).removeClass("doNotTransition").css("transform","")});$("#editorLogo").addClass("doNotTransition").css("transform",fc({Oc:-a.outerWidth()})).css("opacity",
"").delay(20,function(){$(this).removeClass("doNotTransition").css("transform","")});$("#documentTitleAndMenu").addClass("doNotTransition").css("transform",fc({Oc:-a.outerWidth()})).css("opacity","").delay(20,function(){$(this).removeClass("doNotTransition").css("transform","")});$("#zoomer").addClass("doNotTransition").css("transform",fc({uc:a.outerWidth()})).css("opacity","").delay(20,function(){$(this).removeClass("doNotTransition").css("transform","")});$("#showPages").addClass("doNotTransition").css("transform",
fc({uc:a.outerWidth()})).css("opacity","").delay(20,function(){$(this).removeClass("doNotTransition").css("transform","")});$(".page").addClass("on");$(".page .elements").css("opacity",0).animate({opacity:1},500,function(){$(this).css("opacity","")})},600)},20),Pd())}var rd;
function Pd(){ha=ga=fa=0;var a=Qd("editorStylesheet");if(null!=a)for(var b=0;b<a.length&&!(".pageToolbar"==a[b].selectorText?(ha=parseInt(a[b].style.marginTop,10),fa=parseInt(a[b].style.width,10)):".pageToolbar.vertical"==a[b].selectorText&&(ga=parseInt(a[b].style.width,10)),ga&&fa&&ha);b++);}function Qd(a){for(var b=null,c=0;c<document.styleSheets.length;c++)if(document.styleSheets[c].ownerNode.id==a){b=document.styleSheets[c];break}return null==b?null:b.cssRules||b.rules||null}
function Od(){if(!oc){var a=$("#objectPanel"),b=$(".layer",a).eq(0).width(),c=Math.ceil(b/110),d=Math.ceil(b/180),b=Math.ceil(b/145),e=Qd("objectPanelStylesheet");null!=e&&(e[0].style.width=Math.round(10*(100/c))/10+"%",e[1].style.width=Math.round(10*(100/d))/10+"%",e[2].style.width=Math.round(10*(100/b))/10+"%");c=Qd("scrollbarsStylesheet");null!=c&&($("body").append('<div id="scrollbarNormal"><div></div></div><div id="scrollbarForced"><div></div></div>'),d=$("#scrollbarNormal > div").width()-$("#scrollbarForced > div").width(),
$("#scrollbarNormal, #scrollbarForced").remove(),null!=c&&(c[0].style.right=-d+"px",c[1].style.marginRight=d+"px"));Rd();Sd();window.setTimeout(function(){a.find(".results > .layer > .inner > .browseCategories").each(function(){Td($(this),!0)})},20);$("#canvaDocument").css("left",$("#objectPanel").outerWidth(!0));Ud==N&&ia&&Vd(ia)}}
function Wd(){var a;if(oc)a=new O(0,0,$(window).width(),$(window).height());else{a=$("#editorLogo").height()+15;var b=$("#canvaDocument").width()-30-30,c=$("#canvaDocument").height()-a-30;a=new O(30,a,b,c)}return a}function Xd(){var a=Wd(),b=a.j(),c=a.h();a.P(30);a.q(c+b-30);return a}
function Yd(){if(!$("#savingError").hasClass("on")){if(window.cdoc&&G.ic())return"We are still auto-saving the latest changes to you design. Are you sure you want to leave the Canva editor?";if(0<ja.Fc)return"You're in the middle of uploading an image. Are you sure you want to leave the Canva editor?";G&&G.close();if(I){var a=I,b=Math.floor((Date.now()-a.Pf)/1E3);a.Pf=null;var c=-1<window.location.search.indexOf("&onboarding");a.gc.ae(c?"minichallenge":"design_close",{design:a.bc,duration:c?null:
b})}}};var Tc="justification list italic bold fontSize fontFamily".split(" ");function Zd(a){var b=a.find("> .inner").get(0);a=$d(b);var c=window.getSelection(),d=a.filter(function(a){return ae(c,a,!1)}),b=$(b).text()==c.toString();return d.length==a.length&&b}
function be(a){function b(a){var b=document.selection.createRange();b.collapse(a);return b.parentElement()}var c=window.getSelection();if(0==c.rangeCount)return!0;var d=c.getRangeAt(0);a=a.find("> .inner").get(0);if(!a)return!0;var e=$.browser.msie?b(!0):d.startContainer,d=$.browser.msie?b(!1):d.endContainer;return a.contains(e)||a.contains(d)?c.isCollapsed:!0}
function ce(a,b){var c=a.kb(b),d=a.ya(b),c=c.find("> .inner"),e=c.find("> font");1==e.length&&1==c.get(0).childNodes.length&&(e.attr("face")&&(d.fontFamily=e.attr("face")),e.attr("color")&&(d.color=e.attr("color")),e=e.html(),a.qc(d.index,d),c.empty().append(e))}function de(a){var b=[],c=[],d=a.find("> .inner").get(0);$d(d).forEach(function(d){d=ee(fe(d),a);b=b.concat(d.ub);c=c.concat(d.hb)});return{ub:b,hb:c}}
function ge(a){function b(a){var b;$.browser.msie?(b=document.selection.createRange(),b.collapse(!0),b=b.parentElement()):b=window.getSelection().getRangeAt(0).startContainer;return a.contains(b)}var c=[],d=[],e=window.getSelection(),f=a.find("> .inner").get(0);be(a)?1==e.rangeCount&&b(f)&&(f=e.getRangeAt(0).startContainer,f=ee(fe(f),a),c=c.concat(f.ub),d=d.concat(f.hb)):$d(f).filter(function(a){return ae(e,a,!0)&&a.nodeType==Node.TEXT_NODE}).forEach(function(b){b=ee(fe(b),a);c=c.concat(b.ub);d=d.concat(b.hb)});
c=c.filter(function(a,b){return c.lastIndexOf(a)===b});d=d.filter(function(a,b){return d.lastIndexOf(a)===b});return{ub:c,hb:d}}
function ee(a,b){var c,d,e,f=[],g=[];e=b.find("> .inner").get(0);c=b.get(0);if(a==e||a==c)c=b.data("fontName"),e=b.data("colorObj"),c&&f.push(c),e&&g.push(e.color);else{for(;a!==e;)"font"==a.tagName.toLowerCase()&&(c=a.getAttribute("face"),d=a.getAttribute("color"),c&&f.push(c),d&&g.push(d)),a=a.parentElement;0==f.length&&b.data("fontName")&&f.push(b.data("fontName"));0==g.length&&b.data("colorObj")&&g.push(b.data("colorObj").color)}return{ub:f,hb:g}}
function $d(a){for(var b=[],c=0;c<a.childNodes.length;c++){var d=a.childNodes[c];0==d.childNodes.length?b.push(d):b=b.concat($d(d))}return b}function fe(a){if(a.parentElement)return a.parentElement;for(a=a.parentNode;a&&a.nodeType!==Node.ELEMENT_NODE;)a=a.parentNode;return a}
function ae(a,b,c){if(a.containsNode)return a.containsNode(b,c);c=document.createRange();c.selectNodeContents(b);b=0;for(var d;b<a.rangeCount;++b){d=a.getRangeAt(b);try{if(0>=d.compareBoundaryPoints(d.START_TO_START,c)&&0<=d.compareBoundaryPoints(d.END_TO_END,c))return!0}catch(e){if(e.code!==DOMException.WRONG_DOCUMENT_ERR)throw e;}}return!1}function Ac(a){if(!a)return[];var b=/<font[^>]+\bface="([^"]+)/g;a.match(b);for(var c=null,d=[];c=b.exec(a);)d.push(c[1]);return d}
function he(a,b){var c=Ac(a);ie(c,b)}
function je(a,b,c){function d(){g&&document.execCommand("fontName",!1,h.k);if(Zd(f)||be(f)){var a="'"+h.k+"'";$.browser.msie||(a+=", "+h.zc);f.data("fontName",h.name||h.k).data("fontFamily",h.k).css("font-family",a).css("font-weight",void 0!==h.be?h.be:"")}f.css("font-weight",void 0!==h.be?h.be:"");void 0!==c&&c(!0);e.trigger("change:fontFamily",this,f,b)}var e=this,f=this.kb(a);if(void 0===b)f.removeData("fontFamily").removeData("fontWeight").css("font-family","").css("font-weight","");else{var g=
f.is(".focused"),h=le(b);h?me(b,function(a){a?d():void 0!==c&&c(!1)}):c&&c(!1)}}function ne(a,b){var c=this.kb(a);void 0===b?c.removeData("fontSize").css("font-size",""):c.data("fontSize",b).css("font-size",b*Ra+"%")}function oe(a){this.ob(this.va(),a)}function pe(a){return this.kb(a).data("fontSize")||24}function qe(a,b){var c=this.kb(a);void 0===b?c.removeData("justification").css("text-align",""):c.data("justification",b).css("text-align",b)}
function re(a,b){var c=this.kb(a),d=b?Pb(b.color):"#000000";c.is(".focused")&&b&&document.execCommand("foreColor",!1,d);if(Zd(c)||be(c))void 0===b||null===b?c.removeData("colorObj").css("color",""):c.data("colorObj",b).css("color",d)}function se(a,b){var c=this.kb(a);c.is(".focused")&&document.execCommand("bold",!1,null);if(Zd(c)||be(c))void 0===b?c.removeData("bold").removeClass("bold"):(c.data("bold",b),b?c.addClass("bold"):c.removeClass("bold"));te(c)}
function ue(a,b){var c=this.kb(a);c.is(".focused")&&document.execCommand("italic",!1,null);if(Zd(c)||be(c))void 0===b?c.removeData("italic").removeClass("italic"):(c.data("italic",b),b?c.addClass("italic"):c.removeClass("italic"))}
function ve(a,b){function c(){null!==window.getSelection().focusNode&&"BODY"!==window.getSelection().focusNode.tagName&&(document.execCommand("selectAll",!1,null),document.execCommand("insertUnorderedList",!1,null),$(".inner *",d).css("font-size",""),te(e))}var d=this.kb(a),e=this.Ac(),f=0<$("ul",d).length;void 0===b?f&&(d.find("> .inner").focus(),we($("> .inner",d),c),d.removeData("list")):(f!=b&&(d.find("> .inner").focus(),we($("> .inner",d),c)),d.data("list",b))}
function xe(){var a=this.Ac();0<a.parents("#overlays").length&&ye(a)};function U(a){this.i=$('<div class="element" />');this.i.data("canvaElement",this);this.$f=!0;this.Td=this.J=this.A=this.ea=this.ia=0;this.M=this.na=null;this.yb=!1;this.vc=!0;a&&(this.Sa(Fb(a)),null!=a.rotation&&gc(this,a.rotation),a.hasOwnProperty("userEdited")&&(this.vc=a.userEdited))}U.prototype.trigger=Backbone.Events.trigger;U.prototype.listenTo=Backbone.Events.listenTo;U.prototype.stopListening=Backbone.Events.stopListening;_.extend(U.prototype,Backbone.Events);
function ze(a){switch(a.type){case "text":return new Sc(a);case "image":return new Ae(a);case "svg":return new hc(a);case "grid":return new Be(a)}return null}y=U.prototype;y.remove=function(){this.M&&Ce(this.M,this);this.na=this.M=null};y.s=function(){return this.M?this.M.aa().indexOf(this):-1};y.v=s("M");y.S=function(a){void 0===a||(this.ia=a);this.pa()};y.l=s("ia");y.V=function(){return(this.i.get(0).getBoundingClientRect().left-this.na.get(0).getBoundingClientRect().left)/N};
y.Da=function(){return(this.i.get(0).getBoundingClientRect().right-this.na.get(0).getBoundingClientRect().left)/N};y.Q=function(){return(this.i.get(0).getBoundingClientRect().top-this.na.get(0).getBoundingClientRect().top)/N};y.Y=function(){return(this.i.get(0).getBoundingClientRect().bottom-this.na.get(0).getBoundingClientRect().top)/N};y.Fa=function(){return this.Da()-this.V()};y.Ca=function(){return this.Y()-this.Q()};y.Z=function(){var a=Math.round(this.ia*N);return(this.M.Z()||0)+a};
y.P=function(a){void 0===a||(this.ea=a);this.pa()};y.j=s("ea");y.ga=function(){var a=Math.round(this.ea*N);return(this.M.ga()||0)+a};y.tg=k();y.rh=k();y.oa=function(a,b){void 0===a||null==a||(this.ia=a);void 0===b||null==b||(this.ea=b);this.pa()};y.D=function(a){void 0===a||(this.A=a);a=Math.round(this.A*N);this.i.css("width",a)};y.g=s("A");y.q=function(a){void 0===a||(this.J=a);a=mc(this);this.i.css("height",null==a?"":a)};y.h=s("J");function mc(a){return Math.round(a.J*N)}
y.setSize=function(a,b){this.D(a);this.q(b)};function lc(a){a=a.i.get(0).getBoundingClientRect();return{x:a.left+a.width/2,y:a.top+a.height/2}}y.Bc=function(){return this.j()+this.h()/2};y.Qb=function(){return this.l()+this.g()/2};y.Sa=function(a){this.oa(a.l(),a.j());this.setSize(a.g(),a.h())};y.B=function(){return new O(this.l(),this.j(),this.g(),this.h())};function gc(a,b){a.Td=b;a.pa()}y.qa=s("Td");y.W=function(){return this.ia+this.A};y.G=function(){return this.ea+this.J};y.Bg=k();y.gf=t(!1);
y.Md=function(){return this.hasClass("selected")||this.hasClass("multiSelected")};y.ca=t(!1);y.Qe=function(a){a?De(this):Ee(this)};y.pa=function(){var a=this.i,b=Math.round(this.ia*N),c=Math.round(this.ea*N);if(0<a.parents("#overlays").length)var d=this.M||C.n[0],b=b+d.Z(),c=c+d.ga();a.css("transform",fc({uc:b,Oc:c,rotate:this.Td}));this.na&&this.L()};y.hasClass=function(a){return this.i.hasClass(a)};y.clone=function(){return ze(this.serialize())};
y.appendTo=function(a){-1==a.N.indexOf(this)?a.addElement(this):Fe(a,this,a.aa().length)};function Ge(){var a=He;return-1<T(C).N.indexOf(a)}y.insertAfter=function(a){var b=a.s();if(-1!=b){var c=a.M,d=c.N.indexOf(this);-1==d?Fe(c,this,b+1):d<b?Fe(c,this,b):d>b&&Fe(c,this,b+1);!this.na&&a.na&&(this.na=a.na);this.Ha()}};y.insertBefore=function(a){var b=a.s();if(-1!=b){var c=a.M,d=c.N.indexOf(this);-1==d?Fe(c,this,b):d<b-1?Fe(c,this,b-1):d>b&&Fe(c,this,b);!this.na&&a.na&&(this.na=a.na)}};
y.Ha=function(){this.$f&&(this.S(),this.P(),this.D(),this.q(),this.pa(),this.na&&this.L())};
y.L=function(){var a=this.i,b=this.Z(),c=this.ga();Math.round(this.A*N);mc(this)||a.height();var b=b+(this.V()-this.l())*N,d=this.qa();45<d&&135>d&&(b-=45-Math.abs(90-d));if(a=a.data("toolbar"))d=$(".multipleSelectionBox"),0<d.length?(c=new O(parseInt(d.css("left"),10),parseInt(d.css("top"),10),d.width(),d.height()),Ie(a,c)):(c=new O(b,c,this.Fa()*N,this.Ca()*N),Ie(a,c),Je(a,this));var e=this.i,c=this.Z(),b=this.ga(),a=this.Td,d=Math.round(this.A*N),f=mc(this)||e.height();(e=e.data("selectionBox"))&&
e.css("transform",fc({uc:c,Oc:b,rotate:a})).css("width",d).css("height",f);Ke(e,a)};y.nb=function(){var a=this.i,b=a.data("selectionBox"),c=a.data("toolbar");b&&b.remove();c&&c.remove();a.removeData("selectionBox").removeData("toolbar");kc()};y.serialize=function(){return{elementIndex:this.s(),left:this.ia,top:this.ea,width:this.A,height:this.J,rotation:this.Td,userEdited:this.vc}};y.Rb=function(){return new Wb};function Le(){return 0==this.ta().length}
function Me(){var a=this.ta();return 0>=a.length?null:Fb(a.data("imageRect"))}
function Ne(){var a=this.i,b=this.ta(),c=this.U();c.scale(N).round();var d=a.data("toolbar");d&&d.css("display","none");d=a.data("cropControls");d||(d=$('<div class="cropControls"><div class="viewPort"><div class="inner"><img class="masked" /></div></div><div class="cropBox cornerHandles"><div class="inner"></div><a class="handle tl" href="#"></a><a class="handle tr" href="#"></a><a class="handle br" href="#"></a><a class="handle bl" href="#"></a><a class="move" href="#"></a><img class="uncropped" /></div></div>'),d.data("canvaElement",
this),a.data("cropControls",d),d.appendTo("#overlays"));$(".viewPort",d).css(Oe(c,0));$(".viewPort .inner").css("width",c.g()).css("height",c.h());var b=b.attr("src")||b.attr("xlink:href"),e=$("img.masked, img.uncropped",d);e.attr("src")!=b&&e.attr("src",b);var b=a.data("selectionBox"),f=b.attr("style"),g,h;(g=f.match(/translate(3d)?\((-?\d+)[^-\d]+(-?\d+)/))?(e=parseInt(g[2],10),g=parseInt(g[3],10)):(e=parseInt(b.css("left"),10),g=parseInt(b.css("top"),10));h=f.match(/width: (\d+)/);var l=f.match(/height: (\d+)/),
f=h?parseInt(h[1],10):b.width();h=l?parseInt(l[1],10):b.height();e=new O(e,g,f,h);d.css(Oe(e,this.qa()));g=this.Ja();g.scale(N).round();$(".viewPort img.masked",d).css(Oe(g,0));g.translate(c.l(),c.j());$(".cropBox",d).css(Oe(g,0));b.addClass("cropping");$("#canvaDocument > .inner > .page").first();c=$("#overlays");d=a.data("confirmationToolbar");d||(d=$('<menu class="crop elementToolbar"><li class="enabled confirmationToolbarOk"><a href="#">Ok</a></li><li class="enabled confirmationToolbarCancel"><a href="#">Cancel</a></li></menu>'),
d.appendTo(c).data("element",a).data("width",d.outerWidth()).data("height",d.outerHeight()),a.data("confirmationToolbar",d));a=a.data("confirmationToolbar");c=g.clone().translate(e.l(),e.j());Ie(a,c)}function Pe(a,b){var c=this.i.data("cropControls");$(".cropBox",c);var c=this.Ja(),d=this.U();d.S(0).P(0);a>d.l()?a=d.l():a+c.g()<d.W()&&(a=d.W()-c.g());b>d.j()?b=d.j():b+c.h()<d.G()&&(b=d.G()-c.h());c.S(a).P(b);this.eb(c)}function Qe(a){this.ta().data("imageRect",a)}
function Re(){var a=this.i;a.removeClass("cropping");var b=a.data("confirmationToolbar"),c=a.data("cropControls");a.removeData("confirmationToolbar").removeData("cropControls");b&&b.remove();c&&c.remove();(a=a.data("selectionBox"))&&a.removeClass("cropping")}function Se(){this.i.removeClass("cropping");var a=this.ta();if(a){var b=this.Ja(),c=b.clone();c.scale(N).round();a.css(Oe(c,0)).attr("data-image-rect",JSON.stringify(b.serialize()))}}function Te(){var a=this.Fd();return this.jb(a)}
function Ue(){var a=this.Fd(),a=this.xa(a);return void 0!==a.mediaId&&void 0!==a.mediaVersion}function Ve(a,b){return function(c,d,e){var f="image"==a.get(0).tagName?"xlink:href":"src";a.attr(f,e[We]);Xe(e["print"==Ye?Ze:$e],function(e){c===a.data("mediaId")&&d===a.data("mediaVersion")&&(a.attr(f,e),b&&b(c,d))})}}
function Ae(a){U.call(this,a);this.Rf=a.origin;this.yb=!0;this.hc=!!a.isBackground;this.Ld=!!a.isRecolorable;this.Xg=!!a.isDark;this.wc=a.backgroundColor;this.Na=a.mediaId;this.Oa=a.mediaVersion;this.Cf=(this.wf=void 0!==a.isCutout)?a.isCutout:!0;var b=void 0!==this.Na&&void 0!==this.Oa,c=this.i;c.addClass("image");b&&(c.append("<img>"),this.Wd(this.Na,this.Oa));this.Ld&&c.css("background-color",this.wc);this.Ta=new O((this.A-0.5*this.A)/2,(this.J-0.5*this.J)/2,0.5*this.A,0.5*this.J);this.La=new O(-this.Ta.l(),
-this.Ta.j(),this.A,this.J);this.pd=this.B();this.$b=!1;a.viewPortBox&&a.imageRect&&(pb(this,Fb(a.viewPortBox)),this.eb(Fb(a.imageRect)),this.pd=this.Ja(),this.Ib(),this.Sa(Fb(a)));this.hc&&Mc(this);b||(L.trigger("elementLoaded",this),L.trigger("elementLoaded:image",this))}Ae.prototype=new U;y=Ae.prototype;y.Zc=Le;y.Ja=Me;y.xc=Ne;y.Oe=Pe;y.eb=Qe;y.mc=Re;y.Ib=Se;y.U=Te;y.ye=Ue;y.gf=function(){return!this.ca()&&!this.$c()};y.appendTo=function(a){this.hc?Fe(a,this,0):U.prototype.appendTo.call(this,a)};
y.serialize=function(){var a=U.prototype.serialize.call(this);a.type="image";a.mediaId=this.Na;a.mediaVersion=this.Oa;a.isBackground=this.hc;a.isRecolorable=this.Ld;a.isCutout=this.Cf;a.isDark=this.Xg;a.backgroundColor=this.wc;this.$b&&(a.imageRect=this.La.serialize(),a.viewPortBox=this.Ta.serialize());return a};y.D=function(a){void 0===a&&(a=this.A);var b=this.i,c=a!=this.A;this.La&&c&&!b.is(".cropping")&&(b=a/this.A,this.La.scale(b,1),this.Ta.scale(b,1));U.prototype.D.call(this,a)};
y.q=function(a){void 0===a&&(a=this.J);var b=this.i,c=a!=this.J;this.La&&c&&!b.is(".cropping")&&(b=a/this.J,this.La.scale(1,b),this.Ta.scale(1,b));U.prototype.q.call(this,a)};y.Ha=function(){U.prototype.Ha.call(this);var a=this.i;if(this.$b&&!a.is(".cropping")){var b=this.La.clone();b.scale(N).round();$("img",a).css(Oe(b,0))}};y.L=function(){U.prototype.L.call(this);this.i.is(".cropping")?this.xc():this.mc()};y.Gd=function(){return{id:this.Na,version:this.Oa}};
y.Wd=function(a,b){this.Na=a;this.Oa=b;var c=this,d=this.i.find("img");d.data("mediaId",a).data("mediaVersion",b);af(this.Na,this.Oa,Ve(d,function(a,b){a===c.Na&&b===c.Oa&&(L.trigger("elementLoaded",c),L.trigger("elementLoaded:image",c))}))};y.ld=k();y.ta=function(){return $("img",this.i).filter(function(){return"/static/images/placeholder.jpg"!=$(this).attr("src")}).first()};y.Fd=t(0);y.vb=function(a){return 0!=a?$():$("img",this.i).eq(0)};y.wa=t(1);y.jb=function(){return this.Ta.clone()};y.xa=t(null);
y.pb=k();y.ag=k();function pb(a,b){var c=a.Ta.l(),d=a.Ta.j();a.Ta=b.clone();a.La.translate(c-a.Ta.l(),d-a.Ta.j())}y.Ja=function(){return this.La.clone()};y.ye=t(!0);y.ec=s("Rf");
y.xc=function(){var a=this.i;this.Ve||(this.Ve=!0,this.pd=new O(this.ia+(this.$b?this.La.l():0),this.ea+(this.$b?this.La.j():0),this.La.g(),this.La.h()));var b=this.M.Z()||0,c=this.M.ga()||0,d=this.pd.clone();d.scale(N).translate(b,c).round();a.data("selectionBox").css(Oe(d,this.qa()));Ne.call(this);0==$(".viewPort .frameHandle").length&&(b=$('<a class="frameHandle tl" href="#"><span class="tl"></span></a><a class="frameHandle tr" href="#"><span class="tr"></span></a><a class="frameHandle br" href="#"><span class="br"></span></a><a class="frameHandle bl" href="#"><span class="bl"></span></a>'),
a=a.data("cropControls"),$(".viewPort",a).append(b))};y.nb=function(){U.prototype.nb.call(this);this.mc()};y.eb=function(a){this.La=a.clone()};y.Ib=function(){Se.call(this);var a=this.i;this.ta().css("position","absolute");a.css("overflow","hidden");var b=this.Ta.clone();b.translate(this.pd.l(),this.pd.j());a.addClass("cropping");this.Sa(b);a.removeClass("cropping");this.Ta.S(-this.La.l()).P(-this.La.j());this.$b=!0;this.Ve=!1};
function Mc(a){a.hc=!0;a.yb=!1;a.i.addClass("background");a.M&&(Fe(a.M,a,0),a.M.trigger("change:background",a.M))}function bf(a){a.hc=!1;a.yb=!0;a.i.removeClass("background");a.M&&a.M.trigger("change:background",a.M)}y.ca=s("hc");y.Cc=s("Ld");y.$c=function(){var a=this;this.wf||(this.wf=!0,na.ib(this.Na,cf(this.Oa),function(b,c){a.Cf=c.ua().$c()}));return this.Cf};y.Ka=function(){var a=this.wc||"#ffffff";return this.hc&&this.Ld?[Qb(a)]:[]};
y.Vd=function(a,b){if(0!==a)throw"ImageElement.setChangeableColorAtIndex - invalid index: "+a.toString();var c=this.i;b?(this.wc=b.color,c.css("background-color",this.wc)):(this.wc=null,c.css("background-color",""));this.hc&&this.M&&(this.M.trigger("change:background",this.M),this.L())};y.Rb=function(){var a=new Wb;this.Ka().forEach(function(b){Xb(a,new Rb(b.color))});return a};
function hc(a){this.lc=[];this.w=this.X=this.sg=null;this.T=$();this.Te=[];this.ig=$();this.Nd=!1;U.call(this,a);if(void 0!==a&&void 0!==a.mediaId){this.Na=a.mediaId;this.Oa=a.mediaVersion;var b=this.i;b.addClass("svg");var c=$('<img class="placeholder" />');b.append(c);this.listenTo(this,"change:fontSize",this.hh);this.listenTo(this,"change:fontFamily",this.hh);this.ma=a.contents;this.sh=a.scaleStretch;a.fillColors&&(this.Rg=a.fillColors.map(function(a){return{index:a.index,color:Qb(a.color)}}));
this.Wd(this.Na,this.Oa)}}hc.prototype=new U;y=hc.prototype;y.Zc=Le;y.Ja=Me;y.xc=Ne;y.Oe=Pe;y.eb=Qe;y.mc=Re;y.Ib=Se;y.U=Te;y.ye=Ue;y.Vb=je;y.ob=ne;y.Pe=oe;y.Bb=qe;y.setColor=re;y.oc=se;y.pc=ue;y.md=ve;y.kg=xe;y.cc=pe;y.rh=function(){oa.set("hasUpdatedSvgPlaceholder",!0);$(".dragAPhotoInHere").remove()};function df(){$(".dragAPhotoInHere").each(function(a,b){b.setAttribute("class","dragAPhotoInHere hidden")})}
function ef(){$(".dragAPhotoInHere").each(function(a,b){b.setAttribute("class","dragAPhotoInHere")})}
y.tg=function(a){function b(){window.clearTimeout(x);v.setAttribute("fill",A);v.setAttribute("fill-opacity","1")}function c(){x=window.setTimeout(d,z)}function d(){v.setAttribute("fill",J);v.setAttribute("fill-opacity","0.4")}function e(){function a(f){jQuery.contains(document.documentElement,v)||($(".page.selected, #overlays").off("mousemove",a),$(".page.selected, #overlays").off("mouseover",e));f.clientX>=c.left&&f.clientX<=c.right&&f.clientY>=c.top&&f.clientY<=c.bottom?($("#overlays .selectionBox").css("cursor",
"pointer"),b()):($("#overlays .selectionBox").css("cursor","move"),d())}var c=v.getBoundingClientRect();$(".page.selected, #overlays").on("mousemove",a);$(".page.selected, #overlays").on("mouseout",function(){$(".page.selected, #overlays").off("mousemove",a)})}var f=50/54;if(!(1>this.lc.length)){var g=this.lc[this.lc.length-1];a=a.find("image.placeholder").last();a=$(a).parent("g.canva");var h=g.g(),l=g.h(),m=l/15,n=0.2*l,l=l/3.5,p=l*f,q=g.l(),u=g.j(),f=function(a,b){var c=document.createElementNS("http://www.w3.org/2000/svg",
"text");c.setAttribute("width",p);c.setAttribute("x",q+h/2);c.setAttribute("y",b);c.setAttribute("font-size",m);c.setAttribute("text-anchor","middle");c.setAttribute("class","dragAPhotoInHere");c.appendChild(document.createTextNode(a));return c},g=u+l+n+1.44*m,r=g+1.2*m,w=r+1.2*m;a.append(function(a,b){var c=document.createElementNS("http://www.w3.org/2000/svg","image");c.setAttributeNS("http://www.w3.org/1999/xlink","href","/static/images/placeholder_arrow.png");c.setAttribute("width",a);c.setAttribute("height",
b);c.setAttribute("x",q+h/2-p/1.5);c.setAttribute("y",u+n);c.setAttribute("class","dragAPhotoInHere");return c}(p,l));a.append(f("DRAG A PHOTO",g));a.append(f("IN HERE OR",r));l=function(a,b){var c=p/16,d=document.createElementNS("http://www.w3.org/2000/svg","text");d.setAttribute("width",p);d.setAttribute("x",q+h/2);d.setAttribute("y",b+3*c);d.setAttribute("font-size",m-2);d.setAttribute("fill","white");d.setAttribute("text-anchor","middle");d.setAttribute("class","uploadYourOwn");d.setAttribute("z-index",
1);d.setAttribute("class","uploadAPhoto dragAPhotoInHere");d.appendChild(document.createTextNode(a));return d}("UPLOAD YOUR OWN",w);a.append(l);var v=function(a){var b=p/16,c=p/16,d=document.createElementNS("http://www.w3.org/2000/svg","rect");d.setAttribute("width",a.width+2*b+20);d.setAttribute("x",a.x-b-10);d.setAttribute("y",a.y-c);d.setAttribute("height",a.height+2*b);d.setAttribute("fill","black");d.setAttribute("fill-opacity","0.4");d.setAttribute("rx",a.height/1.6);d.setAttribute("ry",a.height/
1.6);d.setAttribute("class","uploadAPhoto uploadAPhotoButton dragAPhotoInHere");d.setAttribute("z-index",2);return d}(l.getBBox());v.onmouseover=b;l.onmouseover=b;var x=0,z=100,A="#00c4cc",J="black";v.onmouseout=c;l.onmouseout=c;$(".page.selected, #overlays").on("mouseover",e);l.parentNode.removeChild(l);a.append(v);a.append(l)}};
function ff(a,b,c){function d(){f.stopListening(f,"placeholderImage:loaded");f.Nd=!0;m.css("position","absolute");L.trigger("elementLoaded",f);L.trigger("elementLoaded:svg",f);c&&c()}var e=a.i,f=a,g=a.ma?a.ma.filter(function(a){return"text"==a.type}):[],h=a.ma?a.ma.filter(function(a){return"image"==a.type}):[],l=gf();b=hf(b,l);var m=$(b).filter("svg");jf(m);m=$(m.get(0).cloneNode(!0));m.appendTo(e);a.X=kf(m);a.A&&a.J||(a.D(a.X.g()),a.q(a.X.h()));a.T=lf(m);a.T.css("opacity",0).data("canvaElement",
a).appendTo(e);mf(a);nf(a).each(function(){var a=$(this).data("designObject");f.listenTo(a,"change:width",f.gh);f.listenTo(a,"change:height",f.fh)});b=of(m,a.T);a.Te=b.jk;a.Te.forEach(function(a){f.listenTo(a,"change",f.ih)});a.ig=b.zi;a.ig.appendTo(e);a.Rg&&a.Rg.forEach(function(a){f.Vd(a.index,a.color)});var n=[];a.T.each(function(){var a=$(this).data("fontFamily"),b=de($(this)).ub;n.push(a);n=n.concat(b)});g.forEach(function(a){a=Ac('<font face="'+a.fontFamily+'"></font>'+a.html);n=n.concat(a)});
ie(n,function(){f.T.each(function(a,b){f.qc(a,f.ya(a));$(b).css("opacity","")});g.forEach(function(a){f.qc(a.index,a);he(a.html)});f.lc=pf(m,".photoPlaceholder");qf(m,f.lc);f.tg(m);var a=_.after(h.length,d);f.listenTo(f,"placeholderImage:loaded",a);h.forEach(function(a){f.pb(a.index,a)});f.yb=0<$("svg .photoPlaceholder",e).length;f.w=rf(m);f.w&&(f.sh&&sf(f,f.sh),f.D(f.g()),f.q(f.h()));0===h.length&&d()})}y.hh=function(a,b){var c=b.data("designObject");c&&this.Nd&&tf(c)};var uf=0;
function gf(){uf=uf==Math.pow(2,53)?0:uf+1;return"CANVA"+uf+"_"}
function rf(a){function b(a){for(a=a.firstChild;a&&a.nodeType!=Node.ELEMENT_NODE;)a=a.nextSibling;return a}function c(a,c,e,f,g){if(0!=a.length){var h=document.createElementNS(d,"pattern");q.appendChild(h);h.id=gf()+uf.toString();h.setAttribute("width",f);h.setAttribute("height",g);h.setAttribute("patternUnits","userSpaceOnUse");h.setAttribute("patternTransform","translate("+c.toString()+", "+e.toString()+")");f=a.get(0).cloneNode(!0);f.removeAttribute("id");f.setAttribute("transform","translate("+
(-c).toString()+", "+(-e).toString()+")");$("g.canva, .textPlaceholder, .photoPlaceholder",f).remove();h.appendChild(f);$("> *:not(.canva)",a).remove();f=document.createElementNS(d,"rect");f.setAttribute("class","repeat");f.setAttribute("fill","url(#"+h.id+")");f.setAttribute("x",c);f.setAttribute("y",e);f.setAttribute("width",h.getAttribute("width"));f.setAttribute("height",h.getAttribute("height"));a=a.get(0);a.insertBefore(f,b(a))}}var d="http://www.w3.org/2000/svg";if(!(0<$("g",a).filter(function(){return-1!=
"nw n ne w c e sw s se".split(" ").indexOf(this.id)}).length))return null;var e=a.parent(),f=a.prev(),g=kf(a),h={left:0,right:0,top:0,bottom:0,repeat:!1,Hc:!0,Ic:!0},l=$("<div></div>");l.appendTo($("#limbo"));l.css("opacity",0).css("width",g.g()*N).css("height",g.h()*N);a.appendTo(l);var m=a.get(0),n=g.g(),p=g.h();$("g",a).each(function(a,b){-1!=["n","e","s","w"].indexOf(b.id)&&(h.repeat|=b.classList.contains("repeat"));-1!=["ne","e","se"].indexOf(b.id)?(h.right=Math.max(h.right,n-b.getBBox().x),
h.right==n&&(h.right=0)):-1!=["n","c","s"].indexOf(b.id)&&(h.left=Math.max(h.left,b.getBBox().x));-1!=["sw","s","se"].indexOf(b.id)?(h.bottom=Math.max(h.bottom,p-b.getBBox().y),h.bottom==p&&(h.bottom=0)):-1!=["w","c","e"].indexOf(b.id)&&(h.top=Math.max(h.top,b.getBBox().y))});h.Hc=!m.classList.contains("verticalOnly");h.Ic=!m.classList.contains("horizontalOnly");if(h.repeat){var q=document.createElementNS(d,"defs");m.insertBefore(q,b(m));var g=h.left+h.right,u=h.top+h.bottom,r=m.classList.contains("horizontalOnly"),
m=m.classList.contains("verticalOnly");c($("g#n",a),h.left,0,n-g,r?p:h.top);c($("g#s",a),h.left,p-h.bottom,n-g,r?p:h.bottom);c($("g#c",a),h.left,h.top,n-g,p-u);c($("g#w",a),0,h.top,m?n:h.left,p-u);c($("g#e",a),n-h.right,h.top,m?n:h.right,p-u)}0<e.length?0<f.length?a.insertAfter(f):a.prependTo(e):a.detach();l.remove();return h}
function pf(a,b){var c=a.parent(),d=a.prev(),e=kf(a),f=$("<div></div>");f.appendTo($("#limbo"));f.css("width",e.g()).css("height",e.h());a.appendTo(f);var g=[];a.attr("stroke","transparent");a.attr("stroke-width",0);var h=a.get(0).getBoundingClientRect();$(b,a).each(function(a,b){var c=$(b).clone();c.attr("fill","transparent").appendTo($(b).parents("g, svg").first());var d=Fb(c.get(0).getBoundingClientRect());c.remove();d.translate(-h.left,-h.top);g.push(d)});0<c.length?0<d.length?a.insertAfter(d):
a.prependTo(c):a.detach();f.remove();return g}
function lf(a){var b=$(),c=pf(a,".textPlaceholder"),d=$(".canva .textPlaceholder",a);c.forEach(function(a,c){var g=d.eq(c),h=g.data()||{},l=$('<div class="text"><div class="inner">'+(h.placeholderText||"Text")+"</div></div>");l.data("textIndex",c).data("placeholderElement",g).data("placeholderText",h.placeholderText).data("rect",a).data("justification",h.justification||"center").css("text-align",h.justification||"center").data("fontSize",h.fontSize||24).data("defaultFontSize",h.fontSize||24).data("colorObj",
h.colorObj).css("color",h.colorObj?h.colorObj.color:"").data("fontName",h.fontName).data("fontFamily",h.fontFamily).css("font-family",h.fontFamily?h.fontFamily:"").data("bold",h.bold).data("lineSpacing",h.lineSpacing||1.2).css("line-height",h.lineSpacing||1.2).data("dynamicFontSize",h.dynamicFontSize).data("dynamicHeight",h.dynamicHeight).data("dynamicWidth",h.dynamicWidth);0<g.parents().filter(function(){return this.classList.contains("stack")}).length||vf(l);g=new wf(l,0,0);l.data("designObject",
g);b=b.add(l)});return b}
function of(a,b){function c(a,b,c){var d=[];$(a).find(".textPlaceholder").each(function(e,f){var q=c.filter(function(){return $(this).data("placeholderElement").get(0)==f});if(1===q.length){var u=new wf(q.eq(0),b.l(),b.j());q.data("stackId",a.getAttribute("data-stack-id")).data("designObject",u);d.push(u)}});return d}var d=$(),e=[],f=pf(a,".canva.stack");a.find(".canva.stack").each(function(a,h){var l=f[a],m=0<$(h).parents("#n, #c, #s").length,n=0<$(h).parents("#w, #c, #e").length,p=c(h,l,b),l=new xf({vk:h.getAttribute("data-valign"),
fe:l.serialize(),Hc:m,Ic:n,contents:p});e.push(l);m=$('<div class="stack"></div>');n=b.filter(function(){return $(this).data("stackId")==h.getAttribute("data-stack-id")});m.data("sourceElement",h).data("stack",l).append(n);d=d.add(m)});return{jk:e,zi:d}}function vf(a){var b=a.data("placeholderElement"),c=0<b.parents("#n, #c, #s").length,b=0<b.parents("#w, #c, #e").length;c||b?b?a.data("dynamicHeight",!0):c&&a.data("dynamicWidth",!0):a.data("dynamicFontSize",!0)}
function qf(a,b){b.forEach(function(b,d){var e=new O(0,0,1438,560);Jb(e,b);$("image.placeholder",a).eq(d).attr("x",e.l()).attr("y",e.j()).attr("width",e.g()).attr("height",e.h())})}
function yf(a,b,c,d){if(!c)return b.clone().scale(d.scale);b=b.clone();b.scale(d.scale);c=a.parents("g#ne, g#e, g#se");0<c.length&&(c=c.data("offsetX")||0,b.translate(d.scale*c,0));c=a.parents("g#n, g#c, g#s");0<c.length&&(c=c.data("deltaX")||0,Mb(b,c*d.scale,0));c=a.parents("g#sw, g#s, g#se");0<c.length&&(c=c.data("offsetY")||0,b.translate(0,d.scale*c));c=a.parents("g#w, g#c, g#e");0<c.length&&(a=c.data("deltaY")||0,Mb(b,0,a*d.scale));return b}y=hc.prototype;
y.gh=function(a,b){if(this.w&&this.w.Hc&&0!==b){var c=Mb(this.B(),b,0);switch(a.Fb.data("justification")){case zf:c.translate(-b/2,0);break;case Af:c.translate(-b,0)}Bf(this,c);this.pa()}};y.fh=function(a,b){if(this.w&&this.w.Ic&&0!==b){var c=Mb(this.B(),0,b);c.translate(0,-b/2);Bf(this,c);this.pa()}};function Bf(a,b){var c=a.L,d=a.pa;a.L=k();a.pa=k();a.Sa(b);a.pa=d;a.L=c}
y.ih=function(a){if(this.w&&(this.w.Hc||this.w.Ic)){var b=!1,c=a.B(),d=this.i.find("> .stack").filter(function(){return $(this).data("stack")===a}),d=yf($(d.data("sourceElement")),a.Hd(),!0,Cf(this));if(this.w.Ic){var e=c.G()-d.G(),b=b||0!==e;this.q(this.h()+e)}this.w.Hc&&(c=c.W()-d.W(),b=b||0!==c,this.D(this.g()+c));b&&this.Ha()}};function sf(a,b){a.setSize(a.X.g()*b.scale,a.X.h()*b.scale);b.deltaX&&a.D(b.scale*b.deltaX+a.g());b.deltaY&&a.q(b.scale*b.deltaY+a.h())}
y.setSize=function(a,b){Df(a,this.A)&&!Df(b,this.J)?this.q(b):Df(b,this.J)&&!Df(a,this.A)?this.D(a):(U.prototype.D.call(this,a),U.prototype.q.call(this,b),Ef(this),mf(this))};
y.D=function(a){U.prototype.D.call(this,a);if(this.w&&void 0!==this.A&&void 0!==a&&0!=$("svg",this.i).length){var b=kf($("svg",this.i));b.h()==this.X.h()?(a=this.X.h()*this.A/this.J,b=this.X.clone()):(a=b.h()*this.A/this.J,b=b.clone());b.D(a);$("svg",this.i).get(0).setAttribute("viewBox",b.l()+" "+b.j()+" "+b.g()+" "+b.h());var b=this.w.left+this.w.right,c=this.X.g()-b,d=a-b,e=d/c,f=-this.w.left*(e-1),g=this;$("g#n, g#c, g#s",this.i).each(function(){var a=void 0===$(this).data("scaleY")?1:$(this).data("scaleY"),
b=$(this).data("offsetY")||0;"c"==this.id&&(b=-g.w.top*(a-1));g.w.repeat?$(".repeat",this).attr("width",d):$(this).attr("transform","translate("+f.toString()+", "+b.toString()+") scale("+e.toString()+", "+a.toString()+")");$(this).data("deltaX",d-c).data("scaleX",e)});var h=d-c-1;$("g#ne, g#e, g#se",this.i).each(function(){var a=$(this).data("offsetY")||0,b=void 0===$(this).data("scaleY")?1:$(this).data("scaleY");"e"==this.id&&(a=-g.w.top*(b-1));"e"==this.id&&g.w.repeat?$(this).attr("transform","translate("+
h.toString()+")").data("offsetX",h):$(this).attr("transform","translate("+h.toString()+", "+a.toString()+") scale(1, "+b.toString()+")").data("offsetX",h)});$("g#nw, g#w, g#sw",this.i).each(function(){var a=$(this).data("offsetY")||0,b=void 0===$(this).data("scaleY")?1:$(this).data("scaleY");"w"==this.id&&(a=-g.w.top*(b-1));"w"==this.id&&g.w.repeat?$(this).attr("transform","translate(1, 0)").data("offsetX",1):$(this).attr("transform","translate(1,"+a.toString()+") scale(1,"+b.toString()+")").data("offsetX",
1)});Ef(this)}};
y.q=function(a){U.prototype.q.call(this,a);if(this.w&&void 0!==this.J&&void 0!==a&&0!=$("svg",this.i).length){var b=kf($("svg",this.i));b.g()==this.X.g()?(a=this.X.g()*this.J/this.A,b=this.X.clone()):(a=b.g()*this.J/this.A,b=b.clone());b.q(a);$("svg",this.i).get(0).setAttribute("viewBox",b.l()+" "+b.j()+" "+b.g()+" "+b.h());var b=this.w.top+this.w.bottom,c=this.X.h()-b,d=a-b,e=d/c,f=-this.w.top*(e-1),g=this;$("g#w, g#c, g#e",this.i).each(function(){var a=void 0===$(this).data("scaleX")?1:$(this).data("scaleX"),
b=$(this).data("offsetX")||0;"c"==this.id&&(b=-g.w.left*(a-1));g.w.repeat?$(".repeat",this).attr("height",d):$(this).attr("transform","translate("+b.toString()+", "+f.toString()+") scale("+a.toString()+", "+e.toString()+")");$(this).data("deltaY",d-c).data("scaleY",e)});var h=d-c-1;$("g#sw, g#s, g#se",this.i).each(function(){var a=$(this).data("offsetX")||0,b=void 0===$(this).data("scaleX")?1:$(this).data("scaleX");"s"==this.id&&(a=-g.w.left*(b-1));"s"==this.id&&g.w.repeat?$(this).attr("transform",
"translate(0, "+h.toString()+")").data("offsetY",h):$(this).attr("transform","translate("+a.toString()+", "+h.toString()+") scale("+b.toString()+", 1)").data("offsetY",h)});$("g#nw, g#n, g#ne",this.i).each(function(){var a=$(this).data("offsetX")||0,b=void 0===$(this).data("scaleX")?1:$(this).data("scaleX");"n"==this.id&&(a=-g.w.left*(b-1));"n"==this.id&&g.w.repeat?$(this).attr("transform","translate(0, 1)").data("offsetY",1):$(this).attr("transform","translate("+a.toString()+", 1) scale("+b.toString()+
", 1)").data("offsetY",1)});Ef(this)}};function Ff(a){return a.X?a.A/a.X.g():0}function Cf(a){var b={scale:Ff(a),deltaX:0,deltaY:0};if(!a.w)return b;var c=null,d=kf($("svg",a.i));a.X.g()!=d.g()&&a.X.h()!=d.h()?c=a.A/d.g():a.X.h()==d.h()?c=a.J/a.X.h():(a.X.g(),d.g(),c=a.A/a.X.g());b.scale=c;b.deltaX=d.g()-a.X.g();b.deltaY=d.h()-a.X.h();return b}
function ic(a){a.T.each(function(b,c){var d=$(c),e=d.data("fontSize"),f=void 0!==d.data("stackId"),g=Cf(a),e=e*g.scale;d.css("font-size",e*Ra+"%");f||(f=d.data("placeholderElement"),e=d.data("rect").clone(),e=yf(f,e,!!a.w,g),g=d.data("designObject"),a.stopListening(g,"change:width"),a.stopListening(g,"change:height"),g.Sa(e),a.listenTo(g,"change:width",a.gh),a.listenTo(g,"change:height",a.fh),e.scale(N).round(),d.css(e.serialize()))})}
function nf(a){return a.T.filter(function(){return 0==$(this).data("placeholderElement").parents().filter(function(){return this.classList.contains("stack")}).length})}function mf(a){if(a.T&&0!=a.T.length){var b=nf(a),c=Cf(a);b.each(function(){$(this).data("designObject").scale(c.scale)})}}
function Ef(a){a.Te.forEach(function(b,c){var d=Cf(a),e=a.i.find(".canva.stack").eq(c),e=yf(e,b.Hd(),!!a.w,d),f=e.clone().scale(N).round();a.ig.eq(c).css(f.serialize());a.stopListening(b,"change");b.Sa(e,d.scale);b.Ma();a.listenTo(b,"change",a.ih)})}y.remove=function(){Gf(this);this.T.each(function(){var a=$(this);a.hasClass("focused")&&0<a.parents("#overlays").length&&ye(a)});U.prototype.remove.call(this);this.stopListening();this.T.remove();this.Te.forEach(function(a){a.remove()})};
y.nb=function(){var a=this.i.data("toolbar");a&&a.find(".elementToolbarColor").each(function(){var a=$(this).data("picker");a&&(a.remove(),$(this).removeData("picker"))});U.prototype.nb.call(this);Gf(this);this.mc()};function Gf(a){a.T.each(function(){var a=$(this).data("textToolbar");a&&a.find(".dd-container").ddslick("destroy");a&&a.remove();$(this).removeData("textToolbar")})}
y.L=function(){U.prototype.L.call(this);ic(this);Ef(this);Hf(this);var a=this.i,b=a.data("selectionBox");b&&this.w&&(this.w.Ic&&b.addClass("verticalScale"),this.w.Hc&&b.addClass("horizontalScale"));var c=a.data("toolbar");c&&0<c.length&&this.Ka().forEach(function(a,b){a&&c.find(".elementToolbarColor").eq(b).find(".pickAColor > span").css("background-color",a.color)});if(a.is(".cropping"))this.xc();else{this.mc();var d=this,a=$("#overlays .svg.text.focused"),b=(a=a.filter(function(){return d==$(this).data("canvaElement")}))&&
a.data("textToolbar");if(0<a.length&&b){var e=Fb(a.get(0).getBoundingClientRect()),f=this.na.get(0).getBoundingClientRect(),g=f.left-this.M.Z(),f=f.top-this.M.ga();e.translate(-g,-f);If(b,a);Ie(b,e,1)}}};y.Gd=function(){return{id:this.Na,version:this.Oa}};
y.Wd=function(a,b){this.Na=a;this.Oa=b;var c=this,d=this.i;af(this.Na,this.Oa,function(a,b,g){a=g["print"==Ye?Ze:$e];a.match(/^data:image\/svg\+xml;base64,/i)?($("img.placeholder",d).remove(),g=window.atob(a.substr(a.indexOf(",")+1)),ff(c,g)):(c.i.find("img.placeholder").attr("src",g[We]),$.ajax({url:a,dataType:"text",context:c}).done(function(a){ff(this,a,function(){$("> img.placeholder",d).remove();c.Ha()})}))})};
function Hf(a){Jf(a);var b=a.ta();if(0<b.length){var c=b.get(0),d=c.getAttribute("class");"/static/images/placeholder.jpg"!=c.getAttribute("xlink:href")&&c.setAttribute("class",d+" active");c=1/Ff(a)/N;a="stroke-width: "+1*c+"px;";c="stroke-dasharray: "+3*c+" "+3*c+";";b.next(".outline").get(0).setAttribute("style",a+c)}}
function Jf(a){var b=$("image.placeholder.active",a.i);b.each(function(){var a=b.get(0),d=a.getAttribute("class"),d=d.replace(/\s*\bactive\b/g,"");a.setAttribute("class",d);b.next(".outline").get(0).removeAttribute("style")})}y.Bg=function(){Jf(this)};y.ld=function(a){this.Zc()||(this.sg=a,Hf(this))};
y.xa=function(a){var b=this.vb(a),c=new O(parseInt(b.attr("x"),10),parseInt(b.attr("y"),10),parseInt(b.attr("width"),10),parseInt(b.attr("height"),10)),d=this.jb(a);c.scale(Ff(this)).translate(-d.l(),-d.j());return{type:"image",index:a,mediaId:b.data("mediaId"),mediaVersion:b.data("mediaVersion"),imageBox:c.serialize()}};
y.pb=function(a,b){function c(b,c){var e=d.xa(a);b===e.mediaId&&c===e.mediaVersion&&d.trigger("placeholderImage:loaded",a)}var d=this,e=this.vb(a),f=this.jb(a),g=Fb(b.imageBox);df();g.translate(f.l(),f.j()).scale(1/Ff(this));e.attr("width",g.g()).attr("height",g.h()).attr("x",g.l()).attr("y",g.j());b.mediaId?(e.data("mediaId",b.mediaId).data("mediaVersion",b.mediaVersion),af(b.mediaId,b.mediaVersion,Ve(e,c))):this.ag(a)};
y.ag=function(a){this.vb(a).removeData("mediaId").removeData("mediaVersion").attr("xlink:href","/static/images/placeholder.jpg");qf(this.i,this.lc);ef()};y.ta=function(){var a=this.sg;a||(a=$("image.placeholder",this.i).filter(function(){return"/static/images/placeholder.jpg"!=$(this).attr("xlink:href")}).first());return a};y.Fd=function(){var a=this.ta();return $("image.placeholder",this.i).index(a)};y.vb=function(a){return $("image.placeholder",this.i).eq(a)};y.wa=function(){return this.lc.length};
y.xc=function(){Ne.call(this);var a=this.i.data("cropControls");$(".viewPort",a).css("display","none");if(0==$("svg",a).length){var b=this.ta().clone().get(0),c=this.U().scale(1/Ff(this)).round(),d=document.createElementNS("http://www.w3.org/2000/svg","svg"),e=document.createElementNS("http://www.w3.org/2000/svg","g");d.appendChild(e);e.appendChild(b);d.setAttribute("viewBox",[c.l(),c.j(),c.g(),c.h()].join(" "));b=$(d).find("> g").get(0);b.classList.add("cropLayer");b.classList.add("masked");a.append(d)}d=
this.U();d.scale(N).round();a.find("svg").css("transform",fc({uc:d.l(),Oc:d.j()})).css("width",d.g()).css("height",d.h())};y.Oe=function(a,b){Pe.call(this,a,b);var c=this.i.data("cropControls"),d=this.ta(),c=$("g.cropLayer image",c),e=this.U(),f=this.Ja();f.translate(e.l(),e.j()).scale(1/Ff(this));d.attr("x",f.l()).attr("y",f.j());c.attr("x",f.l()).attr("y",f.j())};
y.eb=function(a){Ff(this);var b=this.ta(),c=this.i.data("cropControls"),c=$("g.cropLayer image",c),d=this.U();a=a.clone();a.translate(d.l(),d.j()).scale(1/Ff(this));c.attr("x",a.l()).attr("y",a.j()).attr("width",a.g()).attr("height",a.h());b.attr("x",a.l()).attr("y",a.j()).attr("width",a.g()).attr("height",a.h())};y.jb=function(a){var b=Ff(this);a=this.lc[a].clone();a.scale(b);return a};
y.Ja=function(){var a=this.ta(),b=this.U(),a=new O(parseFloat(a.attr("x")),parseFloat(a.attr("y")),parseFloat(a.attr("width")),parseFloat(a.attr("height")));a.scale(Ff(this)).translate(-b.l(),-b.j());return a};y.Ib=function(){var a=this.i;a.removeClass("cropping");var b=this.ta(),a=a.data("cropControls"),a=$("g.cropLayer image",a);b.attr("x",a.attr("x"));b.attr("y",a.attr("y"));b.attr("width",a.attr("width"));b.attr("height",a.attr("height"))};
y.serialize=function(){var a=this.i,b=U.prototype.serialize.call(this);a.find("svg");b.type="svg";b.mediaId=this.Na;b.mediaVersion=this.Oa;0!==Ff(this)&&(b.scaleStretch=Cf(this));for(var c=this,d=[],a=c.wa(),e=0;e<a;e++){var f=c.xa(e);void 0!==f.mediaId&&null!==f.mediaId&&void 0!==f.mediaVersion&&null!==f.mediaVersion&&d.push(f)}this.T&&this.T.each(function(a){a=c.ya(a);a.type="text";d.push(a)});0<d.length&&(b.contents=d);a=this.Ka().map(function(a,b){return{index:b,color:a.color}});0<a.length&&(b.fillColors=
a);return b};y.Ac=function(){var a=$();this.T&&(a=this.T.filter(".focused"));return a};y.Rb=function(){var a=new Wb;this.T&&this.T.each(function(b,c){de($(c)).hb.forEach(function(b){Xb(a,new Rb(b))})});this.Ka().forEach(function(b){Xb(a,new Rb(b.color))});return a};y.kb=function(a){return this.T?this.T.eq(a):$()};y.va=function(){return this.T.index(this.Ac())};
y.ya=function(a){if(0>a||a>=this.T.length)throw"SvgElement.getTextAtIndex - invalid index: "+a.toString();var b={index:a},c=this.T.eq(a);b.html=$(".inner",c).html();$.each(Tc,function(a,e){b[e]=c.data(e)});c.data("colorObj")&&(b.color=c.data("colorObj").color);(a=c.data("designObject"))&&(b.preferredFontSize=a.Fe);return b};
y.qc=function(a,b){if(this.T&&!(0>a||a>this.T.length-1)){var c=this.T.eq(a),d=$("> .inner",c);d.html(b.html);var e=("true"==d.attr("contentEditable")).toString();d.attr("contentEditable","true");for(var f=window.getSelection(),g=[],h=0;h<f.rangeCount;h++)g.push(f.getRangeAt(h));h=document.createRange();h.selectNodeContents(c.get(0));f.removeAllRanges();f.addRange(h);this.Vb(a,b.fontFamily);this.setColor(a,Qb(b.color));f.removeAllRanges();g.forEach(function(a){f.addRange(a)});this.ob(a,b.fontSize*
Cf(this).scale);this.oc(a,b.bold);this.pc(a,b.italic);this.Bb(a,b.justification);this.md(a,b.list);c=c.data("designObject");void 0!==b.preferredFontSize&&(c.Fe=b.preferredFontSize);d.attr("contentEditable",e)}};y.ob=function(a,b){var c=this.kb(a);if(void 0===b)c.removeData("fontSize").css("font-size","");else{var d=Cf(this).scale;c.data("fontSize")!==b/d&&(c.data("fontSize",b/d).css("font-size",b*Ra+"%"),this.trigger("change:fontSize",this,c,b))}};
y.cc=function(a){a=pe.call(this,a);var b=Cf(this).scale;return a*b};y.Pe=function(a){var b=this.Ac().data("designObject"),c=Cf(this).scale;b.Fe=a/c;oe.apply(this,arguments)};y.Ka=function(){var a=Kf(this);return _.sortBy(a,function(a,c){return parseInt(c.match(/\d+/)[0],10)})};
function Kf(a){var b={};a.i.find("> svg").find(".color").each(function(){for(var a,d=0;d<this.classList.length;d++){var e=this.classList.item(d);if(e.match(/^color-\d+$/)){a=e;break}}void 0!=a&&(d=Qb(this.getAttribute("fill")),null!=d&&(b[a]=d))});return b}y.Vd=function(a,b){var c=Kf(this),c=_.sortBy(_.keys(c),function(a){return parseInt(a.match(/\d+/)[0],10)})[a];this.i.find("> svg").find("."+c).each(function(){var a=b?b.color:this.getAttribute("data-color");this.setAttribute("fill",a)})};
function Sc(a,b){U.call(this,a);var c=this,d=this.i;d.data("placeholderText",a.placeholderText||"Querulous, playful pangolins").addClass("text").append('<div class="inner">Querulous, playful pangolins</div>');this.Ah=a.style;this.Wa={};this.qc(0,a);this.Wa=$.extend(!0,{},a.stylesOverriden);var e=a.html,e=e+('<font face="'+a.fontFamily+'"></font>');he(e,function(){var e=$("<div></div>");e.css("opacity",0).css("width",a.width).appendTo($("#canvaDocument > .inner .page .elements").first());var g=d.clone();
g.css("height","").appendTo(e);window.setTimeout(function(){var d=g.height();e.remove();c.$f=!0;c.Ha();c.q(a.height||d);c.P();c.S();c.i.css("opacity",1);c.pa();L.trigger("elementLoaded",c);L.trigger("elementLoaded:text",c);b&&b(c)},20)});null!=a.height&&c.q(a.height);c.i.css("opacity",0);c.$f=!1}Sc.prototype=new U;y=Sc.prototype;y.Vb=je;y.ob=ne;y.Pe=oe;y.Bb=qe;y.setColor=re;y.oc=se;y.pc=ue;y.md=ve;y.kg=xe;y.cc=pe;y.Vb=function(a,b,c){this.Wa.fontFamily=!0;je.apply(this,arguments)};
y.ob=function(a,b){var c=this.i;this.Wa.fontSize=!0;ne.apply(this,arguments);te(c)};y.oc=function(a,b){var c=this.i;this.Wa.bold=!0;se.apply(this,arguments);te(c)};y.pc=function(a,b){this.Wa.italic=!0;ue.apply(this,arguments)};y.Bb=function(a,b){this.Wa.justification=!0;qe.apply(this,arguments)};y.setColor=function(a,b){this.Wa.color=!0;re.apply(this,arguments)};var Lf={Ik:"title",Hk:"subtitle",yk:"body"};y=Sc.prototype;
y.q=function(a){var b=this.i.find(".inner").height();this.J=void 0!==a?a:b;this.i.css("height",this.J*N)};y.pa=function(){var a=this.i,b=Math.round(0.5*this.A*(N-1)),c=Math.round(0.5*this.J*(N-1));a.find("> .inner").css("transform","translate("+b+"px, "+c+"px) scale("+N+")").css("width",this.A);U.prototype.pa.apply(this,arguments)};y.Ac=s("i");y.Rb=function(){var a=new Wb;de(this.i).hb.forEach(function(b){Xb(a,new Rb(b))});return a};y.kb=function(a){return 0!==a?$():this.i};y.va=t(0);
y.ya=function(a){var b={index:a};b.stylesOverriden=$.extend(!0,{},this.Wa);var c=this.i;b.html=$(".inner",c).html();$.each(Tc,function(a,e){b[e]=c.data(e)});c.data("colorObj")&&(b.color=c.data("colorObj").color);b.height=this.h();return b};y.qc=function(a,b){$("> .inner",this.i).html(b.html);this.Vb(a,b.fontFamily);this.ob(a,b.fontSize);this.oc(a,b.bold);this.pc(a,b.italic);this.Bb(a,b.justification);this.md(a,b.list);var c=Qb(b.color);this.setColor(a,c);this.Wa=$.extend(!0,{},b.stylesOverriden)};
y.md=function(a,b){void 0!==b&&ve.call(this,a,b)};y.remove=function(){var a=this.i;0<a.parents("#overlays").length&&ye(a);U.prototype.remove.call(this)};y.L=function(){U.prototype.L.call(this);var a=this.i,b=this.Z(),c=this.ga();this.V();this.l();var d=c+(this.Q()-this.j())*N;if(c=a.data("textToolbar")){var e=a.data("selectionBox");e&&!e.hasClass("horizontalScale")&&e.addClass("horizontalScale");If(c,a);a=new O(b,d,this.Fa()*N,this.Ca()*N);Ie(c,a,1)}};
y.nb=function(){U.prototype.nb.call(this);var a=this.i,b=a.data("textToolbar"),c=$(".textToolbarColor",b).data("picker"),d=$(".textToolbarJustification",b).data("dropdown"),e=$(".textToolbarList",b).data("dropdown");b&&b.find(".dd-container").ddslick("destroy");b&&b.remove();c&&c.remove();d&&d.remove();e&&e.remove();a.removeData("textToolbar")};
y.serialize=function(){var a=U.prototype.serialize.call(this);a.type="text";a.style=this.Ah;a.stylesOverriden=$.extend(!0,{},this.Wa);var b=this.ya(0),c;for(c in b)a[c]=b[c];return a};
function Be(a){function b(){c.stopListening(c,"placeholderImage:loaded");L.trigger("elementLoaded",c);L.trigger("elementLoaded:grid",c)}void 0===a&&(a={});a.width=a.width||300;a.height=a.height||300;U.call(this,a);this.spacing=a.spacing||Ib;this.H=a.items||Mf.Vk.H;this.contents=a.contents||[];this.yb=!0;this.i.addClass("grid").css("width",this.A*N).css("height",this.J*N);Nf(this,Of(this.H));var c=this;a=_.after(this.contents.length,b);this.listenTo(this,"placeholderImage:loaded",a);this.contents.forEach(function(a){c.pb(a.index,
a)});0===this.contents.length&&b()}Be.prototype=new U;y=Be.prototype;y.Zc=Le;y.Ja=Me;y.xc=Ne;y.Oe=Pe;y.eb=Qe;y.mc=Re;y.Ib=Se;y.U=Te;y.ye=Ue;var Ib=10;
function Of(a){function b(a){var d=a.type||"rows";a=a.children||a;for(var e=$(),f=0,g=0;g<a.length;g++){var h=a[g],l=$('<div class="'+h.type+'"></div>');"item"==h.type&&$('<div class="content"><div class="placeholder" /></div>').appendTo(l);if("rows"==d){var m=1/(a.length-g)*(100-f),m=h.height||m,n=f;l.css("top",n+"%").css("height",m+"%").attr("data-top",n/100).attr("data-height",m/100)}else m=1/(a.length-g)*(100-f),m=h.width||m,n=f,l.css("left",n+"%").css("width",m+"%").attr("data-left",n/100).attr("data-width",
m/100);f+=m;void 0!==h.children&&l.append(b(h));e=e.add(l)}return e}return b([{type:"rows",children:a}])}function Nf(a,b){var c=a.i;c.empty();$('<div class="inner"></div>').append(b).appendTo(c)}y=Be.prototype;
y.Ha=function(){U.prototype.Ha.call(this);var a=$("> .inner",this.i),b=Math.round(Math.round(this.spacing/2)*N);a.css("left",b).css("right",b).css("top",b).css("bottom",b);$(".item > .content",a).css("left",b).css("right",b).css("top",b).css("bottom",b);$(".item.filled > .content .placeholder",a).each(function(a,b){var e=Fb($(b).data("imageRect"));e.scale(N).round();$(b).css(Oe(e,0))})};
y.L=function(){U.prototype.L.call(this);var a=this.i,b=this.Z(),c=this.ga(),b=b+(this.V()-this.l())*N,c=c+(this.Q()-this.j())*N,c=new O(b,c,this.Fa()*N,this.Ca()*N);(b=a.data("gridToolbar"))&&Ie(b,c,1);a.is(".cropping")?this.xc():this.mc()};y.nb=function(){U.prototype.nb.call(this);var a=this.i;this.mc();var b=a.data("gridToolbar");b&&b.remove();a.removeData("gridToolbar")};function Pf(a,b){a.spacing=b;a.Ha()}
y.serialize=function(){var a=U.prototype.serialize.call(this);a.type="grid";a.items=this.H;a.spacing=this.spacing;for(var b=[],c=this.wa(),d=0;d<c;d++){var e=this.xa(d);void 0!==e.mediaId&&null!==e.mediaId&&void 0!==e.mediaVersion&&null!==e.mediaVersion&&b.push(e)}a.contents=b;return a};y.ld=function(a){if(!this.Zc()){var b=$(".item .placeholder.active, div.content.active",this.i);0<b.length&&b.removeClass("active");a.attr("src")&&a.parent("div.content").andSelf().addClass("active")}};
y.ta=function(){var a=$(".item .active.placeholder",this.i).first();0==a.length&&(a=$(".item .placeholder",this.i).filter(function(){return void 0!=$(this).attr("src")}).first());return a};y.Fd=function(){var a=this.ta();return $(".item .placeholder",this.i).index(a)};y.vb=function(a){return $(".item .placeholder",this.i).eq(a)};y.wa=function(){return this.i.find(".item .placeholder").length};
y.jb=function(a){a=this.vb(a).parent("div.content");var b=new O(0,0,this.A,this.J),c=a.parentsUntil(".inner").reverse();a.parent(".item");Hb(b);c.each(function(a,c){c=$(c);var f=parseFloat(c.data("left"))||0,g=parseFloat(c.data("top"))||0,h=parseFloat(c.data("width"))||1,l=parseFloat(c.data("height"))||1;b.translate(f*b.g(),g*b.h()).D(b.g()*h).q(b.h()*l)});b.D(b.g()-Ib).q(b.h()-Ib);return b};
y.xa=function(a){var b=this.vb(a),c={type:"image",index:a,mediaId:b.data("mediaId"),mediaVersion:b.data("mediaVersion")};b.data("mediaId")?c.imageBox=b.data("imageRect"):(a=this.jb(a),a.S(0).P(0),c.imageBox=a.serialize());return c};
y.pb=function(a,b){function c(b,c){var e=d.xa(a);b===e.mediaId&&c===e.mediaVersion&&d.trigger("placeholderImage:loaded",a)}var d=this,e=this.vb(a),f=Fb(b.imageBox),g=f.clone();g.scale(N).round();var h=e.parents(".content").first();b.mediaId?(h.parent(".item").addClass("filled"),h=$('<img class="placeholder" />'),h.css(g.serialize()).data("imageRect",f.serialize()).data("mediaId",b.mediaId).data("mediaVersion",b.mediaVersion),e.replaceWith(h),af(b.mediaId,b.mediaVersion,Ve(h,c))):(h.parent(".item").removeClass("filled"),
e.replaceWith('<div class="placeholder" />'))};y.ag=k();function xf(a){this.pg=a.vk;this.rb=Fb(a.fe);this.Ga=this.rb.clone();this.Uj=a.Hc;this.dg=a.Ic;this.ma=a.contents;this.qg=[];this.bj=[];this.Kc=1;this.Yc=Qf(this);this.Vg=this.rb.h()-Rf(this);Sf(this);this.Ma();var b=this;this.ma.forEach(function(a){b.listenTo(a,"change:width",b.Ma);b.listenTo(a,"change:height",b.Ma)})}xf.prototype.trigger=Backbone.Events.trigger;xf.prototype.listenTo=Backbone.Events.listenTo;xf.prototype.stopListening=Backbone.Events.stopListening;_.extend(xf.prototype,Backbone.Events);
y=xf.prototype;y.remove=function(){var a=this;this.stopListening(this);this.ma.forEach(function(b){a.stopListening(b)})};y.D=function(a){Df(a,this.g())||(this.rb.D(a),this.Ma(),this.trigger("change:width",this),this.trigger("change",this))};y.g=function(){return this.rb.g()};y.q=function(a){Df(a,this.h())||(this.rb.q(a),this.Ma(),this.trigger("change:height",this),this.trigger("change",this))};y.h=function(){return this.rb.h()};
y.setSize=function(a,b,c){var d=this.g()!==a,e=this.h()!==b;if(d||e)this.rb.setSize(a,b),this.Kc!==c&&(this.Kc=c,Tf(this)),this.Ma(),d&&this.trigger("change:width",this),e&&this.trigger("change:height",this),this.trigger("change",this)};y.Sa=function(a,b){this.rb.S(a.l()).P(a.j());this.setSize(a.g(),a.h(),b)};y.B=function(){return this.rb.clone()};y.Hd=function(){return this.Ga.clone()};function Qf(a){a=a.ma.map(function(a){return a.B()});return Array.min(a.map(function(a){return a.j()}))}
function Rf(a){a=a.ma.map(function(a){return a.B()});return Array.max(a.map(function(a){return a.G()}))}function Uf(a){var b=Qf(a);return Rf(a)-b}function Vf(a){a=a.ma.slice(0);a.sort(function(a,c){var d=a.Hd(),e=c.Hd();return d.j()<e.j()?-1:d.j()>e.j()?1:0});return a}function Sf(a){a.qg=[];if(!(2>a.ma.length)){var b=Vf(a);a.ma.forEach(function(c){var d=b.indexOf(c);d==a.ma.length-1?d=0:(c=c.B(),d=b[d+1].B().j()-c.G());a.qg.push(d)})}}
function Wf(a,b){a.ma.forEach(function(c){var d=c.B();d.translate(0,b);a.stopListening(c);c.Sa(d,a.Kc);a.listenTo(c,"change:width",a.Ma);a.listenTo(c,"change:height",a.Ma)})}function Tf(a){a.ma.forEach(function(b){a.stopListening(b);b.scale(a.Kc);a.listenTo(b,"change:width",a.Ma);a.listenTo(b,"change:height",a.Ma)})}
y.Ma=function(){var a=this;this.ma.forEach(function(b){a.stopListening(b);if(!b.Zd)if(b.qf)Xf(b);else{var c=b.B(),d=Yf(b);c.D(d.width);c.q(d.height);b.Sa(c)}});var b=0===this.bj.length;this.ma.forEach(function(c){if(a.Uj&&b){var d=c.B();d.g()!==a.g()&&(d.D(a.g()),c.Sa(d,a.Kc))}});var c=Vf(this);c.forEach(function(b,d){if(0!==d){var e=c[d-1],f=a.ma.indexOf(e),n=a.qg[f],f=b.B(),e=e.B().G()+n*a.Kc;f.P(e);b.Sa(f,a.Kc)}});var d=Uf(this),e=this.rb.h();if("CENTER"==this.pg){var f=this.Yc+this.Vg,f=e-d-f,
f=this.Yc+f/2,f=f-Qf(this);Wf(this,f);d>e&&this.dg&&(f=-Qf(this),Wf(this,f),this.q(d))}else"TOP"==this.pg?this.Yc+d>e&&this.dg&&this.q(this.Yc+d):"BOTTOM"==this.pg&&(f=this.Yc+this.Vg,f=e-d-f,f=this.Yc+f,f-=Qf(this),Wf(this,f),d>e&&this.dg&&(f=-Qf(this),Wf(this,f),this.q(d)));this.ma.forEach(function(b){a.listenTo(b,"change:width",a.Ma);a.listenTo(b,"change:height",a.Ma)})};
function wf(a,b,c){this.Fb=a;this.Ga=a.data("rect").clone().translate(-b,-c);this.Ad=!!a.data("dynamicWidth");this.ne=!!a.data("dynamicHeight");this.qf=!!a.data("dynamicFontSize");this.Fe=a.data("defaultFontSize");this.qf&&(this.ne=this.Ad=!1);this.Ad&&this.ne&&(this.Ad=!1);this.C={$e:0,qd:0,ra:0,da:1};this.Zd=!1}wf.prototype.trigger=Backbone.Events.trigger;wf.prototype.listenTo=Backbone.Events.listenTo;wf.prototype.stopListening=Backbone.Events.stopListening;_.extend(wf.prototype,Backbone.Events);
var zf="center",Af="right",Zf="width",$f="height";wf.prototype.Hd=function(){return this.Ga.clone()};wf.prototype.B=function(){var a=this.Ga.clone();a.P(this.C.$e+this.Ga.j()*this.C.da).S(this.Ga.l()*this.C.da).D(this.C.qd+a.g()*this.C.da).q(this.C.ra+a.h()*this.C.da);return a};
wf.prototype.Sa=function(a,b){void 0===b&&(b=this.C.da);var c=this.B(),d=a.clone().scale(N).round();this.Fb.css(d.serialize());ag(this);this.C.da=b;this.C.$e=a.j()-this.Ga.j()*this.C.da;this.C.qd=a.g()-this.Ga.g()*this.C.da;this.C.ra=a.h()-this.Ga.h()*this.C.da;var d=!Df(c.g(),a.g()),e=!Df(c.h(),a.h());d&&this.trigger("change:width",this,a.g()-c.g());e&&this.trigger("change:height",this,a.h()-c.h());(d||e)&&this.trigger("change",this)};
wf.prototype.scale=function(a){this.Ga.clone();this.B();this.C.$e*=a/this.C.da;this.C.qd*=a/this.C.da;this.C.ra*=a/this.C.da;this.C.da=a};function ag(a){if(a.Fb.hasClass("text")){var b=a.B();a=a.Fb.find("> .inner");a.css("width",b.g()).css("height","");var c=a.height(),b=Math.round(0.5*b.g()*(N-1)),d=Math.round(-c/2);a.css("height",c).css("position","absolute").css("top","50%").css("transform","translate("+b+"px, "+d+"px) scale("+N+")")}}
function Xf(a){if(!a.Zd){a.Fb.data("fontSize");var b=bg(a),c=a.Fb.data("canvaElement"),d=a.Fb.data("textIndex");a.Zd=!0;c.ob(d,b);a.Zd=!1;ag(a)}}function tf(a){var b;if(!a.Zd)if(a.qf)Xf(a);else{var c=a.B();b=Yf(a);var d=b.width;b=b.height;a.Ad&&(d=Math.max(d,a.Ga.g()*a.C.da));a.ne&&(b=Math.max(b,a.Ga.h()*a.C.da));c.D(d);c.q(b);a.Sa(c)}}
function bg(a){function b(a,b,d){var m="width"==a?b.width:b.height;a="width"==a?e:f;var n=m.call(b);d/=n/a;b.css("font-size",d*Ra+"%");n=m.call(b);if(0==n)return c;if(n>a)for(;n>a&&!(d*=0.95,b.css("font-size",d*Ra+"%"),n=m.call(b),n<a||8>d););else if(n<a)for(;n<a;)if(d/=0.95,b.css("font-size",d*Ra+"%"),n=m.call(b),n>a||d>c){d*=0.95;break}return d=Math.max(Math.min(c,d),8)}var c=a.Fe*a.C.da,d=parseFloat(a.Fb.data("fontSize"))*a.C.da,e=Math.floor(a.C.qd+a.Ga.g()*a.C.da),f=Math.floor(a.C.ra+a.Ga.h()*
a.C.da);a=a.Fb.clone();a.addClass("element").appendTo("#canvaDocument > .inner").css("width","").css("height","");a.find(" > .inner").css("width","").css("height","").css("transform","").css("position","").css("top","");d=b("width",a,d);a.css("font-size",d*Ra+"%");a.height()>f&&(a.css("width",a.width()),d=b("height",a,d));a.remove();return d}
function Yf(a){function b(a,b,c){var d=b===$f?c:"";c=b===Zf?c:"";a=a.clone();b===Zf&&a.css("white-space","nowrap");a.addClass("element").appendTo("#limbo").css("width",d).css("height",c);a.find(" > .inner").css("width",d).css("height",c).css("transform","").css("position","").css("top","");b=a.get(0).getBoundingClientRect()[b];a.remove();return b}var c=a.C.qd+a.Ga.g()*a.C.da,d=a.C.ra+a.Ga.h()*a.C.da,e=a.Fb;a.Ad&&(c=b(e,Zf,d));a.ne&&(d=b(e,$f,c));return{width:c,height:d}};function cg(){this.$a=null;this.Yb=dg;this.Af=[]}cg.prototype.vf=s("$a");cg.prototype.wb=s("Yb");
var dg="UNINITIALIZED",eg="INITIALIZED",fg={Mb:function(a,b){this.Vf=b.permissions.data[0]},param:"permissions"},gg={xk:{Mb:function(a){this.Fh=a.accessToken}},zk:{Mb:k(),param:"email"},Bk:{Mb:k(),param:"first_name"},Ck:{Mb:function(a){this.id=a.userID}},Dk:{Mb:k(),param:"last_name"},Ek:{Mb:function(a,b){this.name=b.name},param:"name"},Fk:fg,Gk:{Mb:k(),param:"picture.type(large)"},Ak:{Mb:function(a){this.pk=(new Date).getTime()+1E3*a.expiresIn}}};
function hg(a,b,c,d,e,f,g,h,l){this.lb=a;this.td=b;this.qk=c;this.Pd=f;this.nh=l}hg.prototype.t=s("lb");hg.prototype.getName=s("Pd");y=cg.prototype;
y.init=function(a){function b(a){FB.Event.subscribe("auth.authResponseChange",function(b){"connected"==b.status?a.Wc().then(c).fail(d):a.$a=null});FB.init({appId:"525265914179580",channelUrl:"//"+window.location.hostname+"/static/channel.html",status:!0,xfbml:!1});a.Yb=eg;for(var b=a.Af.length,e=0;e<b;e++)a.Af.pop()(a)}function c(a){e.$a=a}function d(){e.$a=null}var e=this;this.Yb==eg?a(e):(this.Af.push(a),"INITIALIZING"!=this.Yb&&(this.Yb="INITIALIZING",window.fbAsyncInit=function(){b(e)},function(a,
b,c){var d=a.getElementsByTagName(b)[0];a.getElementById(c)||(a=a.createElement(b),a.id=c,a.src="//connect.facebook.net/en_US/all.js",d.parentNode.insertBefore(a,d))}(document,"script","facebook-jssdk")))};y.getAuthResponse=function(){var a=new $.Deferred;FB.getAuthResponse()?a.resolve(FB.getAuthResponse()):FB.getLoginStatus(function(b){"connected"==b.status?a.resolve(b.authResponse):a.reject("UNAUTHORIZED")});return a.promise()};
y.Wc=function(){var a=this,b=[],c;for(c in gg)b.push(gg[c]);var d=new $.Deferred;this.se(b).then(function(b){a.$a=new hg(b.id,b.Fh,b.pk,0,0,b.name,0,0,b.Vf);d.resolve(a.$a)}).fail(function(a){d.reject(a)});return d.promise()};
y.se=function(a){var b=this,c=new $.Deferred;b.getAuthResponse().then(function(b){for(var e=[],f=0;f<a.length;f++){var g=a[f];g.param&&e.push(g.param)}FB.api("/me?return_ssl_resources=1&fields="+encodeURIComponent(e.join(",")),function(e){if("error"in e)c.reject("FB_API_ERROR");else{for(var f={},g=0;g<a.length;g++)a[g].Mb.call(f,b,e);c.resolve(f)}})}).fail(function(a){b.$a=null;c.reject(a)});return c.promise()};
y.wd=function(a){var b=this,c=new $.Deferred;this.se([fg]).then(function(d){var e=[];b.$a&&(b.$a.nh=d.Vf);e=d.Vf;d=[];for(var f in a)null==e[a[f]]&&d.push(a[f]);c.resolve(d)}).fail(function(a){c.reject(a)});return c.promise()};
y.Ge=function(a){function b(a){h.resolve(a)}function c(a){this.$a=null;h.reject(a)}var d=this,e=[],f=d.$a?d.$a.nh:[],g;for(g in a)null==f[a[g]]&&e.push(a[g]);var h=$.Deferred();0<e.length?FB.login(function(e){e.authResponse&&e.status?d.wd(a).then(b).fail(c):h.reject("FB_API_ERROR")},{scope:e.join(",")}):d.wd(a).then(b).fail(c);return h.promise()};function ig(a,b){this.O=a;this.Nb=b}function jg(a){var b=new ig(sa,new cg);b.init(function(){a(b)});return b}y=ig.prototype;y.init=function(a){var b=this;this.Nb.init(function(){a(b)})};y.wd=function(a){return this.Nb.wd(a)};y.Wc=function(){return this.Nb.Wc()};y.se=function(a){return this.Nb.se(a)};y.getAuthResponse=function(){return this.Nb.getAuthResponse()};y.wb=function(){return this.Nb.wb()};y.vf=function(){return this.Nb.vf()};y.Ge=function(a){return this.Nb.Ge(a)};
function kg(){return pa.Ge(["user_photos","user_status"])}function lg(a,b,c){this.og=a;this.J=b;this.A=c}lg.prototype.Sb=s("og");lg.prototype.h=s("J");lg.prototype.g=s("A");function mg(a,b,c,d){this.lb=a;this.Pd=b;this.ok=c;this.Hj=d}mg.prototype.t=s("lb");mg.prototype.getName=s("Pd");function ng(a,b,c){this.lb=a;this.Pd=b;this.nj=c}ng.prototype.t=s("lb");ng.prototype.getName=s("Pd");ng.prototype.dc=s("nj");
function og(a,b){if(a.wb()!=eg)throw"Unable to perform action. FB API not yet initialized";var c={};void 0!==b&&(c.offset=b);c.limit=10;var d=new $.Deferred;FB.api("/me/albums?return_ssl_resources=1",c,function(a){"error"in a?d.reject("FB_API_ERROR"):(a=a.data.map(function(a){return new ng(a.id,a.name,a.count||0)}),d.resolve(a))});return d.promise()}
function pg(a,b,c,d){if(a.wb()!=eg)throw"Unable to perform action. FB API not yet initialized";a={};void 0!==c&&(a.offset=c);void 0!==d&&(a.limit=d);var e=new $.Deferred;FB.api("/"+encodeURIComponent(b)+"/photos?return_ssl_resources=1",a,function(a){"error"in a?e.reject("FB_API_ERROR"):(a=a.data.map(function(a){var b=a.height,c=a.width,d=a.source,e=b/4.6,f=c/4.6,q=a.picture,u=a.images.filter(function(a){return a.source===q});0<u.length&&(e=u[0].height,f=u[0].width);u=a.images.sort(function(a,b){return b.height-
a.height})[0];if(u.width>c||u.height>b)b=u.height,c=u.width,d=u.source;return new mg(a.id,a.name,new lg(q,e,f),new lg(d,b,c))}),e.resolve(a))});return e.promise()}
function qg(a,b){var c=pa;function d(c){n=n.concat(c);var f=n.reduce(function(a,b){return a+b.dc()},0)<a+b;c=0<c.length&&10>=c.length;f&&c?og(l,n.length).done(d).fail(h):e()}function e(){var c=0,d=n.filter(function(b){c+=b.dc();return c>a}),e=n.filter(function(a){return-1===d.indexOf(a)}).reduce(function(a,b){return a+b.dc()},0),m=[],p=0;d.forEach(function(c,d){var g=0===d?a-e:0,h=Math.min(b,c.dc()-g);p<b&&(g=pg(l,c.t(),g,h).done(f),m.push(g));p+=h});$.when.apply($.when,m).done(g).fail(h)}function f(a){m=
m.concat(a)}function g(){p.resolve(m)}function h(a){p.reject(a)}var l=c;if(c.wb()!=eg)throw"Unable to perform action. FB API not yet initialized";var m=[],n=[],p=new $.Deferred;og(c,0).done(d).fail(h);return p}
function rg(){var a=pa,b=new $.Deferred;if(a.wb()!=eg)throw"Unable to perform action. FB API not yet initialized";a.Wc().then(function(c){a.O.post("/profile/link/fb",{fbId:c.t(),fbToken:c.td,fbTokenExpires:c.qk},null,function(a){200==a?b.resolve(c):b.reject("ERROR")})}).fail(function(a){b.reject(a)});return b.promise()};function sg(a){this.we=!1;var b=this;b.re={};b.Yf=a;tg(b.Yf,function(a){b.load(a);ug(b)})}var vg=["templateSuperposition"];function ug(a){var b=window;b.onhashchange=function(){var c,d;/feature:/.test(b.location.hash)&&(d=b.location.hash.match(/feature:([a-zA-z]+)=(on|off)/))&&3===d.length&&(c=d[1],d=d[2],wg(a,c,d))}}function wg(a,b,c){function d(){e.re[b]=c}var e=a;-1===vg.indexOf(b)||"on"!==c&&"off"!==c||e.Yf.set(b,c,d)}
sg.prototype.load=function(a){var b=this;vg.forEach(function(c){b.re[c]="off";a&&"on"===a[c]&&(b.re[c]="on")});b.we=!0};function xg(){this.width=this.height=0;this.url="";this.version=0}xg.prototype.g=s("width");xg.prototype.h=s("height");xg.prototype.R=s("version");xg.prototype.Sb=s("url");function yg(){this.id="";this.version=0;this.thumbnail=new xg;this.name=""}yg.prototype.t=s("id");yg.prototype.R=s("version");yg.prototype.getName=s("name");function zg(){this.content=null}zg.prototype=new yg;function Ag(a){return a?$.extend(new zg,a):null}function Bg(){this.items=[]}function Cg(){this.O=sa}
function Dg(a){(new Cg).O.get("/folders/layouts/"+encodeURIComponent(Gc(C))+"?",function(b,c){if(200==b){var d;c?(d=$.extend(new Bg,c),d.items&&(d.items=d.items.map(Ag))):d=null;a(b,d.items)}else a(b,null)})};function le(a){for(var b=0;b<db.length;b++)for(var c=db[b],d=0;d<c.Ob.length;d++){var e=c.Ob[d];if(e.name==a||e.k==a)return e.zc=c.zc,e}return null}function me(a,b){ie([a],b)}var Eg=[],Fg=[],Gg=[],Hg=[];function Ig(a,b){Eg=Eg.concat(a);Hg.push({ub:a,gb:b||k()})}
function Jg(){Hg.forEach(function(a){0===a.ub.filter(function(a){var c;c=(c=le(a))?void 0===c.url||0<=Fg.indexOf(a):!1;a=0<=Gg.indexOf(a);return!(c||a)}).length&&("function"!==typeof a.gb?a.lf=!0:a.lf||(a.lf=!0,a.gb(!0)))});Hg=Hg.filter(function(a){return!a.lf})}function Kg(a){Fg=Fg.filter(function(b){return 0>a.indexOf(b)});a.forEach(function(a){-1==Gg.indexOf(a)&&Gg.push(a)});Jg()}function Lg(a){a.forEach(function(a){-1==Fg.indexOf(a)&&Fg.push(a)});Jg()}
function ie(a,b){function c(a){return le(a).url.replace(/^.+\=/,"")}var d=_.uniq(a).filter(function(a){return null!==le(a)}),e=d.filter(function(a){var b=0<=Fg.indexOf[a];a=void 0===le(a).url;return!(b||a)}),f=e.filter(function(a){return 0>Eg.indexOf(a)}),f=_.uniq(f.map(c));0===_.uniq(e.map(c)).length?b&&b(!0):(Ig(d,b),Jg(),0<f.length&&WebFont.load({google:{families:f},active:function(){Lg(a)},inactive:function(){Kg(a)}}))}
function Mg(){var a=[];db.forEach(function(b){b.Ob.forEach(function(b){a.push(b)})});a.sort(function(a,c){return(a.name||a.k).localeCompare(c.name||c.k)});return a}function Ng(a){this.$g=a.justification;this.bh=a.list;this.Hf=a.italic;this.ef=a.bold;this.tf=a.fontSize;this.sf=a.fontFamily;this.hf=a.color}Ng.prototype.trigger=Backbone.Events.trigger;_.extend(Ng.prototype,Backbone.Events);y=Ng.prototype;
y.Bb=function(a){this.$g=a;this.trigger("change:justification",this);this.trigger("change",this);return this};y.md=function(a){this.bh=a;this.trigger("change:list",this);this.trigger("change",this);return this};y.pc=function(a){this.Hf=a;this.trigger("change:italic",this);this.trigger("change",this);return this};y.oc=function(a){this.ef=a;this.trigger("change:bold",this);this.trigger("change",this);return this};y.cc=s("tf");
y.ob=function(a){this.tf=a;this.trigger("change:fontSize",this);this.trigger("change",this);return this};y.Vb=function(a){this.sf=a;this.trigger("change:fontFamily",this);this.trigger("change",this);return this};y.setColor=function(a){this.hf=a;this.trigger("change:color",this);this.trigger("change",this);return this};y.serialize=function(){return{justification:this.$g,list:this.bh,italic:this.Hf,bold:this.ef,fontSize:this.tf,fontFamily:this.sf,color:this.hf}};function Og(a,b){this.og=a;this.Ug=$('<img src="'+a+'" />');this.Nd=!1;this.Be=[];void 0!==b&&Pg(this,b);if(this.Ug.complete)this.we();else{var c=this;this.Ug.on("load",function(){c.we()})}}function Pg(a,b){a.Be.push(b);a.Nd&&Qg(a)}function Qg(a){for(var b=0;b<a.Be.length;b++)a.Be[b](a.og);a.Be=[]}Og.prototype.we=function(){this.Nd=!0;Qg(this)};function sd(){this.zf={}}function Xe(a,b){var c=ca;if(void 0===c.zf[a]){var d=new Og(a);b&&Pg(d,b);c.zf[a]=d}else b&&Pg(c.zf[a],b)};function Rg(){this.location=window.location;this.mj=qc}function tc(a){a=a.location.hash.replace(/#/,"");var b=/^([0-9]+)x/,c=/x([0-9]+)$/,d=0,e=0;/^[0-9]+x[0-9]+$/.test(a)&&(d=parseInt(a.match(b)[1],10),e=parseInt(a.match(c)[1],10));return 0!==d*e?{width:d,height:e}:null}function uc(a){var b=a.location.hash.replace(/#/,"");return a.mj.hasOwnProperty(b)?b:null};function Sg(){this.id="";this.version=0;this.origin=Tg;this.description=this.title=this.artist=this.group=this.brand=null;this.recolorable=this.repeating=this.cutout=this.background=!1;this.oneTimeUsePriceCents=this.keywords=null;this.files={}}var Ug="FACEBOOK",Tg="CANVA";y=Sg.prototype;y.t=s("id");y.R=s("version");y.ec=s("origin");y.Ea=s("title");y.ca=s("background");y.$c=s("cutout");y.ad=s("repeating");y.Cc=s("recolorable");function Vg(a){return a.oneTimeUsePriceCents}y.uf=s("keywords");y.ab=s("files");
function Wg(a){if(!a)return null;a=$.extend(new Sg,a);if(a.files)for(var b in a.files)a.files[b]=a.files[b]?$.extend(new Xg,a.files[b]):null;return a}function Yg(){this.results=[]}function Zg(a){if(!a)return null;a=$.extend(new Yg,a);a.results&&(a.results=a.results.map(Wg));return a}function $g(a){this.O=a;this.Ra=this.Jc=this.Yb=this.Qa=null}function ah(a,b){if(a.Ra)throw"callback already set";a.Ra=b}
$g.prototype.search=function(a,b,c,d){function e(b,c){h.Yb=b;h.Jc=Zg(c);h.Ra&&h.Ra();(200!=b||0==h.Jc.results.length)&&I&&I.track("search",{query:a,success:200==b,num_results:200==b?h.Jc.results.length:0,cause:"typed"})}function f(){h.Jc=Zg({results:[]});h.Ra()}function g(a){for(var b=[],c=0;c<a.length;c++){var d=a[c],f=d.ok,g=d.Hj,f={height:f.h(),width:f.g(),url:f.Sb()},g={height:g.h(),width:g.g(),url:g.Sb()};b.push({id:d.t(),title:d.getName(),origin:Ug,files:{THUMBNAIL:f,SCREEN:g}})}e(200,{results:b})}
bh(this);var h=this;"facebook"==a.toLowerCase()?qg(b,c).then(g).fail(f):(b="/search?q="+escape(a)+(void 0!==c?"&limit="+escape(""+c):"")+(void 0!==b?"&from="+escape(""+b):"")+(void 0!==d?"&style="+escape(JSON.stringify(d)):""),h.Qa=h.O.get(b,e))};function bh(a){a.Qa&&(a.Qa.cancel(),a.Qa=null);a.Yb=null;a.Jc=null}$g.prototype.wb=s("Yb");var ch=13,dh=27,eh={Kk:8,ol:9,Ok:ch,shift:16,Mk:17,alt:18,Qk:dh,$k:37,sl:38,ll:39,Nk:40,"delete":46,one:49,ql:50,pl:51,Tk:52,Rk:53,a:65,b:66,c:67,d:68,e:69,f:70,Uk:71,Wk:72,Xk:73,Yk:74,Zk:75,bd:76,bl:77,fl:78,gl:79,hl:80,il:81,r:82,nl:83,od:84,rl:85,tl:86,ul:87,x:88,y:89,z:90,cl:91,Lk:188,eh:189,dl:173,Pg:187,Pk:61,Sk:191,jl:63,al:219,ml:221};function Md(){$(document).keydown(fh);var a=new gh;$(document).keydown(hh(a));$(document).keyup(a.save())}function gh(){ih(this)}
function ih(a){a.dd=null;a.Sc=[];a.tb={top:0,left:0}}function jh(a){kh();a.Sc.forEach(function(b){b={elementIndex:b.s(),pageIndex:P(C,b.v()),"new":{left:b.l(),top:b.j()},old:{left:b.l()-a.tb.left,top:b.j()-a.tb.top}};Q(D,new R(jc,b))});lh()}
function hh(a){return function(b){a.Sc=C.ba();var c=$(b.target);if("true"==c.attr("contenteditable")||c.is("input:focus")||c.is("textarea:focus"))return ih(a),!0;if(0<$(".dd-container.on").length)return!0;switch(b.which){case 37:a.dd=37;a.tb.left-=1*(1/N);a.Sc.forEach(function(a){a.ia-=1*(1/N);a.pa()});break;case 38:a.dd=38;a.tb.top-=1*(1/N);a.Sc.forEach(function(a){a.ea-=1*(1/N);a.pa()});break;case 39:a.dd=39;a.tb.left+=1*(1/N);a.Sc.forEach(function(a){a.ia+=1*(1/N);a.pa()});break;case 40:a.dd=40;
a.tb.top+=1*(1/N);a.Sc.forEach(function(a){a.ea+=1*(1/N);a.pa()});break;default:return null!==a.dd&&jh(a),ih(a),!0}mh();return!1}}gh.prototype.save=function(){var a=this;return function(b){a.dd===b.which&&(jh(a),ih(a))}};
function fh(a){switch(a.which){case dh:if(0<$("*:focus").length)$("*:focus").blur();else if(0<$(".mask.on").length)$(".mask.on").trigger("touchClick");else{if(0<$(".dd-container.on").length)return!0;0<$("#canvaDocument .element.selected").length?V():$(".infoPanel .close").trigger("touchClick")}return!1}if(!(0<$(".mask.on").length||$("body").hasClass("blockDocument"))){var b=0<$("#canvaDocument .element.text.focused, input:focus, textarea:focus").length;if(b&&9===a.which)return!1;if(!b){if(a.metaKey||
a.ctrlKey)switch(a.which){case 67:return nh(),!1;case 86:return oh(),!1;case 90:return a.shiftKey?ph():qh(),!1;case 89:return ph(),!1}if(!a.metaKey&&!a.ctrlKey&&!a.altKey)switch(a.which){case 84:return $("#objectPanel .textControls a[data-style=body]").trigger("click"),!1}switch(a.which){case 8:case eh["delete"]:return $(".elementToolbarDelete a").trigger("click"),!1;case 191:return $("#search").focus().get(0).select(),!1}}if(a.metaKey||a.ctrlKey)switch(a.which){case 38:return $(".elementToolbarForward a").click(),
!1;case 40:return $(".elementToolbarBackward a").click(),!1;case 187:case 61:return $("#zoomIn").trigger("touchClick"),!1;case 189:case 173:return $("#zoomOut").trigger("touchClick"),!1}}};var qc={a4:{name:"Document",width:794,height:1123,dpi:300,multiPage:!0,templates:{blank:{width:794,height:1123,dpi:300}}},presentation:{name:"Presentation",width:1024,height:768,multiPage:!0,templates:{blank:{width:1024,height:768}}},blogGraphic:{name:"Blog Graphic",width:800,height:1200,multiPage:!0,templates:{blank:{width:800,height:1200}}},facebookCover:{name:"Facebook Cover",width:851,height:315,multiPage:!0,templates:{blank:{width:851,height:315}}},socialMediaGraphic:{name:"Social Media Graphic",
width:800,height:800,multiPage:!0,templates:{blank:{width:800,height:800}}},card:{name:"Card",width:560,height:397,dpi:300,multiPage:!0,templates:{blank:{width:560,height:397,dpi:300}}},photoCollage:{name:"Photo Collage",width:945,height:756,dpi:300,multiPage:!0,templates:{blank:{width:945,height:756,dpi:300}}},poster:{name:"Poster",width:1588,height:2246,dpi:300,multiPage:!0,templates:{blank:{width:1588,height:2246,dpi:300}}},businessCard:{name:"Business Card",width:322,height:189,dpi:300,multiPage:!0,
templates:{blank:{width:322,height:189,dpi:300}}},invitation:{name:"Invitation",width:530,height:530,dpi:300,multiPage:!0,templates:{blank:{width:530,height:530,dpi:300}}},custom:{name:"Design",multiPage:!0,templates:{blank:{}}}},Mf={grid1x1:{H:[{type:"columns",children:[{type:"item"}]}]},grid2x1Horizontal:{H:[{type:"columns",children:[{type:"item"},{type:"item"}]}]},grid6238Horizontal:{H:[{type:"columns",children:[{type:"item",width:62},{type:"item"}]}]},grid2x1Vertical:{H:[{type:"rows",children:[{type:"item"},
{type:"item"}]}]},grid6238Vertical:{H:[{type:"rows",children:[{type:"item",height:38},{type:"item"}]}]},grid3x1Horizontal:{H:[{type:"columns",children:[{type:"item"},{type:"item"},{type:"item"}]}]},grid3x1Vertical:{H:[{type:"rows",children:[{type:"item"},{type:"item"},{type:"item"}]}]},grid4x1Horizontal:{H:[{type:"columns",children:[{type:"item"},{type:"item"},{type:"item"},{type:"item"}]}]},grid4x1Vertical:{H:[{type:"rows",children:[{type:"item"},{type:"item"},{type:"item"},{type:"item"}]}]},grid2x2:{H:[{type:"columns",
children:[{type:"item"},{type:"item"}]},{type:"columns",children:[{type:"item"},{type:"item"}]}]},grid1Large2SmallHorizontal:{H:[{type:"columns",children:[{type:"item"},{type:"rows",children:[{type:"item"},{type:"item"}]}]}]},grid1Large2SmallVertical:{H:[{type:"rows",children:[{type:"item"},{type:"columns",children:[{type:"item"},{type:"item"}]}]}]},grid1Large3SmallHorizontal:{H:[{type:"columns",children:[{type:"item"},{type:"rows",children:[{type:"item"},{type:"item"},{type:"item"}]}]}]},grid1Large3SmallVertical:{H:[{type:"rows",
children:[{type:"item"},{type:"columns",children:[{type:"item"},{type:"item"},{type:"item"}]}]}]},grid2x3:{H:[{type:"columns",children:[{type:"item"},{type:"item"},{type:"item"}]},{type:"columns",children:[{type:"item"},{type:"item"},{type:"item"}]}]},grid2small1Large2SmallHorizontal:{H:[{type:"columns",children:[{type:"rows",children:[{type:"item"},{type:"item"}]},{type:"item"},{type:"rows",children:[{type:"item"},{type:"item"}]}]}]},grid2small1Large2SmallVertical:{H:[{type:"rows",children:[{type:"columns",
children:[{type:"item"},{type:"item"}]},{type:"item"},{type:"columns",children:[{type:"item"},{type:"item"}]}]}]},grid3x3:{H:[{type:"columns",children:[{type:"item"},{type:"item"},{type:"item"}]},{type:"columns",children:[{type:"item"},{type:"item"},{type:"item"}]},{type:"columns",children:[{type:"item"},{type:"item"},{type:"item"}]}]},grid3x3L:{H:[{type:"columns",children:[{type:"rows",width:66.667,children:[{type:"item",height:66.667},{type:"columns",children:[{type:"item"},{type:"item"}]}]},{type:"rows",
children:[{type:"item"},{type:"item"},{type:"item"}]}]}]},grid5x5:{H:[{type:"columns",children:[{type:"item"},{type:"item"},{type:"item"},{type:"item"},{type:"item"}]},{type:"columns",children:[{type:"item"},{type:"item"},{type:"item"},{type:"item"},{type:"item"}]},{type:"columns",children:[{type:"item"},{type:"item"},{type:"item"},{type:"item"},{type:"item"}]},{type:"columns",children:[{type:"item"},{type:"item"},{type:"item"},{type:"item"},{type:"item"}]},{type:"columns",children:[{type:"item"},
{type:"item"},{type:"item"},{type:"item"},{type:"item"}]}]}};function rh(a){this.O=a}var We="THUMBNAIL",$e="SCREEN",Ze="PRINT",sh="PENDING_SUBMISSION",th="PARENT";function Xg(){this.url="";this.height=this.width=0}Xg.prototype.Sb=s("url");Xg.prototype.h=s("height");Xg.prototype.g=s("width");function uh(a,b){this.locale=a;this.text=b}function vh(a){return a?$.extend(new uh(a.locale,a.text),a):null}
function wh(){this.version=0;this.status=sh;this.description=this.title=this.artist="";this.recolorable=this.repeating=this.textholder=this.photoholder=this.isolated=this.cutout=this.background=!1;this.keywords=[];this.files={};this.quality=null}y=wh.prototype;y.R=s("version");y.wb=s("status");y.Ea=s("title");y.ca=s("background");y.$c=s("cutout");y.ad=s("repeating");y.Cc=s("recolorable");y.uf=s("keywords");y.ab=s("files");
function xh(){this.importKey=this.id="";this.type=th;this.copyright="";this.bundle=new wh}xh.prototype.t=s("id");xh.prototype.ua=s("bundle");function yh(a){if(!a)return null;a=$.extend(new xh,a);if(a.bundle){var b;var c=a.bundle;if(c){c=$.extend(new wh,c);c.keywords&&(c.keywords=c.keywords.map(vh));if(c.files)for(b in c.files)c.files[b]=c.files[b]?$.extend(new Xg,c.files[b]):null;b=c}else b=null;a.bundle=b}return a}function zh(){}zh.prototype.Ye=function(a){this.restricted=a;return this};
zh.prototype.Ch=function(a){this.staging=a;return this};function Ah(a,b){var c=(new zh).Ye(!0);c.skip=a;c.limit=b;return c}function Bh(){}function Ch(a){var b=new Bh;b.name=a;return b}Bh.prototype.Ye=function(a){this.restricted=a;return this};function Dh(){}function cf(a){var b=new Dh;b.version=a;return b}Dh.prototype.Ch=function(a){this.staging=a;return this};
function Eh(a,b){return na.O.get("/media?"+("brand"in a?"&brand="+encodeURIComponent(a.brand):"")+("query"in a?"&query="+encodeURIComponent(a.query):"")+("restricted"in a?"&restricted="+encodeURIComponent(a.restricted):"")+("staging"in a?"&staging="+encodeURIComponent(a.staging):"")+("skip"in a?"&skip="+encodeURIComponent(a.skip):"")+("limit"in a?"&limit="+encodeURIComponent(a.limit):""),function(a,d){var e;if(200==a){if(e=d.media){for(var f=[],g=0;g<e.length;g++)f.push(yh(e[g]));e=f}else e=null;
e={media:e,total:d.total}}else e=null;b&&b(a,e)})}function Fh(a,b){na.O.post("/media?"+("name"in a?"&file="+encodeURIComponent(a.name):"")+("restricted"in a?"&restricted":""),{},null,function(a,d){var e=200==a?yh(d):null;b&&b(a,e)})}rh.prototype.ib=function(a,b,c){return this.O.get("/media/"+encodeURIComponent(a)+("version"in b?"/"+encodeURIComponent(b.version):"")+("staging"in b?"?staging":""),function(a,b){var f=200==a?yh(b):null;c&&c(a,f)})};function Gh(){var a=na;this.Gb=$.extend({},window.mediaMap,!0);this.dh=a}function Hh(a,b,c,d){a.Gb[b]=a.Gb[b]||{};a.Gb[b][c]=a.Gb[b][c]||{};for(var e in d)a.Gb[b][c][e]=d[e].Sb()}function af(a,b,c){var d=ka;Ih(d,a,b)?c(a,b,d.Gb[a][b]):d.dh.ib(a,cf(b),function(e,f){if(200==e){var g=f.ua(),h=g.R();Hh(d,a,h,g.ab());c(a,b,d.Gb[a][h])}})}function Ih(a,b,c){return!!a.Gb[b]&&!!a.Gb[b][c]};function Jd(){function a(a,b,e){e||b.forEach(function(a){a.t&&a.R&&a.ab&&Hh(ka,a.t(),a.R(),a.ab())})}var b=new Jh({model:C});$("#resultsText > .layer > .inner").prepend(b.el);(new Kh({el:"#resultsSearch"})).on("results:didFetch",a);(new Lh({el:"#resultsUpload"})).on("results:didFetch",a);(function(){function a(){e.Pa&&(Mh(e),Nh(e))}var b=$("#resultsBackground .colorControls"),e=new Oh(b,C),b=Ph();e.on("select",b.select);e.on("confirm",b.confirm);e.render();e.listenTo(C,"change",e.render);e.listenTo(L,
"elementLoaded:svg",e.render);e.listenTo(C,"page:change:selected",a);$("#resultsBackground > .layer").on("scroll",a)})();ra=!0;xa=!1;qa=new $g(sa);ah(qa,Qh);$("#search").on("keypress",Rh);$("#objectPanel > menu a").on("touchClick",Sh);$("#objectPanel").on("touchClick",".templateGallery a",Th);(new S("#objectPanel")).on("mousedown+touchstart",".templateGallery a",Uh);$("#objectPanel").on("touchClick",".backgroundGallery a",Vh);(new S("#objectPanel")).on("mousedown+touchstart",".backgroundGallery *:not(.static) a",
Wh);Rd();$("#objectPanel").on("click",".backgroundGallery a",!1);$("#objectPanel").on("touchClick",".infoPanelGallery .info .moreInfo",Xh);$("#objectPanel").on("touchClick",".infoPanel .favorite a",Yh);$("#objectPanel").on("touchClick",".infoPanel .add a",Zh);$("#objectPanel").on("touchClick",".infoPanel .close",$h);$("#objectPanel").on("touchClick",".infoPanel .brand a",ai);(new S("#objectPanel")).on("mousedown+touchstart",".photoGallery:not(.gridGallery):not(.albumGallery) a",bi);$("#objectPanel").on("click",
".photoGallery:not(.gridGallery):not(.albumGallery) a",!1);(new S("#objectPanel")).on("mousedown+touchstart",".gridGallery a",ci);$("#fileUpload").on("change",di);pa&&pa.init(function(a){a.Nb.wd(["user_photos","user_status"]).then(function(){$("#objectPanel .content button.facebookButton").addClass("view").text("Use Facebook photos")}).fail(k())});$(".results.infinite:not(#resultsSearch):not(#resultsUpload) > .layer").on("scroll",ei);$("#objectPanel").on("touchClick",".suggestions > .inner .close",
fi);$("#search").on("focus",gi);$("#someoneElseEditing a").on("touchClick",hi);$("#objectPanel .scrollBar").each(function(){new ii($(this),$(this).nextAll(".scrollPane"))})}function gi(){var a=this;"resultsSearch"!==ji().attr("id")&&$("#objectPanel > menu .search a").trigger("click");setTimeout(function(){a.select()},20)}
function Sh(){function a(a){var b=$(a);a=0===b.find(".gallery li:not(.static)").length;b=0<b.find(".searchLoader").length;return a&&!b}function b(a,b){var c=$(a),d=c.find("> .layer > .inner > .searchGroup").first(),e=d.parent(".layer");bh(qa);e.find(".searchError").remove();ki(d);d.height(c.height());X=new li(b,mi(c,c.height()),ni);d.data("search",X);ni();ra=!0}var c=$(this).parents("menu"),d=$("li",c),e=$(this).parents("li"),f=d.index(c.find("li.on"))+1,g=e.index()+1,h=$("#objectPanel");h.find(".content > .results").get(f-
1);var c="#"+h.find(".content > .results").get(g-1).id,l=h.get(0).className,l=l.replace(/(^| )stage[^ ]+/g,"");h.get(0).className=l;h.addClass("stage"+g);d.removeClass("on");e.addClass("on");d=ji();e.hasClass("search")&&$("#search").focus();f==g&&d.find("> .layer").first().animate({scrollTop:0},Ha);e=$("#results"+f+" > .layer");oi(e);"#resultsLayout"==c&&a(c)&&(h.find("#resultsLayout > .layer").first().find(".searchError").remove(),Nd());"#resultsText"==c&&a(c)&&b(c,"text");"#resultsBackground"==
c&&a(c)&&b(c,"backgrounds");(e=d.find("> .layer").last().find(".searchGroup").last().data("search"))&&"facebook"!=X.query.toLowerCase().trim()&&(X=e);_gaq.push(["_trackEvent","Object Panel","Click - Tab",c]);return!1}
function Th(){var a=$(this).parents(".layer");$(".gallery li.on",a).removeClass("on");a=$(this).parents("li");a.addClass("on");ba=a.data("content");var b=T(C),c=b.serialize();pi(b,ba);b={pageIndex:P(C,b),"new":ba,old:c};Q(D,new qi(ri,b));_gaq.push(["_trackEvent","Object Panel","Click - Template",a.attr("data-template")]);return!1}
function Uh(a){function b(a){var b=void 0!==a.clientX?a.clientX:a.touches[0].clientX;a=void 0!==a.clientY?a.clientY:a.touches[0].clientY;if(null==l&&(4<=Math.abs(b-m)||4<Math.abs(a-n))){l=$('<div class="clone template"></div>');var c=$("img",d).clone();c.css("width",g).css("height",h);l.data("li",e).append(c).css("left",f.left).css("top",f.top);$("#content").append(l);d.css("opacity",0);$("#search").blur();si(l,ti(p))}null!=l&&(a=f.top+a-n,l.css("left",f.left+b-m).css("top",a));return!1}function c(){function a(){$(this).remove();
d.css("opacity","")}$("#hotspots").remove();p.off("mousemove|touchmove",b).off("mouseup|touchend",c);d.removeClass("pickedUp");null==l||l.hasClass("disappeared")?(l&&l.remove(),d.animate({opacity:1},Ca)):(f=d.offset(),l.addClass("returning"),l.one("transitionend",a).css("left",f.left).css("top",f.top),$("img",l).css("width",g).css("height",h))}var d=$(this);d.addClass("pickedUp");var e=d.parents("li"),f=d.offset(),g=d.width(),h=d.height(),l=null;$("#objectPanel").offset();var m=void 0!==a.clientX?
a.clientX:a.touches[0].clientX,n=void 0!==a.clientY?a.clientY:a.touches[0].clientY,p=new S($(document));p.on("mousemove|touchmove",b).on("mouseup|touchend",c);return!1}
function Ph(){var a=T(C),b=Lc(a)[0];b&&b.Ka();var c=!1,d=null;return{select:function(e){a=T(C);b=Lc(a)[0];if(!b){var f={type:"image",isBackground:!0,isRecolorable:!0};_.extend(f,a.B().serialize());b=ze(f);b.appendTo(a);kh();vi(b);c=!0}f=0<b.Ka().length;!d&&f&&(d=b.Ka()[0].color);b.Vd(0,e)},confirm:function(a){if(0<b.Ka().length){var f={elementIndex:b.s(),pageIndex:b.v().s(),"new":{index:0,color:a.color},old:{index:0,color:d}};Q(D,new R(wi,f));d=a.color;c&&(lh(),c=!1)}}}}
function Vh(a){if($(a.target).is(".moreInfo"))return!1;a=$(a.currentTarget);var b=$(a.parents("li")[0]);xi(b);a=$("img",a).attr("src").replace(/_thumb/,"");_gaq.push(["_trackEvent","Object Panel","Click - Background Image",a]);return!1}
function Wh(a){function b(a){var b=void 0!==a.clientX?a.clientX:a.touches[0].clientX;a=void 0!==a.clientY?a.clientY:a.touches[0].clientY;if(null==m&&(4<=Math.abs(b-n)||4<Math.abs(a-p))){m=$('<div class="clone bg"></div>');f.ad()&&m.addClass("patterned");var c=$("img",d).clone(!0).off(""),v=parseInt(c.attr("width"),10),x=parseInt(c.attr("height"),10);v<x?c.css("width",h).css("height",c.height()):c.css("width",c.width()).css("height",h);m.data("li",e).append(c).css("left",g.left).css("top",g.top).css("width",
h).css("height",l).css("background-color",e.data("color"));$("#content").append(m);d.css("opacity",0);$("#search").blur();si(m,ti(q))}null!=m&&(a=g.top+a-p,m.css("left",g.left+b-n).css("top",a));return!1}function c(){function a(){$(this).remove();d.css("opacity","")}$("#hotspots").remove();q.off("mousemove|touchmove",b).off("mouseup|touchend",c);d.removeClass("pickedUp");null==m||m.hasClass("disappeared")?(m&&m.remove(),d.animate({opacity:1},Ca)):(g=d.offset(),m.addClass("returning"),m.one("transitionend",
a).css("left",g.left).css("top",g.top))}if(3==a.which||a.ctrlKey)return!0;if($(a.target).is(".moreInfo"))return!1;var d=$(this);d.addClass("pickedUp");var e=d.parents("li"),f=e.data("result"),g=d.offset(),h=d.width(),l=d.height(),m=null,n=void 0!==a.clientX?a.clientX:a.touches[0].clientX,p=void 0!==a.clientY?a.clientY:a.touches[0].clientY,q=new S($(document));q.on("mousemove|touchmove",b).on("mouseup|touchend",c);return!1}
function xi(a){var b=T(C),c=Lc(b);0<c.length&&c[c.length-1].i.clone().removeClass("appearing").appendTo($("> .elements",b.i)).delay(480,function(){$(this).remove()});kh();c.forEach(function(a){var c={elementIndex:a.s(),pageIndex:P(C,b)};bf(a);Q(D,new R(yi,c));zi(a);a.remove()});a=$("img",a);a=ze(Ai(a));var c=b.B(),d=a.B();Jb(d,c);a.Sa(d);b.addElement(a,!1,!0);vi(a);c=a.s();Mc(a);a={elementIndex:a.s(),oldElementIndex:c,pageIndex:P(C,b)};Q(D,new R(Bi,a));lh()}
function Rd(a,b,c){void 0===b&&(b=!0);var d=void 0===a?$("#resultsSearch > .layer"):a.parents(".layer");void 0===a&&(a=$("#objectPanel .photoGallery, #objectPanel .infoPanelGallery"));a.is(".gridGallery")?Sd(a):a.each(function(){var a=$(this),f=a.hasClass("backgroundGallery");if(!(0>=$("li",a).length||(a.removeClass("laidOut"),0>=a.width()))){var g=a.find("> li");b||g.filter(":not(.newSearch)").addClass("doNotTransition");$("img",a).css("height","");g.css("width","").css("left","").css("top","");
for(var h=$("li",this).first().width(),l=parseInt($("a",this).css("margin-right"),10),m=parseInt($("a",this).css("margin-bottom"),10),n=Math.round(a.width()/h),p=a.data("columnData"),q={le:h,marginRight:l,marginBottom:m,F:[]},u=!c&&p&&p.F.length==n&&p.le==h,r=0;r<n;r++)q.F[r]={height:0,H:[],ra:0},u&&(q.F[r].ra=p.F[r].ra);var w=null;$("> li a.infoOpen",a).parents("li").first().each(function(){var a=$("img",this),b=a.attr("width")||a.get(0).naturalWidth,a=a.attr("height")||a.get(0).naturalHeight;w=
$(this).data("originalTop")+(h-l)/b*a+m});null!=w&&u||g.removeData("modifiedTop");var v=0;g.each(function(){for(var b=$(this),c=b.data("result"),d=0,g=q.F[d].height,n=0;n<q.F.length;n++)if(0==q.F[n].height){d=n;g=0;break}else q.F[n].height<g&&(d=n,g=q.F[n].height);var p=b.find("a"),r=b.find("img"),z,x;0<r.length?(z=parseInt(r.attr("width"),10)||r.get(0).naturalWidth,x=parseInt(r.attr("height"),10)||r.get(0).naturalHeight):x=z=h;var wc=z>x,B=h-l,n=B/z*x;r.css("height",n);b.data("originalTop",g).css("width",
h).css("left",d*h);f&&(wc&&(B=z/x*(h-m),r.css("width",B).css("height","")),"backgroundColorAlbum"===b.attr("id")?b.add(p).add(r).css("width","").css("height",""):(b.height(h),p.height(h-m),c&&!c.ad()&&(n=wc?0:(h-m-n)/2,r.css("margin-left",(h-l-B)/2).css("margin-top",n))),c&&(c.Cc()&&(n="#"+Sa[v%Sa.length],b.data("color",n),p.css("background-color",n),v++),c.ad()&&b.addClass("patterned")),n=h-m);c=d;b.hasClass("newSearch")?(d=0,null!=w&&g+n+m>w&&(d=q.F[c].ra,0==d&&(d=Ci(a.parents(".searchGroup")),
d+=w-q.F[c].height,q.F[c].ra=d),b.data("modifiedTop",g+d)),b.css("top",g+d)):b.data("modifiedTop")?(c=b.data("columnIndex"),g=b.data("modifiedTop"),b.css("left",c*h).css("top",g).data("originalTop",g-q.F[c].ra)):u?(c=b.data("columnIndex"),b.css("left",c*h).css("top",q.F[c].height).data("originalTop",q.F[c].height)):b.css("top",g);q.F[c].height+=n+m;q.F[c].H.push(b);b.data("columnIndex",c)});a.data("columnData",q);var x=a.parents(".searchGroup").height();a.addClass("laidOut");b||setTimeout(function(){g.filter(":not(.newSearch)").removeClass("doNotTransition")},
Fa);var z=a.parent(".searchGroup"),n=!z.hasClass("suggestions")&&d.find("> .inner > .searchGroup").last().get(0)==z.get(0);Td(z,!n);setTimeout(function(){var b=Di(a.parents(".results")),c=0<a.parents("#resultsSearch").length,d=c?Ei(z):0,f=-1;$("> li.newSearch",a).each(function(){var a=$(this),e=!1;(e=c?d+a.data("originalTop")<b:parseInt(a.css("top"),10)<x)?setTimeout(function(){a.removeClass("newSearch")},++f*Ea):a.addClass("doNotTransition").removeClass("newSearch").removeClass("doNotTransition")})},
20)}})}
function Fi(a,b){var c=!0;void 0===c&&(c=!1);b=$(b);var d=a.data("columnData"),e=0<a.parents("#resultsUpload").length,f=b.get(0).complete&&""!==b.get(0).src,g=$('<li class="newSearch"><a href="#"></a></li>');e||g.find("a").append('<span class="info">Free <span class="favorite" title="Add to favorites">Favorite</span></span>');f||g.addClass("loading");g.find("a").prepend(b);c?a.prepend(g):a.append(g);if(!d||c)Rd(a,!1,!0);else{c=0;e=d.F[c].height;for(f=0;f<d.F.length;f++)if(0==d.F[f].height){c=f;e=
0;break}else d.F[f].height<e&&(c=f,e=d.F[f].height);var f=b.attr("width")||b.get(0).naturalWidth,h=b.attr("height")||b.get(0).naturalHeight,f=(d.le-d.marginRight)/f*h;b.css("height",f);g.data("originalTop",e).data("columnIndex",c).css("width",d.le).css("left",c*d.le).css("top",e+d.F[c].ra).delay(20,function(){$(this).removeClass("newSearch")});d.F[c].height+=f+d.marginBottom;d.F[c].H.push(g);a.data("columnData")}}
function Sd(a){void 0===a&&(a=$("#objectPanel .gridGallery"));var b=$("a",a).width();$("li, a",a).css("height",b);a.addClass("laidOut");a.each(function(){var a=$(this),b=a.find("> li"),a=a.parents(".searchGroup"),e=a.parents(".layer"),f=e.offset(),g=e.height();b.each(function(){var a=$(this),b=a.position().top+(a.hasClass("newSearch")?50:0);a.data("originalTop",b)});Td(a,!1);setTimeout(function(){b.each(function(a){var b=$(this);b.offset().top<f.top+g?setTimeout(function(){b.removeClass("newSearch")},
a*Ea):b.removeClass("newSearch")})},20)})}
function Ai(a){var b=a.parents("li"),c=b.data("result");c||(b=a.parent().data("li"),c=b.data("result"));var d=0<b.parents("#resultsBackground").length;return{type:a.hasClass("svg")?"svg":"image",origin:c.ec(),mediaId:c.t(),mediaVersion:c.R(),width:parseInt(a.data("screen-width")||a.attr("width"),10),height:parseInt(a.data("screen-height")||a.attr("height"),10),isDark:!!a.hasClass("dark"),isBackground:c.ca()&&d,isCutout:c.$c(),isRepeating:c.ad(),isRecolorable:c.Cc(),backgroundColor:c.Cc()?b.data("color"):
void 0}}function Gi(a){var b=$("img",a);a=ze(Ai(b));var c=a.g(),d=a.h(),e=Math.min(c,0.95*E.width),f=d*(e/c);f>0.95*E.height&&(f=0.95*E.height,e=c*(f/d));a.D(e);a.q(f);T(C).addElement(a,!0);b=b.parents("li").data("result");a instanceof Ae&&b.ec()==Ug&&Hi(b,Ii(b,a));vi(a)}function Ii(a,b){var c=a.t(),d=a.R();return function(e){a.id=e.t();a.version=e.ua().R();a.origin=Tg;b.Wd(e.t(),e.ua().R());b.Rf="CANVA";C.trigger("change");Ji({mediaId:c,mediaVersion:d},{mediaId:e.t(),mediaVersion:e.ua().R()})}}
function Hi(a,b){function c(a){a&&0<a.length?alert("You must allow Canva access to your photos to use them in a design."):(rg(),pa.Wc().then(d).fail(e))}function d(b){Ki(b.td,a.t(),l,m,n,f)}function e(a){alert("An error occurred whilst attempting to gain access to your Facebook photos: "+a)}function f(a){(Li[g]||[]).forEach(function(b){b(a)});delete Li[g];Mi[g]=a}var g=a.t(),h=Mi[g];if(h)b(h);else if(h=Li[g])h.push(b);else{Li[g]=[b];var l=a.ab()[$e].url,m=a.ab()[We].url,h=l.substr(l.lastIndexOf(".")),
n=a.t()+h;kg().then(c).fail(e)}}var Li={},Mi={};
function Xh(){var a=$(this).parents("a"),b=$("img",a),c=a.parents("li"),d=a.parents(".gallery"),e=a.parents(".layer"),f=a.parents(".searchGroup"),g=$(this).parents(".results"),h=Ni(f),l=parseInt(f.css("margin-top"),10),m=0;Ta&&f.prevAll(".searchGroup").each(function(){m=Math.max(m,Oi($(this)))});e.find(".infoPanel .close").trigger("touchClick");a.addClass("infoOpen");var n=c.data("result"),p=c.data("originalTop"),q=c.height(),u=p+q,h=h+u+Ei(f),l=h-m+l,p=Vg(n),r=$('<div class="infoPanel"><a class="close" href="#" title="Close this info panel">Close</a><h3></h3><h4><span class="brand">&nbsp;</span><span class="spinner">&hellip;</span></h4><p class="price" title="What you\'ll have to pay for this image when you export your design">'+
(null===p?"Price unavailable":0===p?"Free":"$"+(p/100).toFixed(2))+"</p></div>");$("h3",r).text(n.Ea()||"Untitled Image");n.uf()&&r.append($('<p class="keywords">').text("Keywords: "+n.uf().join(", ")));n.t()&&(p=$('<a target="_blank">ID: '+n.t()+"</a>").attr("href","/media/"+encodeURIComponent(n.t())),r.append($('<p class="id">').append(p)));n=sa.get("/brand/"+n.brand,function(a,b){var c=r.find(".brand"),d=r.find(".spinner"),e;e=200===a?$("<a></a>").text(b.brand.displayName).data("brandId",b.brand.id).attr("href",
"#"):$("<span>Unknown Brand</span>");d.addClass("off");c.text("by ").append(e).addClass("on");r.removeData("xhr")});r.data("xhr",n);$(".info .favorite",c).hasClass("on")&&$(".favorite",r).addClass("on");r.css("top",l).appendTo(f);a.data("infoPanel",r);r.data("item",a);var w=$('<div class="infoPanelPointer"></div>');w.css("left",parseInt(c.css("left"),10)+parseInt(r.css("left"),10)+c.width()/2).css("top",l).appendTo(f);r.data("infoPanelPointer",w);var v=r.height(),x=r.outerHeight(!0);r.one("transitionend",
function(){f.removeClass("transitioning")}).css("height",0).delay(20,function(){$(this).addClass("on").css("height",v);w.addClass("on")});var z=Pi(d,u),z=z.filter(function(a){return a!=c.get(0)}),A=d.data("columnData");A.F.forEach(function(a){var b=null;a.H.filter(function(a){return-1<z.indexOf(a.get(0))}).forEach(function(c){var d=c.data("originalTop");null===b&&(b=u+x-d,a.ra=b);c.css("top",d+b).data("modifiedTop",d+b).data("columnIndex",A.F.indexOf(a))})});a=!f.hasClass("suggestions")&&e.find("> .inner > .searchGroup").last().get(0)==
f.get(0);f.addClass("transitioning");Td(f,!a);a=h+x;g=Di(g);a>g?e.animate({scrollTop:e.scrollTop()+(a-g)},Ha):l<e.scrollTop()&&e.animate({scrollTop:e.scrollTop()-(e.scrollTop()-l)},Ha);f.hasClass("inlineFolderGroup")&&L.trigger("infoPanelToggle",f,Oi(f));_gaq.push(["_trackEvent","Object Panel","Click - Photo open",b.attr("src")])}
function $h(){var a=$(this).parents(".infoPanel");a.outerHeight(!0);var b=a.data("xhr"),c=a.data("item");c.removeClass("infoOpen");c.parents("li").siblings().each(function(){var a=$(this).data("originalTop");$(this).css("top",a).removeData("modifiedTop")});var d=a.parents(".searchGroup").first();d.addClass("transitioning").height(d.data("contentHeight"));$(".gallery",d).data("columnData").F.forEach(function(a){a.ra=0});a.one("transitionend",function(){e&&(e.remove(),a.remove(),d.removeClass("transitioning"))}).removeClass("on").css("height",
0);var e=a.data("infoPanelPointer");e.removeClass("on");b&&b.cancel();b=null;a.removeData("xhr");d.hasClass("inlineFolderGroup")&&L.trigger("infoPanelToggle",d,0);_gaq.push(["_trackEvent","Object Panel","Click - Info panel close",$("img",c).attr("src")]);return!1}function Yh(){var a=$(this),b=a.parents("li"),a=a.parents(".infoPanel").data("item"),a=$(".info .favorite",a);b.hasClass("on")?(b.removeClass("on"),a.removeClass("on")):(b.addClass("on"),a.addClass("on"));return!1}
function ai(){var a=$(this).data("brandId");$("#search").val("brand:"+a);X=null;Qi()}function Zh(){$("#search").blur();var a=$(this).parents(".infoPanel").data("item").parents("li");Gi(a);a=$("img",a);_gaq.push(["_trackEvent","Object Panel","Click - Add to design",a.attr("src")]);return!1}
function bi(a){function b(a){function b(){r=$('<div class="clone"></div>');h.is(".svg")&&r.addClass("svg");var a=h.clone();a.css("width",f).css("height",g);r.append(a).css("left",e.left).css("top",e.top).data("li",d.parents("li"));$("#content").append(r);d.css("visibility","hidden");a=Ai(a);a.isCutout&&r.addClass("cutout");("image"==a.type||a.isCutout)&&Ri(r,ti(K));$("#search").blur()}var c=void 0!==a.clientX?a.clientX:a.touches[0].clientX;a=void 0!==a.clientY?a.clientY:a.touches[0].clientY;if(null==
r)if(ti(K)){var l=ec(A,J,c,a);if(300<l||60>l)b();else return!0}else(4<Math.abs(c-A)||4<Math.abs(a-J))&&b();if(null!=r){var m=Math.min(1,Math.sqrt(Math.pow(c-A,2)+Math.pow(a-J,2))/da),l=f+(q-f)*m,m=g+(u-g)*m;$("img",r).css("width",l).css("height",m);m=e.top+a-J+F*g-m*F;r.css("left",e.left+c-A+H*f-l*H).css("top",m);(c<v.left||c>v.left+w.outerWidth()||a<v.top||a>v.top+w.outerHeight())&&r&&!r.hasClass("disappeared")&&!r.hasClass("placing")&&Si(x,r)?(null==Z&&(Z=new rb(r,z)),Ti(Z,M)):$("#overlays .align").removeClass("on")}return!1}
function c(a){function l(){$(this).remove();d.css("visibility","visible")}function m(){d.css("opacity",0);setTimeout(function(){d.one("transitionend",function(){$(this).removeClass("reappearing")}).css("visibility","").addClass("reappearing").css("opacity","")},20)}K.off("mousemove|touchmove",b).off("mouseup|touchend",c);if(!0!==Ui){$("#overlays .align").removeClass("on");$("#content").trigger("mousedown");V();var n=void 0!==a.clientX?a.clientX:a.changedTouches[0].clientX;a=void 0!==a.clientY?a.clientY:
a.changedTouches[0].clientY;$("#hotspots").remove();d.delay(Ga,function(){$(this).removeClass("pickedUp")});if(null==r&&4>Math.abs(n-A)&&4>Math.abs(a-J))return $("#search").blur(),Gi(d.parents("li")),_gaq.push(["_trackEvent","Object Panel","Click - Photo Gallery Image",h.attr("src")]),!1;null!=r&&((n<v.left||n>v.left+w.outerWidth()||a<v.top||a>v.top+w.outerHeight())&&r&&!r.hasClass("disappeared")&&Si(x,r)?(n=$("img",r),n=ze(Ai(n)),r.remove(),n.oa(Z.l(),Z.j()),n.D(Z.g()),n.q(Z.h()),n.appendTo(T(C)),
a=h.parents("li").data("result"),n instanceof Ae&&a.ec()==Ug&&Hi(a,Ii(a,n)),vi(n),De(n),m(),_gaq.push(["_trackEvent","Object Panel","Drag - Photo",h.attr("src")])):(null==r||r.hasClass("disappeared")?null!=r&&r.hasClass("disappeared")&&(m(),Vi(d.parent("li")),Wi(r.data("placedInElement"))):(e=d.offset(),r.addClass("returning"),r.one("transitionend",l).css("left",e.left).css("top",e.top),$("img",r).css("width",f).css("height",g)),_gaq.push(["_trackEvent","Object Panel","Drag Invalid - Photo",h.attr("src")])))}}
if(3==a.which||a.ctrlKey)return!0;if($(a.target).is(".moreInfo"))return!1;var d=$(this);d.addClass("pickedUp");var e=d.offset(),f=d.width(),g=d.height(),h=$("img",d).first(),l=parseInt(h.data("screen-width")||h.attr("width"),10),m=parseInt(h.data("screen-height")||h.attr("height"),10),n=Math.min(l,0.95*E.width),p=m*(n/l);p>0.95*E.height&&(p=0.95*E.height,n=l*(p/m));var q=n*N,u=p*N,r=null,w=$("#objectPanel"),v=w.offset(),x=Xi(),z=x.offset(),A=void 0!==a.clientX?a.clientX:a.touches[0].clientX,J=void 0!==
a.clientY?a.clientY:a.touches[0].clientY,H=(A-e.left)/f,F=(J-e.top)/g,da=Math.abs(A-(v.left+w.outerWidth())),K=new S($(document));K.on("mousemove|touchmove",b).on("mouseup|touchend",c);var Z=null,M=Yi();return Zi}
function ci(a){function b(a){function b(){g=e.clone(!1);g.appendTo("#content").css("top",r).css("left",u).addClass("clone draggableGridItem dragging");e.css("visibility","hidden")}var c=void 0!==a.clientX?a.clientX:a.touches[0].clientX;a=void 0!==a.clientY?a.clientY:a.touches[0].clientY;if(null==g)if(ti(K)){var d=ec(H,F,c,a);if(300<d||60>d)b();else return!0}else 4<c-H&&b();null!=g&&(a=Math.min(1,Math.sqrt(Math.pow(c-H,2)+Math.pow(a-F,2))/da),a=c<=H?0:a,c=q+(m-q)*a,d=v+(J-v)*a,g.css("width",w+(A-w)*
a).css("height",d),d=r+(z-r)*a,g.css("left",u+(x-u)*a).css("top",d),g.find("> .rows, > .columns, .item > .content").css("left",c/2).css("right",c/2).css("top",c/2).css("bottom",c/2));return!1}function c(){p.aa().forEach(function(a){if(a instanceof Be){for(var b=a.wa(),c,d=!0,e=0===a.j()&&0===a.l()&&0===a.qa()&&a.g()===p.g()&&a.h()===p.h(),f=0;f!==b;f++)if(c=a.xa(f).Ce){d=!1;break}d&&e&&a.remove()}})}function d(a){function f(a){function b(a){this==a.target&&$(this).off("animationend",b).remove()}this==
a.target&&($(this).off("transitionend",f).on("animationend",b).addClass("disappearing"),e.css("visibility",""))}function l(){e.css("opacity",0);setTimeout(function(){e.one("transitionend",function(){$(this).removeClass("reappearing")}).css("visibility","").addClass("reappearing").css("opacity","")},20)}a=void 0!==a.clientX?a.clientX:a.touches[0].clientX;null==g?(n.D(ba.width),n.q(ba.height),c(),p.addElement(n,!0),vi(n),_gaq.push(["_trackEvent","Object Panel","Add to page - Grid",h])):a>=x?(n.D(ba.width),
n.q(ba.height),c(),n.appendTo(p),De(n),vi(n),l(),g.remove(),_gaq.push(["_trackEvent","Object Panel","Drag - Grid",h])):(g.addClass("returning").on("transitionend",f),parseInt(g.css("left"),10)==Math.floor(u)&&parseInt(g.css("top"),10)==Math.floor(r)?g.trigger("transitionend"):g.css("left",u).css("top",r).css("width",w).css("height",v),_gaq.push(["_trackEvent","Object Panel","Drag Invalid - Grid",h]));K.off("mousemove|touchmove",b).off("mouseup|touchend",d)}if(3==a.which||a.ctrlKey)return!0;$("#search").blur();
V();var e=$(a.currentTarget),f=e.offset(),g=null,h=e.parents("li").data("grid-name"),l=$.extend(!0,[],Mf[h].H),m=(Mf[h].spacing||Ib)*N,n=new Be({items:l}),p=T(C),q=2,l=$(p.i).offset(),u=f.left,r=f.top,w=e.width(),v=e.height(),x=l.left,z=l.top,A=p.g()*N,J=p.h()*N,H=void 0!==a.clientX?a.clientX:a.touches[0].clientX,F=void 0!==a.clientY?a.clientY:a.touches[0].clientY;$("#objectPanel").offset();var da=x-H,K=new S($(document));K.on("mousemove|touchmove",b).on("mouseup|touchend",d);return!1}
function $i(){$("#fileUpload").removeData("upload-destination");$("#fileUpload").removeData("upload-placeholder-index");$("#fileUpload").trigger("click")}
function di(a){function b(){}var c=a.target.files||a.dataTransfer.files||a.originalEvent.dataTransfer.files,d=null==a.target.files?"drop":"button",e=$("#objectPanel");a=$("#resultsUpload");var f=$("#normalUploads");$(".photoGallery",f);var g=0===f.find("li").length,h=ji(),l=$("#fileUpload").data("upload-destination"),m=$("#fileUpload").data("upload-placeholder-index")||0,n=c[0];10<c.length?alert("Unfortunately Canva doesn't work too well when you upload more than 10 files at a time, so try uploading them 10 at a time. Thanks!"):
(l&&(b=function(a){var b=l.jb(m),c=new FileReader;c.onload=function(){var d=new Image;d.onload=function(){var c=new O(0,0,d.width,d.height);Jb(c,b).translate(-b.l(),-b.j());c={type:"image",index:m,mediaId:a.t(),mediaVersion:a.ua().R(),imageBox:c.serialize()};l.pb(m,c)};d.src=c.result};c.readAsDataURL(n);$("#fileUpload").removeData("upload-destination");$("#fileUpload").removeData("upload-placeholder-index")}),h.get(0)!==a.get(0)||g?(e.addClass("slow"),setTimeout(function(){f.removeClass("hidden disappearing");
$("> menu .uploads a",e).trigger("touchClick").delay(600,function(){e.removeClass("slow");aj(c,d,b)})},20)):f.removeClass("hidden").delay(20,function(){f.removeClass("disappearing").delay(300,function(){$("#beforeFirstUpload").remove();aj(c,d,b)})}))}
function aj(a,b,c){function d(){$("a.uploads","#resultsUpload").trigger("mousedown");var d=window.setInterval(function(){0<f.find(".inlineFolderGroup button.fileUploadButton").length&&(window.clearInterval(d),h=f.find(".inlineFolderGroup"),0<h.find(".noResults").length&&e(),bj(a,b,c))},200)}function e(){l=$('<div class="gallery infoPanelGallery photoGallery laidOut"></div>');h.append(l);h.find(".noResults").remove()}var f=$("#normalUploads"),g=f.find(".browseCategories"),h=f.find(".inlineFolderGroup"),
l=h.find(".photoGallery"),m=0<h.length&&0<f.find("li.folderExpanded a.uploads").length,n=0<h.length&&0<f.find("li.folderExpanded a.facebook").length;g.hasClass("hidden")&&(f.find(".uploadButtons").addClass("hidden"),g.removeClass("hidden"));m&&0<h.find(".noResults").length?(e(),bj(a,b,c)):m?bj(a,b,c):n?($("a.facebook","#resultsUpload").trigger("mousedown"),window.setTimeout(function(){d()},1.2*Da)):d()}
function bj(a,b,c){$("#objectPanel");for(var d=0,e=$(".inlineFolderGroup .photoGallery","#normalUploads"),f=0;f<a.length;f++){var g=a[f];if(g.type.match("image.*")){d++;var h=new FileReader;h.onload=function(a){return function(b){cj(a,b.target.result,function(a){var c=$('<img src="'+b.target.result+'" />');c.one("load",function(){var b=new O(0,0,this.naturalWidth,this.naturalHeight);Kb(b,new O(0,0,200,200));this.width=b.g();this.height=b.h();$(this).attr("data-screen-width",this.naturalWidth).attr("data-screen-height",
this.naturalHeight).attr("data-media-id",a.t());af(a.t(),1,function(a,b,e){Xe(e[We],function(a){c.attr("src",a);setTimeout(function(){var a=$,b,e=c.get(0);b=document.createElement("canvas");var f=b.getContext("2d");b.width=e.naturalWidth;b.height=e.naturalHeight;f.drawImage(e,0,0);for(var e=f.getImageData(0,0,e.naturalWidth,e.naturalHeight),g=e.data,h=g.length,l=0;l<h;l+=4)g[l]=g[l+1]=g[l+2]=0.2126*g[l]+0.7152*g[l+1]+0.0722*g[l+2];f.putImageData(e,0,0);b=b.toDataURL();a=a('<img src="'+b+'" />');d.append(a)},
20)})});Fi(e,this);d.insertAfter(c);b=new Sg;b.id=a.t();b.version=a.ua().R();$(this).parents("li").data("result",b)});$("#limbo").append(c)},function(a){var b=d.find("img"),c=1-a,e=1/c;d.css("width",100*c+"%").css("left",100*a+"%");b.css("width",100*e+"%").css("left",100*-a*e+"%")},function(a){d.remove();c&&c(a)});var d=$('<div class="uploadProgress"></div>')}}(g);h.readAsDataURL(g)}}0<d&&(I&&I.track("image_upload",{source:b,quantity:d}),I&&I.increment("uploads_"+b,d))}
function Oi(a){var b=0,c=$(".gallery",a).data("columnData");if(c)b=Array.max(c.F.map(function(a){return a.ra}));else return b;b=Array.max(c.F.map(function(a){return a.height}));c=Array.max(c.F.map(function(a){return 0==a.height?0:a.height+a.ra}));return b=b!=c?c-b:Ci(a)}function Ci(a){var b=0,c=$(".infoPanel",a).clone();0<c.length&&(c.appendTo(a).addClass("doNotTransition").css("height","").css("display","none"),b=c.outerHeight(!0),c.remove());return b}
function Td(a,b){if(0!=a.parents(".results.infinite").length){var c=a.hasClass("inlineFolderGroup"),d=a.parents(".results").first(),e=c?a.find("p button")?a.find("p").height():0:Ni(a),f=0;$(".gallery li",a).each(function(a,b){var c=$(b);f=Math.max(f,c.data("originalTop")+c.height())});f+=e;a.data("contentHeight",f);e=Oi(a);b||c?a.height(f+e):a.is(".suggestions")?a.height(Math.max(f+e,200)):a.height(Math.max(f+e,d.height()))}}
function ei(){var a=$(this).parent(".results");clearTimeout(a.data("scrollTimer"));var b=setTimeout(function(){dj(a)},100);a.data("scrollTimer",b)}
function Pi(a,b){var c=[],d=a.data("columnData");if(void 0===d)return c;for(var d=d.F,e=0;e<d.length;e++){for(var f=d[e].H,g=0,h=!1,l=0;l<f.length;l++){var m=f[l],n=m.data("originalTop")||0,n=(m.data("modifiedTop")||n)-n;0==n||h||(g+=n,h=!0);g+=m.height();if(g>b)break}c=c.concat(f.slice(l))}return c.map(function(a){return a.get(0)}).filter(function(a){return null!=a.parentNode})}
function fi(a){var b=$(a.currentTarget).parents(".suggestions"),c=b.data("storedDOM"),d=b.prev(".searchGroup"),e=$(a.target).parents(".results");a=$(a.target).parents(".layer");var f=a.scrollTop(),g=e.height();X===b.data("search")&&bh(qa);e.addClass("modifying");var h=Ei(b),l=$('<div class="placeholder searchGroup"></div>'),m=e.find(".searchLoaderHolder.on").height()||0;l.height(b.height()+m).insertAfter(b);oi(a);b.css("width",b.width()).css("position","absolute").css("top",h);b.animate({opacity:0},
Fa,function(){d.addClass("doNotTransition");b.remove();c.elements.removeClass("oldSearch").addClass("newSearch").appendTo(d.find(".gallery"));Rd(d.find(".gallery"));d.removeClass("doNotTransition");setTimeout(function(){c.gg.css("opacity",0).insertAfter(d);c.gg.each(function(){var a=$(this);Ei(a)<f+g?setTimeout(function(){a.animate({opacity:1},600)},20):a.css("opacity",1)});$(".searchGroup:not(.placeholder)",e).each(function(){Td($(this),!0)});l.remove()},20)});e.removeClass("modifying");X=0<c.gg.length?
c.gg.last().data("search"):d.data("search");return!1}function mi(a,b){var c=$("> .layer > .inner > .searchGroup",a).first().find(".gallery li").first().width()||70;return Math.floor(a.width()/c)*Math.max(Math.ceil(b/c),3)}
function dj(a){if(null!=X&&!a.is(".modifying")){var b=a.find("> .layer").last(),c=b.find("> .inner > .searchGroup").last();0<$(".searchLoaderHolder > .searchLoader",a).length||0<$(".searchLoader",c).length||(c=c.outerHeight()+c.offset().top-(a.offset().top+a.outerHeight()),ej()&&c<=0.33*a.outerHeight()&&(c=b.find("> .inner > .searchGroup .gallery li").length,500<c&&fj(b,c-500),a=a.find(".searchLoaderHolder"),ki(a),a.addClass("on"),X.Pb+=X.Ub,X.uh(),ra=!0,Qh()))}}
function fj(a,b){for(var c=a.parents(".results"),d=$(),e=$(),f=b,g=a.find("> .inner > .searchGroup").toArray(),h=0;h<g.length&&!(0>=f);h++){var l=$(g[h]),m=$(".gallery li",l);if(m.length<f)d=d.add(l),f-=m.length;else for(var l=f,n=0;n<l;n++)e=e.add(m[n]),f--}f=e.parents(".searchGroup").add(d);g=$(".infoPanel",f);0<g.length&&(f.addClass("doNotTransition"),g.addClass("doNotTransition"),$(".close",g).trigger("touchClick"),g.data("infoPanelPointer").remove(),g.remove(),f.removeClass("doNotTransition"));
c.addClass("modifying");a.find("> .inner > .searchGroup").addClass("doNotTransition");var f=a.scrollTop(),g=e.parents(".searchGroup"),p=0;0<g.length&&(h=g.outerHeight(!0),m=$(".gallery",g),m.removeData("columnData"),e.remove(),Rd(m),p+=h-g.outerHeight(!0));d.each(function(){p+=$(this).outerHeight(!0)});d.remove();g=a.find("> .inner > .searchGroup .infoPanel");0<g.length&&g.addClass("doNotTransition").css("top",parseInt(g.css("top"),10)-p).removeClass("doNotTransition");d=Math.max(0,f-p);a.scrollTop(d);
a.find("> .inner > .searchGroup").removeClass("doNotTransition");c.removeClass("modifying")}function Ni(a){return 0==a.length?0:$(".gallery, .noResults",a).offset().top-a.offset().top}function gj(a){a=a.find("> .inner > .searchGroup").last();return Ei(a)+a.outerHeight(!0)}function Ei(a){return 0==a.length?0:a.parents(".layer").scrollTop()+a.position().top}
function hj(a,b){if(null!=a&&0!=b.length){var c=b.toArray();a.F.forEach(function(a){c.forEach(function(b){var c=a.H.map(function(a){return a.get(0)}).indexOf(b);-1>=c||(a.H.splice(c,1),a.height-=$(b).height(),void 0!==$(b).data("modifiedTop")&&1<=c&&void 0===a.H[c-1].data("modifiedTop")&&(a.ra=0))})})}}function Di(a){var b=a.find("> .layer").last().scrollTop();a=a.height();return b+a}
function ji(){var a=$("#objectPanel > menu > li.on").index();return $("#objectPanel > .content > .results").eq(a)}function Vi(){}function ij(a){a=a.find("> .layer").last().find("> .inner > .searchGroup.suggestions");$("> .inner .close",a).remove();a.removeData("storedDOM")}
function Nd(){var a=$("#objectPanel").find("#resultsLayout > .layer").first();ki(a);Dg(function(b,c){if(200===b){var d=a.find(".templateGallery"),e=_.template('<li class="loading newSearch"><a href="#" title="<%= name %>"><img src="<%= thumbnail.url %>"></a></li>'),f=0,g=0;c.forEach(function(a,b){var c=$(e(a));c.data("content",JSON.parse(a.content));var n=c.find("img");n.on("load",function(){c.removeClass("loading")});d.append(c);0==f&&(f=c.find("> a").width(),g=Math.ceil(f*a.thumbnail.height/a.thumbnail.width));
n.css("width",f).css("height",g);setTimeout(function(){c.removeClass("newSearch")},4*b*Ea)})}else a.append('<p class="noResults searchError">Sorry, the Canva elves had problems finding layouts. Try again later.</p>');oi(a)})}function hi(){$("#someoneElseEditing").one("animationend",function(){$(this).removeClass("on off")}).addClass("off");jj();return!1}
function kj(){$("#outOfSync").addClass("on");$("body").addClass("blockDocument");V();$("#search").blur();$("#outOfSync button").on("touchClick",function(){$("#outOfSync").one("animationend",function(){$(this).removeClass("on off")}).addClass("off");jj();ta=G.version();td(G.state());L.trigger("session:sync",G.state());return!1})}function lj(){$("#savingError").addClass("on");$("#savingError button").on("touchClick",function(){window.location.reload();return!1})}
function mj(){$("#savingError").hasClass("on")&&$("#savingError").one("animationend",function(){$(this).removeClass("on off")}).addClass("off")};function nj(){this.Ba=[];this.Sd=[];this.fc=[];this.Df=this.Gf=!1}function Q(a,b){if(!(b.p["new"]&&b.p.old&&JSON.stringify(b.p["new"])==JSON.stringify(b.p.old)||a.Gf||a.Df)){var c=b instanceof oj;0<a.fc.length?a.fc[a.fc.length-1].push(b):(a.Ba.push(b),a.Sd=[],!c&&C.trigger("change"))}}function kh(){var a=D,b=new oj;Q(a,b);a.fc.push(b)}
function lh(){var a=D;if(0==a.fc.length)throw"mismatched number of .endGrouping calls";var b=a.fc.pop();0==b.dc()&&a.Ba.splice(a.Ba.indexOf(b),1);0==a.fc.length&&C.trigger("change")}function qh(){var a=D;if(0!=a.Ba.length){a.Gf=!0;if(0<a.fc.length)throw"cannot undo while a grouped operation is being collected";var b=a.Ba.pop(),c=b.invert();c.kc();C.trigger("change");a.Sd.push(b);pj(c);a.Gf=!1}}
function ph(){var a=D;if(0!=a.Sd.length){a.Df=!0;var b=a.Sd.pop();b.kc();C.trigger("change");a.Ba.push(b);pj(b);a.Df=!1}}
function Ji(a,b){var c=D;function d(a){var b=[];a instanceof R?b.push(a):a instanceof oj&&a.Ba.forEach(function(a){b=b.concat(d(a))});return b}function e(a,b,c){a.mediaId===b.mediaId&&a.mediaVersion===b.mediaVersion&&(a.mediaId=c.mediaId,a.mediaVersion=c.mediaVersion)}c=c.Ba.map(d).concat(c.Sd.map(d));[].concat.apply([],c).forEach(function(c){switch(c.I){case qj:e(c.p["new"],a,b);e(c.p.old,a,b);break;case rj:case sj:e(c.p,a,b)}})}function pj(a){V();tj(a).forEach(function(a){De(a)})}
function tj(a){var b=[];if(a instanceof R||a instanceof uj){var c=a.p.elementIndex;C.n[a.p.pageIndex].aa().forEach(function(a){a.s()==c&&b.push(a)})}else a instanceof oj&&(a=a.Ba,a.forEach(function(a){a=tj(a);b=b.concat(a)}),2===b.length&&2==a.length&&a[0]instanceof R&&a[1]instanceof R&&a[0].I==rj&&a[1].I==qj&&(b=tj(a[0])));return b}function xj(){this.I=null;this.p={}}xj.prototype.kc=function(){throw"classes that inherit from Canva.Operation must implement .perform";};
xj.prototype.invert=function(){throw"classes that inherit from Canva.Operation must implement .invert";};function oj(){this.Ba=[]}oj.prototype=new xj;oj.prototype.kc=function(){this.Ba.forEach(function(a){a.kc()})};oj.prototype.invert=function(){var a=new oj;this.Ba.reverse();this.Ba.forEach(function(b){a.push(b.invert())});this.Ba.reverse();return a};oj.prototype.push=function(a){this.Ba.push(a)};oj.prototype.dc=function(){return this.Ba.length};var jc=1,sj=2,rj=3,qj=5,yj=6,Bi=7,yi=8,wi=9;
function R(a,b){this.I=a;this.p=b}R.prototype=new xj;
R.prototype.kc=function(){$("#overlays .element.text").each(function(){ye($(this))});var a=C.n[this.p.pageIndex],b=null,b=this.I==rj?ze(this.p):a.N[this.p.elementIndex];switch(this.I){case jc:a=this.p["new"];null!=a.left&&b.S(a.left);null!=a.top&&b.P(a.top);null!=a.rotation&&gc(b,a.rotation);b.setSize(null==a.width?b.g():a.width,null==a.height?b.h():a.height);b.Ha();break;case sj:b.remove();break;case 4:var c=this.p.oldElementIndex,b=a.N[c];case rj:var d=this.p.elementIndex;4==this.I&&c<d&&d++;c=
a.aa().length;d=Math.max(Math.min(c,d),0);d==c?b.appendTo(a):b.insertBefore(a.N[d]);break;case qj:b.pb(this.p.cropIndex,this.p["new"]);break;case yj:a=b.vb(this.p.cropIndex);b.ld(a);a=this.p["new"];d=Fb(a.imageBox);c=Fb(a.placeholderBox);b instanceof Ae?a.cropped?(pb(b,c),b.eb(d),b.Ib(),b.S(a.left),b.P(a.top)):(b.S(a.left),b.P(a.top),b.D(d.g()),b.q(d.h()),pb(b,c),b.eb(d),b.Ve=!1,b.$b=!1,b.i.find("img").css("transform","").css("width","").css("height","")):(b.eb(d),b.Ib());break;case Bi:b=a.N[this.p.oldElementIndex];
Mc(b);break;case yi:bf(b);Fe(a,b,this.p.oldElementIndex);break;case wi:a=this.p["new"];d=Qb(a.color);b.Vd(a.index,d);break;default:throw"cannot perform unknown operation type "+this.I.toString();}};
R.prototype.invert=function(){var a=$.extend(!0,{},this.p);switch(this.I){case jc:case yj:case qj:case wi:return a["new"]=this.p.old,a.old=this.p["new"],new R(this.I,a);case rj:case sj:return new R(this.I==rj?sj:rj,a);case 4:var b=a.elementIndex;a.elementIndex=a.oldElementIndex;a.oldElementIndex=b;return new R(this.I,a);case Bi:return new R(yi,a);case yi:return b=a.elementIndex,a.elementIndex=a.oldElementIndex,a.oldElementIndex=b,new R(Bi,a);default:throw"cannot invert unknown operation type "+this.I.toString();
}};var ri=4,zj=5;function qi(a,b){this.I=a;this.p=b}qi.prototype=new xj;qi.prototype.kc=function(){$("#overlays .element.text").each(function(){ye($(this))});var a=null,a=1==this.I?new xc(C,this.p):C.n[this.p.pageIndex];switch(this.I){case zj:a=C.n[this.p.oldPageIndex];case 1:Nc(C,a,this.p.pageIndex);break;case 2:Oc(C,a);break;case ri:pi(a,this.p["new"]);break;default:throw"cannot perform unknown operation type "+this.I.toString();}};
qi.prototype.invert=function(){var a=$.extend(!0,{},this.p);switch(this.I){case 1:case 2:return new qi(1==this.I?2:1,a);case ri:return a["new"]=this.p.old,a.old=this.p["new"],new qi(this.I,a);case zj:var b=a.pageIndex;a.pageIndex=a.oldPageIndex;a.oldPageIndex=b;return new qi(this.I,a);default:throw"cannot invert unknown operation type "+this.I.toString();}};var Aj=1;function uj(a,b){this.I=a;this.p=b}uj.prototype=new xj;
uj.prototype.kc=function(){var a=C.n[this.p.pageIndex].N[this.p.elementIndex];switch(this.I){case Aj:var b=this.p["new"];a.qc(this.p.textIndex,b);void 0!==b.height&&a instanceof Sc&&a.q(b.height);break;default:throw"cannot perform unknown operation type "+this.I.toString();}};uj.prototype.invert=function(){var a=$.extend(!0,{},this.p);switch(this.I){case Aj:return a["new"]=this.p.old,a.old=this.p["new"],new uj(this.I,a);default:throw"cannot invert unknown operation type "+this.I.toString();}};
function Bj(a,b){this.I=a;this.p=b}Bj.prototype=new xj;Bj.prototype.kc=function(){switch(this.I){case 1:Pc(C,this.p.style,this.p["new"]);break;default:throw"cannot perform unknown document operation type "+this.I.toString();}};Bj.prototype.invert=function(){var a=$.extend(!0,{},this.p);switch(this.I){case 1:return a["new"]=this.p.old,a.old=this.p["new"],new Bj(this.I,a);default:throw"cannot invert unknown operation type "+this.I.toString();}};(function(a){a.path={};var b={rotate:function(a,b){var e=b*Math.PI/180,f=Math.cos(e),e=Math.sin(e);return[f*a[0]-e*a[1],e*a[0]+f*a[1]]},scale:function(a,b){return[b*a[0],b*a[1]]},add:function(a,b){return[a[0]+b[0],a[1]+b[1]]},eh:function(a,b){return[a[0]-b[0],a[1]-b[1]]}};a.path.Jh=function(c){c.start=a.extend({angle:0,length:0.3333},c.start);c.end=a.extend({angle:0,length:0.3333},c.end);this.De=[c.start.x,c.start.y];this.Ee=[c.end.x,c.end.y];var d=b.eh(this.Ee,this.De),e=b.scale(d,c.start.length),
d=b.scale(d,-1),d=b.scale(d,c.end.length),e=b.rotate(e,c.start.angle);this.jh=b.add(this.De,e);d=b.rotate(d,c.end.angle);this.kh=b.add(this.Ee,d);this.Oi=function(a){return a*a*a};this.Pi=function(a){return 3*a*a*(1-a)};this.Qi=function(a){return 3*a*(1-a)*(1-a)};this.Ri=function(a){return(1-a)*(1-a)*(1-a)};this.css=function(a){var b=this.Oi(a),c=this.Pi(a),d=this.Qi(a);a=this.Ri(a);var e={};e.x=this.x=this.De[0]*b+this.jh[0]*c+this.kh[0]*d+this.Ee[0]*a+0.5|0;e.y=this.y=this.De[1]*b+this.jh[1]*c+
this.kh[1]*d+this.Ee[1]*a+0.5|0;e.left=e.x+"px";e.top=e.y+"px";return e}};a.path.arc=function(a,b){for(var e in a)this[e]=a[e];for(this.dir=this.dir||1;this.start>this.end&&0<this.dir;)this.start-=360;for(;this.start<this.end&&0>this.dir;)this.start+=360;this.css=function(a){a=(this.start*a+this.end*(1-a))*Math.PI/180;var c={};b&&(c.ph=this.x,c.Oj=this.y);c.x=this.x=Math.sin(a)*this.ed+this.ie[0]+0.5|0;c.y=this.y=Math.cos(a)*this.ed+this.ie[1]+0.5|0;c.left=c.x+"px";c.top=c.y+"px";return c}};a.fx.step.path=
function(b){var d=b.end.css(1-b.pos);null!=d.ph&&a.cssHooks.transform.set(b.elem,"rotate("+Math.atan2(d.Oj-d.y,d.ph-d.x)+")");b.elem.style.top=d.top;b.elem.style.left=d.left}})(jQuery);function sc(){this.Wf=0;this.mg=23}function Cj(a){a.preventDefault();a.stopPropagation();return!1}var Dj=[];
[[642,800],[200,106],[192,200],[200,77],[165,200],[141,200],[200,124],[149,200],[191,200],[150,200],[200,129],[129,200],[200,154],[200,174],[200,70],[124,200],[200,176],[200,132],[200,149]].forEach(function(a,b){var c="/static/images/onboarding/lion-"+b+".png";Dj.push({Ea:t(""),id:"Monboarding"+b,t:function(){return"Monboarding"+b},version:0,R:t(0),ec:t("CANVA"),$c:t(!1),ca:t(!1),ad:t(!1),Cc:t(!1),files:{af:{width:a[0],height:a[1],url:c},bf:{width:a[0],height:a[1],url:c}}})});
function Ej(a,b,c){c(200,{ua:function(){return{R:t(0),ab:function(){return{SCREEN:{Sb:t("/static/images/onboarding/lion-0.png")}}}}}})}y=sc.prototype;
y.go=function(){E=qc.custom;ba=E.templates.blank;E.width=1024;E.height=768;ba.width=E.width;ba.height=E.height;this.Wf=0;this.Gj=[this.fj,this.pj,this.Pj,this.fk,this.wk,this.Gh,this.Sj,this.sj,this.ij,this.Eb,this.Cj,this.li,this.bk,this.Eb,this.Aj,this.Fi,this.Gi,this.dk,this.Vj,this.Eb,this.Dj,this.pi,this.Eb,this.yj,this.Uh,this.Eb,this.rk,this.Eb,this.Bj,this.ji,this.Eb,this.zj,this.fi,this.Eb,this.hk,this.Ti,this.Eb,this.gk,this.Eb,this.Rj,this.Rh,this.Wj,this.Nj];this.next()};
y.fj=function(){var a=this;pc({Ed:function(){a.next()}})};function Fj(a,b,c){function d(){f+=e.shift();a(f);0<e.length?window.setTimeout(d,250+Math.floor(100*Math.random())):window.setTimeout(c,250);return!1}var e=b.split(""),f="";a("");d()}function Gj(){for(var a=[],b=0;5!==b;b++)a[b]=new Image,a[b].src="/static/images/onboarding/lion-"+b+".png"}y.pj=function(){var a=this;Gj();WebFont.load({google:{families:["Abril+Fatface","Carter+One"]},active:function(){a.next()},inactive:function(){a.next()}})};
function Hj(a){a.Gg=!1;$("body").addClass("dialogView");$("body > .mask").addClass("on");$("body > .mask").on("touchClick",function(){a.Jb.addClass("disappearing").delay(500,function(){$(this).remove();a.Gg||(Ij(a),Nd())});$("body").removeClass("dialogView");$("body > .mask").addClass("off").delay(500,function(){$(this).removeClass("on off")});$("body > .mask").off("touchClick")})}
y.fk=function(){Hj(this);this.Jb=$('<div id="onboarding-23second-dialog" class="for-onboarding onboarding-dialog"><div class="onboarding-dialog-text"><span class="onboarding-time">'+this.mg+'</span><span class="onboarding-description">second guide to beautiful design in Canva</span></div><div class="onboarding-dialog-icons"><span class="onboarding-search"><span class="icon"><img src="/static/images/onboarding_search.png"/></span>Search</span><span class="onboarding-drag"><span class="icon"><img src="/static/images/onboarding_hand.png"/></span>Drag</span><span class="onboarding-publish"><span class="icon"><img src="/static/images/onboarding_publish.png" /></span>Publish</span></div><div class="onboarding-dialog-actions"><span class="onboarding-show-me-how"><button class="onboarding-show-me-how-button">Show me how it&#8217;s done</button></span></div></div><img src="/static/images/onboarding_hand_clicking.png" width="0" height="0" style="display:none"/><img src="/static/images/onboarding_hand_grabbing.png" width="0" height="0" style="display:none"/>');
this.Jb.appendTo("body");this.next()};
y.wk=function(){var a=this,b=$(".onboarding-dialog");$(".onboarding-show-me-how-button").click(function(){I&&I.track("onboarding",{status:"viewed"});a.Gg=!0;var c=$(".onboarding-drag .icon"),d=c.clone(),e=$(".onboarding-show-me-how-button"),f=e.clone(),e=e.offset(),c=c.find("img").offset();d.attr("id","onboarding-active-hand").addClass("for-onboarding").appendTo("body").offset(c);f.attr("id","onboarding-active-button").addClass("for-onboarding").appendTo("body").offset(e);d=a.mg-1;$("#onboarding-23second-dialog .onboarding-time").text(d.toString());
b.fadeOut(2E3);a.next()})};y.Sj=function(){$("body").append(this.df);this.df.on("click",Cj);var a=this.mg-2;window.setTimeout(function(){$("#onboarding-23second-dialog .onboarding-time").text(a.toString())},1E3);this.next(1500)};y.Gh=function(){Jj();V();var a=new xc(C,C.Db);Nc(C,a,0);this.page=a;this.next()};
y.sj=function(){function a(){c++;2===c&&b.next(300)}var b=this,c=0,d=$("#onboarding-active-hand"),e=$("#onboarding-active-button");$(".onboarding-drag .icon").remove();$(".onboarding-show-me-how-button");$("body > .mask").trigger("touchClick");e.css({width:e.width()});e.text("");e.delay(300).animate({width:"110px",height:"46px","border-radius":"25px",padding:"0 15px 0 35px"},{duration:600,queue:!1,complete:a});d.delay(300).animate({left:1*e.offset().left-15,top:1*e.offset().top-4},{duration:600,queue:!1,
complete:a})};y.ij=function(){var a=$("#onboarding-active-hand"),b=$("#onboarding-active-button"),c=$('<div class="for-onboarding" id="onboarding-active-hand-morphed"></div>'),d=a.offset();c.offset(d);c.appendTo(a.parent());a.appendTo(c);a.css({top:0,left:0});b.appendTo(c);b.css({top:"4px",left:"15px"});b.text("Search");this.next()};function Kj(){$("#onboarding-active-hand img").attr("src","/static/images/onboarding_hand_grabbing.png")}
function Lj(){$("#onboarding-active-hand img").attr("src","/static/images/onboarding_hand.png")}function Mj(){var a=$("#onboarding-active-hand img");a.attr("src","/static/images/onboarding_hand_clicking.png");window.setTimeout(function(){a.attr("src","/static/images/onboarding_hand.png")},300)}y.NEXT="next";function Nj(a,b){return 500+Math.floor(0.8*Math.sqrt(Math.pow(a.left-b.left,2)+Math.pow(a.top-b.top,2)))}
function Oj(a,b){var c=$("#onboarding-active-button");c.text(a);c.animate(b,{duration:500,queue:!1})}
function Pj(a,b,c){var d=c.vg||{x:0,y:0},e=c.gb||k(),f=$("#onboarding-active-hand-morphed"),g=f.offset();b={top:1*$(b).offset().top+1*$(b).height()/3+d.y,left:1*$(b).offset().left+1*$(b).width()/3+d.x};g=Nj(g,b);b=new $.path.Jh({start:{x:1*f.offset().left,y:1*f.offset().top,angle:10,length:0.1},end:{x:b.left,y:b.top,angle:-30,length:0.1}});c.gb===a.NEXT&&(e=function(){a.next(300)});f.animate({path:b},g,e)}y.Cj=function(){Pj(this,"#search",{gb:this.NEXT})};
y.li=function(){Mj();$("#search").focus();this.next(700)};
y.bk=function(){function a(){if(ra){ra=!1;var a=$("#resultsSearch"),a=$("> .layer > .inner > .searchGroup",a).last(),c=$(".photoGallery",a),f=0,g=!1;Dj.forEach(function(a){var d=$('<li class="newSearch loading"><a href="#"><img data-screen-url="'+a.files.af.url+'"data-screen-width="'+a.files.af.width+'"data-screen-height="'+a.files.af.height+'"src="'+a.files.bf.url+'"width="'+a.files.bf.width+'"height="'+a.files.bf.height+'"/></a></li>');d.appendTo(c);$("img",d).on("load",function(){f++;!g&&5<=f&&
(b.next(),g=!0);d.removeClass("loading")});d.data("result",a)});c.addClass("photoGallery");Rd(c)}}var b=this,c=$("#search");Fj(function(a){c.val(a)},"lions",function(){ij($("#resultsSearch"));oi($("#resultsSearch > .layer > .inner > .searchGroup"));Qi(k(),a)})};y.Aj=function(){Oj("Drag",{width:"90px"});Pj(this,"#resultsSearch .searchGroup .photoGallery li:first-child",{gb:this.NEXT})};y.Eb=function(){this.next(700)};
y.Fi=function(){var a=this,b=$("#onboarding-active-hand-morphed"),c=$("section .page.selected"),c={top:c.offset().top-40,left:c.offset().left-42},d=Nj(b.offset(),c),e=Math.floor(0.8*T(C).h())*N,f=Math.floor(0.8025*e);Kj();a.yc=$("#resultsSearch .searchGroup .photoGallery li:first-child img").clone();a.yc.removeAttr("width");a.yc.removeAttr("height");a.yc.css({position:"absolute",top:"-34px",left:"-27px","z-index":"9000",height:"95px"});b.append(a.yc);a.yc.animate({height:e+"px",width:f+"px",left:(-180*
N-42)/2+"px",top:(-180*N-40)/2+"px"},{duration:d,queue:!1});b.animate(c,{duration:d,queue:!1,complete:function(){a.next(300)}})};y.Gi=function(){var a=this,b=$("#resultsSearch .photoGallery li:first-child img"),b=ze(Ai(b)),c=Math.floor(0.8*T(C).h());b.setSize(Math.floor(0.8025*c),c);b.oa(-180,-180);b.appendTo(T(C));vi(b);Lj();a.yc.fadeOut(200,function(){a.yc.remove()});a.next(300)};y.dk=function(){var a=De,b=T(C);a(b.N[0]);this.next(200)};
y.Vj=function(){function a(){Lj();f.removeClass("on");b.next(300)}var b=this,c=$("#onboarding-active-hand-morphed"),d=T(C),e=800/642,f=$(".handle.br"),g=d.ba()[0],h=d.i.offset(),d=0.78*d.g(),l={left:Math.floor(h.left+0.78*d*N),top:Math.floor(h.top+0.78*d*e*N)},m=g.g();g.h();g.g();g.h();Pj(this,".selectionBox .handle.br",{vg:{x:-20,y:-12},gb:function(){var b=c.offset();Kj();f.addClass("on");c.delay(300).animate(l,{duration:1E3,queue:!1,complete:a,progress:function(){var a=(c.offset().left-b.left)/
N+m,d=a*e;$(".selectionBox").css({height:d*N+"px",width:a*N+"px"});g.setSize(a,d)}})}})};y.Dj=function(){var a=this;Oj("Add text",{width:"134px"});Pj(this,"#objectPanel > menu li.text a",{gb:function(){$("#objectPanel > menu li.text a").css("color","#00f7ff");a.next(300)}})};y.pi=function(){Mj();$("#objectPanel > menu li.text a").trigger("touchClick").css("color","");this.next(200)};y.yj=function(){var a=this;Pj(this,"#objectPanel .textControls [data-style=title]",{vg:{x:0,y:16},gb:function(){a.next(300)}})};
y.Uh=function(){function a(){var a=c.va();c.Vb(a,"Carter One")}$("#objectPanel .textControls [data-style=title]");var b=T(C),c=new Sc({width:b.g()/2,html:"&nbsp;",fontFamily:"Carter One",fontSize:120,left:b.g()-400,top:Math.floor(0.5*b.h()-112.5)});V();Mj();a();c.appendTo(b);vi(c);De(c);window.setTimeout(function(){a()},100);window.setTimeout(k(),200);this.next(200)};
y.rk=function(){var a=this,b=T(C).ba()[0];b.i.trigger("click");Fj(function(a){$(b.i.find(".inner")).html(a+'<span class="onboarding-fake-caret"></span>')},"Yum.",function(){b.i.find(".inner").css({border:"none"});$(".onboarding-fake-caret").remove();a.next()})};y.Bj=function(){$("#designToolsText a").css({color:"#fff"});Oj("Publish",{width:"120px",left:"-85px",padding:"0 39px 0 17px"});Pj(this,"#documentMenuExport",{gb:this.NEXT})};
y.ji=function(){Mj();$("#documentMenuExport button").trigger("click");this.next(700)};y.zj=function(){var a=this;Oj("Publish",{width:"108px",left:"22px",padding:"0 20px 0 31px"});Pj(this,"#exportDialog .export .image",{gb:function(){$("#exportDialog .export .image img.on").addClass("selected");a.next(600)}})};y.fi=function(){Mj();this.next()};
y.hk=function(){var a=Xi().clone();a.css({top:0,left:0});a.removeClass("selected");$("body > .mask").addClass("on");$("#exportDialog").remove();this.Jb=$('<div id="onboarding-outro-dialog" class="for-onboarding onboarding-dialog"></div>');this.Jb.css({width:a.width()+"px",height:a.height()+"px","margin-top":-a.height()/2+"px","margin-left":-a.width()/2+"px"});this.Jb.append(a);this.Jb.appendTo("body");this.next()};y.Ti=function(){var a=this;$("#onboarding-active-hand-morphed").fadeOut(1600,function(){a.next()})};
y.gk=function(){var a=this,b=$(window).height()-a.Jb.offset().top,c=!1;$('<div id="onboarding-go-dialog" class="for-onboarding onboarding-dialog"><div class="onboarding-dialog-text"><span class="onboarding-go">NOW</span><span class="onboarding-go-description">IT&#8217;S YOUR TURN</span></div>').appendTo("body");var d=$('<div id="onboarding-exit-hand" class="for-onboarding"><div class="exit-hand open"><div class="exit-hand-fingers"></div><div class="exit-hand-thumb"></div></div></div>');d.css({bottom:"-280px"});
d.appendTo("body");d.animate({bottom:"0"},900,function(){var e=1*a.Jb.css("margin-top").replace(/px/,"")-b;d.animate({bottom:e+"px"},{duration:1800,Za:"easeOutQuint",queue:!1});a.Jb.animate({"margin-top":b+"px"},{duration:1800,Za:"easeOutQuint",queue:!1,complete:function(){c||(a.next(1E3),c=!0)}})})};
function Jj(){X=null;$("#search").val("");ij($("#resultsSearch"));$("#resultsSearch .searchGroup").removeData("search").css("height","").find("ul").empty();$("#resultsSearch .searchGroup").find("h2").remove();$("#objectPanel .results").addClass("doNotTransition");$("#objectPanel > menu .search a").trigger("click");setTimeout(function(){$("#objectPanel .results").removeClass("doNotTransition")},20)}y.Rj=function(){V();Oc(C,this.page);this.next()};
y.Rh=function(){this.df.remove();$("body > .mask").removeClass("on").addClass("off");$(".for-onboarding").remove();$("body").removeClass("onboarding-in-progress").removeClass("dialogView");V();this.next()};y.Pj=function(){this.Hh=Vi;this.Ih=Yd;this.Dh=na.ib;this.Ni=ua.ue;this.Mi=ua.yd;this.Kh=va.te;this.df=$("<div id='block-everything'></div>");ua.ue=function(){return{cancel:k()}};ua.yd=k();va.te=k();Vi=k();Yd=k();na.ib=Ej;G.close();C.off("change");this.next()};
function Ij(a){Jj();Vi=a.Hh;Yd=a.Ih;ua.ue=a.Ni;ua.yd=a.Mi;va.te=a.Kh;na.ib=a.Dh;Qj(window.csession,window.cdoc);C.on("change",Rj)}y.Wj=function(){Ij(this);this.next()};y.Nj=function(){$(".templateGallery").empty();Nd()};y.next=function(a){function b(){d.call(c)}var c=this,d=this.Gj[this.Wf];d&&d.call?(this.Wf++,a&&!isNaN(parseInt(a,10))?window.setTimeout(b,a):b()):c.next=k()};function rc(a){this.document=a}rc.prototype.listenTo=Backbone.Events.listenTo;function Sj(){WebFont.load({google:{families:["Yellowtail"]},active:k(),inactive:k()})}
function Uj(){function a(){window.setTimeout(function(){window.location="/"},300)}$("body").addClass("dialogView");$("body > .mask").removeClass("off").addClass("on");$("body").on("click",a);$("body > .mask").on("click",a);$('<div id="magic-button-dialog"><div id="magic-button-dialog-congratulations">Congratulations!</div><div id="magic-button-dialog-now-ready">You&#8217;re now ready to create your own stunning designs with Canva</div><button id="magic-button-dialog-done">Start your own design</button><div id="magic-button-dialog-share"><iframe src="//www.facebook.com/plugins/like.php?href=https%3A%2F%2Fwww.facebook.com%2Fcanva&amp;width=450&amp;height=65&amp;colorscheme=light&amp;layout=box_count&amp;action=like&amp;show_faces=false&amp;send=false&amp;appId=525265914179580" scrolling="no" frameborder="0" style="border:none; overflow:hidden; width:50px; height:61px;" allowTransparency="true"></iframe><iframe allowtransparency="true" frameborder="0" scrolling="no" src="https://platform.twitter.com/widgets/tweet_button.html?url=%20&text=Just%20got%20my%20@canva%20invite!%20https://www.canva.com&counturl=https://www.canva.com&count=vertical" style="width:56px; height:62px;"></iframe></div></div>').appendTo("body")}
function Vj(a){return 0<a.document.aa().filter(function(a){return"magic-button"==a.i.attr("id")}).length}
rc.prototype.xg=function(){function a(a){a.stopPropagation();a.preventDefault();Uj();I&&I.track("minichallenge_complete");return!1}var b=this.document;this.xg=k();if(!Vj(this)){this.page=new xc(b,b.Db);this.page.Zg=!0;Nc(b,this.page,b.n.length,!1);this.page.i.css("background-color","#20c4cb");var b=new Sc({html:"<strong id='magic-button-text'>I'm finished! &nbsp;<span id='magic-button-text-triangle'>&#9656;</span></strong>",width:310,justification:"center"}),c=b.i;c.attr("id","magic-button");c.on("mousedown",
a);c.on("touchstart",a);this.page.addElement(b,!1,!1);var c=(this.page.g()-b.g())/2,d=(this.page.h()-b.h())/2;b.oa(c,d)}};rc.prototype.go=function(){Sj();this.xg()};function xc(a,b){this.Ia=a;this.J=this.A=0;this.of=null;this.N=[];this.Zb=[];this.Zg=this.Ff=!1;pi(this,b,!0)}xc.prototype.trigger=Backbone.Events.trigger;_.extend(xc.prototype,Backbone.Events);
function Wj(a,b){function c(a,b){var c=!1;b.filter(function(a){return a instanceof Sc}).forEach(function(b){if(!c&&!b.vc){var d=b.ya(0);d.html=a.ya(0).html;b.qc(0,d);b.vc=!0;Ce(e,a,!1);c=!0}});return c}function d(a,b,c,d){var e=c.jb(d);b=Jb(b,e);b=new O(0,0,b.g(),b.h());a.dj=b.serialize();a.dj=b;c.pb(d,a)}var e=a,f=function(a){return a.filter(function(a){return!!a.v()})}(a.Zb.slice());Xj(e,b);(function(a){a.forEach(function(a){var b=a.data;a=a.fe;b=new Ae({ca:!1,Ae:!1,origin:b.Ta,width:a.width,height:a.height,
top:a.top,left:a.left,Ce:b.Ce,qj:b.qj});e.Zb.push(b);e.addElement(b,!1,!1);b.M=e})})(function(a,b){var c=[];b.filter(function(a){return a.wa}).forEach(function(a){for(var b=0;b!==a.wa();b++)c.unshift(function(a,b){return function(c){var e=c.imageBox;e&&d(c,Fb(e),b,a)}}(b,a))});for(var e=0;e!==a.length;e++)if(a[e]){var f=c.pop();if(!f)break;f(a[e].data,a[e].fe)}return a.slice(e)}(function(a){var b=[];a.forEach(function(a){if(0!==(a.wa&&a.wa()||0)&&null!==a.xa(0)){for(var c=0;c!==a.wa();c++){var d=
a.xa(c);d&&d.Ce&&b.push({data:d,fe:a.jb(c)})}Ce(e,a,!1)}});return b}(f),b));(function(a){a.forEach(function(a){Fe(e,a,-1);e.Zb.push(a)})})(function(a,b){var f=[];a.filter(function(a){return a.vc}).forEach(function(a){var g=!1;a instanceof Sc&&(g=c(a,b));if(a instanceof Ae)a:{for(var p=0;p!==b.length;p++){g=b[p];if(!g.wa)break;for(var q=g.wa(),u=0;u!==q;u++){var r=g.xa(u);if(!r||!r.Ce){p=a.serialize();d(p,Fb(r.imageBox),g,u);Ce(e,a,!1);g=!0;break a}}}g=!1}g?Ce(e,a,!1):f.push(a)});return f}(function(a){var b=
[];a.forEach(function(a){0!==(a.wa&&a.wa()||0)&&null!==a.xa(0)||!a.vc?Ce(e,a,!1):b.push(a)});return b}(f),b));(function(a){a=a.filter(e.Wg);0>=e.Zb.filter(e.Wg).length&&0<a.length&&(Fe(e,a[0],-1),e.Zb.push(a[0]))})(f)}
function pi(a,b,c){function d(a){return a.ca()}if(wa&&"on"===wa.re.templateSuperposition)Yj(a,b,c);else{c||a.trigger("willchange",a);0==a.A&&(a.A=b.width,a.J=b.height,a.of=b.dpi);b=b.elements?b.elements.map(ze):[];var e=0<b.filter(d).length;a.N.slice(0).forEach(function(b){!e&&d(b)||Ce(a,b)});a.Zb=b;b.forEach(function(b){b.appendTo(a)});c||Zj(a)}}function Zj(a){a.trigger("change",a);window.setTimeout(function(){C.trigger("change")},2E3)}
function Yj(a,b,c){a.wg&&a.wg===b||(a.wg=b,0==a.A&&(a.A=b.width,a.J=b.height,a.of=b.dpi),b=b.elements?b.elements.map(function(a){a.userEdited=!1;return ze(a)}):[],c||a.trigger("willchange",a),0<a.Zb.length?Wj(a,b):Xj(a,b),c||Zj(a))}y=xc.prototype;y.Wg=function(a){return a.ca()};function Xj(a,b){b.forEach(function(b,d){Fe(a,b,d)});a.Zb=b}y.Rb=function(){var a=new Wb;this.N.forEach(function(b){cc(b.Rb()).forEach(function(b){Xb(a,b)})});return a};y.clone=function(){return new xc(null,this.serialize())};
y.serialize=function(){function a(a){return a.serialize()}return{width:this.A,height:this.J,dpi:this.of,templateCreatedElements:this.Zb.map(a),elements:this.N.map(a)}};y.aa=s("N");y.ba=function(){return this.N.filter(function(a){return a.Md()})};function Lc(a){return a.N.filter(function(a){return a.ca()})}
function ak(a,b){function c(a){return!a.ca()}var d=b instanceof Array?b:[b],d=d.filter(c);return 0===d.length?d:a.aa().filter(c).filter(function(a){return-1===d.indexOf(a)}).filter(function(a){return d.some(function(b){return Lb(b.B(),a.B())})})}function Ce(a,b,c){var d=a.N.indexOf(b);-1<d&&(a.N.splice(d,1),b.remove(),a.trigger("element:remove",a,b,d,!!c),b.ca()&&a.trigger("change:background",a))}
y.addElement=function(a,b,c){this.N.push(a);a.M=this;this.trigger("element:add",this,a,b,c);a.ca()&&this.trigger("change:background",this,a)};function Fe(a,b,c){0>c&&(c=a.N.length);var d=a.N.indexOf(b);-1==d?(c=Math.min(c,a.N.length),a.N.splice(c,0,b),b.M=a,a.trigger("element:add",a,b,!1,!1,c),b.ca()&&a.trigger("change:background",a,b)):(c=Math.min(c,a.N.length-1),a.N.splice(c,0,a.N.splice(d,1)[0]),a.trigger("element:move",a,b,d,c))}y.Z=function(){return parseInt(this.i.css("left"),10)||0};
y.ga=function(){return parseInt(this.i.css("top"),10)||0};y.l=t(0);y.V=xc.prototype.l;y.j=t(0);y.Q=xc.prototype.j;y.g=s("A");y.Fa=xc.prototype.g;y.h=s("J");y.Ca=xc.prototype.h;y.W=function(){return this.l()+this.g()};y.Da=xc.prototype.W;y.G=function(){return this.j()+this.h()};y.Y=xc.prototype.G;y.Bc=function(){return this.j()+this.h()/2};y.B=function(){return new O(this.l(),this.j(),this.g(),this.h())};y.Qb=function(){return this.l()+this.g()/2};y.qa=t(0);y.setSize=k();y.D=k();y.q=k();y.S=k();
y.P=k();y.oa=k();y.Ae=function(){var a=Lc(this);if(0<a.length){var a=a[a.length-1],b;if(b=a.Cc())a:{if(a.Ld&&(b=Qb(a.wc||"#ffffff"))){a=Nb(b.angle/360,b.ed,(100-50*b.ed)*(1-b.mf)/100);b=150>Math.sqrt(0.241*Math.pow(a[0],2)+0.691*Math.pow(a[1],2)+0.068*Math.pow(a[2],2));break a}b=a.Xg}return b}return!1};y.Qe=function(a){void 0===a&&(a=!0);a!=this.Ff&&(this.Ff=a,this.trigger("change:selected",this))};y.Md=s("Ff");y.remove=function(){this.N.forEach(function(a){a.Qe(!1)});this.Ia&&Oc(this.Ia,this)};
y.s=function(){return this.Ia?P(this.Ia,this):-1};function bk(a,b){this.O=a;this.cj=b}function ck(a,b,c){a.get("*",function(d){var e={},f;for(f in d)d.hasOwnProperty(f)&&(e[f]=d[f]);a.O.post("/profile/uiInfo",b(e),null,c)})}bk.prototype.get=function(a,b){this.cj("/profile/_ajax/get",function(c){c=c.uiInfo;"*"===a?b(c):c&&c.hasOwnProperty(a)?b(c[a]):b("NOT_FOUND")})};function tg(a,b){a.get("*",b)}bk.prototype.set=function(a,b,c){ck(this,function(c){c[a]=b;return c},c)};bk.prototype.Jg=function(a,b){ck(this,function(b){delete b[a];return b},b)};function ii(a,b){var c=this,d=null;this.fd=a;this.gd=b;var e=a.find(".scrollHandle");this.Je=e;this.Od=this.fg=this.eg=this.me=this.We=0;this.gd.data("canvaScrollBar",this).on("DOMSubtreeModified",function(){null!=d&&clearTimeout(d);d=setTimeout(function(){dk(c)},20)}).on("scroll",function(){ek(c)});var f=$("<span></span>");this.gd.append(f);f.remove();this.fd.data("canvaScrollBar",this);this.Je.on("mousedown",function(a){function b(a){a=a.clientY-f+n;a=Math.min(a,c.Od);a=Math.max(a,0);c.Je.css("top",
a);c.gd.get(0).scrollTop=(c.me-c.We)*a/c.Od}function d(){$(document).off("mousemove",b).off("mouseup",d);c.fd.removeClass("active")}var f=a.clientY,n=parseInt(e.css("top"),10);e.css("left");$(document).on("mousemove",b).on("mouseup",d);c.fd.addClass("active");return!1});dk(this)}function dk(a){a.We=a.gd.outerHeight();a.me=a.gd.get(0).scrollHeight;a.eg=a.fd.outerHeight();a.fg=Math.round(a.We/a.me*a.eg);a.Je.height(a.fg);a.Od=a.eg-a.fg;0>=a.Od?a.fd.addClass("off"):a.fd.removeClass("off");ek(a)}
function ek(a){var b=a.gd.get(0).scrollTop/(a.me-a.We)*a.Od;a.Je.css("top",b)};var X=null;
function Rh(a){if(a.which==ch){a=$("#search");if(!a.val().match(/^\s*$/))switch(a.val().toLowerCase()){case "grid":case "grids":Qi(k(),fk);break;case "layout":case "layouts":$("#objectPanel > menu > .layout a").trigger("touchClick");a.select();break;case "text":case "font":case "fonts":$("#objectPanel > menu > .text a").trigger("touchClick");a.select();break;case "bkground":case "background":case "backgrounds":$("#objectPanel > menu > .backgrounds a").trigger("touchClick");a.select();break;case "upload":case "uploads":$("#objectPanel > menu > .uploads a").trigger("touchClick");
a.select();break;default:Qi()}_gaq.push(["_trackEvent","Search","Keypress - Enter",a.val()]);return!1}}
function Qi(a,b){function c(){var c=gk(f.find(".browseCategories").data("view"));g.animate({scrollTop:p-50+c},Ha,function(){a();n.remove();ra=!0;b()})}function d(){var a=$(".infoPanel",l);0<a.length&&(l.addClass("doNotTransition"),a.addClass("doNotTransition"),$(".close",a).trigger("touchClick"),a.data("infoPanelPointer").remove(),a.remove(),l.removeClass("doNotTransition"));var b=Di(f),c=-1;$("> .gallery > li",l).each(function(){var a=$(this);m+a.data("originalTop")<b&&(a.addClass("oldSearch"),setTimeout(function(){a.addClass("doNotTransition newSearch");
setTimeout(function(){a.removeClass("doNotTransition newSearch oldSearch")},20)},++c*Ea+Fa))});setTimeout(function(){xa=!1},c*Ea+Fa)}bh(qa);var e=$("#search"),f=$("#resultsSearch"),g=$("> .layer",f).first(),h=$("> .inner > .searchGroup",g);g.data("userPreparedSearch",!0);if(X&&e.val().trim()==X.query){var l=h.last();oi(l);if(!xa){xa=!0;var m=Ei(l),e=m-50;1<Math.abs(e-g.scrollTop())?g.animate({scrollTop:e},Ha,d):d()}}else{a=a||ni;b=b||Qh;X=new li(e.val(),mi(f,f.height()),a);ra=!1;Zi?e.blur():e.select();
l=$('<div class="searchGroup hasContent"><h2></h2><ul class="gallery photoGallery infoPanelGallery"></ul></div>');""!=e.val()?$("h2",l).html("&ldquo;"+e.val()+"&rdquo;"):$("h2",l).html("");l.height(f.height());var n=$();0<$(".searchLoaderHolder.on",f).length&&(n=$('<div class="placeholder"><div/>'),n.height($(".searchLoaderHolder",f).height()),g.addClass("doNotTransition"),n.insertAfter(h.last()),g.removeClass("doNotTransition"));oi(h.last());var p=gj(g),q=Di(f),e=p>q+50,u=$(),r=$();if(e){var w=q+
50,v=$();h.each(function(){var a=$(this);0==v.length&&Ei(a)+a.outerHeight()>w&&(v=a)});0==v.length&&(v=h.last());var q=$(".gallery",v),r=w-Ei(v),x=0;0<q.length&&(x=r-(q.offset().top-v.offset().top));x=Pi(q,x);u=u.add(x);r=v.nextAll(".searchGroup");0>=$("li",q).length-x.length&&(u=$(),r=r.add(v));r=r.filter(function(){return!$(this).hasClass("inlineFolderGroup")});if(0==u.length&&0==r.length)e=!1;else{f.addClass("modifying");x=r;0<u.find("a.infoOpen").length&&(x=x.add(v));var z=$(".infoPanel",x);0<
z.length&&(x.addClass("doNotTransition"),z.addClass("doNotTransition"),$(".close",z).trigger("touchClick"),z.data("infoPanelPointer").remove(),z.remove(),x.removeClass("doNotTransition"));q=q.data("columnData")||null;hj(q,u);u.detach();Td(v,!0);v.hasClass("inlineFolderGroup")&&hk(g.data("view"),!1);f.removeClass("modifying")}}h=$("> .inner > .searchGroup",g);ij(g);u=r.map(function(){return $(this).outerHeight(!0)}).toArray().reduce(function(a,b){return a+b},0);u=gj(g)+l.height()-u;e&&u<Di(f)&&l.height(l.height()+
(Di(f)-u));l.insertAfter(h.last());r.detach();var A=r.toArray(),h=h.filter(function(){return-1==A.indexOf(this)});e||0!=$(".gallery li",h.last()).length||(h.last().remove(),h=h.filter(function(a){return a!=h.length-1}));l.data("search",X);var p=0,J=parseInt(l.css("padding-top"),10)+parseInt(l.css("padding-bottom"),10);h.last().addClass("doNotTransition");h.each(function(){var a=$(this);if(void 0!==a.data("contentHeight")){var b=a.data("contentHeight"),b=b+Oi(a);a.height(b);p+=b+J}});h.last().removeClass("doNotTransition");
$("#objectPanel > menu .search").hasClass("on")||$("#objectPanel > menu .search a").trigger("touchClick");e=f.find(".layer.category");0<e.length?(e.find("a.backLink").trigger("touchClick",{kl:!1}),setTimeout(c,360)):c()}}function ni(){qa.search(X.query,X.Pb,X.Ub)}
function Qh(){if(ra){var a=ji(),b=$("> .layer > .inner > .searchGroup",a).last();if(b.data("search")!==X)oi(b);else{var c=qa.Jc;if(null!=c){ra=!1;var c=c.results,d=$(".photoGallery, .backgroundGallery",b);ik(X,c.length);oi(a.find("> .layer"));if(null==X.Yd)ij(a);else if(0==c.length&&ej()){ra=!0;X.uh();return}0<c.length?(c=c.slice(0,X.Ub),c.forEach(function(a){Hh(ka,a.t(),a.R(),a.ab())}),c.forEach(function(a){jk(a).appendTo(d)}),Rd(d),setTimeout(function(){dj(a)},c.length*Ea+Fa)):0==X.Pb&&(d.remove(),
$(".noResults",b).remove(),b.append("<p class=\"noResults\">Sorry, we couldn't find any results. We'll get right on it. Maybe try something related?</p>"))}else 0==$("> .gallery li",b).length?ki(b):$(".searchLoader",b).css("display","none")}}}
function jk(a){var b=a.ab(),c=b[We],d=c.Sb(),e=c.g(),c=c.h(),b=b[$e],f=b.Sb(),g=b.g(),h=b.h(),l=$('<li class="newSearch loading"><a href="#"><img></a></li>');$("img",l).data("screen-url",f).data("screen-width",g).data("screen-height",h).attr("src",d).attr("width",e).attr("height",c);b.url.match(/\.svg(\?|$)/)&&$("img",l).addClass("svg");d=Vg(a);e=null===d?"":0===d?"Free":"$"+(d/100).toFixed(2);d=$('<span class="price'+("Free"==e?" free":"")+'">'+e+"</span>");e=$('<span class="info"><span class="price">'+
e+'</span> <span class="moreInfo" title="Show more info">i</span></span>');$("a",l).append(d).append(e);$("img",l).on("load",function(){l.removeClass("loading")});l.data("result",a);return l}
function ki(a){function b(){$("span",c).each(function(a){$(this).delay(Ia*a,function(){$(this).addClass("on").delay(Ja,function(){$(this).removeClass("on")})})});var a=setTimeout(b,$("span",c).length*Ia+Ja);c.data("timer",a)}if(0>=$(".searchLoader",a).length){var c=$('<div class="searchLoader"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></div>');a.append(c);b()}}
function oi(a){$(".searchLoader",a).each(function(){var b=$(this).data("timer");clearTimeout(b);$(this).remove();$(".searchLoaderHolder",a).removeClass("on")})}function fk(){if(ra){ra=!1;var a=$("#resultsSearch"),a=$("> .layer > .inner > .searchGroup",a).last(),a=$(".photoGallery",a),b=[],c;for(c in Mf)b.push(c);for(c=0;c<b.length;c++){var d=$('<li class="newSearch" data-grid-name="'+b[c]+'"><a href="#"></a></li>');$("a",d).append(Of(Mf[b[c]].H));d.appendTo(a)}a.addClass("gridGallery");Sd(a)}};function kk(){this.Va=[]}kk.prototype.trigger=Backbone.Events.trigger;kk.prototype.listenTo=Backbone.Events.listenTo;kk.prototype.stopListening=Backbone.Events.stopListening;_.extend(kk.prototype,Backbone.Events);kk.prototype.ud=function(a){lk(this,a,this.Va.length)};
function lk(a,b,c){if(-1===a.Va.indexOf(b))c=Math.max(0,Math.min(c,a.Va.length)),a.Va.splice(c,0,b),a.listenTo(b,"all",function(){a.trigger.apply(this,arguments)}),a.trigger("searchGroup:add",a,b,c);else throw Error("Cannot move searchGroups within a collection");}kk.prototype.bg=function(a){var b=this.Va.indexOf(a);-1<b&&(a.remove(),this.Va.splice(b,1),this.stopListening(a),this.trigger("searchGroup:remove",this,a,b))};kk.prototype.dc=function(){return this.Va.length};
function mk(a,b){this.th=a;this.$d=b||"";this.Lc=[];this.xe=!0}mk.prototype.trigger=Backbone.Events.trigger;_.extend(mk.prototype,Backbone.Events);mk.prototype.Ea=s("$d");mk.prototype.remove=function(){this.th.cancel()};function nk(a,b){a.trigger("results:willFetch",a);a.th.ve(b,function(c,d){a.xe=c.length>=b;0<c.length&&(a.Lc=a.Lc.concat(c));a.trigger("results:didFetch",a,c,d)})}
function ok(a){function b(){}var c=sa,d=na;return-1<["grid","grids"].indexOf(a.toLowerCase())?new pk(a):"uploads"===a?new qk(d):new rk(c,new li(a,0,b))}function sk(){}_.extend(sk.prototype,Backbone.Events);sk.prototype.ve=function(a,b){b&&b([],!0)};sk.prototype.cancel=k();function rk(a,b){this.Ne=new $g(a);this.kd=b;this.Ab=this.Xa=!1;this.Ke=null;ah(this.Ne,_.bind(this.ak,this))}_.extend(rk.prototype,Backbone.Events);
rk.prototype.ve=function(a,b){this.Ab?b&&b([],!0):(this.Ab=!0,this.kd.Ub=a,this.Ne.search(this.kd.query,this.kd.Pb,this.kd.Ub),this.Ke=b)};rk.prototype.cancel=function(){this.Xa=!0;bh(this.Ne)};rk.prototype.ak=function(){var a=this.Ne.Jc,a=!this.Xa&&a&&a.results?a.results:[];this.Ke&&this.Ke(a,this.Xa);this.Ke=null;this.Ab=!1;this.Xa||(ik(this.kd,a.length),a=this.kd,a.Pb+=a.Ub)};function pk(a){this.Xd=0;this.Mf=[];this.Xa=!1;if("grid"===a||"grids"===a)this.Mf=_.keys(Mf)}
pk.prototype.cancel=function(){this.Xa=!0};pk.prototype.ve=function(a,b){if(this.Xd>=this.Mf.length||this.Xa)b&&b([],this.Xa);else{var c=this.Mf.slice(this.Xd,this.Xd+a);this.Xd+=a;b&&b(c,!1)}};function qk(a){this.dh=a;this.hg=0;this.Xa=!1;this.Ab=null}
qk.prototype.ve=function(a,b){function c(a,c){if(200===a&&c.media&&0!==c.media.length){var f=[];d(c.media).forEach(function(a){var b=a.ua(),c=b.ab();a=Wg({id:a.t(),version:b.R(),files:c});f.push(a)});b&&b(f,e.Xa);e.hg+=f.length;e.Ab=null}else b&&b([],e.Xa)}function d(a){return a.sort(function(a,b){var c=a.t(),d=b.t();return-(c<d?-1:c>d?1:0)})}if(this.Ab)b&&b([],!0);else{var e=this,f=Ah(this.hg,a);this.Ab=Eh(f,c)}};qk.prototype.cancel=function(){this.Xa=!0;this.Ab&&(this.Ab.cancel(),this.Ab=null)};function li(a,b,c){this.query="";this.Yd=null;"string"===typeof a?this.query=a.trim():a instanceof Sg&&(this.Yd=a,this.query="group:"+a.brand);this.Pb=0;this.Ub=b;this.Lf=0;this.uh=c;this.zh=!1}function ej(){var a=X,b=null!=a.Yd&&a.Lf<a.Ub&&0==a.Pb&&!a.zh;return a.Lf>=a.Ub||b}function ik(a,b){a.Lf=b;null!=a.Yd&&b<a.Ub&&(a.query.match(/^group:/)?(a.Pb=0,a.query="brand:"+a.Yd.brand):a.query.match(/^brand:/)&&(a.zh=!0))};function hf(a,b){var c;c=a.replace(/SVGID_/g,b+"SVGID_");return c=c.replace(/(font-size\s*:\s*\d+\.?\d*)[\s;"]/g,"$1px")}function jf(a){var b=a.get(0);b.removeAttribute("width");b.removeAttribute("height");b.removeAttribute("id");$("g",a).each(function(a,b){b.id=b.id.toLowerCase()});$("style",a).remove();tk(a);uk(a);vk(a);wk(a);xk(a)}
function tk(a){var b=0,c=0,d=/^[neswc]_repeat/i,e=/^([ns][ew]?|e|w|c)(_\d+)(_|$)/i;$("g",a).each(function(a,f){if(d.test(f.id))f.id=f.id.substr(0,1),f.classList.add("repeat");else{var g=f.id.match(e);g&&g[1]&&(f.id=g[1])}-1<["w","e"].indexOf(f.id)&&b++;-1<["n","s"].indexOf(f.id)&&c++});var f=0<b&&0===c,g=0<c&&0===b,h=a.get(0);f?(h.classList.add("horizontalOnly"),$("g#w, g#c, g#e",a).each(function(a,b){b.id="n"+b.id;"nc"==b.id&&(b.id="n")})):g&&(h.classList.add("verticalOnly"),$("g#n, g#c, g#s",a).each(function(a,
b){b.id+="w";"cw"==b.id&&(b.id="w")}))}function vk(a){var b=/^stack(_|$)/i;a.find("g").filter(function(){return b.test(this.id)}).each(function(a,b){var e=b.id;b.removeAttribute("id");b.classList.add("canva");b.classList.add("stack");e=e.match(/_(vcenter|vtop|vbottom)(_|$)/i);b.setAttribute("data-valign",e?e[1].substr(1).toUpperCase():"CENTER");b.setAttribute("data-stack-id",a)})}
function uk(a){var b=/^change(\d+|$)/i;a.find("g").filter(function(){return b.test(this.id)}).each(function(a,b){var e=parseInt(b.id.substr(6),10);isNaN(e)&&(e=1);b.removeAttribute("id");var f=/(\b|^)fill\s*:\s*([^;]+);\s*/i,g=null;$("[style*=fill], [fill]",b).each(function(){var a=this.getAttribute("style"),b=a&&a.match(f);g=b?a.match(f)[2]:this.getAttribute("fill");b&&(a=a.replace(f,""),this.setAttribute("style",a),this.setAttribute("fill",g));this.classList.add("color");this.classList.add("color-"+
e);this.setAttribute("data-color",g)})})}function yk(a,b){var c=document.createElementNS("http://www.w3.org/2000/svg",a.nodeName);b.forEach(function(b){a.hasAttribute(b)&&c.setAttribute(b,a.getAttribute(b))});return c}function zk(a,b){var c=[];b.forEach(function(b){b=a.getElementsByTagNameNS("http://www.w3.org/2000/svg",b);for(var e=0;e<b.length;e++)c.push(b[e])});return 0===c.length?null:c[0]}
function wk(a){var b=kf(a),c=b.l(),d=b.j(),e=/^[op](_|$)/i;a.find("g").filter(function(){return e.test(this.id)}).each(function(a,b){var e=document.createElementNS("http://www.w3.org/2000/svg","g");e.setAttribute("class","canva");b.parentNode.insertBefore(e,b);b.parentNode.removeChild(b);var l=zk(b,["circle","ellipse","path","polygon","rect"]);if(null!==l){var m=document.createElementNS("http://www.w3.org/2000/svg","clipPath");e.appendChild(m);m.id=gf();m.setAttribute("transform","translate("+-c+
", "+-d+")");l.setAttribute("class","photoPlaceholder");m.appendChild(l);var n=document.createElementNS("http://www.w3.org/2000/svg","image");n.setAttribute("class","placeholder");n.setAttribute("clip-path","url(#"+m.id+")");n.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href","/static/images/placeholder.jpg");n.setAttribute("transform","translate("+c+", "+d+")");e.appendChild(n);l=yk(l,"cx cy r rx ry d pathLength points x y width height transform".split(" "));l.setAttribute("class","outline");
l.setAttribute("fill","none");e.appendChild(l)}})}
function Ak(a){function b(a){var b={},c=db.map(function(a){return a.Ob}),c=[].concat.apply([],c),d=a.replace(/^['"]|['"]$/g,"").toLowerCase();c.forEach(function(a){var c=(a.m||"").toLowerCase(),e=c.replace(/-[^-]+$/,"");c==d?(b["font-name"]=a.name||a.k,b["font-family"]=a.k):0==d.indexOf(e)&&["bold","italic","bolditalic","black"].forEach(function(c){d==e+"-"+c&&(b["font-name"]=a.name||a.k,b["font-family"]=a.k,b.bold="bold"==c||"bolditalic"==c||"black"==c,b.italic="italic"==c||"bolditalic"==c)})});
return b}var c=["fill","font-size","font-family"];if(!a)return{};var d={};c.forEach(function(b){var c=(a.getAttribute(b)||"").trim();""!==c&&(d[b]=c)});(a.getAttribute("style")||"").split(";").forEach(function(a){var b=a.split(":");2==b.length&&(a=b[0].trim(),b=b[1].trim(),-1<c.indexOf(a)&&(d[a]=b))});if(d.fill){var e=d.fill;delete d.fill;d["color-obj"]=JSON.stringify(Qb(e))}d["font-size"]&&(d["font-size"]=0.72*parseFloat(d["font-size"]));d["font-family"]&&(e=b(d["font-family"]),delete d["font-family"],
$.extend(d,e));return d}
function xk(a){var b=/^t(_|$)/i;a.find("g").filter(function(){return b.test(this.id)}).each(function(a,b){var e=document.createElementNS("http://www.w3.org/2000/svg","g");e.setAttribute("class","canva");b.parentNode.insertBefore(e,b);b.parentNode.removeChild(b);var f=zk(b,["rect"]);if(null!==f){f=yk(f,"rx ry x y width height".split(" "));f.setAttribute("class","textPlaceholder");f.setAttribute("fill","none");e.appendChild(f);var e=zk(b,["text"]),e=Ak(e),g=b.id,h=/_(dfont)(_|$)/.test(g),l=/_(dwidth)(_|$)/.test(g),
m=/_(dheight)(_|$)/.test(g),n=g.match(/_(left|center|right)(_|$)/),g=g.match(/_ls([0-9]+)(_|$)/),e=$.extend({},e,{justification:n?n[1]:void 0,"line-spacing":g?parseFloat(g[1].substring(0,1)+"."+g[1].substring(1)):void 0,"dynamic-font-size":h,"dynamic-width":l&&!m,"dynamic-height":m}),p;for(p in e)f.setAttribute("data-"+p,e[p]);if(b){p=[];e=b.getElementsByTagNameNS("http://www.w3.org/2000/svg","text");for(h=0;h<e.length;h++)l=e[h],l.textContent&&0<l.textContent.trim().length&&p.push(l.textContent.trim());
p=p.join(" ")}else p="";""!=p&&f.setAttribute("data-placeholder-text",p)}})};function Bk(){this.Fc=0}
function cj(a,b,c,d,e){var f=ja;function g(f,g){if(200==f){var l=new Xg;l.url=n;var m=new Xg;m.url=b;var w={};w[We]=l;w[$e]=m;Hh(ka,g.t(),1,w);c&&c(g);l=new Ck(g,a);Dk.ug(l);d&&l.Zf.push(d);e&&Ek(l,e);Ek(l,function(a){h.nd(a)})}}f.Fc++;var h=f,l=Ch(a.name).Ye(!0),m=$('<img src="'+b+'" />'),n=null;m.one("load",function(){var a=m.get(0),b=document.createElement("canvas"),c=b.getContext("2d"),d=document.createElement("canvas"),e=d.getContext("2d");b.width=a.naturalWidth;b.height=a.naturalHeight;c.drawImage(a,
0,0);c=Math.min(a.naturalWidth,200);d.width=c;d.height=c*a.naturalHeight/a.naturalWidth;e.drawImage(b,0,0,a.naturalWidth,a.naturalHeight,0,0,d.width,d.height);n=d.toDataURL();Fh(l,g)})}function Ki(a,b,c,d,e,f){var g=ja;g.Fc++;e=Ch(e).Ye(!0);Fh(e,function(e,l){if(200==e){var m=new Xg;m.url=d;var n=new Xg;n.url=c;var p={};p[We]=m;p[$e]=n;Hh(ka,l.t(),1,p);f&&f(l);m=new Fk(l,b,a);Dk.ug(m);Ek(m,function(a){g.nd(a)})}})}
Bk.prototype.nd=function(a){var b=a.ua(),c=0>=this.Fc,d=this,e=window.setInterval(function(){var f=cf(b.R()).Ch(!0);na.ib(a.t(),f,function(a,b){if(200==a){var f=b.ua().wb(),m=!Ih(ka,b.t(),b.ua().R());"APPROVED"==f?(window.clearInterval(e),e=null,c||d.Fc--,Gk(b)):!m&&c&&"PENDING_REVIEW"!=f&&f==sh&&(window.clearInterval(e),e=null)}else window.clearInterval(e),e=null,c||d.Fc--})},5E3)};
function Gk(a){var b=a.ua(),c=b.ab(),d=a.t(),e=b.R(),f=$("#normalUploads, #uploadsDisabled").find(".gallery img").filter(function(){return $(this).data("mediaId")==d});f.removeData("mediaId");Xe(c[We].Sb(),function(a){f.attr("src",a)});a=Wg(b);a.id=d;f.parents("li").data("result",a);Hh(ka,d,e,c);var g=!1;C.aa().forEach(function(a){if(a.Gd){var b=a.Gd();b.id==d&&b.version==e&&(a.Wd(d,e),g=!0)}if(a.yb&&!(a instanceof Ae))for(b=0;b<a.wa();b++){var c=a.xa(b);c.mediaId==d&&c.mediaVersion==e&&(c.mediaId=
d,c.mediaVersion=e,a.pb(b,c),g=!0)}});g&&C.trigger("change")};(function(){function a(a){var b="animationend"==a?e():d();return function(a){$(this).on(b,a,c)}}function b(a){var b="animationend"==a?e():d();return function(){$(this).off(b,c)}}function c(a){function b(){var d=a.data;$(c);d.handler.call(c,a)}var c=this;("animationend"==a.type?La:Ta)?b():-1<["class","style"].indexOf(a.attrName)&&b()}function d(){var a=document.createElement("div"),b={transition:"transitionend",MozTransition:"transitionend",WebkitTransition:"webkitTransitionEnd"},c;for(c in b)if(void 0!==
a.style[c])return b[c];return"DOMAttrModified"}function e(){var a=document.createElement("div"),b={animation:"animationend",MozAnimation:"animationend",WebkitAnimation:"webkitAnimationEnd"},c;for(c in b)if(void 0!==a.style[c])return b[c];return"DOMAttrModified"}["animationend","transitionend"].forEach(function(c){var g="animationend"==c?e():d();c!=g&&($.event.special[c]={add:a(c),remove:b(c)})})})();function ec(a,b,c,d){var e;a==c?e=b>d?1.5*Math.PI:0.5*Math.PI:(e=Math.atan((d-b)/(c-a)),a<c?d<b&&(e=2*Math.PI+e):e=Math.PI+e,isNaN(e)&&(e=0));return Hk(180*e/Math.PI)}function Hk(a){a%=360;0>a&&(a+=360);return a}function Y(a){return Math.PI/180*a}function Ik(a,b){var c;c=a-b;return 0>c?360+c:c}function Jk(a,b){var c;c=Math.floor(180*Math.atan2(a.y-b.y,a.x-b.x)/Math.PI+90);return 0>c?360+c:c}
function Kk(a){switch(a){case Wa:return 270;case Ya:return 0;case cb:return 90;case ab:return 180;default:return-1}}function Lk(a,b,c,d){return Math.sqrt(Math.pow(c-a,2)+Math.pow(d-b,2))};function Ie(a,b,c){function d(a,b,c){var d=r.translate(-b,-c);d.W()>a.W()&&d.translate(a.W()-d.W(),0);d.l()<a.l()&&d.translate(a.l()-d.l(),0);d.G()>a.G()&&d.translate(0,a.G()-d.G());d.j()<a.j()&&d.translate(0,a.j()-d.j());d.translate(b,c)}void 0===c&&(c=0);var e=a.data("position")||c,f=b.l(),g=b.j(),h=0,l=0,m=a.data("width"),n=a.data("height");0==c?(h=f-m-20,l=g):1==c&&(h=f,l=g-n-20);a.data("position",c);var p=document.getElementById("canvaDocument"),q=p.scrollLeft,p=p.scrollTop,u=Xd(),r=new O(h,
l,m,n);d(u,q,p);h=r.j()-l;1==c&&(c=r.l(),l=r.j(),r.G()>b.j()&&(r.oa(c,l).translate(0,n+20+b.h()+20-h),d(u,q,p),h=r.l()-c,a.data("position",2),r.j()<b.G()&&(r.oa(c,g).translate(b.g()+20-h,0),d(u,q,p),a.data("position",3),r.l()<b.W()&&(r.oa(f-m-20-n/2-20,g),d(u,q,p),a.data("position",0)))),e!==a.data("position")&&a.css("display","none").addClass("doNotAnimate"));r.round();a.css("display","").css("transform",fc({uc:r.l(),Oc:r.j()})).delay(20,function(){$(this).hasClass("doNotAnimate")&&$(this).removeClass("doNotAnimate")})}
function Mk(a){var b=$("#overlays"),c=a.data("canvaElement"),d=a.data("toolbar");d||(d=$('<menu class="elementToolbar"><li class="elementToolbarForward"><a href="#" title="Bring forward">Bring forward</a></li><li class="elementToolbarBackward"><a href="#" title="Send backward">Send backward</a></li><li class="elementToolbarCopy"><a href="#" title="Copy">Copy</a></li><li class="elementToolbarDelete"><a href="#" title="Delete">Delete</a></li><li class="elementToolbarCrop"><a href="#" title="Crop">Crop</a></li></menu>'),
d.appendTo(b).data("element",a),a.data("toolbar",d),1<a.length?(d.find("li").addClass("disabled"),["Copy","Delete"].forEach(function(a){$(".elementToolbar"+a,d).addClass("enabled").removeClass("disabled")})):c.ca()?($("li",d).addClass("disabled"),$(".elementToolbarDelete",d).removeClass("disabled").addClass("enabled")):d.find("li").addClass("enabled"),c&&c.yb&&d.addClass("canCrop"),1==a.length&&c&&c.Ka&&c.Ka().forEach(function(a){var b=$('<li class="elementToolbarColor"><a class="pickAColor" href="#" title="Pick a color"><span>Pick a color</span></a></li>');
d.append(b);a&&b.find(".pickAColor > span").css("background-color",a.color)}),d.data("width",d.outerWidth()).data("height",d.outerHeight()));c.L()}
function Nk(a){function b(){var a=$(this).siblings(".textToolbarFontFamily");$("#overlays > .mask").addClass("on ddslick");a.ddslick("open");return!1}function c(a){var b=$(this).siblings(".textToolbarFontSize"),c=$(this).find("input");if(b.hasClass("on"))a.target===a.currentTarget&&b.ddslick("close");else return c.select(),$("#overlays > .mask").addClass("on ddslick"),b.ddslick("open"),!1}function d(){$("#overlays > .mask").removeClass("on ddslick")}function e(b){$(this);$("#overlays > .mask").removeClass("on ddslick");
$("#null").focus();if(!b.didSelectAnOption){var c=a.data("canvaElement"),d=c.cc(c.va()),e=x.find("input"),f=parseFloat(e.val()),g=b.lastKeyBeforeSelect;if("enter"!=g&&"tab"!=g||isNaN(f))e.val(Ok(d)),"enter"==g&&(b.cancel=!0,e.select());else{-1===p.indexOf(f)&&$(this).ddslick("deselect");var h=Math.max(Math.min(400,f),8);Pk(c,function(){c.Pe(h)})}}}var f=$("#overlays"),g=a.data("textToolbar"),h=a.data("canvaElement"),l=h.va();if(!g){var m=[];db.forEach(function(a){a.Ob.forEach(function(a){m.push(a)})});
m.sort(function(a,b){return(a.name||a.k).localeCompare(b.name||b.k)});var n='<select class="textToolbarFontFamily">';m.forEach(function(a){a=a.name||a.k;n+='<option data-image-src="/static/images/fonts/'+a.replace(/ /g,"-")+Pa+'.png">'+a+"</option>"});var n=n+"</select>",p=[12,14,16,18,21,24,28,32,36,42,48,56,64,72,80,88,96,104,120,144],q='<select class="textToolbarFontSize">';p.forEach(function(a){q+='<option data-text="'+a+'">'+a+"</option>"});q+="</select>";g=$('<menu class="textToolbar"><li class="textToolbarFont">'+
n+'<span class="textToolbarFontFamilySpan">Archer</span>'+q+'<span class="textToolbarFontSizeSpan"><input type="text" autocomplete="off" value="24"></span></li><li class="textToolbarBold"><a href="#" title="Bold">Bold</a></li><li class="textToolbarItalic"><a href="#" title="Italic">Italic</a></li><li class="textToolbarJustification"><a href="#" title="Justification">Justification</a></li><li class="textToolbarList"><a href="#" title="Bulleted list">Unordered/ordered list</a></li><li class="textToolbarColor"><a class="pickAColor" href="#" title="Pick a color"><span>Pick a color</span></a></li></menu>');
g.find(".textToolbarFontSize option[data-text=24]").prop("selected",!0);var u=a.data("fontName"),r=$(".textToolbarFontFamily",g).get(0);if(u){var w="";$(".textToolbarFontFamily option",g).each(function(){if($(this).text()==u)return w=this.value,!1});$(r).val(w)}else $(r).val("Glegoo");Ad.call(r);var v=h.cc(l),l=$(".textToolbarFontSize",g).get(0);$(l).val(v.toString());Bd.call(l);g.appendTo(f).data("element",a).data("width",g.outerWidth()).data("height",g.outerHeight());$(r).hasClass("dd-container")||
(f={onClose:d},$(r).ddslick(f));r=g.find(".textToolbarFontFamilySpan");(new S(r)).on("mousedown+touchstart",b);var x=g.find(".textToolbarFontSizeSpan");$(l).hasClass("dd-container")||(f={onClose:e,width:"6em",align:"bottom",linkedControl:x.find("input").get(0)},$(l).ddslick(f));(new S(x)).on("mousedown+touchstart",c);a.data("textToolbar",g)}h.L()}
function wd(){$("#overlays .element.text").each(function(){ye($(this))});var a=$(this).parents("li"),b=T(C),c=b.ba(),b=ak(b,c),d=$("#layerGraph");if(0>=d.length){for(var d=$('<ol id="layerGraph"></ol>'),e=0;e<b.length+1;e++)d.append("<li>A layer</li>");$(this).after(d);d.css("top",a.height()/2-d.height()/2)}else d.css("opacity","");if(!d.data("locked")){d.stop();clearTimeout(d.data("fadeTimer"));var e=c[0],f=e.s(),c=b.filter(function(a){return a.s()>f});if(a=c[0])e.insertAfter(a),e.L(),b={oldElementIndex:f,
elementIndex:e.s(),pageIndex:P(C,e.v())},Q(D,new R(4,b));var b=$("li",d),g=b.eq(c.length),h=g.prev(),c=b.first().outerHeight(!0);g.addClass("selected");a&&(d.data("locked",!0),g.animate({left:-c/2},{duration:100,Za:"linear",queue:!1,complete:function(){$(this).animate({left:0},{duration:100,Za:"linear",queue:!1,complete:function(){h.before(g);g.css("left","").css("top","");h.css("top","");d.removeData("locked")}})}}).animate({top:-c},{duration:200,queue:!1}),h.animate({top:c},200));a=setTimeout(function(){d.animate({opacity:0},
1E3,function(){$(this).remove()})},1E3);d.data("fadeTimer",a)}_gaq.push(["_trackEvent","Toolbar","Click - Forward"])}
function vd(){$("#overlays .element.text").each(function(){ye($(this))});var a=$(this).parents("li"),b=T(C),c=b.ba(),b=ak(b,c),d=$("#layerGraph");if(0>=d.length){for(var d=$('<ol id="layerGraph"></ol>'),e=0;e<b.length+1;e++)d.append("<li>A layer</li>");$(this).after(d);d.css("top",a.height()/2-d.height()/2)}else d.css("opacity","");if(!d.data("locked")){d.stop();clearTimeout(d.data("fadeTimer"));var e=c[0],f=e.s(),c=b.filter(function(a){return a.s()<f}).reverse();if(a=c[0])e.insertBefore(a),e.L(),
e={oldElementIndex:f,elementIndex:e.s(),pageIndex:P(C,e.v())},Q(D,new R(4,e));var e=$("li",d),g=e.eq(b.length-c.length),h=g.next(),b=e.first().outerHeight(!0);g.addClass("selected");a&&(d.data("locked",!0),g.animate({left:-b/2},{duration:100,Za:"linear",queue:!1,complete:function(){$(this).animate({left:0},{duration:100,Za:"linear",queue:!1,complete:function(){h.after(g);g.css("left","").css("top","");h.css("top","");d.removeData("locked")}})}}).animate({top:b},{duration:200,queue:!1}),h.animate({top:-b},
200));b=setTimeout(function(){d.animate({opacity:0},1E3,function(){$(this).remove()})},1E3);d.data("fadeTimer",b)}_gaq.push(["_trackEvent","Toolbar","Click - Backward"])}function xd(){$("#overlays .element.text").each(function(){ye($(this))});var a=C.ba(),b=[];kh();a.forEach(function(a){var d=a.clone();d.oa(d.l()+30,d.j()+30);a=a.v()||T(C);d.appendTo(a);b.push(d);vi(d)});lh();a.forEach(function(a){Ee(a)});b.forEach(function(a){De(a)});_gaq.push(["_trackEvent","Toolbar","Click - Copy"])}
function yd(){kh();C.ba().forEach(function(a){"function"==typeof a.kg&&a.kg();zi(a);a.remove()});lh();$(".multipleSelectionBox").remove();_gaq.push(["_trackEvent","Toolbar","Click - Delete"])}function zd(){C.ba().forEach(function(a){Qk(a)});_gaq.push(["_trackEvent","Toolbar","Click - Crop"])}
function Ad(){function a(a){d.removeClass("loading");$(".spinner",d).remove();if(c)if(a){if(te(c),!c.is(".focused")){a=c.data("canvaElement");var b=g.index,e=a.ya(b);a={elementIndex:a.s(),pageIndex:P(C,a.v()),textIndex:b,"new":e,old:g};Q(D,new uj(Aj,a))}}else alert("Sorry, there was some problem trying to apply the font "+f+". Please let us know about it.")}var b=$(this),c=b.parents(".textToolbar").data("element"),d=b.nextAll(".textToolbarFontFamilySpan"),e=null;$("option",b).each(function(){if(!0==
this.selected)return e=$(this),!1});null==e&&(e=$('option[selected="selected"]',b));var f=e.text();d.text(f);var g=null;if(c){var b=c.data("canvaElement"),h=b.va();-1<h&&(d.addClass("loading").append('<span class="spinner"></span>'),g=b.ya(h),b.Vb(h,f,a))}_gaq.push(["_trackEvent","Toolbar","Change - Font Family",f])}
function Bd(){var a=$(this),b=a.parents(".textToolbar").data("element"),c=a.nextAll(".textToolbarFontSizeSpan"),d=null;$("option",a).each(function(){if(!0==this.selected)return d=$(this),!1});null==d&&(d=$('option[selected="selected"]',a));c.find("input").val(d.text());if(b){var e=b.data("canvaElement"),f=parseInt(a.val(),10);Pk(e,function(){e.Pe(f)})}_gaq.push(["_trackEvent","Toolbar","Change - Font Size",d.text()])}
function Cd(){var a=$(this).parents("li"),b=$(this).parents(".textToolbar").data("element"),c=b.data("canvaElement"),d=c.va(),e=!!b.data("bold");Pk(c,function(){c.oc(d,!e)});b.is(".focused")||(e?a.removeClass("on"):a.addClass("on"));_gaq.push(["_trackEvent","Toolbar","Click - Bold",!e])}
function Dd(){var a=$(this).parents("li"),b=$(this).parents(".textToolbar").data("element"),c=b.data("canvaElement"),d=c.va(),e=!!b.data("italic");Pk(c,function(){c.pc(d,!e)});b.is(".focused")||(e?a.removeClass("on"):a.addClass("on"));_gaq.push(["_trackEvent","Toolbar","Click - Italic",!e])}
function Ed(){function a(){h.animate({height:0},Ba,"linear",function(){c.removeData("dropdown");$(this).remove()})}function b(d){$(document).off("mousedown",b);var e=c.get(0);d.target==e||jQuery.contains(e,d.target)||a()}var c=$(this).parents("li"),d=$(this).parents(".textToolbar"),e=d.data("element").data("canvaElement"),f=e.va(),g=$("#overlays"),h=c.data("dropdown"),l=document.getElementById("canvaDocument");null!=h?a():(h=$('<menu class="toolbarDropdown"><li class="justificationDropdownLeft"><a href="#">Left</a></li><li class="justificationDropdownCenter"><a href="#">Center</a></li><li class="justificationDropdownRight"><a href="#">Right</a></li></menu>'),
c.hasClass("center")?$(".justificationDropdownCenter",h).addClass("on"):c.hasClass("right")?$(".justificationDropdownRight",h).addClass("on"):$(".justificationDropdownLeft",h).addClass("on"),h.on("mousedown",!1).on("click",!1).css("left",c.offset().left+l.scrollLeft-$(l).offset().left).css("top",d.offset().top+d.outerHeight()+l.scrollTop).appendTo(g),c.data("dropdown",h),d=h.outerHeight(),h.css("height",0).animate({height:d},Ba,"easeOutSine",function(){$(this).css("height","")}),$("a",h).on("click",
function(){var b=$(this).parents("li");b.hasClass("justificationDropdownCenter")?(Pk(e,function(){e.Bb(f,"center")}),c.removeClass("right").addClass("center")):b.hasClass("justificationDropdownRight")?(Pk(e,function(){e.Bb(f,"right")}),c.removeClass("center").addClass("right")):(Pk(e,function(){e.Bb(f,"left")}),c.removeClass("center right"));$("li",h).removeClass("on");b.addClass("on");a();_gaq.push(["_trackEvent","Toolbar","Click - Justification Option",b.get(0).className]);return!1}),$(document).on("mousedown",
b));_gaq.push(["_trackEvent","Toolbar","Click - Justification"])}function Fd(){var a=$(this).parents("li"),b=$(this).parents(".textToolbar").data("element"),c=b.data("canvaElement"),d=c.va(),b=b.data("list");c.md(d,!b);b?a.removeClass("on"):a.addClass("on");_gaq.push(["_trackEvent","Toolbar","Click - List",!b])}
function Gd(){function a(a){d.css("background-color",a.color);h.setColor(l,a);g.data("colorObj",a)}function b(a){if(g.is(".focused"))h.setColor(l,a);else{a=h.va();0>a&&(a=l);var b=h.ya(a),b={elementIndex:h.s(),pageIndex:P(C,h.v()),textIndex:a,"new":b,old:m};Q(D,new uj(Aj,b));m=h.ya(a)}}var c=$(this).parents("li"),d=$(".pickAColor > span",c),e=$(this).parents(".textToolbar");e.offset();var f=$("#canvaDocument");f.get(0);f.get(0);$("#canvaDocument").offset();var g=e.data("element"),h=g.data("canvaElement"),
l=h.va(),m=h.ya(h.va()),f=g.data("colorObj"),n=$("#overlays"),p=c.data("picker");kc();n=new Oh(n,h.v().Ia);null!=p?(p.remove(),c.removeData("picker")):(e=Rk(n,e),2===e&&Rk(n,g),f&&(n.rd=f),n.Rc=c,n.on("select",a),n.on("confirm",b),n.render());_gaq.push(["_trackEvent","Toolbar","Click - Font Color"])}
function Hd(){function a(a){n||(n=g.Ka()[f].color);g.Vd(f,a);d.css("background-color",a.color)}function b(a){if(g&&g.v()){var b={elementIndex:g.s(),pageIndex:g.v().s(),"new":{index:f,color:a.color},old:{index:f,color:n}};Q(D,new R(wi,b));n=a.color}}var c=$(this).parents("li"),d=$(".pickAColor > span",c),e=$(this).parents(".elementToolbar"),f=c.index(".elementToolbarColor"),g=e.data("element").data("canvaElement"),h=g.Ka()[f],l=$("#overlays"),m=c.data("picker");kc();l=new Oh(l,g.v().Ia);null!=m?(m.remove(),
c.removeData("picker")):(Rk(l,e),h&&(l.rd=h),l.Rc=c,l.on("select",a),l.on("confirm",b),l.render());var n=null;_gaq.push(["_trackEvent","Toolbar","Click - Element Color"])}function Pk(a,b){if(a.Ac().is(".focused"))b();else{var c=a.va(),d=a.ya(c);b();var e=a.ya(c),c={elementIndex:a.s(),pageIndex:P(C,a.v()),textIndex:c,"new":e,old:d};Q(D,new uj(Aj,c))}}
function Sk(a,b,c,d){function e(a){var b=f.data("angle")||0,c=f.data("radius")||0,d=f.data("distance")||0,e,g=100*c,n=(100-50*c)*(1-d),z=100-50*c;e=Math.round(b);g=Math.round(g);n=Math.round(n);z=Math.round(z);n="hsl("+e+","+g+"%,"+n+"%)";e="hsl("+e+","+g+"%,"+z+"%)";l.css("background-color",e);$(".colorPickerColorCodeHex",f).val(Vb(new Rb(n)).replace(/#/g,""));var g=parseInt(h.css("left"),10),z=parseInt(h.css("top"),10),A=parseInt(m.css("left"),10);a({color:n,Fg:e,xh:g,yh:z,ah:A,angle:b,ed:c,mf:d})}
var f=$('<div class="colorPicker showColorCode"><a class="enterColorCode" href="#">&#xe003;</a><div class="colorPickerSpectrum"><div class="marker"></div></div><div class="colorPickerLightness"><div class="marker"></div></div><ul class="colorPickerSlots"></ul><div class="colorPickerColorCode">Color code #<input class="colorPickerColorCodeHex" maxlength="7" name="colorPickerColorCodeHex"></input></div></div>');f.data("canvaPicker",this).on("mousedown",!1).on("click",!1);Tk(f,a);var g=$(".colorPickerSpectrum",
f),h=$(".marker",g),l=$(".colorPickerLightness",f),m=$(".marker",l);$(".enterColorCode",f);var n=$(".colorPickerColorCodeHex",f);a&&n.val(Vb(new Rb(a.color)).replace(/^#/,""));(new S(g)).on("touchstart+mousedown",function(a){function d(a){var c=(void 0!==a.clientX?a.clientX:a.touches[0].clientX)-m.left;a=(void 0!==a.clientY?a.clientY:a.touches[0].clientY)-m.top;var g=ec(w/2,v/2,c,a),l=g*Math.PI/180,n=Lk(c,a,w/2,v/2);n>z&&(n=z,a=Math.sin(l)*z+w/2,c=Math.cos(l)*z+v/2);l=n/z;f.data("angle",g).data("radius",
l);h.css("left",c).css("top",a);e(b);return!1}function l(){g.removeClass("mousedown");void 0!==c&&e(c);A.off("mousemove|touchmove",d).off("mouseup|touchend",l);return!1}var m=g.offset(),w=g.width(),v=g.height(),x=parseInt(h.css("margin-top"),10),z=w/2+x;g.addClass("mousedown");n.blur();var A=new S($(document));A.on("mousemove|touchmove",d).on("mouseup|touchend",l);d(a);_gaq.push(["_trackEvent","Color Picker","Mousedown - Color Picker Spectrum"]);return!1});(new S(n)).on("touchstart+mousedown",function(){$(this).focus().select()}).on("keyup",
function(a){var e="0123456789abcdef".split(""),g=$(this).val().split("").filter(function(a){return 0<=e.indexOf(a.toLowerCase())}).join("").substring(0,6);g!==$(this).val()&&$(this).val(g);6===g.length&&(g=Qb("#"+g),Tk(f,g),b(g),c&&c(g));(a.which===ch||a.which===dh)&&d&&d()});(new S(l)).on("touchstart+mousedown",function(a){function d(a){a=(void 0!==a.clientX?a.clientX:a.touches[0].clientX)-h.left;a<-x?a=-x:a>z&&(a=z);f.data("distance",a/z);m.css("left",a);e(b);return!1}function g(){l.removeClass("mousedown");
void 0!==c&&e(c);A.off("mousemove|touchmove",d).off("mouseup|touchend",g);return!1}var h=l.offset(),w=l.outerWidth(),v=m.outerWidth(),x=parseInt(m.css("margin-left"),10);l.addClass("mousedown");n.blur();var z=w-v-x,A=new S($(document));A.on("mousemove|touchmove",d).on("mouseup|touchend",g);d(a);_gaq.push(["_trackEvent","Color Picker","Mousedown - Color Picker Lightness"]);return!1});return{element:f}}
function Tk(a,b){var c=$(".colorPickerSpectrum",a),c=$(".marker",c),d=$(".colorPickerLightness",a),e=$(".marker",d);b?(a.data("angle",b.angle).data("radius",b.ed).data("distance",b.mf),c.css("left",b.xh).css("top",b.yh),e.css("left",b.ah),d.css("background-color",b.Fg)):(c.css("left",100).css("top",100),e.css("left",10),d.css("background-color",""))}
function Je(a,b){a&&b&&(b.yb?(a.addClass("canCrop"),b.Zc&&b.Zc()?$(".elementToolbarCrop",a).removeClass("enabled").addClass("disabled"):$(".elementToolbarCrop",a).addClass("enabled").removeClass("disabled")):(a.removeClass("canCrop"),a.removeClass("disableCrop")),b.Ka&&(a.find(".elementToolbarColor").remove(),b.Ka().forEach(function(b){var d=$('<li class="elementToolbarColor"><a class="pickAColor" href="#" title="Pick a color"><span>Pick a color</span></a></li>');a.append(d);b&&d.find(".pickAColor > span").css("background-color",
b.color)})),Uk(a,b))}function Uk(a,b){var c=ak(b.v(),b),d=b.s(),e=c.filter(function(a){return a.s()>d}),c=c.filter(function(a){return a.s()<d});0===e.length?a.find(".elementToolbarForward").removeClass("enabled").addClass("disabled"):a.find(".elementToolbarForward").addClass("enabled").removeClass("disabled");0===c.length?a.find(".elementToolbarBackward").removeClass("enabled").addClass("disabled"):a.find(".elementToolbarBackward").addClass("enabled").removeClass("disabled")}
function Id(){var a=$(this),b=a.parents(".gridToolbar").data("element"),c=a.nextAll(".gridToolbarSpacingSpan"),d=null;$("option",a).each(function(){if(!0==this.selected)return d=$(this),!1});null==d&&(d=$('option[selected="selected"]',a));c.text("Spacing: "+d.text());b&&Pf(b.data("canvaElement"),a.val());Ib=a.val()}
function If(a,b){function c(a){var b="linear-gradient(left, ",c=100/a.length;a.forEach(function(d,e){var f=e*c+"%",q=(e+1)*c+"%";0==e?b+=d+" "+q+",":e==a.length-1?b+=d+" "+f:(b+=d+" "+f+",",b+=d+" "+q+",")});return b+=")"}b.data("bold")?$(".textToolbarBold",a).addClass("on"):$(".textToolbarBold",a).removeClass("on");b.data("italic")?$(".textToolbarItalic",a).addClass("on"):$(".textToolbarItalic",a).removeClass("on");b.data("justification")&&$(".textToolbarJustification").addClass(b.data("justification"));
b.data("list")?$(".textToolbarList",a).addClass("on"):$(".textToolbarList",a).removeClass("on");var d=b.data("canvaElement"),d=d.cc(d.va());$(".textToolbarFontSize",a).val(d.toString());var d=Ok(d),e=a.find(".textToolbarFontSizeSpan input");e.is(":focus")||e.val(d);d=ge(b);e=a.find(".textToolbarColor .pickAColor > span");if(0<d.hb.length)if(e.removeClass("noColor"),1==d.hb.length)e.css("background-color",d.hb[0]).css("background-image","");else{var f=d.hb.map(function(a){return a||"black"}),f=c(f);
e.css("background-color","").css("background-image","-webkit-"+f).css("background-image",f)}else b.data("colorObj")?(f=b.data("colorObj"),e.css("background-color",f.color).css("background-image","").removeClass("noColor")):e.css("background-color","").css("background-image","").addClass("noColor");b.data("fontFamily")&&(e=b.data("fontName"),f=b.data("fontFamily"),$(".textToolbarFontFamily",a).val(f),$(".textToolbarFontFamilySpan",a).text(1<d.ub.length?"":d.ub[0]||e))};(function(){function a(a){var c=$(this),f=a.data,g=$(this).data("touchClickLockingEventType"),h=a.type;if("touchstart"!==h&&"click"!==h)return!1;window.setTimeout(function(){c.removeData("touchClickLockingEventType")},500);if(g&&g!==h)return!1;$(this).data("touchClickLockingEventType",h);return"touchstart"===h?b.call(this,a):"click"===h?f.handler.call(this,a):!0}function b(a){function b(a){g.off("touchend",b);if(4>Math.abs(a.changedTouches[0].clientX-h)&&4>Math.abs(a.changedTouches[0].clientY-l))return c=
f.handler.call(this,a);c=!1}var f=a.data,g=$(this),h=a.touches[0].clientX,l=a.touches[0].clientY;g.on("touchend",f,b);$(document).bind("touchend",function(a){$(this).unbind(a);g.off("touchend",b)});if(f.data&&f.data.cancel)return!1}var c=!1;$.event.special.touchClick={add:function(b){$(this).on("touchstart",b.selector,b,a).on("click",b.selector,b,a)},remove:function(b){$(this).off("touchstart",b.selector,a).off("click",b.selector,a)}}})();
(function(){function a(a){var c=a.data,d=$(this).data("mousedownTouchstartLockingEventType"),e=a.type;if("touchstart"!==e&&"mousedown"!==e)return!1;var f=$(this);window.setTimeout(function(){f.removeData("mousedownTouchstartLockingEventType")},500);if(d&&d!==e)return!1;$(this).data("mousedownTouchstartLockingEventType",e);return c.handler.call(this,a)}$.event.special.mousedownTouchstart={add:function(b){$(this).on("touchstart",b.selector,b,a).on("mousedown",b.selector,b,a)},remove:function(b){$(this).off("touchstart",
b.selector,a).off("mousedown",b.selector,a)}}})();
(function(){function a(a){var c=a.data,f=$(this).data("dblLockingEventType"),g=a.type;if("touchClick"!==g&&"dblclick"!==g)return!1;var h=$(this);window.setTimeout(function(){h.removeData("dblLockingEventType")},500);if(f&&f!==g)return!1;"click"===g?$(this).removeData("dblLockingEventType"):$(this).data("dblLockingEventType",g);return"touchClick"===g?b.call(this,a):"dblclick"===g?c.handler.call(this,a):!0}function b(a){function b(a){g.off("touchClick",b);if(Date.now()<=h+c)return f.handler.call(this,
a)}var f=a.data.data,g=$(this);g.on("touchClick",b);var h=Date.now()}var c=500;$.event.special.touchDblClick={add:function(b){$(this).on("touchClick",b.selector,b,a);$(this).on("dblclick",b.selector,b,a)},remove:function(b){$(this).off("touchClick",b.selector,a);$(this).off("dblclick",b.selector,a)}}})();var Dk=function(){function a(){if(0!=e.length){var a=e.shift();if(a instanceof Ck){var h=a.getFile(),l=a.ib().t(),m=a.ib().ua().R();h?(d=a,f.post("/upload/"+encodeURIComponent(l)+"/"+encodeURIComponent(m.toString()),h,b,c)):d=null}else a instanceof Fk?(h={accessToken:a.td,photoId:a.Mj},l=a.ib().t(),m=a.ib().ua().R(),d=a,f.post("/upload/"+encodeURIComponent(l)+"/"+encodeURIComponent(m.toString()),h,b,c)):d=null}}function b(a){if(a.lengthComputable){var b=d;a=a.loaded/a.total;for(var c=0;c<b.Zf.length;c++)b.Zf[c](a)}}
function c(b,c){for(var e=200==b?yh(c):null,f=d,n=0;n<f.jf.length;n++)f.jf[n](e);d=null;null===d&&a()}var d=null,e=[],f=new gb;return{ug:function(b){e.push(b);null===d&&a()}}}();function Vk(a){this.rj=a;this.Zf=[];this.jf=[]}var Wk=new xh;function Fk(a,b,c){Vk.call(this,a);this.Mj=b;this.td=c}Fk.prototype=new Vk(Wk);function Ck(a,b){Vk.call(this,a);this.Wi=b}Ck.prototype=new Vk(Wk);Ck.prototype.getFile=s("Wi");function Ek(a,b){a.jf.push(b)}Vk.prototype.ib=s("rj");$.fn.reverse=[].reverse;Array.max=function(a){return Math.max.apply(Math,a)};Array.min=function(a){return Math.min.apply(Math,a)};$.fn.delay=function(a,b){jQuery.fx.step.delay=k();return this.animate({delay:1},a,b)};function Xk(){var a,b,c="T"+"transform".slice(1),d=["Moz","Webkit","ms"],e=document.createElement("div");if("transform"in e.style)b="transform";else for(var f=0;f<d.length;f++)if(a=d[f]+c,a in e.style){b=a;break}return $.support.transform=b}
$(function(){var a=Xk();a&&"transform"!==a&&($.cssHooks.transform={get:function(b){return $.css(b,a)},set:function(b,c){b.style[a]=c}})});function Si(a,b){var c={left:a.offset().left,top:a.offset().top,width:a.width(),height:a.height()},d={left:b.offset().left,top:b.offset().top,width:b.width(),height:b.height()};return Yk(c,d)}function Yk(a,b){return a.left+a.width<=b.left||a.top+a.height<=b.top||a.left>=b.left+b.width||a.top>=b.top+b.height?!1:!0}
function Oe(a,b){a instanceof O||(a=Fb(a));return{transform:fc({uc:a.l(),Oc:a.j(),rotate:b}),left:"",top:"",width:a.g(),height:a.h()}}function kf(a){a=a.get(0).getAttribute("viewBox").split(" ");return new O(parseFloat(a[0]),parseFloat(a[1]),parseFloat(a[2]),parseFloat(a[3]))}
function fc(a){var b=a.uc||0,c=a.Oc||0,d=void 0===a.Yj?1:a.Yj,e=void 0===a.Zj?1:a.Zj;a=a.rotate||0;var f="",f=aa?f+("translate3d("+b+"px,"+c+"px,0px) "):f+("translate("+b+"px,"+c+"px) ");if(1!=d||1!=e)f+="scale("+d+","+e+") ";0!=a&&(f+="rotate("+a+"deg)");return f}function Df(a,b){return Math.round(1E5*a)/1E5==Math.round(1E5*b)/1E5}function Ok(a){return 0===a%1?a.toString():a.toFixed(1)}
$(function(){var a=document.createElement("p"),b,c={webkitTransform:"-webkit-transform",OTransform:"-o-transform",msTransform:"-ms-transform",MozTransform:"-moz-transform",transform:"transform"};document.body.insertBefore(a,null);for(var d in c)void 0!==a.style[d]&&(a.style[d]="translate3d(1px,1px,1px)",b=window.getComputedStyle(a,null).getPropertyValue(c[d]));document.body.removeChild(a);aa=void 0!==b&&0<b.length&&"none"!==b});
(function(){for(var a=0,b=["ms","moz","webkit","o"],c=0;c<b.length&&!window.requestAnimationFrame;++c)window.requestAnimationFrame=window[b[c]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[b[c]+"CancelAnimationFrame"]||window[b[c]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(b){var c=(new Date).getTime(),f=Math.max(0,16-(c-a)),g=window.setTimeout(function(){b(c+f)},f);a=c+f;return g});window.cancelAnimationFrame||(window.cancelAnimationFrame=
function(a){clearTimeout(a)})})();function Zk(a){switch(/(\s|^)(tl|t|tr|r|br|b|bl|l)(\s|$)/gi.exec(a.className)[2]){case "tl":return Wa;case "t":return Xa;case "tr":return Ya;case "r":return $a;case "br":return cb;case "b":return bb;case "bl":return ab;case "l":return Za;default:return null}}function Ke(a,b){var c=Math.round(Hk(b)/45);8>c||(c=0);if(a){for(var d=0;8!==d;d++)a.removeClass("octant"+d);a.addClass("octant"+c)}};(function(){function a(){var c=null==h?!0:!1;if(0>=p.width())setTimeout(a,100);else return g=document.createElement("canvas"),g.width=p.outerWidth(),g.height=p.outerHeight(),g.style.opacity="0.5",p.append(g),h=document.createElement("canvas"),h.width=g.width,h.height=g.height,g.getContext&&g.getContext("2d")?(l=g.getContext("2d"),m=h.getContext("2d"),m.lineCap="round",m.shadowColor="#000000",m.shadowBlur=30,n=new Image,n.src="https://di8vc3anm8wl1.cloudfront.net/static/images/bg_color.jpg",n.onload=
function(){c&&b()},!0):!1}function b(){window.Tj(b);var a=Date.now();q&&r.splice(0,0,{time:a,x:q,y:u});m.clearRect(0,0,h.width,h.height);for(var p=1;p<r.length;p++){if(a-r[p].time>c){r.splice(p,r.length);break}var x=Math.sqrt(Math.pow(r[p].x-r[p-1].x,2)+Math.pow(r[p].y-r[p-1].y,2));m.strokeStyle="rgba(0,0,0,"+Math.max(1-(a-r[p].time)/c,0)+")";m.lineWidth=d+Math.max(1-x/f,0)*(e-d);m.beginPath();m.moveTo(r[p-1].x,r[p-1].y);m.lineTo(r[p].x,r[p].y);m.stroke()}a=g.width;p=g.width/n.naturalWidth*n.naturalHeight;
p<g.height&&(p=g.height,a=g.height/n.naturalHeight*n.naturalWidth);l.drawImage(n,0,0,a,p);l.globalCompositeOperation="destination-in";l.drawImage(h,0,0);l.globalCompositeOperation="source-over"}var c=1E3,d=25,e=100,f=50,g,h,l,m,n,p=null,q=null,u=null,r=[];$(function(){var b=$("#viewOnly"),c=$("#viewOnlyLoggedIn");"none"!=b.css("display")?p=b:"none"!=c.css("display")&&(p=c);p&&(p.mousemove(function(a){q=a.clientX;u=a.clientY}),p.bind("touchstart",function(a){q=a.touches[0].pageX;u=a.touches[0].pageY}),
$(window).on("blur",function(){u=q=null}).on("resize",function(){g&&g.parentNode&&g.parentNode.removeChild(g);a()}),a())});window.Tj=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){window.setTimeout(a,1E3/60)}}()})();var $k=Va.map(function(a){return a}),al=4,N=$k[al],Ud=1,bl=0,cl=0;function Kd(){0<al&&ia&&dl(ia,al-1);_gaq.push(["_trackEvent","Zoomer","Click - Zoom Plus"]);return!1}function Ld(){al<$k.length-1&&ia&&dl(ia,al+1);_gaq.push(["_trackEvent","Zoomer","Click - Zoom Minus"]);return!1};function el(a){a.stopPropagation()}function fl(a){a.preventDefault()}function gl(){return!1}var Zi="createTouch"in document,Ui=!1;function S(a){this.el=$(a);this.Xe=[];this.Ze={};this.Hg=""}function ti(a){return 0<=a.Hg.indexOf("touch")}function hl(a,b,c){function d(){if(!0===a.Xe[c])return!0;a.Xe[c]=!0;window.setTimeout(function(){a.Xe[c]=!1},500);return!1}a.Xe[c]=!1;return function(a){return d()?!0:b.call(this,a)}}
S.prototype.selected=function(a){var b=this,c=null;return function(d){var e=d.type;b.Hg=e;null===c&&(c=e);return e!==c?!0:a.call(this,d)}};function il(a){return a.split("+").filter(function(a){return""!==a})}function jl(a){return a.split("|").filter(function(a){return""!==a})}function kl(a){return a.split(/[|+]/).filter(function(a){return""!==a})}S.prototype.$i=function(){var a=0;return function(){a+=1;return"debounce_"+a}}();
S.prototype.on=function(a,b,c){var d=this,e,f,g=null;"undefined"===typeof c?c=b:g=b;if(0<=a.indexOf("+"))e=hl(d,c,d.$i()),d.Ze[a+"_"+(g||"")]=e,il(a).forEach(function(a){if(g)d.el.on(a,g,e);else d.el.on(a,e)});else if(0<=a.indexOf("|"))f=d.selected(c),d.Ze[a+"_"+(g||"")]=f,jl(a).forEach(function(a){if(g)d.el.on(a,g,f);else d.el.on(a,f)});else if(d.Ze[a+"_"+(g||"")]=c,g)this.el.on(a,g,c);else this.el.on(a,c);return d};
S.prototype.off=function(a,b,c){var d=this,e=kl(a),f=null;"undefined"!==typeof c&&(f=b);var g=d.Ze[a+"_"+(f||"")];g&&g.call&&e.forEach(function(a){f?d.el.off(a,f,g):d.el.off(a,g)});return d};function ll(){var a=G.id(),b=G.Bd();return location.protocol+"//"+location.host+"/design/"+encodeURIComponent(a)+(b?"/"+encodeURIComponent(b):"")+"/edit"}function ml(){var a=G.id(),b=G.rg();return location.protocol+"//"+location.host+"/design/"+encodeURIComponent(a)+(b?"/"+encodeURIComponent(b):"")+"/view"}var Ye="screen",oc=!1;function Qj(a,b){G=ya.open(b.id,0,a,b.version,b.session,b.timestamp,b.content,b.extensions,[]);G.Re(nl);ta=0}
function ud(){$("#canvaDocument").on("mousedown",".page img, .cropControls img, a",fl);$("#content").on("keydown",".element.text.focused",ol);if(!Zi)$("#canvaDocument").on("click",".page .element:not(.focused)",!1);$("#content").on("touchDblClick",".selectionBox:not(.multipleSelectionBox)",pl);(new S("#canvaDocument")).on("touchstart",".element.focused",el).on("click",".element.focused",el).on("mousedown",".element.focused",el).on("mousedown+touchstart",".element:not(.focused, .multiSelected)",ql);
(new S("#content")).on("click",".selectionBox.multipleSelectionBox",gl).on("click",".element.multiSelected",gl).on("mousedown+touchstart",".selectionBox.multipleSelectionBox",rl).on("mousedown+touchstart",".element.multiSelected",rl);(new S("#content")).on("click",".selectionBox",gl).on("mousedown+touchstart",".selectionBox",sl);(new S("#content")).on("click",".selectionBox .handle",gl).on("mousedown+touchstart",".selectionBox .handle",tl);(new S("#content")).on("click",".cropControls",gl).on("mousedown+touchstart",
".cropControls",ul);(new S("#content")).on("click",".cropControls .handle",gl).on("mousedown+touchstart",".cropControls .handle",vl);(new S("#content")).on("click",".viewPort .frameHandle",gl).on("mousedown+touchstart",".viewPort .frameHandle",wl);(new S("#content")).on("click",".selectionBox .rotate",gl).on("mousedown+touchstart",".selectionBox .rotate",dc);(new S("#objectPanel")).on("mousedown+touchstart",xl).on("mousedown+touchstart",".gallery a",xl);if(Zi)$("#content").on("touchClick",yl);$("#null").keydown(function(){$(this).blur()});
window.addEventListener("dragenter",zl,!1);window.addEventListener("dragover",Al,!1);window.addEventListener("drop",Bl,!1);$("#dropZone").on("mouseover",Cl).on("dragleave",Dl)}
function td(a){void 0!==C&&(V(),C.off(),ia.remove(),oc||(za.remove(),Aa.remove()));ie(zc(a));var b=_.flatten(_.pluck(a.pages,"elements")).length,c=_.after(b+1,function(){L.off("elementLoaded",c);setTimeout(function(){L.trigger("documentRendered")},500)});L.on("elementLoaded",c);C=new vc(a);C.on("change",Rj);E=C.ha;ba=C.Db;oc?ia=new El({model:C}):(za=new Fl({model:C}),ia=new El({model:C}),Aa=new Gl({model:C,Lb:ia}));C.n.forEach(function(a){a.aa().forEach(function(b){a.trigger("element:add",a,b)})});
c();D=new nj;if(!oc){var d=[];C.aa().forEach(function(a){if(a.Gd){var b=a.Gd();a instanceof Ae&&a.ca()&&void 0===b.id&&void 0===b.version||Ih(ka,b.id,b.version)||d.push(b)}if(a.yb&&!(a instanceof Ae))for(b=0;b<a.wa();b++){var c=a.xa(b),h=c.mediaId,c=c.mediaVersion;void 0===h||null===h||void 0===c||null===c||Ih(ka,h,c)||d.push({id:h,version:c})}});d.forEach(function(a){a=yh({id:a.id,bundle:{version:a.version}});ja.nd(a)})}}
function vi(a){var b=a.v();if(null==b)throw"cannot register element add operation - element must first be added to a page";a=a.serialize();a.pageIndex=P(C,b);Q(D,new R(rj,a))}function zi(a){var b=a.v();if(null==b)throw"cannot delete canva elements that are not attached to a page";a=a.serialize();a.pageIndex=P(C,b);Q(D,new R(sj,a))}function Xi(){return T(C).i||$("#canvaDocument > .inner > .page").first()}
function Hl(a){var b=a.B();if(!a.ca()&&0>=b.l()&&0>=b.j()&&b.W()>=E.width&&b.G()>=E.height){var c=a.v();c.aa().forEach(function(a){if(a.ca()){var b={elementIndex:a.s(),pageIndex:P(C,c)};bf(a);Q(D,new R(yi,b));zi(a);a.remove()}});b=a.s();Mc(a);V();Wi(a);a={elementIndex:a.s(),oldElementIndex:b,pageIndex:P(C,c)};Q(D,new R(Bi,a))}}function Rj(){var a=C.serialize();Uc(a)?(ta=G.post(ta,a),null==ta&&kj()):(lj(),G.close())}
function nl(a){var b=1===ta&&2===G.Nc(),c=null!==window.opener;0==a&&ta!=G.version()?kj():(L.trigger("session:sync",a),0===a&&b&&c&&window.opener.location.reload())}
function ql(a){function b(a){var b=(void 0!==a.clientX?a.clientX:a.touches[0].clientX)-p;a=(void 0!==a.clientY?a.clientY:a.touches[0].clientY)-q;if(w||4<Math.abs(b)||4<Math.abs(a))w=!0,f.oa(u+b/N,r+a/N),A.hasClass("placing")||Ti(f,x),f.L();if(w&&!z){var c=A.find("img");c.attr("data-screen-width",f.g()).attr("data-screen-height",f.h());A.addClass("clone");!f.gf()&&f instanceof Ae&&A.addClass("cutout");A.data("li",{data:function(a){if("result"==a)return{R:function(){return f.Oa},t:function(){return f.Na},
ec:function(){return f.Rf},ab:function(){var a={url:c.attr("src")};return{THUMBNAIL:a,SCREEN:a}}}}});if(f.gf()||A.hasClass("cutout"))Ri(A,ti(v)),z=!0}return!1}function c(a){$("#hotspots").remove();$("#overlays .align").removeClass("on");v.off("mousemove|touchmove",b).off("mouseup|touchend",c);if(w)f.v()&&(f.v()&&Lb(f.B(),f.v().B())?(kh(),Hl(f),a={elementIndex:f.s(),pageIndex:P(C,f.v()),"new":{left:f.l(),top:f.j()},old:{left:u,top:r}},a=new R(jc,a),Q(D,a),lh()):(a=f.serialize(),a.pageIndex=P(C,f.v()),
a.left=u,a.top=r,a=new R(sj,a),Q(D,a),f.remove()));else if(De(f),e){var h=d.parents(".text").addBack(".text");g?ye(h):a.shiftKey||(f instanceof hc?(Nk(h),Il(h,!0),f.L()):Il(h))}A.removeClass("clone cutout").removeData("startLeft").removeData("startTop").removeData("li");A.find("img").removeAttr("data-screen-width").removeAttr("data-screen-height")}if(3==a.which||a.ctrlKey)return!0;kc();var d=$(a.target),e=d.is(".text")||0<d.parents(".text").length,f=(e?d.parents(".element").addBack(".element"):$(this)).data("canvaElement"),
g=f.hasClass("focused"),h=f.Md();if(f.ca()&&!h)return Aa.Jf(a);if(null!=$(this).data("textToolbar")){var l=$(".textToolbarColor",l);null!=l.data("picker")&&(l.data("picker").remove(),l.removeData("picker"))}a.shiftKey||h||V();if(f instanceof hc){h=$("#overlays .svg.text.focused");0<h.length&&(ye(h),Gf(f));d.is("image.placeholder")&&"/static/images/placeholder.jpg"!=d.attr("xlink:href")&&f.ld(d);var h=$(".uploadAPhoto"),m=void 0!==a.clientX?a.clientX:a.touches[0].clientX,n=void 0!==a.clientY?a.clientY:
a.touches[0].clientY;h.each(function(a,b){var c=b.getBoundingClientRect();if(m>c.left&&m<c.right&&n<c.bottom&&n>c.top){var c=$(b).parent().find("image.placeholder"),c=f.i.find("image.placeholder").index(c),d=f;$i();$("#fileUpload").data("upload-destination",d);$("#fileUpload").data("upload-placeholder-index",c);return!1}return!0})}else f instanceof Be&&d.is("img.placeholder")&&f.ld(d);var p=void 0!==a.clientX?a.clientX:a.touches[0].clientX,q=void 0!==a.clientY?a.clientY:a.touches[0].clientY,u=f.l(),
r=f.j(),w=!1,v=new S($(document));v.on("mousemove|touchmove",b).on("mouseup|touchend",c);var x=Yi(f),z=!1,A=f.i;A.data("startLeft",u).data("startTop",r);return!1}
function rl(a){function b(a){var b=(void 0!==a.clientX?a.clientX:a.touches[0].clientX)-m;a=(void 0!==a.clientY?a.clientY:a.touches[0].clientY)-n;if(p||4<Math.abs(b)||4<Math.abs(a))p=!0,e.oa(f+b/N,g+a/N),Ti(e,l),mh();return!1}function c(){$("#overlays .align").removeClass("on");q.off("mousemove|touchmove",b).off("mouseup|touchend",c);p&&(kh(),d.forEach(function(a,b){var c={elementIndex:a.s(),pageIndex:P(C,a.v()),"new":{left:a.l(),top:a.j()},old:{left:h[b].left,top:h[b].top}};Q(D,new R(jc,c))}),lh())}
if(3==a.which||a.ctrlKey)return!0;var d=C.ba(),e=new qb(d),f=e.l(),g=e.j(),h=d.map(function(a){return{left:a.l(),top:a.j()}}),l=Yi(d),m=void 0!==a.clientX?a.clientX:a.touches[0].clientX,n=void 0!==a.clientY?a.clientY:a.touches[0].clientY,p=!1,q=new S($(document));q.on("mousemove|touchmove",b).on("mouseup|touchend",c);return!1}
function Il(a,b){if(!a.hasClass("focused")){a.parents(".page").hasClass("dark")&&a.addClass("dark");var c=a.data("canvaElement");if(a.is(".svg .text")){var d=a.parents(".element").first();a.data("precedingElement",d.prevAll(".element").first()).addClass("focused svg element");d.appendTo("#overlays");c.S();c.P();ic(c)}else a.data("precedingElement",a.prevAll(".element").first()).appendTo("#overlays").addClass("focused"),c.S(),c.P();$("> .inner",a).attr("contentEditable","true").focus();a.find("> .inner").on("paste",
Jl);a.on("DOMNodeInserted",Kl).on("DOMNodeInserted",Ll).on("DOMNodeRemoved",Ll).on("DOMCharacterDataModified",Ll);Ml.kk(a);d=c.va();c=c.ya(d);a.data("oldTextData",c);c=a.data("placeholderText")||"Querulous, playful pangolins";c=a.find("> .inner").text()==c;(b||c)&&we($("> .inner",a))}}
function we(a,b){window.setTimeout(function(){var c,d;window.getSelection&&document.createRange?(d=document.createRange(),d.selectNodeContents(a.get(0)),c=window.getSelection(),c.removeAllRanges(),c.addRange(d)):document.body.createTextRange&&(d=document.body.createTextRange(),d.moveToElementText(a.get(0)),d.select());b&&b()},1)}
function Jl(a){function b(a){var b=document.createDocumentFragment();a.textContent.split(/\r?\n/).forEach(function(a){a=a.replace(/ {2}/g," \u00a0");b.appendChild(document.createTextNode(a));b.appendChild(document.createElement("br"))});return b}function c(a){for(var b=document.createDocumentFragment(),c;c=a.firstChild;)b.appendChild(c);return b}function d(a){return _.escape(a).replace(/\r?\n/g,"<br>").replace(/ {2}/g," &nbsp;")}if(a.originalEvent.clipboardData)a.preventDefault(),a=a.originalEvent.clipboardData.getData("text/plain"),
document.execCommand("insertHTML",!1,d(a));else if(window.clipboardData)a.preventDefault(),a=window.clipboardData.getData("Text"),document.selection.createRange().pasteHTML(d(a));else{var e=rangy,f=e.saveSelection(),g=a.currentTarget,h=c(g);setTimeout(function(){var a=c(g),a=b(a);g.appendChild(h);var d=e.getSelection();e.restoreSelection(f);d.deleteFromDocument();var n=a.lastChild;0<d.rangeCount?(d=d.getRangeAt(0),d.insertNode(a),d.collapseAfter(n),e.getSelection().setSingleRange(d)):g.appendChild(a)},
1)}}function Kl(a){a=$(a.target);var b=a.attr("style");b&&-1<b.indexOf("Glegoo, Helvetica, Arial, sans-serif")&&a.attr("style","")}function Ll(a){0==a.timeStamp&&(a.timeStamp=Date.now());var b=$(a.currentTarget),c=b.data("designObject");b.is(".svg")&&void 0!==c&&(void 0===Ll.ff&&(Ll.ff={}),5<a.timeStamp-(Ll.ff[a.currentTarget]||0)&&(tf(c),Ll.ff[a.currentTarget]=a.timeStamp))}
var Ml=function(){var a={};return{kk:function(b){var c=b.get(0);if(!(c in a)){var d=Date.now(),e=function(){a[c]=window.requestAnimationFrame(e);if(!(100>Date.now()-d)){d=Date.now();var f=b.data("textToolbar");f&&If(f,b)}};a[c]=window.requestAnimationFrame(e)}},lk:function(b){if(b=b.get(0))window.cancelAnimationFrame(a[b]),delete a[b]}}}();
function ye(a){function b(){var b=a.data("oldTextData");if(b){var c=b.index,e=d.ya(c);a.removeData("oldTextData");b={elementIndex:d.s(),pageIndex:P(C,d.v()),textIndex:c,"new":e,old:b};Q(D,new uj(Aj,b));d.vc=!0}if("Untitled design"==C.Ea()){b=a.get(0).textContent.trim().replace(/\n+/," ").split(" ");c=b[0];for(e=1;e<b.length&&!(40<c.length+b[e].length+1);e++)c+=" "+b[e];c=c.substr(0,40);"Querulous, playful pangolins"!=c&&"Text"!=c&&"Untitled design"!=c&&Ic(C,c)}}a.removeClass("dark");var c=a.data("precedingElement"),
d=a.data("canvaElement"),e=d.na||Xi(),f=d.ya(d.va());Ml.lk(a);if(a.is(".svg.text")){var g=a.parents(".element").first();0<c.length?g.insertAfter(c):g.prependTo($(".elements",e));a.removeData("precedingElement").removeClass("focused svg element");$("> .inner",a).attr("contentEditable","false");ic(d);ce(d,f.index);b()}else 0<a.length&&(0<c.length?a.insertAfter(c):a.prependTo($(".elements",e)),a.removeClass("focused"),$("> .inner",a).attr("contentEditable","false"),a.text().match(/^\s*$/)?((c=a.data("oldTextData"))&&
d.qc(c.index,c),zi(d),d.remove()):(ce(d,f.index),b()));a.find("> .inner").off("paste",Jl);a.removeData("oldTextData").off("DOMNodeInserted",Ll).off("DOMNodeRemoved",Ll).off("DOMCharacterDataModified",Ll);d.S();d.P();$("#null").focus();setTimeout(function(){$("#null").blur()},20)}
function sl(a){if(/touch/gi.test(a.type)||!$(this).hasClass("multipleSelectionBox")){var b=$(this).data("element");b.data("canvaElement")instanceof Sc?a.target=b.get(0):($(this).css("visibility","hidden"),a.target=document.elementFromPoint(void 0!==a.clientX?a.clientX:a.touches[0].clientX,void 0!==a.clientY?a.clientY:a.touches[0].clientY),$(this).css("visibility",""));b=$(this).data("element").get(0);ql.call(b,a)}return!1}
function pl(){var a=$(this).data("element"),b=$(a).data("canvaElement");a.hasClass("text")?Il(a):Qk(b);return!1}function De(a){var b=C.ba();if(-1==b.indexOf(a)){var c=a.i;0==b.length?(Nl(c),Mk(c),a instanceof Sc&&Nk(c)):1==b.length?(a=b[0],Ee(a),a.i.addClass("multiSelected")):b.forEach(function(a){a.nb()});1<=b.length&&(c.addClass("multiSelected"),mh())}}function Wi(a){var b=C.ba();if(1!=b.length||-1==b.indexOf(a))V(),De(a)}
function Nl(a){a.addClass("selected");0==a.parents(".page").length&&Xi();var b=$("#overlays"),c=a.data("selectionBox");c||(c=$('<div class="selectionBox cornerHandles"><div class="inner"></div><a class="handle tl" href="#" title="Resize this element"></a><a class="handle t" href="#" title="Stretch this element"></a><a class="handle tr" href="#" title="Resize this element"></a><a class="handle l" href="#" title="Stretch this element"></a><a class="handle r" href="#" title="Stretch this element"></a><a class="handle br" href="#" title="Resize this element"></a><a class="handle b" href="#" title="Stretch this element"></a><a class="handle bl" href="#" title="Resize this element"></a><a class="rotate" href="#" title="Rotate this element"></a><a class="move" href="#"></a></div>'),
c.data("element",a).appendTo(b),a.hasClass("text")&&c.addClass("text"),a.hasClass("svg")&&c.addClass("svg"),a.data("selectionBox",c));a.data("canvaElement").L()}function Ee(a){a.Bg();a.nb();var b=a.i,c=b.hasClass("multiSelected");b.removeClass("selected").removeClass("multiSelected");b.is(".text.focused")?ye(b):a instanceof hc&&(b=a.Ac(),0<b.length&&ye(b));b=a.v();!c||b&&Lb(a.B(),b.B())||(zi(a),a.remove())}function V(){kc();C.ba().forEach(function(a){Ee(a)});$(".multipleSelectionBox").remove()}
var Ol=null,He=null;function nh(a){void 0===a&&(a=C.ba());0<a.length&&(Ol=a.map(function(a){return a.clone()}),He=a[a.length-1])}function oh(){var a=Ol;if(a){V();if(Ge()){var b=He;a.forEach(function(a){a.ia+=30;a.pa();a.ea+=30;a.pa();a.insertAfter(b);b=a})}else a.forEach(function(a){a.appendTo(T(C))});kh();a.forEach(function(a){vi(a)});lh();a.forEach(function(a){De(a)});nh(a)}}
function ul(a){function b(a){var b=void 0!==a.clientX?a.clientX:a.touches[0].clientX,c=void 0!==a.clientY?a.clientY:a.touches[0].clientY,m=Y(d.qa());a=(b-e)*Math.cos(m)-(f-c)*Math.sin(m)+e-e;b=-1*(f-c)*Math.cos(m)-(b-e)*Math.sin(m)+f-f;if(l||4<Math.abs(a)||4<Math.abs(b))l=!0,a/=N,b/=N,d.Oe(g+a,h+b),d.L();return!1}function c(){m.off("mousemove|touchmove",b).off("mouseup|touchend",c)}if(3==a.which||a.ctrlKey||$(a.target).is(".handle"))return!0;var d=$(this).data("canvaElement"),e=void 0!==a.clientX?
a.clientX:a.touches[0].clientX,f=void 0!==a.clientY?a.clientY:a.touches[0].clientY;a=d.Ja();var g=a.l(),h=a.j(),l=!1,m=new S($(document));m.on("mousemove|touchmove",b).on("mouseup|touchend",c);return!1}
function vl(a){function b(a){var b=a.shiftKey?!f:f,c=void 0!==a.clientX?a.clientX:a.touches[0].clientX,h=void 0!==a.clientY?a.clientY:a.touches[0].clientY,q=0,B=0,W=a=0,B=q=0,ea={x:c,y:h};r=Gb(Fb($(".cropControls").get(0).getBoundingClientRect()));ea=Jk(ea,u);c=Lk(n,p,c,h);h=Math.cos(Y(ea-w))*c;b&&(ea=w,c=h);ea=Ik(ea,e.qa());h=0;switch(Zk(d.get(0))){case Ya:h=ea-Kk(Ya);B=c*Math.cos(Y(h));q=c*Math.sin(Y(h));b&&(B=q/m);a=v;W=x-B;q=z+q;B=A+B;break;case cb:h=ea-Kk(cb);B=c*Math.sin(Y(h));q=c*Math.cos(Y(h));
b&&(B=q/m);a=v;W=x;q=z+q;B=A+B;break;case ab:h=ea-Kk(ab);B=c*Math.cos(Y(h));q=c*Math.sin(Y(h));b&&(B=q/m);a=v-q;W=x;q=z+q;B=A+B;break;case Wa:h=ea-Kk(Wa),B=c*Math.sin(Y(h)),q=c*Math.cos(Y(h)),b&&(B=q/m),a=v-q,W=x-B,q=z+q,B=A+B}var c=l.l()+l.g(),h=l.j()+l.h(),ea=Math.floor(W)>l.j(),xb=Math.floor(a)>l.l(),la=Math.ceil(a+q)<c,Ec=Math.ceil(W+B)<h;ea&&(l.j(),F===l.j()?(W=F,B=da,b&&(a=J,q=H)):(W=l.j(),B=da+(F-W),b&&(q=B*m,a=J,Math.ceil(a+q)<c&&(q=c,B=q/m))));xb&&(l.l(),J===l.l()?(a=J,q=H,b&&(B=da,W=F)):
(a=l.l(),q=H+(J-a),b&&(B=q/m,W=F,Math.ceil(W+B)<h&&(B=h,q=B*m))));la&&(J+H===c?(q=H,a=J,b&&(W=F,B=da)):(q=c-a,b&&(B=q/m,W=F)));Ec&&(F+da===h?(B=da,W=F,b&&(a=J,q=H)):(B=h-W,b&&(q=B*m,a=J)));if(isNaN(1*B)||isNaN(1*q)||isNaN(1*W)||isNaN(1*a))return!1;B<h&&(W=F,a=J,B=h,b&&(q=B*m));q<c&&(a=J,W=F,q=c,b&&(B=q/m));ea=Math.floor(W)>l.j();xb=Math.floor(a)>l.l();la=Math.ceil(a+q)<c;Ec=Math.ceil(W+B)<h;if(ea||xb||la||Ec)return!1;g.S(a/N).P(W/N).D(q/N).q(B/N);e.eb(g);e.L();J=a;F=W;H=q;da=B;return!1}function c(){q.off("mousemove|touchmove",
b).off("mouseup|touchend",c);d.removeClass("on")}var d=$(this),e=C.ba()[0],f=!0;e.ta();var g=e.Ja(),h=e.Ja().scale(N),l=e.U().scale(N);l.S(0).P(0);var m=h.width/h.height,n=void 0!==a.clientX?a.clientX:a.touches[0].clientX,p=void 0!==a.clientY?a.clientY:a.touches[0].clientY,q=new S($(document));q.on("mousemove|touchmove",b).on("mouseup|touchend",c);var u={x:n,y:p};a=Gb(Fb(d.get(0).getBoundingClientRect()));var r=Gb(Fb($(".cropControls").get(0).getBoundingClientRect())),w=Jk(a,r),v=h.l(),x=h.j(),z=
h.g(),A=h.h(),J=h.l(),H=h.g(),F=h.j(),da=h.h();return!1}
function wl(a){function b(a){var b,c,m,H;$(".viewPort").get(0).getBoundingClientRect();var F=void 0!==a.clientX?a.clientX:a.touches[0].clientX,da=void 0!==a.clientY?a.clientY:a.touches[0].clientY,K=0,Z=0;a=f.clone();var M=Lk(h,l,F,da),K=Ik(Jk({x:F,y:da},q),d.qa()),F=0;switch(Zk(e.get(0))){case Ya:F=K-Kk(Ya);Z=M*Math.cos(Y(F));K=M*Math.sin(Y(F));b=f.l();m=f.j()-Z;c=f.g()+K;H=f.h()+Z;break;case cb:F=K-Kk(cb);Z=M*Math.sin(Y(F));K=M*Math.cos(Y(F));b=f.l();m=f.j();c=f.g()+K;H=f.h()+Z;break;case ab:F=K-
Kk(ab);K=M*Math.sin(Y(F));Z=M*Math.cos(Y(F));b=f.l()-K;m=f.j();c=f.g()+K;H=f.h()+Z;break;case Wa:F=K-Kk(Wa),Z=M*Math.sin(Y(F)),K=M*Math.cos(Y(F)),b=f.l()-K,m=f.j()-Z,c=f.g()+K,H=f.h()+Z}M=g.j();m<M&&(w===M?(m=w,H=v):(m=M,H=v+(w-m)));M=g.l();b<M&&(u===M?(b=u,c=r):(b=M,c=r+(u-b)));M=g.h()+g.j();m+H>M&&(w+v===M?(H=v,m=w):H=M-m);M=g.g()+g.l();b+c>M&&(u+r===M?(c=r,b=u):c=M-b);if(20>c||20>H||isNaN(1*H)||isNaN(1*c)||isNaN(1*m)||isNaN(1*b))return!1;a.S(b).P(m).D(c).q(H);u=b;w=m;r=c;v=H;pb(d,a.scale(1/N));
Ti(p,n,[],!1);d.L();return!1}function c(){$("#overlays .align").removeClass("on");m.off("mousemove|touchmove",b).off("mouseup|touchend",c);e.removeClass("on")}var d=C.ba()[0],e=$(this);d.L();var f=d.U();f.scale(N);var g=d.Ja();g.scale(N).translate(f.l(),f.j());var h=void 0!==a.clientX?a.clientX:a.touches[0].clientX,l=void 0!==a.clientY?a.clientY:a.touches[0].clientY,m=new S($(document));m.on("mousemove|touchmove",b).on("mouseup|touchend",c);var n=Yi(d),p=null;d instanceof Ae&&(p=new ob(d));e.get(0).getBoundingClientRect();
$(".viewPort").get(0).getBoundingClientRect();var q={x:h,y:l},u=f.l(),r=f.g(),w=f.j(),v=f.h();return!1}
function tl(a){function b(a){W=lc(f);var b=a.shiftKey?!w:w,c=void 0!==a.clientX?a.clientX:a.touches[0].clientX;a=void 0!==a.clientY?a.clientY:a.touches[0].clientY;var e=Jk({x:c,y:a},r),g=Lk(q,u,c,a),K=Math.cos(Y(e-ea))*g,Yb=e,hb=g,ma=g=e=0;b&&(Yb=ea,hb=K);if(Ec&&3>Math.abs(la-c)||wj&&3>Math.abs(xb-a))return!1;Ec=wj=!1;var ma=Zk(d.get(0)),Ua,Zb=!1,Yb=Ik(Yb,f.qa());switch(f instanceof Sc?ma===Za?ab:cb:ma){case $a:e=K;Ua=da;break;case Za:e=K;Ua=A;break;case Xa:g=K;Ua=H;break;case bb:g=K;Ua=x;break;case Ya:Zb=
!0;Ua=F;ma=Yb-Kk(Ya);e=hb*Math.sin(Y(ma));g=hb*Math.cos(Y(ma));break;case cb:Zb=!0;Ua=v;ma=Yb-Kk(cb);g=hb*Math.sin(Y(ma));e=hb*Math.cos(Y(ma));break;case ab:Zb=!0;Ua=z;ma=Yb-Kk(ab);e=hb*Math.sin(Y(ma));g=hb*Math.cos(Y(ma));break;case Wa:Zb=!0,Ua=J,ma=Yb-Kk(Wa),g=hb*Math.sin(Y(ma)),e=hb*Math.cos(Y(ma))}K=Ua.get(0).getBoundingClientRect();b&&Zb&&(0===e?e=g*p:g=e/p);e=0===e?f.g():Math.max(m+e,Math.max(3*N),M)/N;g=0===g?f.h():Math.max(n+g,Math.max(3*N),ui)/N;Zb=Yi(f);Ti(f,Zb,["UP","DOWN","LEFT","RIGHT"],
b);f.setSize(e,g);b=Ua.get(0).getBoundingClientRect();wc+=K.top-b.top;B+=K.left-b.left;f.oa((h+B)/N,(l+wc)/N);la=c;xb=a;f.Ha();Z||(Z=!0,_gaq.push(["_trackEvent","Element","Resized"]));return!1}function c(){$("#overlays .align").removeClass("on");K.off("mousemove|touchmove",b).off("mouseup|touchend",c);d.removeClass("on");f instanceof Sc&&te(e);var a=f.B();g.Pg(a)||(kh(),Hl(f),a={elementIndex:f.s(),pageIndex:P(C,f.v()),"new":a.serialize(),old:g.serialize()},Q(D,new R(jc,a)),lh());v.remove();x.remove();
z.remove();A.remove();J.remove();H.remove();F.remove();da.remove()}var d=$(this);d.addClass("on");var e=d.parents(".selectionBox").data("element"),f=e.data("canvaElement"),g=f.B(),h=Math.round(f.ia*N),l=Math.round(f.ea*N),m=Math.round(f.A*N),n=mc(f),p=m/n,q=void 0!==a.clientX?a.clientX:a.touches[0].clientX,u=void 0!==a.clientY?a.clientY:a.touches[0].clientY,r={x:q,y:u},w=!(f instanceof Sc||f instanceof Be),v=$("<div></div>");v.css({position:"absolute",top:0,left:0});f.i.append(v);var x=$("<div></div>");
x.css({position:"absolute",top:0,left:"50%"});f.i.append(x);var z=$("<div></div>");z.css({position:"absolute",top:0,right:0});f.i.append(z);var A=$("<div></div>");A.css({position:"absolute",top:"50%",right:0});f.i.append(A);var J=$("<div></div>");J.css({position:"absolute",bottom:0,right:0});f.i.append(J);var H=$("<div></div>");H.css({position:"absolute",bottom:0,left:"50%"});f.i.append(H);var F=$("<div></div>");F.css({position:"absolute",bottom:0,left:0});f.i.append(F);var da=$("<div></div>");da.css({position:"absolute",
top:"50%",left:0});f.i.append(da);var K=new S($(document));K.on("mousemove|touchmove",b).on("mouseup|touchend",c);var Z=!1,M=0,ui=0;f instanceof hc&&(a=f.w?$.extend(!0,{},f.w):null)&&(M=(a.left+a.right)*Cf(f).scale*N,ui=(a.top+a.bottom)*Cf(f).scale*N);var wc=0,B=0,W=lc(f);a=Gb(Fb(d.get(0).getBoundingClientRect()));var ea=Jk(a,W),xb=u,la=q,Ec=!1,wj=!1;return!1}
function mh(){var a=C.ba();if(!(2>a.length)){var b=$("#overlays");document.getElementById("canvaDocument");var c=$(".selectionBox.multipleSelectionBox");0==c.length&&(c=$('<div class="selectionBox multipleSelectionBox"><div class="inner"></div><a class="handle tl" href="#"></a><a class="handle tr" href="#"></a><a class="handle br" href="#"></a><a class="handle bl" href="#"></a><a class="rotate" href="#"></a><a class="move" href="#"></a></div>'),c.appendTo(b));var b=a.map(function(a){return a.V()*
N+(a.v().Z()||0)}),d=a.map(function(a){return a.Q()*N+(a.v().ga()||0)}),b=Array.min(b)+1,d=Array.min(d)+1,e=Array.max(a.map(function(a){return a.Da()*N+(a.v().Z()||0)})),f=Array.max(a.map(function(a){return a.Y()*N+(a.v().ga()||0)}));c.css("left",b).css("top",d).css("width",e-b).css("height",f-d);var g=$();a.map(function(a){g.push(a.i.get(0))});Mk(g)}}function Pl(){var a=$(this);!a.data("canvaElement").ca()&&Si(a,$("#marquee"))?a.addClass("multiSelected"):a.removeClass("multiSelected")}
function ol(){var a=$(this);setTimeout(function(){te(a)},20)}function te(a){if(!(a.is(".svg")||0<a.parents(".element.svg").length)){var b=a.data("canvaElement"),c=b.g();a.css("overflow","scroll");c=Math.max(c,$("> .inner",a).get(0).scrollWidth);a.css("overflow","");b.D(c);b.q();var d=(c=b.h())||a.height(),d=Math.max(d,$("> .inner",a).height());null!=c?b.q(d):a.css("height",d);b.Ha()}}
function xl(){var a=$("#overlays .confirmationToolbarCancel a");0<$("#overlays > .mask.on").length&&0<a.length&&a.trigger("click")}
function yl(a){if($(a.target).is("#content, #canvaDocument, #canvaDocument > .inner, #canvaDocument > .inner > .page, #canvaDocument > .inner > .page > .elements")){var b=$(".textToolbarColor"),c=[];b.each(function(){null!=$(this).data("picker")&&c.push($(this).data("picker"))});if(0<c.length){for(a=0;a<c.length;a++)c[a].remove();b.removeData("picker")}else $(a.target).is("input")||$("*:focus").blur(),V()}}
function Ri(a,b){var c=null;function d(a){Ui=!0;window.clearTimeout(A);A=window.setTimeout(function(){Ui=!1},1E3);var b=document.elementFromPoint(a.touches[0].clientX,a.touches[0].clientY);J.forEach(function(a){a!=b&&h.call(a)});a=$(b);var c=0<=J.indexOf(b);!c&&0<a.parents("#hotspots").length&&a.is(".element.hotspot")?(z=b,f.call(b),J=[b]):J=c?[b]:[]}function e(a){$(document).off("touchmove",d).off("touchend",e);a=document.elementFromPoint(a.changedTouches[0].clientX,a.changedTouches[0].clientY);
$(a);a=$(z);0<a.parents("#hotspots").length&&a.is(".element.hotspot")&&l.call(z);window.setTimeout(function(){Ui=!1},300)}function f(){if(a.is(".svg, .cutout")){var b=$("#cutoutMessage");0>=b.length&&(b=$('<div id="cutoutMessage">Cut-out images can\'t currently be put into frames (in case you were trying). Try using a normal photo.</div>'),b.appendTo("#content"));b.off("transitionend").removeClass("disappear")}else{var c=u.clone();c.css("width","").css("height","");var b=$(this).data("canvaElement"),
d=$(this).data("placeholderIndex");a.data("placedInElement",b).addClass("placing");var e=b.jb(d),c=new O(0,0,parseInt(c.data("screenWidth")||c.attr("width"),10),parseInt(c.data("screenHeight")||c.attr("height"),10));Jb(c,e).translate(-e.l(),-e.j());e=a.data("li").data("result");n=e.t();p=e.R();q=e.ec();e={type:"image",index:d,mediaId:n,mediaVersion:p,imageBox:c.serialize()};x=b.xa(d);b.pb(d,e);r&&(d=r.i,b=d.data("selectionBox"),d=d.data("toolbar"),b&&b.hide(),d&&d.addClass("hidden"))}}function g(){var b=
a.offset();$("#cutoutMessage").css("left",b.left+a.width()/2-$("#cutoutMessage").outerWidth()/2).css("top",b.top+a.height()/2-$("#cutoutMessage").outerHeight()/2)}function h(){$("#cutoutMessage").on("transitionend",m).addClass("disappear");var b=$(this).data("canvaElement"),c=$(this).data("placeholderIndex");a.removeData("placedInElement").removeClass("placing");b.pb(c,x);r&&(c=r.i,b=c.data("selectionBox"),c=c.data("toolbar"),b&&b.show(),c&&c.removeClass("hidden"))}function l(){if(a.data("li")&&($("#cutoutMessage").on("transitionend",
m).addClass("disappear"),!a.is(".svg, .cutout"))){var b=a.data("li").data("result"),c=$(this).data("canvaElement"),d=$(this).data("placeholderIndex"),e=c.vb(d),f=c.xa(d);c.rh();Wi(c);f={elementIndex:c.s(),pageIndex:P(C,c.v()),cropIndex:d,"new":f,old:x};f=new R(qj,f);kh();Q(D,f);c.vc=!0;c.ld(e);a.one("transitionend",m).addClass("disappeared").removeClass("placing");w.remove();e.removeData("oldPlacement");r&&(r.S(a.data("startLeft")),r.P(a.data("startTop")),zi(r),r.remove());lh();q===Ug&&Hi(b,function(a){var b=
c.xa(d);b.mediaId===n&&(b.mediaId=a.t(),b.mediaVersion=a.ua().R(),c.pb(d,b),C.trigger("change"));Ji({mediaId:n,mediaVersion:p},{mediaId:a.t(),mediaVersion:a.ua().R()})});_gaq.push(["_trackEvent","Document","Drag - Photo Placed In Hotspot"])}}function m(){$(this).remove()}c||(c=T(C)||C.n[0]);var n,p,q,u=$("img",a),r=a.data("canvaElement"),w=$('<section id="hotspots"></section>'),v=Ql(c);w.css(v.serialize());c.aa().forEach(function(a){if(a instanceof hc||a instanceof Be){var c=$('<div class="container"></div>'),
d=a.B();c.css(d.scale(N).round().serialize()).css("transform","rotate("+a.qa().toString()+"deg)");for(var d=a.wa(),e=0;e<d;e++){var m=a.jb(e);m.scale(N).round();var n=$('<div class="element hotspot"></div>');n.css(m.serialize()).data("canvaElement",a).data("placeholderIndex",e).appendTo(c);!1===b&&n.mouseover(f).mousemove(g).mouseout(h).mouseup(l)}c.appendTo(w)}});w.appendTo("#content");c=ia.u[c.s()].$el;w.css("left",c.offset().left).css("top",c.offset().top);var x=null,z=null,A=null;if(!0===b){var J=
[];$(document).on("touchmove",d).on("touchend",e)}}
function si(a,b){function c(a){a={left:a.touches[0].clientX,top:a.touches[0].clientY,width:0,height:0};for(var b={left:m,top:n,width:0,height:0},c=0;c<l.length;c++){var d=l[c];Yk(a,d)&&!Yk(b,d)?e.call(d.element):Yk(b,d)&&!Yk(a,d)&&f.call(d.element)}m=a.left;n=a.top}function d(b){$(document).off("touchmove",c).off("touchend",d);for(var e={left:b.changedTouches[0].clientX,top:b.changedTouches[0].clientY,width:0,height:0},f=0;f<l.length;f++){var m=l[f];if(Yk(e,m)){var n=$(".page",h).index(m.element);
$(m.element).data("page",$("#canvaDocument > .inner > .page").eq(n));g.call(m.element,b,a)}}}function e(){$(this).addClass("hover");$(this).data("page").addClass("hotspotHover");a.addClass("placing")}function f(){$(this).removeClass("hover");$(this).data("page").removeClass("hotspotHover");a.removeClass("placing")}function g(b,c){2==arguments.length&&(a=c);var d=a.data("li");d.find("a").css("opacity","");var e=$(this).data("page"),e=$("#canvaDocument > .inner > .page").index(e);yc(C,e);if(0<d.parents(".backgroundGallery").length)xi(a.data("li")),
_gaq.push(["_trackEvent","Document","Drag - Background Placed On Page"]);else if(0<d.parents(".templateGallery").length){ba=d.data("content");var f=C.n[e],g=f.serialize();pi(f,ba);Q(D,new qi(ri,{pageIndex:e,"new":ba,old:g}));_gaq.push(["_trackEvent","Document","Drag - Template Placed On Page",d.attr("data-template")])}h.remove();a.remove();$("#canvaDocument > .inner > .page").removeClass("hotspotHover")}$("img",a);var h=$('<div id="hotspots"></div>');h.css("left",parseInt($("#canvaDocument").css("left"),
10)).css("top",-$("#canvaDocument").get(0).scrollTop).appendTo("#content");$("#canvaDocument > .inner > .page").each(function(){$(this).clone().data("page",$(this)).empty().appendTo(h)});if(b){var l=[],m=0,n=0;$(".page",h).each(function(){var a=$(this).offset(),b=$(this).outerWidth(),c=$(this).outerHeight();l.push({element:this,left:a.left,top:a.top,width:b,height:c})});$(document).on("touchmove",c).on("touchend",d)}else $(".page",h).mouseover(e).mouseout(f).mouseup(g)}
function Qk(a){function b(){var b=a.l(),c=a.j();a.Ib();d();b={elementIndex:a.s(),pageIndex:P(C,a.v()),cropIndex:a.Fd(),"new":{placeholderBox:a.U().serialize(),imageBox:a.Ja().serialize(),cropped:!0,left:a.l(),top:a.j()},old:{placeholderBox:g.serialize(),imageBox:f.serialize(),cropped:a instanceof Ae?h:!0,left:b,top:c}};Q(D,new R(yj,b));$("#overlays > .mask").removeClass("on");m.css("background-color","rgba(255, 255, 255, 0)");a.Ha();a.L();d();_gaq.push(["_trackEvent","Toolbar","Click - Crop OK"])}
function c(){a instanceof Ae?(g&&pb(a,g),a.eb(f),a.Ve=!1,e.removeClass("cropping")):(a.eb(f),a.Ib());$("#overlays > .mask").removeClass("on");m.css("background-color","rgba(255, 255, 255, 0)");a.Ha();a.L();d();_gaq.push(["_trackEvent","Toolbar","Click - Crop Cancel"])}function d(){$("#content").off("click",".crop .confirmationToolbarOk a",b).off("click",".crop .confirmationToolbarCancel a",c)}if(a.yb&&a.ye()){$("#content").on("click",".crop .confirmationToolbarOk a",b).on("click",".crop .confirmationToolbarCancel a",
c);var e=a.i,f=a.Ja(),g=a.U(),h=a.$b;$("#overlays > .mask").addClass("on");e.addClass("cropping");a.L();var l=$(".cropControls img.uncropped"),m=$(".cropControls .cropBox");l.css("opacity",0.5);m.css("background-color","rgba(255, 255, 255, 1)");Ke($(".cropControls"),a.qa())}}
function Ti(a,b,c,d){function e(a){return a.v?a.Q()*N+a.v().ga():a.ga()}function f(a){return a.v?a.V()*N+a.v().Z():a.Z()}function g(a,b,d){var e=null,f=null,g=[],h={bd:!1,r:!1,cy:!1,od:!1,b:!1,cx:!1},l=a.Fa(),m=a.Ca(),n=Infinity,p=Infinity,r=a.V(),q=a.Q(),u=a.Da(),w=a.Y(),ea=q+a.Ca()/2,xb=r+a.Fa()/2;b.forEach(function(b){function x(a,c){a=Math.abs(a);return a*N<=d&&a<=p?(p=a,f=c,g.push(b),!0):!1}function la(a,c){a=Math.abs(a);return a*N<=d&&a<=n?(n=a,e=c,g.push(b),!0):!1}if(void 0===c||-1<c.indexOf("LEFT"))h.bd|=
la(b.V()-r,b.V()),h.bd|=la(b.Da()-r,b.Da());if(void 0===c||-1<c.indexOf("RIGHT"))h.r|=la(b.V()-u,b.V()-a.Fa()),h.r|=la(b.Da()-u,b.Da()-a.Fa());if(void 0===c||-1<c.indexOf("UP"))h.od|=x(b.Q()-q,b.Q()),h.od|=x(b.Y()-q,b.Y());if(void 0===c||-1<c.indexOf("DOWN"))h.b|=x(b.Q()-w,b.Q()-a.Ca()),h.b|=x(b.Y()-w,b.Y()-a.Ca());var Fc=x(b.Bc()-ea,b.Bc()-a.Ca()/2);h.cx|=Fc;var ke=la(b.Qb()-xb,b.Qb()-a.Fa()/2);h.cy|=ke;if(Fc){var vj=c&&-1<c.indexOf("TOP"),Fc=vj?a.Y():a.Q();m=2*Math.abs(b.Bc()-Fc);vj&&(f-=(m-a.Ca())/
2)}ke&&(Fc=(ke=c&&-1<c.indexOf("LEFT"))?a.Da():a.V(),l=2*Math.abs(b.Qb()-Fc),ke&&(e-=(l-a.Fa())/2))});b=a.l()-a.V();var la=a.j()-a.Q();null!==e&&e>a.l()?e+=b:null!==e&&e<a.l()&&(e+=b);null!==f&&f>a.j()?f+=la:null!==f&&f<a.j()&&(f+=la);return{Wb:e,Xb:f,Ag:l,zg:m,nk:g,qb:h}}void 0===d&&(d=!0);var h=a.V(),l=a.Q(),m=g(a,b,5);void 0!==c&&null!=m.Wb&&null!=m.Xb&&(Math.abs(h-m.Wb)>Math.abs(l-m.Xb)?m.Xb=null:m.Wb=null);if(null!=m.Wb){if(void 0!==c){var n=m.Wb-h,p=m.qb.cy?m.Ag:a.g()-n;-1<c.indexOf("RIGHT")&&
(p=m.qb.cy?m.Ag:a.g()+n,m.Wb=h);h=a.g()/a.h();p=d?p/h:a.h()}!c&&a.S(m.Wb)}null!=m.Xb&&(void 0!==c&&(h=m.Xb-l,p=m.qb.cx?m.zg:a.h()-h,-1<c.indexOf("DOWN")&&(p=m.qb.cx?m.zg:a.h()+h,m.Xb=l),h=a.g()/a.h(),p=d?p*h:a.g()),!c&&a.P(m.Xb));if(null!=m.Wb||null!=m.Xb)m=g(a,b,1);$("#overlays .align").removeClass("on");b=m.nk;if(null!=m.Wb){d=Array.max(b.map(function(a){return a.Y()}).concat(a.Y()));var l=Array.min(b.map(function(a){return a.Q()}).concat(a.Q())),q=Math.abs(d-l)*N,u=Array.min(b.map(function(a){return e(a)}).concat(e(a)));
d=[];m.qb.bd&&d.push(f(a));m.qb.r&&d.push(f(a)+a.Fa()*N);m.qb.cy&&d.push(f(a)+a.Fa()/2*N);d.forEach(function(a,b){$("#overlays .vertical.align").eq(b).addClass("on").css("top",Math.round(u)).css("left",Math.round(a)).css("height",Math.round(q))})}if(null!=m.Xb){d=Array.max(b.map(function(a){return a.Da()}).concat(a.Da()));var l=Array.min(b.map(function(a){return a.V()}).concat(a.V())),r=Math.abs(d-l)*N,w=Array.min(b.map(function(a){return f(a)}).concat(f(a)));b=[];m.qb.od&&b.push(e(a));m.qb.b&&b.push(e(a)+
a.Ca()*N);m.qb.cx&&b.push(e(a)+a.Ca()/2*N);b.forEach(function(a,b){$("#overlays .horizontal.align").eq(b).addClass("on").css("top",Math.round(a)).css("left",Math.round(w)).css("width",Math.round(r))})}}function Yi(a){var b=[];void 0!==a&&(a instanceof U?b.push(a):a instanceof Array&&(b=a));a=0==b.length?T(C):b[0].v();var c=a.aa(),c=c.filter(function(a){return-1==b.indexOf(a)&&!a.ca()});c.push(a);return c}
function zl(){$("#dropZone").addClass("on");$(".mask").last().addClass("on");var a=$("#objectPanel");a.hasClass("stage4")||(a.data("previousStage",$("menu > li.on",a).index()),$("> menu .uploads a",a).trigger("touchClick"))}function Al(a){a.preventDefault();a.dataTransfer.dropEffect="copy"}function Cl(){Dl()}
function Dl(){function a(){$(this).removeClass("on off")}$("#dropZone").addClass("off").delay(300,a);$(".mask").last().addClass("off").delay(300,a);var b=$("#objectPanel"),c=b.data("previousStage");null!=c&&c!=$("#objectPanel > menu .uploads").index()&&$("> menu a",b).eq(c).trigger("touchClick");b.removeData("previousStage")}
function Bl(a){function b(){$(this).removeClass("on off")}a.preventDefault();a.stopPropagation();$("#dropZone").addClass("off").delay(300,b);$(".mask").last().addClass("off").delay(300,b);$("#objectPanel").removeData("previousStage");void 0!==a&&di(a);return!1}function jj(){$("body").removeClass("blockDocument")};$(function(){$(document).on("mouseover","a",function(){"#"==$(this).attr("href")&&$(this).removeAttr("href")});Zi&&(jQuery.event.props.push("touches"),jQuery.event.props.push("changedTouches"),$("html").addClass("touch"));sa=new gb;var a=$.get;pa=jg(function(){$("#objectPanel .content .facebookButton").prop("disabled",!1)});"ANON_VIEW"==window.accessMode&&(sa.get=function(){return new fb},sa.post=function(){return new fb},sa.Jg=function(){return new fb},a=k());ya=id();ua=new jd(sa);va=new vb(sa);
na=new rh(sa);ka=new Gh;ja=new Bk;oa=a=new bk(sa,a);wa=new sg(oa);I=tb();var b=new Rg;window.scrollTo(0,0);$(window).resize(Od).on("beforeunload",Yd);var c=window.csession,d=window.cdoc;if(d){(new nc(b,a)).go(d);Qj(c,d);var e=null;"EDIT"==window.accessMode&&fd(function(){e||(e=window.setTimeout(function(){e=null;lj()},3E4))},function(a){a&&(e&&window.clearTimeout(e),e=null,mj())});I&&ub(d.id)}Od();$("body").append($('<div id="blurOverlayPreloader"></div>'))});function El(){}El=Backbone.View.extend({el:"#canvaDocument"});El.prototype.events=function(){var a={};a["click #addNewPage"]=this.Sh;a.scroll=this.$j;a.mousemove=this.mousemove;a.mouseout=this.mouseout;a["click > .inner > .page"]=t(!1);a["mousedownTouchstart > .inner > .page"]=this.Kf;return a};El.prototype.remove=function(){this.undelegateEvents();this.stopListening();this.u.forEach(function(a){a.remove()})};
El.prototype.initialize=function(){this.listenTo(this.model,"page:add",this.Ij);this.listenTo(this.model,"page:remove",this.Kj);this.listenTo(this.model,"page:move",this.Jj);this.listenTo(this.model,"change:layout",this.render);this.listenTo(L,"pageView:copyButton:click",this.lh);this.listenTo(L,"pageView:deleteButton:click",this.lh);this.listenTo(L,"pageView:toolbar:mouseout",this.Lj);this.u=[];var a=this;this.model.n.forEach(function(b){a.u.push(new Rl({model:b}))});this.mb=this.Id=this.Aa=this.Xf=
0;this.cf=!1;this.render()};y=El.prototype;
y.render=function(){var a=this.$("> .inner"),b=this;this.u.forEach(function(c,d){c.render();a.append(c.$el);Sl(c,Tl(b,d));c.$el.addClass("on")});var c=this.u[this.u.length-1].$el,d=this.$("#addNewPage");d.css("top",Tl(this,this.u.length));d.insertAfter(c);this.$el.removeClass("multiPage hasMultiplePages");this.model.ha.multiPage&&(this.$el.addClass("multiPage"),1<this.model.n.length&&(this.$el.addClass("hasMultiplePages"),15<=this.model.n.length&&this.$("#addNewPage").addClass("off")));var c=Tl(this,
0),d=Ul(this),e=Wd();a.css("height",c+d+($(window).height()-e.G()));Vd(this);return this};y.Sh=function(a){a=$(a.currentTarget);if(a.is(":animated")||a.is(".off"))return!1;a=Kc(this.model);var b=a.serialize();b.pageIndex=P(this.model,a);Q(D,new qi(1,b));_gaq.push(["_trackEvent","Document","Click - Add New Page"]);return!1};
y.$j=function(){var a=this.el.scrollTop,b=Tl(this,0),c=Wd(),d=Jc(this.model),e=this.u[d].$el.offset(),f=this.Xf<a?"down":"up",g=null;L.trigger("documentView:scroll",a);this.Xf=a;Vl(this);clearTimeout(this.Id);if(!this.$el.hasClass("modifying")){d=$(window).height();if(bl>d/2)for(c=0;c<this.u.length-1;c++){g=b+c*(bl+cl);if(g<a){if(e=g+bl-a,0>=e){g=c+1;continue}}else e=a+d-g;g=e>a+d-(g+bl)?c:c+1;break}else"up"==f&&e.top+bl>c.G()?g=Math.floor((a+$(window).height()-(b-cl))/(bl+cl))-1:"down"==f&&0>e.top&&
(g=Math.ceil((a-b)/(bl+cl)));0==a?g=0:a>=this.$("> .inner").height()-this.$el.height()&&(g=this.model.n.length-1);null!=g&&(g=Math.min(this.model.n.length-1,g),g=Math.max(0,g),yc(this.model,g))}};y.mousemove=function(a){var b=void 0!==a.clientY?a.clientY:a.touches[0].clientY;Wd();var c=this;this.u.forEach(function(a){var e=a.B(),f=b+c.$el.scrollTop();f>e.j()&&f<e.G()?a.$el.addClass("pseudoHover"):a.$el.removeClass("pseudoHover")})};
y.mouseout=function(a){-1<$(a.relatedTarget||a.toElement).parents().addBack().index(this.$("> .inner"))||this.u.forEach(function(a){a.$el.removeClass("pseudoHover")})};
y.Kf=function(a){function b(a){var b=(void 0!==a.clientX?a.clientX:a.touches[0].clientX)-e;a=(void 0!==a.clientY?a.clientY:a.touches[0].clientY)-f;if(h||4<Math.abs(b)||4<Math.abs(a)){h||(h=!0,d.$el.addClass("dragging doNotAnimate"),yc(p,P(p,q)));for(var b=-1,c=0;c<m.length&&!(g+a<m[c]);c++)b++;0>b&&(b=0);Nc(p,q,b);b=a=g+a;a<x?(b=(x-a)/(x-w),b=2>=b?x-(x-a)*(1-b/4):w):a>z&&(b=(a-z)/(v-z),b=2>=b?z+(a-z)*(1-b/4):v);Sl(d,b)}return!1}function c(){l.off("mousemove|touchmove",b).off("mouseup|touchend",c);
if(h){d.$el.removeClass("doNotAnimate");var a=q.s(),e=Tl(r,a);d.$el.animate({top:e},Ka,"easeOutBack",function(){Sl(d,e);d.$el.removeClass("dragging")});Q(D,new qi(zj,{pageIndex:a,oldPageIndex:u}))}}if(!(0==$(a.target).parents(".pageToolbar").addBack(".pageToolbar").length||0<$(a.target).parents("a").addBack("a").length)){var d=null;this.u.forEach(function(b){b.$el.get(0)==a.currentTarget&&(d=b)});var e=void 0!==a.clientX?a.clientX:a.touches[0].clientX,f=void 0!==a.clientY?a.clientY:a.touches[0].clientY;
d.Z();var g=d.ga(),h=!1,l=new S($(document));l.on("mousemove|touchmove",b).on("mouseup|touchend",c);for(var m=[],n=0;n<this.u.length;n++)m.push(Tl(this,n)-bl/2);var p=this.model,q=d.model,u=P(p,q),r=this,w=Tl(this,-1),v=Tl(this,this.u.length),x=Tl(this,0),z=Tl(this,this.u.length-1);return!1}};
y.Kj=function(a,b,c){V();var d=this,e=this.u[c];1==a.n.length&&d.$el.removeClass("hasMultiplePages");clearTimeout(this.Id);this.Aa&&yc(a,Math.min(a.n.length-1,c));b={height:0,top:Tl(this,c)+this.mb*(bl+cl)};this.Aa&&c==a.n.length&&(b.top+=bl);this.$el.addClass("modifying");e.$el.addClass("removing").animate(b,{duration:500,Za:"easeOutSine",queue:!1,complete:function(){e.remove();d.$el.removeClass("modifying");d.Aa?Zi&&(d.Id=setTimeout(function(){Vl(d)},1E3)):Wl(d)}});this.u.splice(c,1);Xl(this,c);
this.$el.hasClass("holding")||Yl(this,c)};
y.Ij=function(a,b,c,d){15<=this.model.n.length&&this.$("#addNewPage").addClass("off");V();a=!0;!1===d&&(a=!1);d=P(this.model,b);c=b.h()*N;Math.round(50*N);var e=this.u[0];this.u.splice(d,0,new Rl({model:b}));var f=this.u[d];b=e.Z();var g=this,h=Tl(this,d,this.model.n.length-1);Zl(f,b,h+this.mb*(bl+cl));f.$el.addClass("on").css("height",0);clearTimeout(this.Id);this.Aa?yc(this.model,d-1):yc(this.model,d);0==d?f.$el.insertBefore(e.$el):f.$el.insertAfter(this.u[d-1].$el);g.$el.addClass("modifying");
var l=Tl(this,d);f.$el.animate({height:c,top:l},{duration:500,Za:"easeOutSine",queue:!1,complete:function(){Sl(f,l);g.$el.removeClass("modifying");g.Aa&&Zi&&(g.Id=setTimeout(function(){Vl(g)},1E3))}}).css("overflow","");this.$el.addClass("hasMultiplePages");Xl(this,d);a&&!this.$el.hasClass("holding")&&Yl(this,d)};
y.Jj=function(a,b,c,d){a=this.u[c];b=this.u[d];c<d?a.$el.insertAfter(b.$el):c>d&&a.$el.insertBefore(b.$el);this.u.splice(d,0,this.u.splice(c,1)[0]);c>d&&(a=c,c=d,d=a);for(;c<=d;c++){var e=this.u[c];if(!e.$el.hasClass("dragging")){var f=Tl(this,c);e.$el.animate({top:f},Ka,function(){Sl(e,f)})}}Yl(this,d)};y.lh=function(){this.Aa=this.Aa||this.model.n.length;this.$el.addClass("holding");15>=this.model.n.length&&this.$("#addNewPage").removeClass("off")};y.Lj=function(){Vl(this)};
function Vl(a){a.Aa&&!a.$el.hasClass("modifying")&&(a.Aa=0,a.mb=0,Xl(a,0,!0),a.$el.removeClass("holding"))}function Wl(a){if(!oc){var b=Wd(),c=a.u[0].B(),d=$l(a.u[0]),e;c.g()<=b.g()?(e=b.l()+Math.round((b.g()-c.g())/2),a.$("> .inner").css("width","")):(e=b.l()+b.g()/6,a.$("> .inner").css("width",e+d.g()+e));a.u.forEach(function(b,c){Zl(b,e,Tl(a,c))});d=$l(a.u[0]);a.$("#addNewPage").css("top",Tl(a,a.u.length)).css("left",d.l()).css("width",d.g())}}
function Tl(a,b,c){void 0===c&&(c=a.model.n.length);a.Aa&&(c=a.Aa);var d=Wd(),e=Math.round(50*N),f=a.model.ha.height*N;a=Ul(a,c);c=d.j();$("#editorLogo").outerHeight();oc?c=0:a<=d.h()&&(c+=(d.h()-a)/2);return c+(f+e)*b}function Ul(a,b){var c;void 0===b&&(b=a.model.n.length);void 0===c&&(c=al);a.Aa&&(b=Math.max(a.Aa,b));c=$k[c];var d=a.$("#addNewPage"),e=(b*a.model.ha.height+50*(b-1))*c;a.model.ha.multiPage&&!$("body").hasClass("blockDocument")&&(e+=50*c+d.outerHeight());return Math.round(e)}
function am(a,b){var c=Wd(),d=Ul(a);d>c.h()?(d=Tl(a,0)+d+(a.$el.height()-c.G()),bl>c.h()&&(d+=c.g()/6)):d=a.$el.height();b?a.$("> .inner").animate({height:d},{duration:500,Za:"easeOutSine",queue:!1}):a.$("> .inner").css("height",d)}
function Xl(a,b,c){void 0===b&&(b=0);void 0===c&&(c=0<a.Aa);am(a,c);var d=0;a.Aa&&b==a.model.n.length?(c=(a.mb||a.Aa)-b,a.mb!=c-1&&(c=a.mb+1,a.mb=b),d+=(bl+50*N)*c,a.mb=c):a.mb&&(c=a.mb,d+=(bl+50*N)*c);a.$("#addNewPage").animate({top:Tl(a,a.u.length)+d},{duration:500,Za:"easeOutSine",queue:!1});var e=a.el.scrollTop,f=e+a.$el.height();a.u.forEach(function(a,b){var c=Tl(this,b)+d,m=c+bl;!this.Aa&&!this.mb||m>e&&c<f?a.$el.addClass("transitioning").animate({top:c},{duration:500,Za:"easeOutSine",queue:!1,
complete:function(){Sl(a,c)}}):Sl(a,c)},a);setTimeout(function(){for(var b=0;b<a.u.length;b++)a.u[b].$el.removeClass("transitioning")},500)}
function Yl(a,b){b=Math.max(0,Math.min(a.u.length-1,b));var c=a.el.scrollTop;if(b==a.u.length-1)c=Wd(),c=Tl(a,a.model.n.length)+a.$("#addNewPage").height()-c.G();else{var d=Tl(a,b),e=d+bl,f=a.$el.height(),f=a.el.scrollTop+f;f<e?c+=e-f+30:a.el.scrollTop>e&&(c-=a.el.scrollTop-d+30)}a.cf||c==a.el.scrollTop||(a.cf=!0,a.$el.animate({scrollTop:c},500,"easeOutSine",function(){a.cf=!1}))}
function Vd(a){var b;void 0===b&&(b=T(a.model)||a.model.n[0]);var c=Wd(),d=al,e=a.u[b.s()];if(oc)d=$k.indexOf(1);else{var d=e.model.g(),f=e.model.h(),e=c.g()/d;C.ha.multiPage&&(e=(c.g()-$(".pageToolbar").outerWidth(!0))/d);C.ha.multiPage?(f+50)*e>c.h()-a.$("#addNewPage").outerHeight()&&(e=(c.h()-a.$("#addNewPage").outerHeight())/(f+50)):f*e>c.h()&&(e=c.h()/f);-1==Va.indexOf(Ud)&&(c=$k.indexOf(Ud),$k.splice(c,1));Ud=Math.min(e,1);for(c=$k.length-1;0<=c;c--)if(Ud<$k[c]){$k.splice(c+1,0,Ud);break}else if(Ud==
$k[c])break;d=$k.indexOf(Ud)}dl(a,d,b)}function Ql(a){for(var b=ia,c=0;c<b.u.length;c++)if(b.u[c].model==a)return b.u[c].B();return null}
function dl(a,b,c){void 0===c&&(c=T(a.model)||a.model.n[0]);a.$el.addClass("zooming");al=b;var d=N=$k[b];cl=Math.round(50*d);bl=Math.round(a.model.ha.height*d);L.trigger("documentView:zoom",b);Wl(a);am(a,!1);b=Wd();d=a.$("> .inner").width();c=$l(a.u[c.s()]);d>b.g()&&(d=Math.round(c.l()+c.g()/2),d=Math.round(d-b.l()-b.g()/2),c.g()<b.g()&&(d+=(b.g()-c.g())/2),a.el.scrollLeft=d);Ul(a)>b.h()&&(c=Math.round(c.j()+c.h()/2),a.Xf=a.el.scrollTop,a.el.scrollTop=Math.round(c-b.G()/2));a.model.aa().forEach(function(a){a.Ha()});
mh();a.$el.removeClass("zooming")};function Fl(){}Fl=Backbone.View.extend({el:"#editorControls"});
Fl.prototype.events=function(){var a={};a["focus #documentTitle input"]=this.Xi;a["blur #documentTitle input"]=this.Lh;a["keydown #documentTitle input"]=this.kj;a["mouseover #documentMenu li"]=this.xj;a["mouseout #documentMenu li"]=this.vj;a["touchClick #documentMenuUndo button"]=this.ai;a["touchClick #documentMenuExport button"]=this.Zh;a["touchClick #documentMenuPublish button"]=this.$h;a["touchClick #documentMenuHome a"]=this.Cg;a["touchClick #editorLogo"]=this.Cg;return a};
Fl.prototype.remove=function(){this.undelegateEvents();this.stopListening()};Fl.prototype.initialize=function(){this.listenTo(this.model,"change:title",this.ng);this.listenTo(C,"change",this.Ci);this.listenTo(L,"documentView:scroll",this.Di);this.listenTo(L,"documentView:zoom",this.Ei);this.listenTo(L,"session:sync",this.ek);this.render()};y=Fl.prototype;y.render=function(){this.ng();bm(this,$("#documentMenuExport, #documentMenuPublish"));return this};
y.Xi=function(){var a=this.$("#documentTitle input");if($("body").hasClass("blockDocument"))return a.blur(),!1;var b=this;a.removeData("unfocused").removeAttr("data-unfocused");this.cg();setTimeout(function(){b.$("#documentTitle input").select()},20);_gaq.push(["_trackEvent","Design Tools","Focus - Document Title"])};
y.Lh=function(a){a=$(a.currentTarget);a.val().match(/^\s*$/)?this.ng():$("body").hasClass("blockDocument")||(a=a.val().trim(),"Untitled design"==this.model.Ea()&&I&&I.track("design_title_change",{title:a,source:"typed"}),Ic(this.model,a));_gaq.push(["_trackEvent","Design Tools","Blur - Document Title"])};
y.kj=function(a){var b=$(a.currentTarget);a.which==ch?(b.get(0).blur(),_gaq.push(["_trackEvent","Design Tools","Keypress - Enter"])):a.which==dh?(Ic(this.model,this.model.Ea()),b.get(0).blur()):setTimeout(this.cg,20)};y.xj=function(a){$("#documentMenuExport button").css("background-color","transparent");bm(this,$(a.currentTarget))};y.vj=function(){bm(this,$("#documentMenuExport, #documentMenuPublish"))};
function bm(a,b){var c=a.$("#documentMenu"),d=c.offset(),e=c.find("> .marker"),d=b.offset().left-d.left;e.css("right",c.width()-d-b.width()).css("width",b.width())}y.Zh=function(){var a=this.model.ha;(new cm({Bi:a.width,Ai:a.height})).show($("body"))};
y.$h=function(){G.ic()?(alert("Your document contains some unsaved changes. Wait a few seconds for us to save the document, then try publishing again"),G.sync()):gd(function(a){a?(a=$("#documentMenuPublish"),a.addClass("rePublish"),a.find("a").text("Re-Publish")):alert("There was an error publishing your document. Wait a few seconds and try publishing again")})};y.ai=function(){$("#documentBlocker").hasClass("on")||qh()};
y.Cg=function(){/magicButton/gi.test(window.location.search.toString())&&I&&I.ae("minichallenge_leave");this.$el.off("mouseout","#documentMenu li")};
function dm(a,b){var c=a.outerHeight();a.addClass("preparing").css("height",c);var d=$(".content",a),e=d.outerHeight();d.one("transitionend",function(){$(this).remove()}).css("marginBottom",-e).addClass("replacing");b.appendTo(a).delay(20,function(){$(this).removeClass("new")});d=b.outerHeight();c=c+d-e;a.removeClass("preparing").css("height",c).css("top",($(window).height()-c)/2)}
y.cg=function(){var a=this.$("#documentTitle input");if(!a.data("unfocused")){var b=$('<div class="documentTitleDummy">'+_.escape(a.val())+"</div>");b.css("font-size",a.css("font-size")).appendTo("#limbo");a.css("width",b.outerWidth());b.remove()}};y.Ci=function(){0<D.Ba.length?this.$("#documentMenu").removeClass("undoDisabled"):(this.$("#documentMenu").addClass("undoDisabled"),bm(this,$("#documentMenuExport, #documentMenuPublish")))};y.Ei=function(){$("#zoomText").text(Math.round(1E3*N)/10+"%")};
y.Di=function(a){var b=this.$("#documentMenu");a?b.addClass("dark"):b.removeClass("dark")};y.ng=function(){this.$("#documentTitle input").val(this.model.Ea());this.cg();var a=$("title"),b=a.text(),b=b.match(/ \-[^\-]+$/)[0];a.text(this.model.Ea()+b)};
y.ek=function(a){var b=this.$("#editorLogo"),c=b.data("timer");c&&clearTimeout(c);(c=b.data("removeWaitingTimer"))&&clearTimeout(c);1===a?(b.removeClass("saved").addClass("saving"),b.data("removeWaitingTimer",setTimeout(function(){b.removeClass("waitingForSave")},1E3))):b.removeClass("waitingForSave").removeClass("saving").addClass("saved").data("timer",setTimeout(function(){b.removeClass("saved").addClass("waitingForSave")},5E3))};function em(){}em=Backbone.View.extend({});em.Eh=function(a){if(a instanceof Sg)return new fm({model:a});if("string"===typeof a&&-1<_.keys(Mf).indexOf(a))return new gm({model:a});throw new TypeError("Unknown galleryObject type: "+typeof a);};em.prototype.Q=function(){return this.$el.offset().top};em.prototype.Y=function(){return this.Q()+this.$el.height()};em.prototype.Qb=function(){return parseInt(this.$el.css("left"),10)+this.$el.width()/2};
function hm(a,b,c){var d=a.$el.data("originalTop");c?a.$el.css("top",d+b):a.$el.addClass("doNotTransition").css("top",d+b).removeClass("doNotTransition")}function fm(){}fm=em.extend({});fm.prototype.initialize=function(a){this.Le=this.model;!a.el&&this.render()};fm.prototype.render=function(){this.$el=jk(this.Le);this.$el.data("view",this);(this.Le.ec()===Ug||null==this.Le.brand&&null==Vg(this.Le))&&this.$(".info").remove();return this};function gm(){}
gm=em.extend({tagName:"li",className:"newSearch",template:_.template('<a href="#"></a>')});gm.prototype.initialize=function(a){this.Tg=this.model;this.aj=Mf[this.Tg];!a.el&&this.render();this.$el.data("view",this)};gm.prototype.render=function(){this.$el.html(this.template()).attr("data-grid-name",this.Tg);this.$("a").append(Of(this.aj.H));return this};function Kh(){}Kh=Backbone.View.extend({});Kh.prototype.initialize=function(a){var b=this;this.If=[];var c=new kk;this.listenTo(c,"results:didFetch",function(a,c,d){b.trigger("results:didFetch",a,c,d)});var d=new mk(new sk);c.ud(d);c=new im({model:c,el:this.$(".layer")});d=new jm({model:d,el:this.$(".browseCategories")});c.ja.push(d);this.If.push(c);!a.el&&this.render()};function Lh(){}
Lh=Backbone.View.extend({Mh:_.template('<div class="browseCategories hidden"><ul class="gallery photoGallery albumGallery categories"><li><a href="#" data-query="uploads" title="Uploads" class="uploads"><span class="page on"></span><span class="page on"></span><img src="/static/images/upload_folder_thumbnail.png" width="200" height="200" alt="Upload folder thumbnail"><span class="text">Uploads</span></a></li><li><a href="#" data-query="facebook" title="Facebook" class="facebook"><span class="page on"></span><span class="page on"></span><img src="/static/images/upload_folder_facebook.png" width="200" height="200" alt="Facebook folder thumbnail"><span class="text">Facebook</span></a></li></ul></div>'),ck:_.template('<div class="searchGroup"><ul class="gallery infoPanelGallery photoGallery"></ul></div>')});
Lh.prototype.events=function(){var a={};a["click .fileUploadButton"]=this.ei;a["click button.facebookButton"]=this.uk;return a};
Lh.prototype.initialize=function(a){this.If=[];this.xf=this.Tb=this.ze=!1;var b=$(this.Mh()),c=$(this.ck());this.$(".layer").find("> .inner").append(b).append(c);b=this.$(".uploadButtons");b.css("height",b.height());c=new kk;this.listenTo(c,"results:didFetch",this.Kb);b=new mk(new sk);c.ud(b);c=new im({model:c,el:this.$(".layer")});b=new jm({model:b,el:this.$(".browseCategories")});c.ja.push(b);this.If.push(c);!a.el&&this.render();km(this)};
Lh.prototype.Kb=function(a,b,c){var d=a.Ea()===this.$("a.facebook").attr("title");!d||this.Tb||c?d&&this.Tb&&!c&&0===a.Lc.length&&this.$(".noResults").text("Add some photos to your Facebook account to use them in your designs"):(d=$('<button class="facebookButton">Use Facebook photos</button>'),this.$(".noResults").text("Sign in to your Facebook account to use your photos in your designs").after(d));var d=a.Ea()===this.$("a.uploads").attr("title"),e=a.Lc.length===b.length;d&&e&&!c&&(d=$('<button class="fileUploadButton">Upload your own images</button>'),
d=$('<p style="text-align: center; padding-bottom: 1em;"></p>').append(d),this.$(".inlineFolderGroup").prepend(d),0===b.length&&this.$(".noResults").text("Upload your own images and use them in your designs"));this.trigger("results:didFetch",a,b,c)};
function km(a){function b(){d.Tb||d.xf?(d.$(".uploadButtons").addClass("hidden"),d.$(".browseCategories").removeClass("hidden")):(d.$(".uploadButtons").removeClass("hidden"),d.$(".browseCategories").addClass("hidden"));d.xf?d.$("a.uploads").trigger("mousedown"):d.Tb&&d.$("a.facebook").trigger("mousedown")}function c(){pa.vf()?(d.Tb=!0,b()):pa.Wc().done([function(){d.Tb=!0},b]).fail([function(){d.Tb=!1},b])}var d=a;a=Ah(0,1);Eh(a,function(a,f){d.xf=200===a&&f.media&&0<f.media.length;var g=0,h=window.setInterval(function(){pa.wb()===
eg&&(window.clearInterval(h),c());g++;5<g&&(window.clearInterval(h),d.Tb=!1,b())},500)})}Lh.prototype.ei=function(){$i();return!1};
Lh.prototype.uk=function(){function a(){rg();d.addClass("view").text("Use Facebook photos");c.ze=!1;if(c.$(".uploadButtons").hasClass("hidden"))c.$("a.facebook").trigger("mousedown"),setTimeout(function(){c.$("a.facebook").trigger("mousedown")},1.2*Da);else c.$(".uploadButtons").addClass("hidden").one("transitionend",function(){c.$(".browseCategories").removeClass("hidden").one("transitionend",function(){c.$("a.facebook").trigger("mousedown")})})}function b(){d.text("Use Facebook photos");c.ze=!1}
var c=this,d=this.$("button.facebookButton");0<this.$("li.folderExpanded .facebook").length&&this.Tb||this.ze||(this.ze=!0,I&&I.track("facebook_links"),d.removeClass("view").addClass("connecting").html('Authorizing<span class="loadingDot loadingDot1">.</span><span class="loadingDot loadingDot2">.</span><span class="loadingDot loadingDot3">.</span>'),kg().then(a).fail(b))};function Gl(){}Gl=Backbone.View.extend({tagName:"div",id:"overlays",template:_.template('<div class="mask"></div><div class="vertical align"></div><div class="vertical align"></div><div class="vertical align"></div><div class="horizontal align"></div><div class="horizontal align"></div><div class="horizontal align"></div><div class="rotation align"></div><div class="rotationGuide"></div></div>')});Gl.prototype.events=function(){return{}};
Gl.prototype.initialize=function(a){this.Lb=a.Lb;this.listenTo(this.model,"page:change:selected",this.render);a=_.bind(this.Jf,this);var b=_.bind(this.Kg,this),c=_.bind(this.Og,this);this.Lb.$el.on("mousedown",a);this.Lb.$el.on("touchstart",b);this.Lb.$el.on("touchend",c);this.$el.html(this.template());this.render();this.$el.prependTo(this.Lb.$("> .inner"))};y=Gl.prototype;
y.remove=function(){Backbone.View.prototype.remove.call(this);this.Lb.$el.off("mousedown",this.Jf);this.Lb.$el.off("touchstart",this.Kg);this.Lb.$el.off("touchsend",this.Og)};y.render=function(){Jc(this.model);T(this.model);this.model.aa().forEach(function(a){a.na&&a.L()});return this};y.Kg=function(){this.Yg=!0};y.Og=function(){this.Yg=!1};
y.Jf=function(a){function b(a){f||V();f=!0;var b=void 0!==a.clientX?a.clientX:a.touches[0].clientX,b=b-$("#canvaDocument").offset().left,b=b-g;a=(void 0!==a.clientY?a.clientY:a.touches[0].clientY)-h;0>b&&p.css("left",l+b);0>a&&p.css("top",m+a);p.css("display","").css("width",Math.abs(b)).css("height",Math.abs(a));$(u).each(Pl);_gaq.push(["_trackEvent","Document","Drag - Multiple Items Selection Begun"]);return!1}function c(){q.off("mousemove|touchmove",b).off("mouseup|touchend",c);$("#marquee").remove();
if(f){var a=C.ba();0==a.length?V():1==a.length?(V(),De(a[0])):(mh(),_gaq.push(["_trackEvent","Document","Drag - Multiple Items Selected"]))}}if(this.Yg||3==a.which||a.ctrlKey)return!0;var d=$(a.target).is("#content, #canvaDocument, #canvaDocument > .inner, .bg, .elements"),e=$(a.target).is(".elements .background.image.element, .elements .background.image.element img");if(!d&&!e||0<$(".dd-container.on").length)return!0;var f=!1,g=void 0!==a.clientX?a.clientX:a.touches[0].clientX,g=g-$("#canvaDocument").offset().left,
h=void 0!==a.clientY?a.clientY:a.touches[0].clientY,d=document.getElementById("canvaDocument"),l=g+d.scrollLeft,m=h+d.scrollTop,d=$(".textToolbarColor"),n=[];d.each(function(){null!=$(this).data("picker")&&n.push($(this).data("picker"))});if(0<n.length){for(e=0;e<n.length;e++)n[e].remove();d.removeData("picker")}else $(a.target).is("input")||$("*:focus").blur(),V();var p=$('<div id="marquee"></div>');p.css("display","none").css("left",l).css("top",m).appendTo(this.$el);var q=new S($(document));q.on("mousemove|touchmove",
b).on("mouseup|touchend",c);var u=$("#content .element");a.preventDefault()};function Rl(){}Rl=Backbone.View.extend({tagName:"section",className:"page",template:_.template('<div class="elements"></div><menu class="pageToolbar"><li class="pageToolbarUp <%= isFirst ? "disabled" : "enabled" %>"><a href="#" title="Move page up">Move page up</a></li><li class="pageToolbarDown <%= isLast ? "disabled" : "enabled" %>"><a href="#" title="Move page down">Move page down</a></li><li class="pageToolbarCopy <%= isPageNumMax ? "disabled" : "enabled" %>"><a href="#" title="Copy this page">Copy this page</a></li><li class="pageToolbarDelete <%= isFirst && isLast ? "disabled" : "enabled" %>"><a href="#" title="Delete this page">Delete this page</a></li><li class="pageNumber"><%= pageNumber %></li></menu>')});
Rl.prototype.events=function(){var a={};a.touchClick=this.ii;a["mousedownTouchstart > .elements"]=this.Kf;a["touchClick .pageToolbarUp.enabled"]=this.ti;a["touchClick .pageToolbarDown.enabled"]=this.si;a["touchClick .pageToolbarCopy.enabled"]=this.qi;a["touchClick .pageToolbarDelete.enabled"]=this.ri;a["mouseout .pageToolbar"]=this.wj;return a};
Rl.prototype.initialize=function(){this.ea=this.ia=0;var a=this.model.Ia;this.listenTo(this.model,"willchange",this.wi);this.listenTo(this.model,"change",this.vi);this.listenTo(this.model,"change:background",this.yg);this.listenTo(this.model,"change:selected",this.vh);this.listenTo(this.model,"element:add",this.Hi);this.listenTo(this.model,"element:remove",this.Ji);this.listenTo(this.model,"element:move",this.Ii);this.listenTo(a,"page:add",this.nf);this.listenTo(a,"page:remove",this.nf);this.listenTo(a,
"page:move",this.nf);this.listenTo(L,"documentView:zoom",this.Ng);this.render()};y=Rl.prototype;y.render=function(){var a=this.model.Ia,b=this.model.s();this.$el.html(this.template({pageNumber:b+1,isFirst:a&&0==b,isLast:a&&b==a.n.length-1,isPageNumMax:ia&&15<=ia.model.n.length}));this.Ng();this.vh(this.model);this.model.i=this.$el;this.yg();return this};y.Z=s("ia");y.ga=s("ea");function Sl(a,b){a.ea=b;a.$el.css("top",b)}function Zl(a,b,c){a.ia=b;a.ea=c;a.$el.css("left",b).css("top",c)}
y.Kf=function(a){function b(a){var b=(void 0!==a.clientX?a.clientX:a.touches[0].clientX)-e;a=(void 0!==a.clientY?a.clientY:a.touches[0].clientY)-f;!g&&(4<Math.abs(b)||4<Math.abs(a))&&(g=!0)}function c(){h.off("mousemove|touchmove",b).off("mouseup|touchend",c);g||0<d.ba().length||Lc(d).forEach(function(a){De(a)})}if(a.target===a.currentTarget||0!==$(a.target).parent(".element.background.image").addBack(".element.background.image").length){var d=this.model;if(!(0<d.ba().length)){var e=void 0!==a.clientX?
a.clientX:a.touches[0].clientX,f=void 0!==a.clientY?a.clientY:a.touches[0].clientY,g=!1,h=new S($(document));h.on("mousemove|touchmove",b).on("mouseup|touchend",c)}}};y.ii=function(a){if(!(0<$(a.target).parents(".pageToolbar").length)){a=this.model.Ia;var b=P(a,this.model);yc(a,b)}};y.ti=function(){var a=this.model.Ia;if(a){var b=this.model.s();1>b||(Nc(a,this.model,b-1),Q(D,new qi(zj,{pageIndex:b-1,oldPageIndex:b})))}};
y.si=function(){var a=this.model.Ia;if(a){var b=this.model.s();b>=a.n.length-1||(Nc(a,this.model,b+1),Q(D,new qi(zj,{pageIndex:b+1,oldPageIndex:b})))}};y.qi=function(){L.trigger("pageView:copyButton:click");var a=this.model.s(),b=this.model.clone();Nc(this.model.Ia,b,a+1);b=b.serialize();b.pageIndex=a+1;Q(D,new qi(1,b))};y.ri=function(){L.trigger("pageView:deleteButton:click");var a=this.model.s();this.model.remove();var b=this.model.serialize();b.pageIndex=a;Q(D,new qi(2,b))};
y.wj=function(a){0==$(a.relatedTarget||a.toElement).parents(".pageToolbar").addBack(".pageToolbar").length&&L.trigger("pageView:toolbar:mouseout")};y.wi=function(){this.Rd&&this.Rd.remove();this.Rd=this.$el.clone();this.Rd.addClass("doNotAnimate").insertAfter(this.$el)};y.vi=function(){var a=this;this.$el.one("animationend",function(){a.$el.addClass("on").css("opacity","");a.Rd.remove()}).css("opacity",1).removeClass("on").insertAfter(this.Rd)};
y.yg=function(){this.model.Ae()?this.$el.addClass("dark"):this.$el.removeClass("dark")};y.vh=function(a){a.Md()?this.$el.addClass("selected"):this.$el.removeClass("selected")};
y.Hi=function(a,b,c,d,e){function f(){V();var a=$(this);a.removeClass("dropping");De(b);a.hasClass("text")&&Il(a,!0)}if(c){c=b.i;c.one("animationend",f);var g=(a.g()-b.g())/2;a=(a.h()-b.h())/2;b.oa(g,a);c.addClass("dropping")}d&&(c=b.i,c.addClass("appearing"));d=b.i;void 0===e||e>=this.model.aa().length-1?d.appendTo(this.$("> .elements")):d.insertBefore(this.model.N[e+1].i);b.na=this.$el;b.Ha()};
y.Ji=function(a,b,c,d){var e=b.i;b.nb();d?e.addClass("disappearing").delay(Ca,function(){e.remove()}):e.remove()};y.Ii=function(a,b,c,d){a=this.$("> .elements > .element");d=Math.min(a.length-1,d);a=a.eq(d);b=b.i;c<d?b.insertAfter(a):c>d&&b.insertBefore(a)};
y.nf=function(){this.$(".pageNumber").text((this.model.s()+1).toString());this.$("li").removeClass("disabled").addClass("enabled");var a=this.model.Ia,b=this.model.s(),c=a&&0==b,a=a&&b==a.n.length-1;c&&this.$(".pageToolbarUp").removeClass("enabled").addClass("disabled");a&&this.$(".pageToolbarDown").removeClass("enabled").addClass("disabled");c&&a&&this.$(".pageToolbarDelete").removeClass("enabled").addClass("disabled");15<=ia.model.n.length&&this.$(".pageToolbarCopy").removeClass("enabled").addClass("disabled")};
y.Ng=function(){var a=this.model.h()*N,b=this.$(".pageToolbar");this.$el.css("width",this.model.g()*N).css("height",a);if(300<a){b.addClass("vertical");var c=a/2+ha+190;c>a?b.css("margin-top",+ha-(c-a)):b.css("margin-top","")}else b.removeClass("vertical").css("margin-top","")};y.B=function(){var a=this.$(".pageToolbar"),a=a.is(":visible")?Math.round(a.outerWidth(!0)):0;return new O(this.ia,this.ea,parseInt(this.$el.css("width"),10)+a,parseInt(this.$el.css("height"),10))};
function $l(a){return new O(a.ia,a.ea,parseInt(a.$el.css("width"),10),parseInt(a.$el.css("height"),10))};function cm(){}cm=Backbone.View.extend({id:"exportDialog",className:"dialogContainer",template:_.template('<div class="mask"></div><div class="dialog preparing"><h2><%= title %></h2><div class="content"></div><a class="close" href="#" title="Close this dialog">Close</a></div>')});
cm.prototype.events=function(){var a={};a["touchClick a.close"]=this.cancel;a["touchClick .mask"]=this.cancel;a["touchClick button.done"]=this.Ej;a["touchClick .export a"]=this.di;a["touchClick .share a"]=this.mi;a["submit .payment form"]=this.mk;a["touchClick .payment a.draft"]=this.bi;a["mousedown #exportErrorLink"]=this.tj;a["focus #exportErrorLink"]=this.Yi;a["keydown #exportErrorLink"]=this.lj;a["copy #exportErrorLink"]=this.xi;a["touchClick .share a.removeWatermark"]=this.ki;a["touchClick .share button.facebook"]=
this.ni;return a};cm.prototype.remove=function(){var a=this;this.$("> .mask").addClass("off");this.$("> .dialog").addClass("disappearing").delay(300,function(){for(var b in a.n)a.n[b].remove();Backbone.View.prototype.remove.call(a)});this.Sf.removeClass("dialogView");this.trigger("remove")};
cm.prototype.initialize=function(a){a=new O(0,0,a.Bi,a.Ai);Kb(a,new O(0,0,100,100));this.o={thumbWidth:a.g(),thumbHeight:a.h(),exportUrl:null,thumbnailUrl:"/static/images/spacer.gif",outputType:null,shareType:null,documentFilename:null,isDraft:!1,paymentCheckComplete:!1,paymentCheckError:!1,thumbnailCreationError:!1,errorMessage:null,billing:null,paymentMade:!1};this.n={Xj:new lm({model:this.o}),tk:new mm({model:this.o}),Qj:new nm({model:this.o}),mh:new om({model:this.o}),Uf:new pm({model:this.o}),
rf:new qm({model:this.o}),Li:new rm({model:this.o}),Dd:new sm({model:this.o}),Si:new tm({model:this.o}),Se:new um({model:this.o}),Jk:new vm({model:this.o})};this.K=this.n.Qj;G.ic()?(this.K=this.n.Xj,G.sync()):0<ja.Fc&&(this.K=this.n.tk);this.qh=0};y=cm.prototype;
y.render=function(){if(0==this.$(".content").length||this.$(".content").is(":empty"))this.K.render(),this.$el.html(this.template({title:this.K.fb(this.o)})),this.$(".content").append(this.K.$el);else{var a=$('<div class="content new">'),b=this;this.$el.queue("pageQueue",function(){b.K.render();b.$(".dialog > h2").html(b.K.fb(b.o));a.append(b.K.$el);dm(b.$("> .dialog"),a);setTimeout(function(){b.qh--;b.$el.dequeue("pageQueue")},1E3)});1==++this.qh&&this.$el.dequeue("pageQueue")}return this};
y.mi=function(a){if(!this.o.outputType&&!this.o.shareType){a=$(a.target);if(a.parents("li").hasClass("facebook"))this.o.shareType="facebook";else{if(a.parents("li").hasClass("twitter"))return!0;a.parents("li").hasClass("pinterest")&&(this.o.shareType="pinterest")}this.K=this.n.Se;this.render();_gaq.push(["_trackEvent","Publish Dialog","Click - Share "+this.o.shareType])}};
y.di=function(a){function b(){e.o.paymentCheckComplete?c():setTimeout(b,1E3)}function c(){var a=e.o.billing;e.o.paymentCheckError||e.o.thumbnailCreationError?(e.K=e.n.Dd,e.render()):a&&0<Db(a)?(e.K=e.n.mh,e.render()):0<Cb(a).length?e.Qd(a,void 0,d):(wm(e,ld),e.K=e.n.rf,e.render())}function d(){e.K=e.n.Dd;e.render()}if(!this.o.outputType&&!this.o.shareType){var e=this;a=$(a.target).parents("li");a.hasClass("image")?this.o.outputType=md:a.hasClass("pdf")&&(this.o.outputType="PDF");if(this.o.paymentCheckComplete)c();
else{this.K.$(".subContent > *:not(.export)").add(a.siblings()).each(function(){$(this).animate({opacity:0},500)});this.K.$(".subContent").css("border",0);a.find("img.on").addClass("selected");var f=this.$("> .dialog"),g=f.offset(),h=a.offset(),l=g.left+(f.outerWidth()-a.outerWidth(!0))/2,f=g.top+(f.outerHeight()-a.outerHeight(!0))/2;a.animate({left:l-h.left,top:f-h.top},500,function(){setTimeout(b,1E3)})}_gaq.push(["_trackEvent","Publish Dialog","Click - Export "+this.o.outputType])}};
y.mk=function(a){function b(a,b){b.error?(d.o.errorMessage=b.error.message,d.K=d.n.Uf,d.render(),I&&I.track("payment_method_register",{status:"failure",type:"credit_card"})):(I&&I.track("payment_method_register",{status:"success",type:"credit_card"}),e=wb(b.id,function(a,b){200==a?d.Qd(f):(d.o.errorMessage=b,d.K=d.n.Uf,d.render())}))}function c(){e&&e.cancel();e=null;d.off("remove",c)}var d=this,e=null;a.preventDefault();a=$(a.target);a.find("input, button").prop("disabled",!0);a.find("button[type=submit]").text("Paying...").addClass("disabled");
var f=this.o.billing;0<Db(f)&&f.creditBalance<Db(f)&&null==f.creditCard?(a={number:this.$("#ccNumber").val(),cvc:this.$("#cvc").val(),exp_month:this.$("#expMonth").val(),exp_year:"20"+this.$("#expYear").val()},Stripe.createToken(a,b)):this.Qd(f);this.on("remove",c)};
y.Qd=function(a,b,c){function d(a){f.o.paymentMade=!0;f.o.billing=a;f.o.shareType?f.K=f.n.Se:(wm(f,ld),f.K=f.n.rf);f.render()}function e(){f.K=f.n.Uf;f.render()}var f=this,g=G.id(),h={};b=b||d;c=c||e;Cb(a).forEach(function(a){var b=a.media;a=a.version;h[b]=h[b]||[];b=h[b];-1==b.indexOf(a)&&b.push(a)});var l=Cb(a).length;a=Db(a);I&&I.track("license_purchase",{quantity_new_items:l,value_new_items:a});va.Qd(g,h,function(a,d){200==a?0<Db(d)?c():b(d):c()})};
y.bi=function(){this.o.shareType?this.K=this.n.Se:(this.o.isDraft=!0,wm(this,kd),this.K=this.n.rf);this.render()};
y.ni=function(){function a(a){d.$(".share button.facebook").text("Publishing...");var b=G.id(),g=G.Nc();a=new qd(a.t(),a.td,d.$("div.share textarea").val());ua.yd(b,g,kd,md,c,a)}function b(){d.$(".share button.facebook").prop("disabled",!1).text("Share").removeClass("disabled");alert("Failed to link your Facebook account to your Canva account. This is most likely due to your Facebook account already being linked to another Canva account.")}function c(a){d.K=200==a?d.n.Si:d.n.Dd;d.render()}var d=this;
this.$(".share button.facebook").prop("disabled",!0).text("Authorizing...").addClass("disabled");this.o.outputType=md;I&&I.track("design_publish",{format:this.o.outputType,watermark:0<$(".removeWatermark").length,destination:"facebook"});pa.Ge(["publish_actions"]).then(function(){rg().then(a).fail(b)}).fail(b)};y.ki=function(){this.K=this.n.mh;this.render()};
function xm(a,b,c){function d(){g&&g.cancel();g=null;e.off("remove",d)}var e=a,f=G.id(),g=va.te(f,function(a,d){200==a?(e.o.billing=d,b&&b(!!d)):c(a);e.o.paymentCheckComplete=!0});a.on("remove",d)}
function wm(a,b,c,d){function e(){p&&p.cancel();p=null;h.off("remove",e)}function f(a){h.nd(a)}function g(a){h.K=h.n.Dd;h.render();var b=$("#exportErrorLink").val(),b=b+(b.match(/#/)?"&":"#"),b=b+("jobId="+a);$("#exportErrorLink").val(b).select()}var h=a,l=G.id(),m=G.Nc(),n="THUMBNAIL"==b?md:a.o.outputType;c=c||f;d=d||g;var p=ua.yd(l,m,b,n,function(a,b){200==a?c(b):h.$("> .dialog").hasClass("disappearing")||(e(),d(b))},null);a.on("remove",e)}
y.nd=function(a,b,c){function d(){n=!0;u&&u.cancel();u=null;clearTimeout(p);q.off("remove",d)}function e(){clearTimeout(p);u=ua.ue(G.id(),a,!0,f);n||(m=Math.min(l,1.4*m),p=setTimeout(function(){u.cancel();!n&&e()},m))}function f(a,e){if(e)if(e.jg==nd)b&&b(e.lg),d();else{if(e.jg==od||e.jg==pd)c(e&&e.lg),d()}else n||(c(e&&e.lg),d())}function g(a){q.o.exportUrl=a;q.o.documentFilename=C.Ea()+(q.o.isDraft?" [DRAFT]":"")+"."+q.o.outputType.toLowerCase();q.K=q.n.Li;q.render();1>$("#canvaDownloadIframe").length&&
$("<iframe />",{id:"canvaDownloadIframe"}).appendTo("body");$("#canvaDownloadIframe").attr("src",a);I&&I.track("design_publish",{format:q.o.outputType,watermark:"no",destination:"download"})}function h(b){q.o.errorMessage=b;q.K=q.n.Dd;q.render();b=$("#exportErrorLink").val();b+=b.match(/#/)?"&":"#";b+="jobId="+a;$("#exportErrorLink").val(b).select()}var l=15E3,m=1E3,n=!1,p=null,q=this,u=null;b=b||g;c=c||h;e();this.on("remove",d)};
y.show=function(a){function b(){c.o.thumbnailCreationError=!0}var c=this;this.Sf=a;this.Sf.addClass("dialogView");this.render();this.$el.appendTo(this.Sf);this.$("> .dialog").css("top",($(window).height()-this.$("> .dialog").outerHeight())/2).delay(20,function(){$(this).removeClass("preparing")});this.$("> .mask").addClass("on");xm(this,function(a){a&&c.o.shareType&&c.K==c.n.Se&&ym(c.K)},function(){c.o.paymentCheckError=!0});wm(this,"THUMBNAIL",function(a){c.nd(a,function(a){c.o.thumbnailUrl=a;c.$("img.outputThumbnail").attr("src",
a)},b)},b)};y.cancel=function(){this.remove();_gaq.push(["_trackEvent","Publish Dialog","Cancel - "+this.K.className])};y.Ej=function(){this.remove();_gaq.push(["_trackEvent","Publish Dialog","Done - "+(this.o.shareType||this.o.outputType)+" "+this.K.className])};function zm(){}zm=Backbone.View.extend({});zm.prototype.render=function(){this.$el.html(this.template(this.model));return this};function lm(){}lm=zm.extend({className:"error savingError",fb:_.template("Unable to publish"),template:_.template('<div class="exporting error"><p>Your document contains some unsaved changes. Wait a few seconds for Canva to save the document, then try publishing again.</p><p class="buttonContainer"><button class="done">OK</button></p></div>')});
function mm(){}mm=zm.extend({className:"error uploadingError",fb:_.template("Unable to publish"),template:_.template('<div class="exporting error"><p>Some of your uploads are still being processed by our servers. Please wait a minute or two then try publishing again.</p><p class="buttonContainer"><button class="done">OK</button></p></div>')});function nm(){}
nm=zm.extend({className:"publishSelect",fb:_.template("&nbsp;"),template:_.template('<div class="subContent"><h2>Share</h2><menu class="share"></menu></div><div class="subContent"><h2>Publish</h2><menu class="export"></menu></div>'),wh:_.template('<li class="<%= service.toLowerCase() %>"><a href="<%= link %>" <%= link == \'#\' ? \'\' : \'target="_blank"\' %>><img src="https://di8vc3anm8wl1.cloudfront.net/static/images/publish_icon_<%= service.toLowerCase() %>.png" /><img class="on" src="https://di8vc3anm8wl1.cloudfront.net/static/images/publish_icon_<%= service.toLowerCase() %>_on.png" /><span><%= service %></span></a></li>'),
ik:_.template('<li class="shareLink">Or link: <input type="text" value="<%= href %>" /></li>'),Ki:_.template('<li class="<%= name.toLowerCase() %>"><a href="#"><img src="/static/images/publish_icon_<%= name.toLowerCase() %>.png" /><img class="on" src="/static/images/publish_icon_<%= name.toLowerCase() %>_on.png" /><span><span class="type"><%= name %></span><span class="description"><%= description %></span></span></a></li>')});
nm.prototype.render=function(){var a=[{name:"Image",description:"Wonderful for the web"},{name:"PDF",description:"Perfect for printing"}],b=$("body").hasClass("viewMode")&&!$("body").hasClass("viewModeLoggedIn")?["Twitter"]:["Facebook","Twitter"];this.$el.html(this.template(this.model));var c=this;b.forEach(function(a){"Twitter"==a?c.$(".share").append(c.wh({service:a,link:"https://twitter.com/share?url=+&text=Take+a+look+at+my+new+Canva+creation!+"+encodeURIComponent(ml())})):c.$(".share").append(c.wh({service:a,
link:"#"}))});b=ml();c.$(".share").append(c.ik({href:b}));$("body").hasClass("viewMode")&&!$("body").hasClass("viewModeLoggedIn")?c.$(".export").replaceWith('<p id="publishNotLoggedIn"><a href="#">Sign up</a> or <a href="#">log in</a> to publish this design as an image or PDF.</p>'):a.forEach(function(a){c.$(".export").append(c.Ki(a))});c.$(".shareLink input").on("mousedown",function(){$(this).trigger("focus");return!1}).on("focus",function(){var a=this;this.select();if(G.Bd()){var b=$("#shareLinkPopup");
0>=b.length&&G.Bd()&&(b=$('<label id="shareLinkPopup" for="editLinkCheckbox"><input id="editLinkCheckbox" type="checkbox" /> Allow anyone to edit with this link</label>'),b.appendTo("body"),$(a).data("editLink")&&(b.find("input").get(0).checked=!0),b.on("mousedown",t(!1)).on("click",function(a){if(a.target==a.currentTarget)return a=b.find("input[type=checkbox]").get(0),a.checked=a.checked?!1:!0,$(a).trigger("change"),!1}),b.find("input[type=checkbox]").on("change",function(){function b(a,c){function d(){var b=
c.substring(0,Math.floor(f/e));b.length==c.length||a.get(0).scrollWidth>g?a.val(c).select():(b+=String.fromCharCode(Math.floor(27*Math.random())+65),a.val(b),f++,setTimeout(d,50))}var e=1;a.val("");var f=7*e,g=a.width();d()}this.checked?(b($(a),ll()),$(a).data("editLink",!0)):(b($(a),ml()),$(a).removeData("editLink"))}));var c=$(this),g=c.offset();b.css("width",c.outerWidth()).css("left",g.left).css("top",g.top+c.height())}}).on("blur",function(){$("#shareLinkPopup").remove()}).on("keydown",function(a){return a.metaKey||
a.ctrlKey||a.which==dh?!0:!1}).bind("copy",function(){I&&I.track("design_copy_share_link")});return this};function qm(){}qm=zm.extend({className:"exporting",fb:_.template('Preparing your <%= outputType == "PNG" ? "Image" : outputType %>&hellip;'),template:_.template('<div class="progress"><span class="progressValue" style="width: 15%;"><span class="text">15%</span><span class="inner"></span></span></div><p>You\'re able to publish this design free of charge because you\'ve used only free Canva elements and your own images. If you <em>do</em> end up using any of Canva\'s premium elements they\'re just $1 apiece!</p>')});
qm.prototype.render=function(){this.$el.html(this.template(this.model));var a=this.model.billing;if(a&&!this.model.isDraft){var b=Eb(a);null!==Eb(a)&&(this.$el.find(".progress").nextAll().remove(),a=(b+864E5-Date.now())/36E5,b=Math.round(60*(a%1)),b=1>a?_.pluralize("minute",b):_.pluralize("hour",Math.round(a)),this.$el.append("<h3>You have purchased images using a One-Time Use License</h3>"),24>Math.round(a)?this.$el.append("<p>You've still got "+b+" to make changes and export this design. If you want to make changes to your design after this time, you will need to re-purchase the paid images.</p>"):
this.$el.append("<p>This license gives you 24 hours to make any changes and export your design without watermarks. If you want to make changes to your design after this time you will need to re-purchase the images.</p>"))}else a&&this.model.isDraft&&(this.$el.find(".progress").nextAll().remove(),this.$el.append("<p>You are downloading a watermarked preview of your design. To remove the watermarks from your premium elements it costs just $1 apiece!</p>"));this.$(".progressValue").delay(600,function(){$(this).css("width",
"45%").children(".text").text("45%").parent().delay(4800,function(){$(this).css("width","67%").children(".text").text("67%").parent().delay(4800,function(){$(this).css("width","95%").children(".text").text("95%")})})});return this};function sm(){}
sm=zm.extend({className:"exporting error",fb:_.template("Publishing hit a snag"),template:_.template('<p>Our publishing elves ran into a problem while assembling your design. Try and publish your design again and if you still get an error then send an email to <a href="mailto:support@canva.com" target="_blank">support@canva.com</a> and include this link:</p><p><input id="exportErrorLink" type="text" value="'+window.location.href+'" /></p><p class="buttonContainer"><button class="done">OK</button></p>')});
sm.prototype.render=function(){var a=this;this.$el.html(this.template(this.model));setTimeout(function(){a.$("#exportErrorLink").focus()},20);return this};cm.prototype.tj=function(a){$(a.target).trigger("focus");return!1};cm.prototype.Yi=function(a){$(a.target).select()};cm.prototype.lj=function(a){return a.metaKey||a.ctrlKey?!0:!1};cm.prototype.xi=function(){I&&I.track("export_error_link")};function tm(){}
tm=zm.extend({className:"facebook export in-progress",fb:_.template("Publishing to your Facebook timeline"),template:_.template('<h3>Publishing in progress</h3><p>The Canva servers are pushing your design to Facebook. This may take a couple of minutes to appear in your Facebook timeline but you can continue using Canva in the meantime.</p><p class="buttonContainer"><button class="done">OK</button></p>')});function rm(){}
rm=zm.extend({className:"exporting complete",fb:_.template('Your <%= outputType == "PNG" ? "Image" : outputType %> is ready!'),template:_.template('<p>Your browser should automatically save your exported design, but if not, click this button:</p><p class="downloadButton"><a class="button" href="<%= exportUrl %>" target="_blank" download="<%= documentFilename %>">Download my design</a></p>')});function om(){}
om=zm.extend({className:"payment",fb:_.template("Pay for your premium images"),template:_.template('<section class="info"><img class="outputThumbnail" width="<%= thumbWidth %>" height="<%= thumbHeight %>" src="<%= thumbnailUrl %>" /><p style="width: -webkit-calc(100% - 1.5em - <%= thumbWidth %>px); width: calc(100% - 1.5em - <%= thumbWidth %>px);">You can edit and publish your design without watermarks on these images for the next <strong>24 hours</strong>. This design can be used for <strong>personal</strong> or <strong>commercial</strong> use. <a href="http://www.canva.com/contribute/licence/onetime/" target="_blank">See the license</a>. (Or you can <a class="draft" href="#"><span class="draftVerb">download</span> a watermarked draft</a>)</p></section><section class="itemList"><table></table></section><section class="total"><p class="amount">Total: $<%= billing.totalCost.toFixed(2) %></p></section>'),hj:_.template('<tr class="license"><td class="thumbnail"><div class="inner"><img class="off" src="<%= thumbnail %>" /></div></td><td class="info"><span class="title"><%= title %></span><span class="by"><%= contributorName %></span><td class="price"><span><%= price > 0 ? "$" + price.toFixed(2) : "Free" %></span></td></tr>'),
Oh:_.template('<form id="ccForm"><p class="creditBalance"><span>Credit remaining: $<%= billing.creditBalance.toFixed(2) %><br/></span> <span>We\'ll charge $<%= (billing.totalCost - billing.creditBalance).toFixed(2) %> to your credit card.</span></p><div class="ccNumber"><label for="ccNumber">Credit card number</label><input id="ccNumber" name="ccNumber" placeholder="1234 5678 1234 5678" pattern="[0-9 -]{13,19}" type="text" maxlength="19" autocomplete="off" required autofocus /></div><div class="expiry"><label for="expMonth">Expiry date</label><input id="expMonth" name="expMonth" placeholder="MM" type="text" pattern="[01]?[0-9]" maxlength="2" autocomplete="off" required /> / <input id="expYear" name="expYear" placeholder="YY" type="text" pattern="[0-3][0-9]" maxlength="2" autocomplete="off" required /></div><div class="cvc"><label for="cvc">CVC</label><input id="cvc" name="cvc" placeholder="123" type="text" pattern="[0-9]{3,4}" maxlength="4" autocomplete="off" required /></div><p class="buttonContainer"><button type="submit">Make payment</button></p></form>'),
Nh:_.template('<form class="ccKnown"><p><span class="creditBalance">Credit remaining: $<%= billing.creditBalance.toFixed(2) %><br/></span> <span>We\'ll charge $<%= (billing.totalCost - billing.creditBalance).toFixed(2) %> to your credit card<br/>XXXX-XXXX-XXXX-<%= billing.creditCard %></span></p><p class="buttonContainer"><button type="submit">Confirm payment</button></p></form>'),yi:_.template('<form class="useCanvaCredits"><p>Credit remaining: $<%= billing.creditBalance.toFixed(2) %></p> <p class="buttonContainer" id="payBtn"><button type="submit">Confirm payment</button></p></form>')});
om.prototype.render=function(){function a(){var a=c.find(".thumbnail > .inner").first(),a=new O(0,0,a.width(),a.height()),b=new O(0,0,this.naturalWidth,this.naturalHeight);this.src.match(/\.png$/)?Kb(b,a):Jb(b,a);$(this).css(b.serialize()).removeClass("off").attr("data-scaled","true")}var b=this.model.billing;b.totalCost=Db(b);this.$el.html(this.template(this.model));0<b.paidItems.length?this.$(".payCount").text(Cb(b).length.toString()+" out of "+(b.paidItems.length+b.newItems.length).toString()+
" elements"):this.$(".payCount").text(_.pluralize("element",Cb(b).length));this.$(".draftVerb").text(this.model.shareType?"share":"download");var c=this.$(".itemList table"),d=this.hj;Cb(b).forEach(function(a){c.append(d(a))});setTimeout(function(){var b=c.find(".thumbnail img");b.attr("data-scaled",!1).one("load",a);b.each(function(){this.complete&&!$(this).data("scaled")&&a.call(this)})},20);0<Db(b)&&b.creditBalance<Db(b)?null==b.creditCard?this.$el.append(this.Oh(this.model)):this.$el.append(this.Nh(this.model)):
this.$el.append(this.yi(this.model));0==b.creditBalance&&this.$(".creditBalance").hide();return this};function pm(){}pm=zm.extend({className:"payment error",fb:_.template('Pay for <%= outputType == "PNG" ? "an image" : "a printable PDF" %>'),template:_.template('<h3>Oops!</h3><p>We cannot process the payment. Please check your payment details.</p><p class="buttonContainer"><button class="done">OK</button></p>')});
pm.prototype.render=function(){this.$el.html(this.template(this.model));this.model.errorMessage&&$('<p class="error">'+this.model.errorMessage+"</p>").insertBefore(this.$(".buttonContainer"));return this};function um(){}um=zm.extend({className:"share",fb:_.template('<span class="<%= shareType %>">Share on <span class="brand"><%= shareType %></span></span>'),template:_.template('<div class="thumbnail"><img class="outputThumbnail" width="<%= thumbWidth %>" height="<%= thumbHeight %>" src="<%= thumbnailUrl %>" /></div><textarea style="width: -webkit-calc(100% - 1.5em - <%= thumbWidth %>px); width: calc(100% - 1.5em - <%= thumbWidth %>px);"></textarea><p class="buttonContainer"><button class="share <%= shareType %>">Share</button></p>')});
um.prototype.render=function(){this.$el.html(this.template(this.model));this.model.billing&&this.model.billing.newItems&&!this.model.paymentMade&&ym(this);return this};function ym(a){$('<a class="removeWatermark" href="#">Remove the watermark</a>').css("width",a.model.thumbWidth).appendTo(a.$("> .thumbnail")).delay(20,function(){$(this).addClass("on")})}function vm(){}
vm=zm.extend({className:"backgroundTask error",fb:_.template("Oh no, something strange happened&hellip;"),template:_.template('<p>Our publishing elves ran into a problem while assembling your design. Try and publish your design again and if you still get an error then send an email to <a href="mailto:support@canva.com" target="_blank">support@canva.com</a> and include this link:</p><p><input id="exportErrorLink" type="text" value="'+window.location.href+'" disabled="disabled" /></p><p class="buttonContainer"><button class="done">OK</button></p>')});function Oh(a,b){this.Ie=a;this.jc=b;this.Qf=!1;this.Tc={};this.Ec=null;this.ka=$('<div class="paletteToolbarWrapper"></div>');this.rd=Qb("#c0c0c0");this.Pa=this.Rc=null;this.la=$('<menu class="paletteToolbar scrollPane"><menu>');this.Ie.append(this.ka);this.ka.append(this.la);Am.push(this);Bm(this)}Oh.prototype.listenTo=Backbone.Events.listenTo;Oh.prototype.stopListening=Backbone.Events.stopListening;_.extend(Oh.prototype,Backbone.Events);var Am=[];
function kc(){var a=Am.filter(function(a){return!a.ka.hasClass("static")});a.forEach(function(a){a.close();a.Tc=[];$(document).off("mousedown",a.zd);a.cb&&a.cb.off&&a.cb.off();a.ka.remove()});Am=Am.filter(function(b){return-1===a.indexOf(b)})}function Bm(a){a.listenTo(a.jc,"paletteEntry:add",a.render);a.listenTo(a.jc,"paletteEntry:remove",a.render)}function Cm(a){a.stopListening(a.jc,"paletteEntry:add",a.render);a.stopListening(a.jc,"paletteEntry:remove",a.render)}
Oh.prototype.on=function(a,b){this.Tc[a]=b};
function Rk(a,b){a.Ec=b;var c;c=a.ka;var d=b.offset(),e=$("#canvaDocument").get(0).scrollLeft,f=$("#canvaDocument").get(0).scrollTop,g=$("#canvaDocument").offset(),h=e+d.left-g.left,l=f+d.top-20-c.outerHeight(),m=Wd(),n=1;l-f<m.j()&&(h=e+d.left+b.outerWidth()+20-g.left,l=f+d.top+b.outerHeight()-c.outerHeight(),n=3,l-f<m.j()&&(l=m.j()+f),h-e+c.outerWidth()>m.W()&&(h=e+d.left-20-c.outerWidth()-g.left,n=0,h-e<m.l()||l-f<m.j()))&&(h=e+d.left-g.left,l=f+d.top+b.outerHeight()+20,n=2,l-f+c.outerHeight()>
m.G()&&(l=f+m.G()-c.outerHeight()));c.css("left",h).css("top",l);c=n;0===a.Ie.parents("#canvaDocument").length&&(d=$("#canvaDocument"),e=parseInt(a.ka.css("left"),10),f=parseInt(a.ka.css("top"),10),g=d.offset(),a.ka.css("left",e+g.left-d.scrollLeft()),a.ka.css("top",f+g.top-d.scrollTop()));return c}function Dm(a,b){a.Rc=b}function Em(a,b){b&&(a.rd=b,a.Mc=b,a.Tc.select&&a.Tc.select(b))}
function Mh(a,b){var c;if(a.Mc)b=a.Mc,c=new Rb(a.Mc.color);else if(b)c=new Rb(b.color);else return;Cm(a);Bc(a.jc,c);Bm(a);a.Tc.confirm&&a.Tc.confirm(b)}function Nh(a){a.Pa&&(a.la.find(".notChanged").remove(),a.Rc&&a.Rc.removeData("picker"),a.Pa.element.remove(),Fm(a,!0),a.Pa=null,a.la.focus())}
function Fm(a,b){if(null!==a.Ec){var c=a.la.find("li").length,c=Math.ceil(c/4);4<c&&(c=4);var d=parseInt(a.ka.css("top").replace(/px/gi,""),10),e=parseInt(a.ka.css("height").replace(/px/gi,""),10),f=56*c,d=d+(e-f);b?(a.ka.animate({top:d+"px",height:f+"px"},500,function(){var b=a.ka.find(".scrollBar").data("canvaScrollBar");b&&dk(b)}),a.la.animate({scrollTop:a.la.get(0).scrollHeight},500)):(a.ka.css("height",56*c+"px"),a.Ec&&Rk(a,a.Ec),a.la.scrollTop(a.la.get(0).scrollHeight),(c=a.ka.find(".scrollBar").data("canvaScrollBar"))&&
dk(c))}a.cb.show().focus()}
function Gm(a,b,c,d){function e(a){function e(){$(document).off("mousemove",l);$(document).off("mouseup",m)}function l(a){var d=a.pageX;a=a.pageY;null==q&&!n&&(4<=Math.abs(d-r)||4<=Math.abs(a-w))&&(q=b.clone(),q.addClass("paletteToolbarCloneItem"),$("body").append(q),q.css("top",u.top+"px").css("left",u.left+"px"));null!=q&&(b.css("visibility","hidden"),q.show().css("margin-top",a-w+"px").css("margin-left",d-r+"px"),d<p.left-20||d>p.right+20||a<p.top-20||a>p.bottom+20)&&(e(),q.remove(),b.remove(),
d=f,a=new Rb(c.color),Cm(d),Cc(d.jc,a),Bm(d),f.cb.show(),Fm(f,!0))}function m(a){var g=a.pageY;a=4<=Math.abs(a.pageX-r)||4<=Math.abs(g-w);e();q&&(q.remove(),b.css("visibility","visible"));c&&!a&&(f.Mc=c,Em(f,c),Mh(f,c));c&&d&&d();return!1}var n=function(){var a=["#ffffff","#000000"],b=new Rb(c?c.color:null);return b.za&&-1<a.indexOf(b.za.toLowerCase())}(),p=f.ka.get(0).getBoundingClientRect(),q=null,u=b.offset();Nh(f);$(document).on("mouseup",m);$(document).on("mousemove",l);var r=a.pageX,w=a.pageY;
return!1}var f=a;(a=b.data("mousedownHandler"))&&b.off("mousedown",a);b.on("mousedown",e).data("mousedownHandler",e)}function Hm(a){function b(a){return a.which===dh?(null!==d.Pa?c():(d.close(),$("#content").off("keydown",b)),a.stopPropagation(),!1):a.which===ch&&null!==d.Pa?(c(),a.stopPropagation(),!1):!0}function c(){null!==d.Pa&&(Nh(d),d.la.focus())}var d=a;$("#content").on("keydown",b)}
Oh.prototype.render=function(){var a=this,b=$b(a.jc.Rb()),c=0<a.la.find(".picker").length,b=a.la.find("li").length-1!==b.length;a.la.find(".colorOption").remove();$b(a.jc.Rb()).forEach(function(b){var e=Im(b);b=Qb(b);Gm(a,e,b);c?e.insertBefore(a.cb):a.la.append(e)});!c&&Jm(a);b&&a.la.append(a.cb);Fm(a,!1);a.ka.show();a.zd&&$(document).off("mousedown",a.zd);a.zd=function(b){var c=a.la.get(0),f=b.target===c,c=jQuery.contains(c,b.target);if(!f&&!c){if(null===a.Ec)return a.Pa&&(Mh(a),Nh(a)),!0;$(document).off("mousedown",
a.zd);a.close()}a.Pa&&(c=a.Pa.element.get(0),f=b.target===c,b=jQuery.contains(c,b.target),f||b||(Mh(a),Nh(a)));return!1};$(document).on("mousedown",a.zd);Hm(a);null===a.Ec?a.ka.addClass("static"):(b=$('<div class="scrollBar"><div class="scrollHandle"></div></div>'),a.ka.prepend(b),a.la.wrapInner('<div class="inner"></div>'),new ii(b,a.la));a.Qf=!0};Oh.prototype.close=function(){this.Qf&&(this.Mc&&Mh(this,this.Mc),this.la.empty(),this.ka.hide(),this.Pa&&this.Pa.element.remove());this.Qf=!1;this.stopListening()};
function Im(a){return $('<li class="colorOption" style="background-color:'+a+'"><a href="#">'+a+"</a></li>")}
function Jm(a){a.cb=$('<li class="picker"><a href="#">Add a color</a></li>');a.la.append(a.cb);a.cb.on("mousedown",function(b){var c=$("#canvaDocument"),d=c.offset()||{left:0,top:0};0<a.Ie.parents("#canvaDocument").length?(d.left-=c.scrollLeft(),d.top-=c.scrollTop()):(d.left=0,d.top=0);c=b.pageX-d.left;b=b.pageY-d.top;c+214>$("#canvaDocument").width()&&(c-=214);a.oh={x:c,y:b};Km(a);return!1});a.la.show();a.cb.show()}
function Km(a){function b(){d.removeClass("notChanged").css("background",a.Mc.color)}var c=null===a.Ec?$("#content"):a.Ie,d=Im("transparent");d.css("background",a.rd.color).addClass("notChanged").insertBefore(a.cb);a.Pa=new Sk(a.rd,function(c){Em(a,c);b();Gm(a,d,c,b)},function(b){Em(a,b)},function(){Mh(a);Nh(a)});a.Pa.element.appendTo(c).css("top",a.oh.y).css("left",a.oh.x);a.Rc&&a.Rc.data("picker",a.Pa.element);a.cb.hide()};function Lm(){}Lm=Backbone.View.extend({className:"searchGroup",template:_.template('<h2><%- title %></h2><ul class="gallery"></ul>')});Lm.prototype.initialize=function(a){this.jd=this.model;this.Zi=a.Sg;this.Ef=!1;this.listenTo(this.jd,"results:willFetch",this.ce);this.listenTo(this.jd,"results:didFetch",this.Kb);!a.el&&this.render();this.$el.data("view",this)};y=Lm.prototype;y.render=function(){this.$el.html(this.template({title:this.jd.Ea()}));this.$(".gallery").addClass(this.Zi);return this};
y.ce=k();y.Kb=function(a,b,c){if(!c){this.$el.addClass("hasContent");var d=this.$(".gallery");0<b.length?(b.forEach(function(a){a=em.Eh(a);a.$el.appendTo(d);a instanceof gm&&d.addClass("gridGallery").removeClass("photoGallery")}),this.Ma()):0===this.jd.Lc.length&&(d.remove(),this.$(".noResults").remove(),this.$el.append("<p class=\"noResults\">Sorry, we couldn't find any results. We'll get right on it. Maybe try something related?</p>"))}};y.Ma=function(){Rd(this.$(".gallery"))};
y.compact=function(){Td(this.$el,!0)};y.q=function(a,b){var c=0===a?0:"";b?this.$el.css("height",a).css("padding",c):this.$el.addClass("doNotTransition").css("height",a).css("padding",c).removeClass("doNotTransition")};function Mm(a,b){a.$el.addClass("doNotTransition").css("height","+="+b).removeClass("doNotTransition")}function Nm(a){var b=a.Y();return a.$el.nextAll().toArray().filter(function(a){return $(a).offset().top>=b}).map(function(a){return $(a).data("view")})}
function Om(a){var b=Nm(a);if(0===b.length)return 0;a=b.slice(0).sort(function(a,b){return a.Q()-b.Q()});b=b.slice(0).sort(function(a,b){return b.Y()-a.Y()});a=a[0];return b[0].Y()-a.Q()}y.Cd=k();y.Eg=k();function jm(){}jm=Lm.extend({});jm.prototype.initialize=function(a){this.rc=null;this.Qg=0;Lm.prototype.initialize.apply(this,arguments);a.el&&this.$(".gallery li").each(function(){var a=new em({el:this});$(this).data("view",a)})};
jm.prototype.Cd=function(a,b){var c=a.$el,d=Nm(a),e=c.height(),e=c.data("originalTop")+e,f=Pm(this,e);this.$el.addClass("folderExpanded");c.addClass("folderExpanded");d.forEach(function(a){hm(a,Math.min(b,f),!0)});b>f&&window.setTimeout(function(){d.forEach(function(a){hm(a,b,!1)})},Da);this.q(e,!0);this.Qg=b;null===this.rc&&(c=Om(a),e=this.$el.next(),this.rc=$('<div class="spacer"></div>'),this.rc.css("height",c).insertAfter(e))};
jm.prototype.Eg=function(a){var b=Nm(a),c=this.Qg-Pm(this);0<c&&b.forEach(function(a){var b=-c;a.$el.addClass("doNotTransition").css("top","+="+b).removeClass("doNotTransition")});this.$el.removeClass("folderExpanded");a.$el.removeClass("folderExpanded");b.forEach(function(a){hm(a,0,!0)});var d=this;window.setTimeout(function(){d.compact();d.rc&&d.rc.remove();d.rc=null},1.2*Da)};
function Pm(a,b){void 0===b&&(b=a.$el.height());var c=a.$el.parents(".layer").outerHeight(!0),d=a.$el.position().top;return c-(d+b)}function gk(a){var b=a.$el.height();a=a.rc?a.rc.height():0;return b+a}function Qm(){}Qm=Lm.extend({className:"inlineFolderGroup searchGroup",template:_.template('<ul class="gallery"></ul>')});Qm.sd=150;Qm.prototype.initialize=function(a){this.xb=null;Lm.prototype.initialize.apply(this,arguments);this.render();this.q(0,!1)};
Qm.prototype.remove=function(){var a=this,b=this.$(".infoPanel .close"),c=0<b.length,d=this.$el.offset(),e=this.$el.parent(),f=d.top+this.$el.outerHeight(),g=e.offset().top+e.outerHeight(),f=f-g;this.Ef=!0;c&&b.trigger("click");if(0<f){Mm(this,-f);var h=e.outerHeight()-d.top;this.$(".gallery li").each(function(){var a=$(this).data("originalTop");(a>=h||a<-d.top)&&$(this).remove()})}this.$el.one("transitionend",function(){Lm.prototype.remove.apply(a,arguments);a.Ef=!1}).addClass("disappearing");if(this.xb)this.xb.css("opacity",
0).one("transitionend",function(){$(this).remove();a.xb=null})};Qm.prototype.ce=function(){0===this.jd.Lc.length&&ki(this.$el);Lm.prototype.ce.apply(this,arguments)};Qm.prototype.Kb=function(a,b,c){oi(this.$el);Lm.prototype.Kb.apply(this,arguments);var d=this;window.setTimeout(function(){d.compact()},300)};Qm.prototype.compact=function(){if(0!==this.model.Lc.length){var a=this;Lm.prototype.compact.apply(this,arguments);window.setTimeout(function(){a.$el.height()<Qm.sd&&a.q(Qm.sd,!0)},Da)}};
function Rm(a){if(null===a.xb){var b=a.$el.parents(".layer");a.xb=$('<div class="folder header clone"><a class="close" href="#" title="Close this folder">Close</a><h2><span>'+_.escape(a.jd.Ea())+"</span></h2></div>");a.xb.css("opacity",0).insertAfter(b).delay(20,function(){$(this).css("opacity","")});a.xb.find("a.close").one("touchClick",function(){a.trigger("headerClose:click",a)})}}
function Sm(a){if(null!==a.xb){var b=a.xb;a.xb=null;b.css("opacity",0).one("transitionend",function(){$(this).remove()})}};function Tm(){}Tm=Backbone.View.extend({tagName:"section",className:"layer"});Tm.prototype.events=function(){var a={};a.scroll=_.throttle(this.scroll,200);return a};Tm.prototype.initialize=function(a){this.hd=this.model;this.ja=[];this.Me=[];this.Bf=!1;this.listenTo(this.hd,"searchGroup:add",this.ud);this.listenTo(this.hd,"searchGroup:remove",this.bg);this.listenTo(this.hd,"results:willFetch",this.ce);this.listenTo(this.hd,"results:didFetch",this.Kb);!a.el&&this.render();this.$el.data("view",this)};
y=Tm.prototype;y.render=function(){this.$el.empty();this.ja.forEach(function(a){this.$el.append(a.$el)});this.$el.append('<div class="searchLoaderHolder"></div>');return this};y.scroll=function(){var a=!1;this.ja.forEach(function(b){a=a||b.Ef});!a&&this.je()};
y.je=function(){var a=this.$el.parent(),b=this.ja[this.ja.length-1],c=this.hd.Va[this.hd.Va.length-1];if(0!==a.length&&b&&c&&!this.Bf){var d;if(d=c.xe)b=b.$el.offset().top+b.$el.outerHeight(),d=a.offset().top+a.outerHeight(),d=b-d<=0.33*a.outerHeight();d&&(a=this.$("> .inner > .searchGroup .gallery li").length,500<a&&fj(this.$el,a-500),this.Bf=!0,nk(c,Um(this)));c.xe||this.$el.data("userPreparedSearch",!0)}};
y.ud=function(a,b,c){(a=this.ja[c-1])&&a.compact();b=new Lm({model:b,Sg:"infoPanelGallery photoGallery"});this.ja.splice(c,0,b);b.$el.insertAfter(a.$el)};y.bg=function(a,b,c){a=this.ja[c];this.ja.splice(c,1);a.remove()};y.ce=function(a){this.Me.push(a);ki(this.$el)};y.Kb=function(a,b){var c=this.Me.indexOf(a);-1<c&&this.Me.splice(c,1);0===this.Me.length&&oi(this.$el);this.Bf=!1;if(a.xe){var d=this;setTimeout(function(){a===d.model.Va[d.model.Va.length-1]&&d.je()},b.length*Ea+Fa)}};
function Um(a){a=a.$el.parent();return mi(a,a.height())}function im(){}im=Tm.extend({});im.prototype.events=function(){var a=Tm.prototype.events.apply(this,arguments);a["mousedownTouchstart .albumGallery a"]=this.Wh;a["click .albumGallery a"]=t(!1);a["mousedown .albumGallery a img"]=function(a){a.preventDefault()};a["touchClick .inlineFolderGroup > .header a.close"]=this.Dg;a.mousedown=this.ci;return a};
im.prototype.initialize=function(a){Tm.prototype.initialize.apply(this,arguments);this.ke=!1;this.qe=0;this.Jd=$();this.listenTo(L,"infoPanelToggle",this.ej)};function Vm(a){a=a.ja.filter(function(a){return a instanceof Qm});return 0<a.length?a[0]:null}y=im.prototype;
y.scroll=function(a){Tm.prototype.scroll.apply(this,arguments);var b=Vm(this);if(b){var c=parseInt(b.$el.css("margin-top"),10),d=parseInt(b.$el.css("margin-bottom"),10),e=b.$el.outerHeight(!1),c=b.$el.position().top+c;0<c||c+e<d?Sm(b):Rm(b)}};y.je=function(){this.$el.data("userPreparedSearch")?ei.call(this.el):Tm.prototype.je.apply(this,arguments)};
y.ci=function(a){if(a.target===this.el||"li"===a.target.nodeName.toLowerCase()&&0<$(a.target).parents(".browseCategories").length)return(a=this.ja[0].$("li.folderExpanded").data("view"))&&Wm(this,a),!1};
y.Wh=function(a){function b(a){var b=f.attr("title"),m=f.data("query"),m=ok(m),n=new mk(m,b);lk(e,n,1);b=c.ja[1];Xm(c,Qm.sd);d.Cd(g,c.qe);0===Om(a)&&b.$el.addClass("end");c.listenTo(b,"headerClose:click",function(){c.Dg()});c.Jd.remove();c.Jd=$('<div class="inlineFolderPointer"></div>');c.Jd.css("left",g.Qb()+parseInt(c.$el.css("padding-left"),10)).insertBefore(b.$el);ki(b.$el);setTimeout(function(){nk(n,Um(c))},1.2*Da);c.$el.removeData("userPreparedSearch")}var c=this,d=this.ja[0],e=this.model,f=
$(a.currentTarget),g=f.parent().data("view");a=d.$el.hasClass("folderExpanded")&&!g.$el.hasClass("folderExpanded");g.$el.hasClass("folderExpanded")?Wm(this,g):a?(a=d.$("li.folderExpanded").data("view"),Wm(this,a)):this.ke||b(g);return!1};y.Dg=function(){var a=this.$(".gallery .folderExpanded").data("view");!this.ke&&Wm(this,a)};
function Wm(a,b){var c=a.ja[0],d=a.model;if(1<d.dc()){a.ke=!0;var e=d.Va[d.Va.length-1],f=Vm(a);a.stopListening(f);d.bg(e);a.Jd&&setTimeout(function(){a.Jd.remove();a.ke=!1},Da)}c.Eg(b);Xm(a,0);a.$el.data("userPreparedSearch",!0)}y.ud=function(a,b,c){(a=this.ja[c-1])&&a.compact();var d=new Qm({model:b,Sg:"infoPanelGallery photoGallery"});this.ja.splice(c,0,d);d.$el.insertAfter(a.$el).delay(20,function(){d.q(Qm.sd-72,!0)})};y.Kb=function(a,b,c){Tm.prototype.Kb.apply(this,arguments);hk(this,!0)};
function hk(a,b){var c=a.ja[0],d=Vm(a),e=c.$("li.folderExpanded").data("view");if(e){var f=d.$el.outerHeight(!0)-d.$el.height(),g=d.$el.data("contentHeight")||0,f=f+g,h=Oi(d.$el),l=Math.max(f,Qm.sd),d=c.$el.find("li");b?c.Cd(e,l+h):d.addClass("doNotTransition").delay(20,function(){c.Cd(e,l+h);$(this).delay(20,function(){$(this).removeClass("doNotTransition")})});Xm(a,l)}}
y.ej=function(a,b){var c=Vm(this);if(c&&c.el===a.get(0)){var c=this.ja[0],d=c.$("li.folderExpanded").data("view");c.Cd(d,this.qe+b)}};function Xm(a,b){var c=b-a.qe;a.qe=b;a.ja[0].$el.nextAll(".searchGroup:not(.inlineFolderGroup)").find(".infoPanel, .infoPanelPointer").one("transitionend",function(){$(this).removeClass("transitionTop")}).addClass("transitionTop").delay(20,function(){$(this).css("top","+="+c)})};function Jh(){}Jh=Backbone.View.extend({tagName:"ul",className:"textControls",oj:_.template('<li style="text-align: <%- justification %>; color: <%= color %>"><a class="add" href="#" style="font-family: \'<%= fontFamily %>\'; font-weight: <%= bold ? "bold" : "normal"%>; font-style: <%= italic ? "italic" : "normal"%>; font-size: <%= fontSizePercentage %>%; color: <%= color %>;" data-style="<%= style %>"><%= placeholderText %></a></li>')});
Jh.prototype.events=function(){var a={};a["touchClick a.add:not(.editing)"]=this.Th;a["mousedownTouchstart a.add"]=this.uj;a["touchClick a.add.editing:not(.active)"]=this.oi;a["touchClick a.change"]=this.Xh;return a};Jh.prototype.initialize=function(){this.ee=0;this.render();this.listenTo(this.model,"change:defaultFont",this.sk);this.ge=!1};y=Jh.prototype;
y.render=function(){var a=this.model;this.$el.empty();for(var b in Lf){var c=Lf[b];Qc(a,c);c=Ym(this,c);this.$el.append(c)}this.$el.append('<li><a class="change" href="#">Change defaults</a></li>');Zm(this);return this};function Zm(a){function b(){c++}var c=0;a=a.model;for(var d in Lf){var e=Qc(a,Lf[d]).fontFamily;me(e,b)}}
function Ym(a,b){var c={title:32,subtitle:18,body:14},d=$.extend(!0,{},a.model.Pc[b]),e=$.extend(!0,{},a.model.vd[b]),e=_.extend({},{bold:!1,italic:!1,justification:"center",color:"auto",placeholderText:{title:"Add text",subtitle:"Add subtitle text",body:"Add a little bit of body text"}[b],style:b},e,d);void 0===d.fontSize&&(e.fontSize=c[b]);e.fontSizePercentage=e.fontSize*Ra;c=le(e.fontFamily);e.fontFamily=c.k;return $(a.oj(e))}
y.sk=function(a,b,c){a=this.$el.find("[data-style="+b+"]");var d=a.parent(),e=Ym(this,b);a.hasClass("active")&&e.find("a").addClass("active");a.hasClass("editing")&&e.find("a").addClass("editing");me(c.fontFamily,function(){d.replaceWith(e)})};
y.Th=function(a){var b=this.model,c=$(a.currentTarget);a=c.data("style");var d=Qc(this.model,a),e=$m(this,c);e.find("a").css("font-size",d.fontSize*Ra+"%");e.css("font-size","100%").css("opacity",0).appendTo("#content");d=e.width();e.remove();c={style:a,width:1.02*d,html:c.text(),placeholderText:c.text()};_.extend(c,Qc(b,a));V();var f=T(C);new Sc(c,function(a){f.addElement(a,!0);vi(a)});this.ge=!0;_gaq.push(["_trackEvent","Object Panel","Click - Text: "+a]);return!1};
function $m(a,b){var c=T(C).Ae(),d=Qc(a.model,b.data("style")),e=b.clone(),f=parseInt(a.el.style.fontSize||100,10)/100,g=parseInt(b.get(0).style.fontSize||100,10)/100;e.css("width",b.width()).css("height",b.height()).css("white-space","nowrap").css("color",d.color||"inherit").css("font-size",100*f*g+"%");d=$('<div class="textControls clone text"></div>');d.css("font-size",100*N+"%").css("color",c?"white":"black").append(e);return d}
y.uj=function(a){function b(a){var g=void 0!==a.clientX?a.clientX:a.touches[0].clientX;a=void 0!==a.clientY?a.clientY:a.touches[0].clientY;if(d.ge)return z.off("mousemove|touchmove",b).off("mouseup|touchend",c),l&&l.remove(),f.removeClass("picked"),d.ge=!1,e.css("opacity",1),!1;if(null==l)if(ti(z)){var p=ec(w,v,g,a);if(300<p||60>p)l=$m(d,e),e.css("opacity",0),$("#content").append(l),f.addClass("pickedUp");else return!0}else if(4<Math.abs(g-w)||4<Math.abs(a-v))l=$m(d,e),e.css("opacity",0),$("#content").append(l),
f.addClass("pickedUp");if(null!=l){p=h.top+a-v;l.css("left",h.left+g-w).css("top",p);var Z=Math.min(1,Math.sqrt(Math.pow(g-w,2)+Math.pow(a-v,2))/x),p=100*(1+(q-1)*Z)+"%",M=H.map(function(a){return Math.round(255-(255-a)*Z)});l.css("font-size",p).css("color","rgb("+M[0]+","+M[1]+","+M[2]+")");(g<n.left||g>n.left+m.outerWidth()||a<n.top||a>n.top+m.outerHeight())&&l&&!l.hasClass("disappeared")&&!l.hasClass("placing")&&Si(u,l)?(null==A&&(A=new rb(l,r)),Ti(A,J)):$("#overlays .align").removeClass("on")}return!1}
function c(a){function g(){$(this).remove();e.css("visibility","visible").css("opacity","");f.removeClass("pickedUp")}function h(){setTimeout(function(){e.one("transitionend",function(){$(this).removeClass("reappearing")}).css("visibility","").addClass("reappearing").css("opacity","");f.removeClass("pickedUp")},20)}z.off("mousemove|touchmove",b).off("mouseup|touchend",c);$("#overlays .align").removeClass("on");$("#content").trigger("mousedown");V();var q=void 0!==a.clientX?a.clientX:a.changedTouches[0].clientX;
a=void 0!==a.clientY?a.clientY:a.changedTouches[0].clientY;if(null==l&&4>Math.abs(q-w)&&4>Math.abs(a-v))return!1;if(null!=l)if((q<n.left||q>n.left+m.outerWidth()||a<n.top||a>n.top+m.outerHeight())&&l&&!l.hasClass("disappeared")&&Si(u,l)){var r=e.data("style"),q={type:"text",style:r,left:A.l(),top:A.j(),width:A.g(),html:e.text(),placeholderText:e.text()};_.extend(q,Qc(d.model,r));q=ze(q);q.appendTo(T(C));vi(q);De(q);Il(q.i);l.remove();h();_gaq.push(["_trackEvent","Object Panel","Click - Text: "+r])}else null==
l||l.hasClass("disappeared")?null!=l&&l.hasClass("disappeared")&&h():(q=e.offset(),l.addClass("returning"),l.one("transitionend",g).css("left",q.left).css("top",q.top).css("font-size",100*p+"%").css("color","white")),_gaq.push(["_trackEvent","Object Panel","Drag Invalid - Default Text",r])}var d=this,e=$(a.currentTarget),f=e.parent("li"),g=$(a.currentTarget).data("style"),h=e.offset();e.width();e.height();var l=null,m=$("#objectPanel"),n=m.offset(),g=Qc(this.model,g),p=parseInt(e.get(0).style.fontSize,
10)/Ra*(parseInt(this.el.style.fontSize||100,10)/100)/g.fontSize,q=1/p*N,u=Xi(),r=u.offset(),w=void 0!==a.clientX?a.clientX:a.touches[0].clientX,v=void 0!==a.clientY?a.clientY:a.touches[0].clientY,x=Math.abs(w-(n.left+m.outerWidth())),z=new S($(document));z.on("mousemove|touchmove",b).on("mouseup|touchend",c);var A=null,J=Yi();a=T(C).Ae();var H;H=g.color?Tb(new Rb(g.color)):a?[255,255,255]:[0,0,0];d.ge=!1;return Zi};
y.Xh=function(a){var b=this,c=$(a.currentTarget);if(!(0<this.ee)){var d=function(a){var c=$(a.target),d=0<c.parents().filter(b.Ua.$el).length,e=a.target==b.el||0<c.parents().filter(b.$el).length,n=0<$(".dd-container.on, .toolbarDropdown").length,p=$(".paletteToolbarWrapper, .colorPicker"),c=0<p.find(c).length||0<p.filter(c).length;d||e||n||c||(a.stopPropagation(),a.preventDefault(),f())},e=function(){f();return!1},f=function(){c.text("Change defaults").off("click",e);b.$el.removeClass("editing");
b.$el.find(".editing").removeClass("editing");b.$el.find(".active").removeClass("active");b.Ua.remove();b.Ua=null;b.stopListening(b.Ig,"change");document.removeEventListener("mousedown",d,!0);document.removeEventListener("click",d,!0);lh()};this.Ua||(kh(),c.text("Save defaults"),V(),an(this,"title"),document.addEventListener("mousedown",d,!0),document.addEventListener("click",d,!0),c.one("click",e));return!1}};
function bn(a,b){var c=a.$el.find("a[data-style="+b+"]");return c.offset().top+c.height()/2}
function an(a,b){var c=$.extend(!0,{},a.model.Pc[b]),d=$.extend(!0,{},a.model.vd[b]),c=new Ng(c);a.$el.addClass("editing");a.$el.find("a").removeClass("active").addClass("editing");a.$el.find("a[data-style="+b+"]").addClass("active");a.Ua=new cn({model:c,kf:new Ng(d),root:$("#content"),pf:!0,yf:[dn]});a.Ua.render();a.Ua.$el.appendTo("#content").css("left",a.$el.offset().left+a.$el.outerWidth()+20).css("top",bn(a,b)-a.Ua.$el.outerHeight()/2);a.Ig=c;a.currentStyle=b;a.listenTo(a.Ig,"change",a.Fj)}
y.Fj=function(a){var b=this.model;a=a.serialize();var c=$.extend(!0,{},b.Pc[this.currentStyle]);Pc(b,this.currentStyle,a);Q(D,new Bj(1,{style:this.currentStyle,"new":a,old:c}))};
y.oi=function(a){if(!(0<this.ee)){var b=this;a=$(a.currentTarget);var c=a.data("style"),d=bn(this,c)-this.Ua.$el.outerHeight()/2;this.$el.find("a").removeClass("active");a.addClass("active");this.ee++;this.Ua.$el.animate({top:d},300,function(){var a=b.Ua;an(b,c);b.Ua.$el.addClass("borderLess");setTimeout(function(){b.Ua&&b.Ua.$el.removeClass("borderLess");a&&a.remove();b.ee--},500)});return!1}};function cn(){}
var cn=Backbone.View.extend({tagName:"menu",className:"textToolbar",template:_.template('<li class="textToolbarFont"><select class="textToolbarFontFamily"><%= fontFamilyOptionsHtml %></select><span class="textToolbarFontFamilySpan"><%= fontFamily %></span><select class="textToolbarFontSize"><%= fontSizeOptionsHtml %></select><span class="textToolbarFontSizeSpan"><input type="text" autocomplete="off" value="<%= fontSize %>"></span></li><li class="textToolbarBold <%= bold ? "on" : "" %>"><a href="#" title="Bold">Bold</a></li><li class="textToolbarItalic <%= italic ? "on" : "" %>"><a href="#" title="Italic">Italic</a></li><li class="textToolbarJustification <%= justification %>"><a href="#" title="Justification">Justification</a></li><li class="textToolbarList"><a href="#" title="Bulleted list">Unordered/ordered list</a></li><li class="textToolbarColor"><a class="pickAColor" href="#" title="Pick a color"><span class="<%= color ? "" : "noColor" %>" style="<%= color ? "background-color: " + color : "" %>">Pick a color</span></a></li></menu>'),jj:_.template('<menu class="toolbarDropdown"><li data-justification="left" class="justificationDropdownLeft <%= justification == "left" ? "on" : "" %>"><a href="#">Left</a></li><li data-justification="center" class="justificationDropdownCenter <%= justification == "center" ? "on" : "" %>"><a href="#">Center</a></li><li data-justification="right" class="justificationDropdownRight <%= justification == "right" ? "on" : "" %>"><a href="#">Right</a></li></menu>')}),
dn="List";cn.prototype.events=function(){var a={"touchClick .textToolbar a":t(!1)};a["touchClick .textToolbarBold a"]=this.Vh;a["touchClick .textToolbarItalic a"]=this.gi;a["touchClick .textToolbarJustification a"]=this.hi;a["touchClick .textToolbarColor a"]=this.Yh;a["change .textToolbarFontFamily"]=this.Ph;a["change .textToolbarFontSize"]=this.Qh;return a};cn.prototype.initialize=function(a){this.kf=a.kf;this.root=a.root;this.pf=a.pf;this.yf=a.yf||[];this.listenTo(this.model,"change",this.render)};
y=cn.prototype;y.remove=function(){this.zb&&this.zb.close();this.$(".dd-container").ddslick("destroy");Backbone.View.prototype.remove.apply(this,arguments)};
y.render=function(){var a=en(),b=Mg().map(function(a){a=a.name||a.k;return'<option data-image-src="/static/images/fonts/'+a.replace(/ /g,"-")+Pa+'.png">'+a+"</option>"}).join(""),a=a.map(function(a){return'<option data-text="'+a+'">'+a+"</option>"}).join(""),c=$.extend(!0,this.kf.serialize(),this.model.serialize());c.fontFamilyOptionsHtml=b;c.fontSizeOptionsHtml=a;this.$el.html(this.template(c));this.pf&&this.$el.addClass("pointer");this.$(".textToolbarFontFamily").val(this.model.sf);this.$(".textToolbarFontSize").val(this.model.cc());
this.$(".pickAColor span");fn(this);var d=this;this.yf.forEach(function(a){a="textToolbar"+a;d.$("."+a).removeClass(a).addClass("disabled")});return this};function en(){return[12,14,16,18,21,24,28,32,36,42,48,56,64,72,80,88,96,104,120,144]}
function fn(a){function b(){$("#overlays > .mask").removeClass("on ddslick")}function c(a){var b=en();$(this);$("#overlays > .mask").removeClass("on ddslick");$("#null").focus();if(!a.didSelectAnOption){var c=d.model.cc(),e=h.find("input"),f=parseFloat(e.val()),g=a.lastKeyBeforeSelect;"enter"!=g&&"tab"!=g||isNaN(f)?(e.val(Ok(c)),"enter"==g&&(a.cancel=!0,e.select())):(-1===b.indexOf(f)&&$(this).ddslick("deselect"),a=Math.max(Math.min(400,f),8),d.model.ob(a))}}var d=a,e=a.$(".textToolbarFontFamily"),
f=a.$(".textToolbarFontFamilySpan");if(!e.hasClass("dd-container")){var g={onClose:b};e.ddslick(g)}(new S(f)).on("mousedown+touchstart",function(){var a=$(this).siblings(".textToolbarFontFamily");$("#overlays > .mask").addClass("on ddslick");a.ddslick("open");return!1});var e=a.$(".textToolbarFontSize"),h=a.$(".textToolbarFontSizeSpan");$(e).hasClass("dd-container")||(g={onClose:c,width:"6em",align:"bottom",linkedControl:h.find("input").get(0)},$(e).ddslick(g));(new S(h)).on("mousedown+touchstart",
function(a){var b=$(this).siblings(".textToolbarFontSize"),c=$(this).find("input");if(b.hasClass("on"))a.target===a.currentTarget&&b.ddslick("close");else return c.select(),$("#overlays > .mask").addClass("on ddslick"),b.ddslick("open"),!1})}y.Ph=function(a){a=$(a.currentTarget);this.model.Vb(a.val())};y.Qh=function(a){a=$(a.currentTarget);a=parseInt(a.val(),10);this.model.ob(a)};y.Vh=function(){var a=this.model;a.oc(!a.ef)};y.gi=function(){var a=this.model;a.pc(!a.Hf)};
y.hi=function(a){function b(){e.animate({height:0},Ba,"linear",function(){d.removeData("dropdown");$(this).remove()})}function c(a){$(document).off("mousedown",c);var e=d.get(0);a.target==e||jQuery.contains(e,a.target)||b()}var d=$(a.currentTarget).parents("li"),e=d.data("dropdown");a=this.$el;var f=this.model;null!=e?b():(e=$(this.jj(f.serialize())),d.data("dropdown",e),e.on("mousedown",!1).on("click",!1).css("left",d.offset().left).css("top",a.offset().top+a.outerHeight()).insertAfter(this.$el),
a=e.outerHeight(),e.css("height",0).animate({height:a},Ba,"easeOutSine",function(){$(this).css("height","")}),$("a",e).on("click",function(){var a=$(this).parents("li").data("justification");f.Bb(a);b();_gaq.push(["_trackEvent","Default Fonts Toolbar","Click - Justification Option",a]);return!1}),$(document).on("mousedown",c));_gaq.push(["_trackEvent","Toolbar","Click - Justification"])};
y.Yh=function(a){function b(a){d.model.setColor(a.color)}this.zb&&this.zb.close();this.zb=new Oh(this.root,C);var c=Qb(this.model.hf),d=this;Rk(this.zb,this.$el);c&&(this.zb.rd=c);Dm(this.zb,$(a.target).parents("li"));this.zb.on("select",b);this.zb.on("confirm",b);this.zb.render()};})();
